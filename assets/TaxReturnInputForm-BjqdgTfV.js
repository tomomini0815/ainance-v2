import{j as e,P as H,q as K,r as N,a as Q,e as V,l as X,F as Z,U as ee,G as j}from"./index-BcSqN67S.js";import{I as U}from"./info-B-EBZxQ1.js";import{g as S,d as A}from"./pdfAutoFillService-D9m2-S6q.js";import{C as te}from"./credit-card-DKh9ApXu.js";import{A as se}from"./activity-C2gNCHS5.js";import{g as ae}from"./motion-B-OgmNda.js";import{E as ne}from"./eye-Ch9b8lqi.js";import{R as L}from"./refresh-cw-C86QBMAj.js";import{S as le}from"./save-BCLCohis.js";import{D as re}from"./download-CFylH2lV.js";import{W as ie}from"./wrench-LeAKhOIg.js";const k={fiscalYear:new Date().getFullYear()-1,income:{business_agriculture:0,real_estate:0,employment:0,miscellaneous_public_pension:0,miscellaneous_other:0,capital_gains:0,occasional:0},deductions:{medical_expenses:0,social_insurance:0,small_business_mutual_aid:0,life_insurance:0,earthquake_insurance:0,donation:0,widow_single_parent:0,working_student:0,spouse:0,dependents:0,basic:48e4},tax_calculation:{withholding_tax:0,foreign_tax_credit:0},refund_account:{bank_name:"",branch_name:"",account_type:"ordinary",account_number:""},withholding_tax_details:[],insurance_premium_details:{life_insurance:[],earthquake_insurance:[],social_insurance:[]},family_details:{spouse:null,dependents:[]},resident_tax:{collection_method:"ordinary",dependent_under_16_names:[]},blue_return_pl:{beginning_inventory:0,ending_inventory:0},blue_return_bs:{items:[{id:"1",asset_liability_type:"asset",account_name:"現金",beginning_balance:0,ending_balance:0},{id:"2",asset_liability_type:"asset",account_name:"預金",beginning_balance:0,ending_balance:0},{id:"3",asset_liability_type:"asset",account_name:"売掛金",beginning_balance:0,ending_balance:0},{id:"4",asset_liability_type:"asset",account_name:"棚卸資産",beginning_balance:0,ending_balance:0},{id:"5",asset_liability_type:"asset",account_name:"車両運搬具",beginning_balance:0,ending_balance:0},{id:"6",asset_liability_type:"asset",account_name:"工具器具備品",beginning_balance:0,ending_balance:0},{id:"7",asset_liability_type:"liability",account_name:"買掛金",beginning_balance:0,ending_balance:0},{id:"8",asset_liability_type:"liability",account_name:"借入金",beginning_balance:0,ending_balance:0},{id:"9",asset_liability_type:"equity",account_name:"元入金",beginning_balance:0,ending_balance:0}]},employee_salaries:[]},T="ainance_tax_return_input_data",D={saveData:t=>{try{localStorage.setItem(T,JSON.stringify(t))}catch(i){console.error("Failed to save tax return input data:",i)}},getData:()=>{try{const t=localStorage.getItem(T);if(t){const i=JSON.parse(t);return{...k,...i}}}catch(t){console.error("Failed to load tax return input data:",t)}return k},resetData:()=>{try{localStorage.removeItem(T)}catch(t){console.error("Failed to reset tax return input data:",t)}},updateData:t=>{const x={...D.getData(),...t};return D.saveData(x),x},calculateDataFromTransactions:t=>{const i={income:{...k.income},deductions:{...k.deductions}},x=u=>typeof u.amount=="number"?u.amount:typeof u.amount=="string"?parseFloat(u.amount.replace(/,/g,"")):0,m=t.filter(u=>u.type==="income").reduce((u,d)=>u+x(d),0);return i.income&&(i.income.business_agriculture=m),t.filter(u=>u.type==="expense").forEach(u=>{const d=x(u),a=(u.category||"").toString(),n=(u.item||"").toString(),p=(u.description||"").toString(),r=`${a} ${n} ${p}`;i.deductions&&(r.includes("医療費")?i.deductions.medical_expenses+=d:r.includes("社会保険")||r.includes("年金")||r.includes("健康保険")?i.deductions.social_insurance+=d:r.includes("生命保険")?i.deductions.life_insurance+=d:r.includes("地震保険")?i.deductions.earthquake_insurance+=d:(r.includes("寄付")||r.includes("ふるさと納税"))&&(i.deductions.donation+=d))}),i}},ce=({data:t,onChange:i})=>{const x=(a,n)=>{i({income:{...t.income,[a]:n}})},m=(a,n)=>{i({deductions:{...t.deductions,[a]:n}})},u=(a,n)=>{i({tax_calculation:{...t.tax_calculation,[a]:n}})},d=(a,n)=>{i({refund_account:{...t.refund_account,[a]:n}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-info-light border border-info/20 p-4 rounded-lg flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-info flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-text-main text-sm",children:"第一表の手動入力について"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"取引データから自動計算された「事業所得」以外の収入や、手動入力が必要な控除項目を入力します。 入力した値は自動計算結果に加算または上書きされます。"})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:["収入金額等",e.jsx("span",{className:"text-xs font-normal text-text-muted ml-2",children:"事業（営業等）以外の収入がある場合に入力"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{label:"事業",value:t.income.business_agriculture,onChange:a=>x("business_agriculture",a)}),e.jsx(_,{label:"不動産",value:t.income.real_estate,onChange:a=>x("real_estate",a)}),e.jsx(_,{label:"給与",value:t.income.employment,onChange:a=>x("employment",a)}),e.jsx(_,{label:"雑（公的年金等）",value:t.income.miscellaneous_public_pension,onChange:a=>x("miscellaneous_public_pension",a)}),e.jsx(_,{label:"雑（その他）",value:t.income.miscellaneous_other,onChange:a=>x("miscellaneous_other",a)}),e.jsx(_,{label:"配当",value:t.income.capital_gains,onChange:a=>x("capital_gains",a)}),e.jsx(_,{label:"一時",value:t.income.occasional,onChange:a=>x("occasional",a)})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:["所得から差し引かれる金額",e.jsx("span",{className:"text-xs font-normal text-text-muted ml-2",children:"控除証明書などを元に入力"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{label:"医療費控除",value:t.deductions.medical_expenses,onChange:a=>m("medical_expenses",a),helper:"支払った医療費 - 保険金などで補填される金額 - 10万円（または総所得の5%）"}),e.jsx(_,{label:"社会保険料控除",value:t.deductions.social_insurance,onChange:a=>m("social_insurance",a),helper:"国民健康保険、国民年金（過去分含む）など"}),e.jsx(_,{label:"小規模企業共済等掛金控除",value:t.deductions.small_business_mutual_aid,onChange:a=>m("small_business_mutual_aid",a)}),e.jsx(_,{label:"生命保険料控除",value:t.deductions.life_insurance,onChange:a=>m("life_insurance",a)}),e.jsx(_,{label:"地震保険料控除",value:t.deductions.earthquake_insurance,onChange:a=>m("earthquake_insurance",a)}),e.jsx(_,{label:"寄附金控除",value:t.deductions.donation,onChange:a=>m("donation",a),helper:"ふるさと納税など（寄附金額 - 2,000円）"}),e.jsx(_,{label:"寡婦・ひとり親控除",value:t.deductions.widow_single_parent,onChange:a=>m("widow_single_parent",a)}),e.jsx(_,{label:"勤労学生控除",value:t.deductions.working_student,onChange:a=>m("working_student",a)}),e.jsx(_,{label:"配偶者（特別）控除",value:t.deductions.spouse,onChange:a=>m("spouse",a)}),e.jsx(_,{label:"扶養控除",value:t.deductions.dependents,onChange:a=>m("dependents",a)}),e.jsx(_,{label:"基礎控除",value:t.deductions.basic,onChange:a=>m("basic",a),readOnly:!0})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:"税金の計算"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{label:"源泉徴収税額",value:t.tax_calculation.withholding_tax,onChange:a=>u("withholding_tax",a),helper:"給与や報酬から天引きされた所得税の合計"}),e.jsx(_,{label:"外国税額控除",value:t.tax_calculation.foreign_tax_credit,onChange:a=>u("foreign_tax_credit",a)})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:"還付される税金の受取場所"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"金融機関名"}),e.jsx("input",{type:"text",className:"input-base",value:t.refund_account.bank_name,onChange:a=>d("bank_name",a.target.value),placeholder:"例: みずほ銀行"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"支店名"}),e.jsx("input",{type:"text",className:"input-base",value:t.refund_account.branch_name,onChange:a=>d("branch_name",a.target.value),placeholder:"例: 本店営業部"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"預金種類"}),e.jsxs("select",{className:"input-base",value:t.refund_account.account_type,onChange:a=>d("account_type",a.target.value),children:[e.jsx("option",{value:"ordinary",children:"普通"}),e.jsx("option",{value:"current",children:"当座"}),e.jsx("option",{value:"saving",children:"貯蓄"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"口座番号"}),e.jsx("input",{type:"text",className:"input-base",value:t.refund_account.account_number,onChange:a=>d("account_number",a.target.value),placeholder:"1234567"})]})]})]})]})},_=({label:t,value:i,onChange:x,helper:m,readOnly:u})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:t}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:`input-base pr-8 ${u?"bg-surface-highlight cursor-not-allowed":""}`,value:i===0?"":i,onChange:d=>x(d.target.value===""?0:Number(d.target.value)),readOnly:u,placeholder:"0",onFocus:d=>d.target.select()}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]}),m&&e.jsx("p",{className:"text-xs text-text-muted mt-1",children:m})]});function F({items:t,onAdd:i,onRemove:x,onEdit:m,renderItem:u,title:d,description:a,addButtonLabel:n="追加する",maxItems:p}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-text-main",children:d}),a&&e.jsx("p",{className:"text-sm text-text-muted",children:a})]}),(!p||t.length<p)&&e.jsxs("button",{onClick:i,className:"btn-sm btn-outline flex items-center gap-1",type:"button",children:[e.jsx(H,{className:"w-4 h-4"}),n]})]}),t.length===0?e.jsx("div",{className:"p-4 bg-surface-highlight rounded-lg border border-border border-dashed text-center text-text-muted text-sm",children:"登録データがありません"}):e.jsx("div",{className:"space-y-3",children:t.map((r,w)=>e.jsxs("div",{className:"p-3 bg-surface border border-border rounded-lg relative group",children:[e.jsx("div",{className:"pr-10",children:u(r,w)}),e.jsx("div",{className:"absolute top-3 right-3 flex gap-2 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:()=>x(w),className:"p-1.5 text-error hover:bg-error-light rounded transition-colors",type:"button",title:"削除",children:e.jsx(K,{className:"w-4 h-4"})})})]},w))})]})}const oe=({data:t,onChange:i})=>{const x=()=>{const s={id:Date.now().toString(),name:"",relationship:"",birth_date:"",income:0,living_separately:!1};i({family_details:{...t.family_details,dependents:[...t.family_details.dependents,s]}})},m=(s,o)=>{const l=[...t.family_details.dependents];l[s]=o,i({family_details:{...t.family_details,dependents:l}})},u=s=>{i({family_details:{...t.family_details,dependents:t.family_details.dependents.filter((o,l)=>l!==s)}})},d=(s,o)=>{const l={id:Date.now().toString(),insurance_company:"",insurance_type:"",term:"",beneficiary:"",payment_amount:0,classification:o};i({insurance_premium_details:{...t.insurance_premium_details,[s]:[...t.insurance_premium_details[s],l]}})},a=(s,o,l)=>{const g=[...t.insurance_premium_details[s]];g[o]=l,i({insurance_premium_details:{...t.insurance_premium_details,[s]:g}})},n=(s,o)=>{i({insurance_premium_details:{...t.insurance_premium_details,[s]:t.insurance_premium_details[s].filter((l,g)=>g!==o)}})},p=()=>{const s={id:Date.now().toString(),payer_name:"",income_category:"給与",revenue_amount:0,tax_amount:0};i({withholding_tax_details:[...t.withholding_tax_details,s]})},r=(s,o)=>{const l=[...t.withholding_tax_details];l[s]=o,i({withholding_tax_details:l})},w=s=>{i({withholding_tax_details:t.withholding_tax_details.filter((o,l)=>l!==s)})},C=(s,o)=>{i({resident_tax:{...t.resident_tax,[s]:o}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-info-light border border-info/20 p-4 rounded-lg flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-info flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-text-main text-sm",children:"第二表の手動入力について"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"源泉徴収の内訳、保険料控除の明細、家族情報など、申告書の第二表に記載する詳細情報を入力します。"})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:"所得の内訳（源泉徴収税額に関する事項）"}),e.jsx(F,{items:t.withholding_tax_details,onAdd:p,onRemove:w,onEdit:r,title:"",addButtonLabel:"支払者を追加",renderItem:(s,o)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"所得の種類"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.income_category,onChange:l=>r(o,{...s,income_category:l.target.value}),placeholder:"給与、報酬など"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"支払者の名称・氏名"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.payer_name,onChange:l=>r(o,{...s,payer_name:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"収入金額"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:s.revenue_amount===0?"":s.revenue_amount,onChange:l=>r(o,{...s,revenue_amount:l.target.value===""?0:Number(l.target.value)}),placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"源泉徴収税額"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:s.tax_amount===0?"":s.tax_amount,onChange:l=>r(o,{...s,tax_amount:l.target.value===""?0:Number(l.target.value)}),placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]})]})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:"保険料控除等に関する事項"}),e.jsx(F,{items:t.insurance_premium_details.life_insurance,onAdd:()=>d("life_insurance","general"),onRemove:s=>n("life_insurance",s),onEdit:(s,o)=>a("life_insurance",s,o),title:"生命保険料控除",addButtonLabel:"生命保険を追加",renderItem:(s,o)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"保険会社名"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.insurance_company,onChange:l=>a("life_insurance",o,{...s,insurance_company:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"保険等の種類"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.insurance_type,onChange:l=>a("life_insurance",o,{...s,insurance_type:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"期間"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.term,onChange:l=>a("life_insurance",o,{...s,term:l.target.value}),placeholder:"例: 10年"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"受取人"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.beneficiary,onChange:l=>a("life_insurance",o,{...s,beneficiary:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"新・旧の区分"}),e.jsxs("select",{className:"input-base py-1.5",value:s.classification,onChange:l=>a("life_insurance",o,{...s,classification:l.target.value}),children:[e.jsx("option",{value:"general",children:"新生命保険"}),e.jsx("option",{value:"old_long_term",children:"旧生命保険"}),e.jsx("option",{value:"nursing",children:"介護医療保険"}),e.jsx("option",{value:"pension",children:"個人年金"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"支払保険料"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:s.payment_amount===0?"":s.payment_amount,onChange:l=>a("life_insurance",o,{...s,payment_amount:l.target.value===""?0:Number(l.target.value)}),placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]})]})}),e.jsx(F,{items:t.insurance_premium_details.earthquake_insurance,onAdd:()=>d("earthquake_insurance","earthquake"),onRemove:s=>n("earthquake_insurance",s),onEdit:(s,o)=>a("earthquake_insurance",s,o),title:"地震保険料控除",addButtonLabel:"地震保険を追加",renderItem:(s,o)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"保険会社名"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.insurance_company,onChange:l=>a("earthquake_insurance",o,{...s,insurance_company:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"保険等の種類"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.insurance_type,onChange:l=>a("earthquake_insurance",o,{...s,insurance_type:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"区分"}),e.jsxs("select",{className:"input-base py-1.5",value:s.classification,onChange:l=>a("earthquake_insurance",o,{...s,classification:l.target.value}),children:[e.jsx("option",{value:"earthquake",children:"地震"}),e.jsx("option",{value:"old_long_term",children:"旧長期"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"支払保険料"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:s.payment_amount===0?"":s.payment_amount,onChange:l=>a("earthquake_insurance",o,{...s,payment_amount:l.target.value===""?0:Number(l.target.value)}),placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]})]})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:"配偶者や親族に関する事項"}),e.jsxs("div",{className:"bg-surface p-4 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("label",{className:"font-medium text-text-main",children:"配偶者"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!t.family_details.spouse,onChange:s=>{s.target.checked?i({family_details:{...t.family_details,spouse:{id:"spouse",name:"",relationship:"夫/妻",birth_date:"",income:0,living_separately:!1}}}):i({family_details:{...t.family_details,spouse:null}})},className:"w-5 h-5 text-primary rounded"}),e.jsx("span",{className:"text-sm text-text-muted",children:"配偶者あり"})]})]}),t.family_details.spouse&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"氏名"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:t.family_details.spouse.name,onChange:s=>i({family_details:{...t.family_details,spouse:{...t.family_details.spouse,name:s.target.value}}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"生年月日"}),e.jsx("input",{type:"date",className:"input-base py-1.5",value:t.family_details.spouse.birth_date,onChange:s=>i({family_details:{...t.family_details,spouse:{...t.family_details.spouse,birth_date:s.target.value}}})})]})]})]}),e.jsx(F,{items:t.family_details.dependents,onAdd:x,onRemove:u,onEdit:m,title:"扶養親族",addButtonLabel:"扶養親族を追加",renderItem:(s,o)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"氏名"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.name,onChange:l=>m(o,{...s,name:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"続柄"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:s.relationship,onChange:l=>m(o,{...s,relationship:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"生年月日"}),e.jsx("input",{type:"date",className:"input-base py-1.5",value:s.birth_date,onChange:l=>m(o,{...s,birth_date:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"所得金額"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:s.income===0?"":s.income,onChange:l=>m(o,{...s,income:l.target.value===""?0:Number(l.target.value)}),placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]})]})})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:"住民税に関する事項"}),e.jsxs("div",{className:"bg-surface p-4 border border-border rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"給与、公的年金等以外の所得に係る住民税の徴収方法"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"resident_tax_collection",checked:t.resident_tax.collection_method==="special",onChange:()=>C("collection_method","special"),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm",children:"特別徴収（給与から天引き）"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"resident_tax_collection",checked:t.resident_tax.collection_method==="ordinary",onChange:()=>C("collection_method","ordinary"),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm",children:"普通徴収（自分で納付）"})]})]})]})]})]})},de=({data:t,onChange:i})=>{const x=(n,p)=>{i({blue_return_pl:{...t.blue_return_pl,[n]:p}})},m=(n,p)=>{const r=[...t.blue_return_bs.items];r[n]=p,i({blue_return_bs:{items:r}})},u=()=>{const n={id:Date.now().toString(),name:"",description:"",months_worked:12,salary_amount:0,bonus_amount:0,withholding_tax:0};i({employee_salaries:[...t.employee_salaries,n]})},d=(n,p)=>{const r=[...t.employee_salaries];r[n]=p,i({employee_salaries:r})},a=n=>{i({employee_salaries:t.employee_salaries.filter((p,r)=>r!==n)})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-info-light border border-info/20 p-4 rounded-lg flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-info flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-text-main text-sm",children:"青色申告決算書の詳細入力"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"貸借対照表（B/S）の期首・期末残高や、従業員給与の内訳を入力します。 売上や経費は取引データから自動集計されますが、棚卸資産などはここで入力が必要です。"})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:["棚卸資産（在庫）",e.jsx("span",{className:"text-xs font-normal text-text-muted ml-2",children:"売上原価の計算に使用"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"期首棚卸高（1月1日時点）"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base pr-8",value:t.blue_return_pl.beginning_inventory===0?"":t.blue_return_pl.beginning_inventory,onChange:n=>x("beginning_inventory",n.target.value===""?0:Number(n.target.value)),placeholder:"0",onWheel:n=>n.target.blur()}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-1",children:"期末棚卸高（12月31日時点）"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base pr-8",value:t.blue_return_pl.ending_inventory===0?"":t.blue_return_pl.ending_inventory,onChange:n=>x("ending_inventory",n.target.value===""?0:Number(n.target.value)),placeholder:"0",onWheel:n=>n.target.blur()}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:["貸借対照表（B/S）",e.jsx("span",{className:"text-xs font-normal text-text-muted ml-2",children:"資産・負債の期首・期末残高"})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 bg-surface-highlight p-3 text-sm font-medium text-text-muted border-b border-border",children:[e.jsx("div",{className:"col-span-4",children:"勘定科目"}),e.jsx("div",{className:"col-span-4",children:"期首など"}),e.jsx("div",{className:"col-span-4",children:"期末（12/31）"})]}),t.blue_return_bs.items.map((n,p)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-3 border-b border-border last:border-0 items-center hover:bg-surface-highlight/50 transition-colors",children:[e.jsx("div",{className:"col-span-4 font-medium text-text-main",children:n.account_name}),e.jsxs("div",{className:"col-span-4 relative",children:[e.jsx("input",{type:"number",className:"input-base py-1 pr-7 text-sm",value:n.beginning_balance===0?"":n.beginning_balance,onChange:r=>m(p,{...n,beginning_balance:r.target.value===""?0:Number(r.target.value)}),placeholder:"期首残高",onWheel:r=>r.target.blur()}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted text-xs pointer-events-none",children:"円"})]}),e.jsxs("div",{className:"col-span-4 relative",children:[e.jsx("input",{type:"number",className:"input-base py-1 pr-7 text-sm",value:n.ending_balance===0?"":n.ending_balance,onChange:r=>m(p,{...n,ending_balance:r.target.value===""?0:Number(r.target.value)}),placeholder:"期末残高",onWheel:r=>r.target.blur()}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted text-xs pointer-events-none",children:"円"})]})]},n.id))]}),e.jsx("p",{className:"text-xs text-text-muted",children:"※ 現金、預金などの資産だけでなく、借入金などの負債も入力してください。 元入金は期首の金額を入力します。"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main border-b border-border pb-2",children:"給料賃金の内訳"}),e.jsx(F,{items:t.employee_salaries,onAdd:u,onRemove:a,onEdit:d,title:"従業員・専従者給与",addButtonLabel:"従業員を追加",renderItem:(n,p)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"氏名"}),e.jsx("input",{type:"text",className:"input-base py-1.5",value:n.name,onChange:r=>d(p,{...n,name:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"従事月数"}),e.jsx("input",{type:"number",className:"input-base py-1.5",value:n.months_worked,onChange:r=>d(p,{...n,months_worked:Number(r.target.value)}),min:1,max:12})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"給料賃金（年額）"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:n.salary_amount===0?"":n.salary_amount,onChange:r=>d(p,{...n,salary_amount:r.target.value===""?0:Number(r.target.value)}),placeholder:"0",onWheel:r=>r.target.blur()}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"賞与"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:n.bonus_amount===0?"":n.bonus_amount,onChange:r=>d(p,{...n,bonus_amount:r.target.value===""?0:Number(r.target.value)}),placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted pointer-events-none",children:"円"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-muted",children:"源泉徴収税額"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"input-base py-1.5 pr-8",value:n.withholding_tax===0?"":n.withholding_tax,onChange:r=>d(p,{...n,withholding_tax:r.target.value===""?0:Number(r.target.value)}),placeholder:"0"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted",children:"円"})]})]})]})})]})]})},ye=()=>{const[t,i]=N.useState(k),[x,m]=N.useState("table1"),[u,d]=N.useState(!1),[a,n]=N.useState("idle"),[p,r]=N.useState(!1),[w,C]=N.useState(!1),[s,o]=N.useState(null),{user:l}=Q(),{currentBusinessType:g}=V(),{transactions:P}=X(l==null?void 0:l.id,g==null?void 0:g.business_type);N.useEffect(()=>{const c=D.getData();i(c)},[]);const R=c=>{i(b=>({...b,...c})),d(!0),n("idle")},q=()=>{if(!P||P.length===0){j.error("取り込む取引データがありません");return}if(window.confirm(`現在入力されているデータに、取引データから集計した値を加算・上書きしますか？
（手動修正した内容は上書きされる可能性があります）`))try{const c=D.calculateDataFromTransactions(P);i(b=>{const h={...b};if(c.income&&(h.income={...h.income,...c.income}),c.deductions){const v={...h.deductions};Object.keys(c.deductions).forEach(f=>{const y=c.deductions[f];y>0&&(v[f]=y)}),h.deductions=v}return h}),d(!0),j.success("取引データを転記しました")}catch(c){console.error("Import failed:",c),j.error("データの転記に失敗しました")}},B=()=>{n("saving"),setTimeout(()=>{D.saveData(t),d(!1),n("saved"),setTimeout(()=>n("idle"),2e3)},500)},I=(c=!1)=>{const b=(t.income.business_agriculture||0)+(t.income.employment||0)+(t.income.miscellaneous_other||0),h=(t.deductions.social_insurance||0)+(t.deductions.life_insurance||0)+(t.deductions.basic||48e4),v=Math.max(0,b-h);return{name:(g==null?void 0:g.representative_name)||(l==null?void 0:l.name)||"",address:(g==null?void 0:g.address)||"",phone:(g==null?void 0:g.phone)||"",tradeName:(g==null?void 0:g.company_name)||"",year:new Date().getFullYear(),month:3,day:15,revenue:t.income.business_agriculture||0,costOfGoods:0,expenses:0,netIncome:t.income.business_agriculture||0,expensesByCategory:[],deductions:{socialInsurance:t.deductions.social_insurance||0,lifeInsurance:t.deductions.life_insurance||0,basic:t.deductions.basic||48e4,medicalExpenses:t.deductions.medical_expenses||0,blueReturn:c?65e4:0},businessIncome:t.income.business_agriculture||0,salaryIncome:t.income.employment||0,miscellaneousIncome:(t.income.miscellaneous_other||0)+(t.income.miscellaneous_public_pension||0),totalIncome:b,taxableIncome:v,estimatedTax:0,fiscalYear:t.fiscalYear,isBlueReturn:c}},$=async()=>{r(!0);try{const c=I(!1),{pdfBytes:b,filename:h}=await S("tax_return_b",c);A(b,h),j.success("確定申告書Bを出力しました")}catch(c){console.error("PDF generation failed",c),j.error(c.message||"PDF出力に失敗しました")}finally{r(!1)}},O=async()=>{r(!0);try{const c=I(!0),{pdfBytes:b,filename:h}=await S("blue_return",c);A(b,h),j.success("青色申告決算書を出力しました")}catch(c){console.error("PDF generation failed",c),j.error(c.message||"PDF出力に失敗しました")}finally{r(!1)}},W=async()=>{r(!0);try{const c=I(!1),{pdfBytes:b,filename:h}=await S("income_statement",c);A(b,h),j.success("所得の内訳書を出力しました")}catch(c){console.error("PDF generation failed",c),j.error(c.message||"PDF出力に失敗しました")}finally{r(!1)}},Y=async(c,b)=>{r(!0);try{const h=await fetch(c);if(!h.ok)throw new Error(`テンプレートの読み込みに失敗: ${h.statusText}`);const v=await h.arrayBuffer(),f=new Blob([v],{type:"application/pdf"}),y=document.createElement("a");y.href=window.URL.createObjectURL(f),y.download=`${b}_${t.fiscalYear}年度.pdf`,y.click(),window.URL.revokeObjectURL(y.href),j.success(`${b}を出力しました`)}catch(h){console.error("PDF download failed",h),j.error(h.message||"PDF出力に失敗しました")}finally{r(!1)}},G=[{id:"kakutei_1_2",name:"確定申告書 第一表・第二表",handler:$,hasAutoFill:!0},{id:"aoiro_kessan",name:"青色申告決算書",handler:O,hasAutoFill:!0},{id:"syotoku_aoiro",name:"所得税青色申告",handler:()=>Y("/templates/syotokuaoiro.pdf","所得税青色申告"),hasAutoFill:!1},{id:"uchiwake",name:"所得の内訳書",handler:W,hasAutoFill:!0}],M=async()=>{r(!0);try{const c=I(!1),{pdfBytes:b}=await S("tax_return_b",c),h=new Blob([b],{type:"application/pdf"}),v=window.URL.createObjectURL(h);o(v),C(!0)}catch(c){console.error("PDF preview failed",c),j.error("プレビューの作成に失敗しました")}finally{r(!1)}},z=()=>{C(!1),s&&(window.URL.revokeObjectURL(s),o(null))},J={table1:{label:"第一表（収入・控除）",icon:se},table2:{label:"第二表（内訳・詳細）",icon:te},blue:{label:"青色申告決算書",icon:Z}};return e.jsxs("div",{className:"bg-background min-h-screen",children:[e.jsxs("div",{className:"max-w-[1280px] mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-text-main whitespace-nowrap",children:"申告書入力エディタ"}),e.jsx("p",{className:"text-xs sm:text-base text-text-muted mt-1",children:"確定申告書・青色申告決算書の各項目を詳細に入力・編集します"})]}),e.jsx("div",{className:"mb-6 overflow-x-auto pb-2 scrollbar-hide",children:e.jsx("nav",{className:"inline-flex bg-white dark:bg-[#1e293b]/80 backdrop-blur-md p-1 rounded-full border border-transparent dark:border-white/10 min-w-max items-stretch shadow-sm dark:shadow-none",children:Object.entries(J).map(([c,b])=>{const h=b.icon,v=x===c,f=b.label.match(/^(.+?)([（(].+[）)])$/),y=f?f[1]:b.label,E=f?f[2].replace(/[（()）]/g,""):null;return e.jsxs("button",{onClick:()=>m(c),className:`
                                        relative flex flex-col items-center justify-center px-4 py-2 rounded-full transition-colors duration-200 min-h-[56px] min-w-[100px]
                                        ${v?"text-primary bg-white dark:bg-transparent":"text-slate-500 bg-white hover:text-slate-700 hover:bg-slate-50 dark:text-slate-400 dark:bg-transparent dark:hover:text-slate-200 dark:hover:bg-white/5"}
                                    `,children:[v&&e.jsx(ae.div,{layoutId:"activeTabIndicatorPersonal",className:"absolute bottom-0 left-3 right-3 h-[3px] bg-primary rounded-t-full shadow-[0_-2px_8px_rgba(var(--color-primary),0.5)]",transition:{type:"spring",bounce:.25,duration:.5}}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center leading-tight",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx(h,{className:`w-3.5 h-3.5 ${v?"text-primary":"text-slate-500 dark:text-slate-400"}`}),e.jsx("span",{className:"text-sm font-bold tracking-tight whitespace-nowrap",children:y})]}),E&&e.jsx("span",{className:`text-[10px] font-medium tracking-wide ${v?"text-primary/80":"text-slate-500 dark:text-slate-400"}`,children:E})]})]},c)})})}),e.jsxs("div",{className:"flex flex-col lg:flex-row bg-surface rounded-2xl shadow-xl border border-border overflow-hidden",children:[e.jsxs("div",{className:"flex-1 p-6 overflow-auto",children:[x==="table1"&&e.jsx(ce,{data:t,onChange:R}),x==="table2"&&e.jsx(oe,{data:t,onChange:R}),x==="blue"&&e.jsx(de,{data:t,onChange:R})]}),e.jsx("div",{className:"w-full lg:w-72 border-t lg:border-t-0 lg:border-l border-border bg-surface-highlight/5",children:e.jsxs("div",{className:"p-6 sticky top-0",children:[e.jsx("h3",{className:"text-sm font-bold text-text-muted uppercase tracking-wider mb-4",children:"アクション"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:q,className:"w-full py-2.5 px-4 bg-transparent border-2 border-primary text-primary rounded-lg font-bold hover:bg-primary/10 transition-all flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"取引データ転記"]}),e.jsxs("button",{onClick:M,className:"w-full py-2.5 px-4 bg-surface border border-border text-text-main rounded-lg font-medium hover:bg-surface-highlight transition-colors flex items-center justify-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"プレビュー"]}),e.jsxs("button",{onClick:B,disabled:a==="saving",className:`w-full py-2.5 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${u?"btn-primary shadow-lg shadow-primary/25":"bg-surface border border-border text-text-muted hover:bg-surface-highlight"}`,children:[a==="saving"?e.jsx(L,{className:"w-4 h-4 animate-spin"}):e.jsx(le,{className:"w-4 h-4"}),a==="saved"?"保存しました":"保存"]}),e.jsx("div",{className:"border-t border-border my-2"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 border border-border rounded-xl overflow-hidden bg-surface shadow-inner",children:[e.jsxs("div",{className:"px-3 py-2 bg-surface-highlight text-[10px] font-bold text-text-muted uppercase border-b border-border tracking-wider flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary animate-pulse"}),"公式PDF書類出力"]}),e.jsx("div",{className:"divide-y divide-border",children:G.map(c=>e.jsxs("button",{onClick:c.handler,disabled:p,className:"w-full py-2.5 px-3 text-left text-sm text-text-main hover:bg-surface-highlight transition-colors flex items-center justify-between disabled:opacity-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.name}),!c.hasAutoFill&&e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 bg-surface-highlight text-text-muted rounded",children:"テンプレート"})]}),p?e.jsx(L,{className:"w-3 h-3 text-text-muted animate-spin"}):e.jsx(re,{className:"w-3 h-3 text-text-muted"})]},c.id))})]})})]}),e.jsx("div",{className:"border-t border-border my-2"}),e.jsxs("button",{onClick:()=>{window.confirm("入力内容をすべてリセットしますか？")&&(D.resetData(),i(k),d(!0))},className:"w-full py-2.5 px-4 bg-transparent text-text-muted rounded-lg font-medium hover:bg-red-50 hover:text-red-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),"リセット"]}),e.jsxs("a",{href:"/tools/coordinate_picker.html",target:"_blank",rel:"noopener noreferrer",className:"w-full py-2 px-4 bg-surface border border-border text-text-muted rounded-lg font-medium hover:bg-surface-highlight transition-colors flex items-center justify-center gap-2 text-sm",children:[e.jsx(ie,{className:"w-4 h-4"}),"座標キャリブレーター"]})]})})]})]}),e.jsx("div",{className:"mt-8 flex justify-between",children:e.jsx("p",{className:"text-sm text-text-muted",children:"※ ここで入力したデータはブラウザに保存され、PDF作成時に使用されます。"})}),w&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-2xl shadow-2xl w-full max-w-4xl h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[e.jsx("h3",{className:"font-bold text-text-main",children:"プレビュー"}),e.jsx("button",{onClick:z,className:"text-text-muted hover:text-text-main transition-colors",children:"✕"})]}),e.jsx("div",{className:"flex-1",children:e.jsx("iframe",{src:s??void 0,className:"w-full h-full",title:"PDF Preview"})})]})})]})};export{ye as TaxReturnInputForm};
