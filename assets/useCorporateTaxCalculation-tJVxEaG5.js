import{r as S}from"./index-C8W6MraP.js";const W=(f,b=[],g={})=>S.useMemo(()=>{const F=new Date,c=F.getFullYear(),D=Array.from(new Set([c,c-1,...f.map(e=>new Date(e.date).getFullYear()),...b.map(e=>new Date(e.date).getFullYear())])).sort((e,n)=>n-e),P=D.includes(c)?c:D[0]||c,l=g.year||P,E=l===c?F.getMonth():11,Y=f.filter(e=>new Date(e.date).getFullYear()===l&&e.approval_status!=="rejected"),R=b.filter(e=>new Date(e.date).getFullYear()===l&&e.status==="pending"),i=e=>{if(typeof e=="number")return e;if(typeof e=="string"){const n=/^-|▲/.test(e),m=e.replace(/[^\d.-]/g,"");let d=parseFloat(m);return isNaN(d)?0:n?-Math.abs(d):d}if(typeof e=="object"&&e!==null){const n=e.value??e.amount??e.number??0;return i(n)}return 0},h=e=>Math.abs(i(e)),x=Y.filter(e=>{const n=i(e.amount);return e.type==="income"||e.type!=="expense"&&n>0}).reduce((e,n)=>e+h(n.amount),0),k=Y.filter(e=>{const n=i(e.amount);return e.type==="expense"||e.type!=="income"&&n<0}).reduce((e,n)=>{var d,A,z;let m=h(n.amount);if((d=n.tags)!=null&&d.includes("depreciation_asset")){const B=(A=n.description)==null?void 0:A.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(B)m=parseInt(B[1].replace(/,/g,""),10);else{const L=(z=n.description)==null?void 0:z.match(/年間償却費: ¥([\d,]+)/);L&&(m=parseInt(L[1].replace(/,/g,""),10))}}return e+m},0),N=R.reduce((e,n)=>e+h(n.amount),0),y=k+N,T=Math.max(0,x-y),I=E+1,s=T/I*12,u=48e4,j=g.enableBlueReturn?65e4:0,_=u+j,o=Math.max(0,s-_);console.log("[TaxDebug] Calculation:",{yearTransactionsLen:Y.length,yearReceiptsLen:R.length,ytdIncome:x,ytdExpense:y,ytdProfit:T,monthsPassed:I,projectedAnnualProfit:s,deductions:{basicDeduction:u,blueReturnDeduction:j},taxableIncome:o});let r=0;o>18e6?r=o*.4-2796e3:o>9e6?r=o*.33-1536e3:o>695e4?r=o*.23-636e3:o>33e5?r=o*.2-427500:o>195e4?r=o*.1-97500:r=o*.05,o<=0&&(r=0);const p=o*.1,M=Math.max(0,s-29e5)*.05,C=Math.min(s*.1,8e5),t=Math.max(0,r+p+M+C),a=t/12;return console.log("[TaxDebug] Result:",{totalTax:t,breakdown:{incomeTax:r,residentTax:p,businessTax:M,healthInsurance:C}}),{totalTax:t,monthlyTaxAru:a,ytdProfit:T,projectedAnnualProfit:s,taxableIncome:o,deductions:{basicDeduction:u,blueReturnDeduction:j,total:_},chartData:{labels:["所得税","住民税","事業税","国民健康保険"],datasets:[{data:[r,p,M,C],backgroundColor:["#3b82f6","#10b981","#f59e0b","#8b5cf6"],borderWidth:0}]},breakdown:{incomeTax:r,residentTax:p,businessTax:M,healthInsurance:C},ytdIncome:x,ytdExpense:y,calculationYear:l}},[f,b,g.enableBlueReturn,g.year]),q=(f,b=[],g={})=>S.useMemo(()=>{const F=new Date,c=F.getFullYear(),D=Array.from(new Set([c,c-1,...f.map(t=>new Date(t.date).getFullYear()),...b.map(t=>new Date(t.date).getFullYear())])).sort((t,a)=>a-t),P=D.includes(c)?c:D[0]||c,l=g.year||P,E=l===c?F.getMonth():11,Y=f.filter(t=>new Date(t.date).getFullYear()===l&&t.approval_status!=="rejected"),R=b.filter(t=>new Date(t.date).getFullYear()===l&&t.status==="pending"),i=t=>{if(typeof t=="number")return t;if(typeof t=="string"){const a=/^-|▲/.test(t),w=t.replace(/[^\d.-]/g,"");let e=parseFloat(w);return isNaN(e)?0:a?-Math.abs(e):e}if(typeof t=="object"&&t!==null){const a=t.value??t.amount??t.number??0;return i(a)}return 0},h=t=>Math.abs(i(t)),x=Y.filter(t=>{const a=i(t.amount);return t.type==="income"||t.type!=="expense"&&a>0}).reduce((t,a)=>t+h(a.amount),0),k=Y.filter(t=>{const a=i(t.amount);return t.type==="expense"||t.type!=="income"&&a<0}).reduce((t,a)=>{var e,n,m;let w=h(a.amount);if((e=a.tags)!=null&&e.includes("depreciation_asset")){const d=(n=a.description)==null?void 0:n.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(d)w=parseInt(d[1].replace(/,/g,""),10);else{const A=(m=a.description)==null?void 0:m.match(/年間償却費: ¥([\d,]+)/);A&&(w=parseInt(A[1].replace(/,/g,""),10))}}return t+w},0),N=R.reduce((t,a)=>t+h(a.amount),0),y=k+N,T=Math.max(0,x-y),I=E+1,s=T/I*12;console.log("[CorporateTaxDebug] Calculation:",{targetYear:l,ytdIncome:x,ytdExpense:y,ytdProfit:T,projectedAnnualProfit:s});let u=0;s<=0?u=0:s<=8e6?u=s*.15:u=8e6*.15+(s-8e6)*.232;const o=u*.129+7e4;let r=0;s>0&&(s<=4e6?r=s*.035:s<=8e6?r=4e6*.035+(s-4e6)*.053:r=4e6*.035+4e6*.053+(s-8e6)*.07);const p=u+o+r,M=p/12;return console.log("[CorporateTaxDebug] Result:",{totalTax:p,breakdown:{corporateTax:u,residentTax:o,businessTax:r}}),{totalTax:p,monthlyTaxAru:M,ytdProfit:T,projectedAnnualProfit:s,chartData:{labels:["法人税","法人住民税","法人事業税"],datasets:[{data:[u,o,r],backgroundColor:["#3b82f6","#10b981","#f59e0b"],borderWidth:0}]},breakdown:{corporateTax:u,residentTax:o,businessTax:r,healthInsurance:0},ytdIncome:x,ytdExpense:y,calculationYear:l,selectableYears:D}},[f,b,g.year]);export{q as a,W as u};
