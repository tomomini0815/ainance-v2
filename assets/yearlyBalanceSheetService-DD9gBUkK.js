import{K as u}from"./index-Ca_aGh3E.js";const p={async getByYear(t,n,r){const{data:i,error:e}=await u.from("yearly_balance_sheets").select("*").eq("user_id",t).eq("business_type",n).eq("year",r).single();if(e){if(e.code==="PGRST116")return null;throw console.error("getYearlyBalanceSheet Error:",e),e}return i},async getAllByBusinessType(t,n){const{data:r,error:i}=await u.from("yearly_balance_sheets").select("*").eq("user_id",t).eq("business_type",n).order("year",{ascending:!1});if(i)throw console.error("getAllYearlyBalanceSheets Error:",i),i;return r||[]},async save(t){console.log("--- yearlyBalanceSheetService.save Start ---",t);const{data:n,error:r}=await u.from("yearly_balance_sheets").upsert({...t,updated_at:new Date().toISOString()},{onConflict:"user_id,business_type,year"}).select().single();if(r)throw console.error("saveYearlyBalanceSheet Error Full:",r),console.error("Error Details:",r.details),console.error("Error Hint:",r.hint),console.error("Error Code:",r.code),r;return console.log("saveYearlyBalanceSheet Success:",n),n},mapAiResultToBS(t,n,r,i={}){console.log("--- BS Result Mapping Start ---");const e=o=>{if(o==null||o==="")return 0;if(typeof o=="number")return o;let s=String(o).replace(/[$,¥円\s,()]/g,""),c=!1;(s.startsWith("△")||s.startsWith("▲")||s.startsWith("-"))&&(c=!0,s=s.substring(1));let l=1;s.includes("千万")?l=1e7:s.includes("百万")?l=1e6:s.includes("千")?l=1e3:s.includes("万")&&(l=1e4);const _=parseFloat(s.replace(/[千万万円]/g,"")),y=isNaN(_)?0:_*l;return Math.floor(c?-y:y)},a=o=>{if(!(!t||typeof t!="object"))for(const s of o){if(t[s]!==void 0&&t[s]!==null)return t[s];const c=s.toLowerCase(),l=Object.keys(t).find(_=>_.toLowerCase()===c);if(l)return t[l]}},d={user_id:n,business_type:r,year:e(a(["year","年度","決算年度"]))||new Date().getFullYear()-1,assets_current_cash:e(a(["assets_current_cash","現金及び預金","現金預金"])),assets_current_total:e(a(["assets_current_total","流動資産合計"])),assets_total:e(a(["assets_total","資産の部合計","資産合計"])),liabilities_total:e(a(["liabilities_total","負債の部合計","負債合計"])),net_assets_capital:e(a(["net_assets_capital","資本金"])),net_assets_retained_earnings:e(a(["net_assets_retained_earnings","繰越利益剰余金"])),net_assets_retained_earnings_total:e(a(["net_assets_retained_earnings_total","利益剰余金合計","その他利益剰余金合計"])),net_assets_shareholders_equity:e(a(["net_assets_shareholders_equity","株主資本合計"])),net_assets_total:e(a(["net_assets_total","純資産の部合計","純資産合計"])),liabilities_and_net_assets_total:e(a(["liabilities_and_net_assets_total","負債及び純資産の部合計","負債純資産合計"])),metadata:{...i,confidence:t.confidence}};return console.log("Mapped BS Data:",d),d}};export{p as y};
