const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RevenueChart-Colr4DBZ.js","assets/index-DbpAXpfG.js","assets/index-BE0n4d-m.css","assets/index-8GBqu_Pm.js","assets/ExpenseChart-Cl-Cv3m7.js","assets/TransactionTable-B1B9vjd3.js","assets/AITransactionTable-DVLbO6u4.js","assets/brain-_BwXx4Hk.js","assets/circle-check-big-C3mejhXj.js","assets/circle-alert-pKTjg2dX.js","assets/TransactionForm-DW-K32FX.js","assets/star-CxiUxBIe.js","assets/calendar-DDHhPYml.js","assets/zap-CZl61L1S.js"])))=>i.map(i=>d[i]);
import{c as $,j as e,F as S,L as O,r as i,s as T,a as F,b as R,d as V,P as M,T as P,e as D,R as v,X as z,_ as N}from"./index-DbpAXpfG.js";import{C as J,B as U}from"./calculator-C5MVaU-P.js";import{C as q}from"./camera-jajAmbNx.js";import{D as Q}from"./download-7ORpH2Oy.js";import{J as B}from"./japanese-yen-DqQ_TQHN.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],K=$("chart-no-axes-column",H);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Y=$("link",X),G=()=>{const a=[{title:"CHAT-TO-BOOK",description:"音声で取引を記録",icon:J,link:"/chat-to-book",color:"bg-purple-500/20",iconColor:"text-purple-500",borderColor:"border-purple-500/30"},{title:"レシート処理",description:"レシートをスキャン",icon:q,link:"/receipt-processing",color:"bg-emerald-500/20",iconColor:"text-emerald-500",borderColor:"border-emerald-500/30"},{title:"請求書作成",description:"新しい請求書を作成",icon:S,link:"/invoice-creation",color:"bg-blue-500/20",iconColor:"text-blue-500",borderColor:"border-blue-500/30"},{title:"取引履歴",description:"すべての取引を確認",icon:K,link:"/transaction-history",color:"bg-amber-500/20",iconColor:"text-amber-500",borderColor:"border-amber-500/30"},{title:"申告サポート",description:"税務申告の準備",icon:U,link:"/tax-filing-support",color:"bg-rose-500/20",iconColor:"text-rose-500",borderColor:"border-rose-500/30"},{title:"連携設定",description:"外部サービス連携",icon:Y,link:"/integration-settings",color:"bg-indigo-500/20",iconColor:"text-indigo-500",borderColor:"border-indigo-500/30"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:a.map((r,p)=>e.jsx(O,{to:r.link,className:"bg-white dark:bg-surface rounded-xl p-4 hover:bg-surface-highlight transition-all duration-300 group border border-border hover:border-border-strong hover:-translate-y-1 shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`w-12 h-12 ${r.color} rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300 border ${r.borderColor}`,children:e.jsx(r.icon,{className:`w-6 h-6 ${r.iconColor}`})}),e.jsx("h3",{className:"font-medium text-text-main mb-1 text-sm",children:r.title}),e.jsx("p",{className:"text-xs text-text-muted leading-relaxed",children:r.description})]})},p))})},W=()=>{const[a,r]=i.useState([]),[p,w]=i.useState(!1),x=i.useCallback(()=>(w(!0),T.from("ai_transactions").select("*").order("created_at",{ascending:!1}).then(({data:g,error:u})=>{u?(console.error(`AI取引データの取得に失敗しました: ${u.message}`),r([])):r(g||[]),w(!1)}),()=>{}),[]),k=async(g,u,h)=>{try{const{data:j,error:C}=await T.from("ai_transactions").update({manual_verified:u,learning_feedback:h,updated_at:new Date().toISOString()}).eq("id",g).select().single();if(C)throw C;console.log(u?"AI分類を承認しました":"AI分類を却下しました"),r(y=>y.map(d=>d.id===g?{...d,manual_verified:u}:d))}catch(j){throw console.error("AI取引の確認に失敗しました:",j),j}};return i.useEffect(()=>{const g=x();return()=>{g&&g()}},[x]),{aiTransactions:a,loading:p,fetchAITransactions:x,verifyAITransaction:k}},Z=v.lazy(()=>N(()=>import("./RevenueChart-Colr4DBZ.js"),__vite__mapDeps([0,1,2,3]))),ee=v.lazy(()=>N(()=>import("./ExpenseChart-Cl-Cv3m7.js"),__vite__mapDeps([4,1,2,3]))),se=v.lazy(()=>N(()=>import("./TransactionTable-B1B9vjd3.js"),__vite__mapDeps([5,1,2]))),re=v.lazy(()=>N(()=>import("./AITransactionTable-DVLbO6u4.js"),__vite__mapDeps([6,1,2,7,8,9]))),te=v.lazy(()=>N(()=>import("./TransactionForm-DW-K32FX.js"),__vite__mapDeps([10,1,2,11,12,13]))),ce=()=>{const{currentBusinessType:a}=F(),{transactions:r,loading:p,createTransaction:w,fetchTransactions:x}=R(a==null?void 0:a.id),{aiTransactions:k,loading:g}=W(),[u,h]=i.useState(!1),{isAuthenticated:j,user:C,loading:y}=V();console.log("ダッシュボード - currentBusinessType:",a),console.log("ダッシュボード - transactions:",r),console.log("ダッシュボード - loading:",p),i.useEffect(()=>{const t=()=>h(!0);return window.addEventListener("openCreateTransactionModal",t),()=>{window.removeEventListener("openCreateTransactionModal",t)}},[]),i.useEffect(()=>{a!=null&&a.id&&x()},[a,x]),i.useEffect(()=>{const t=()=>{a!=null&&a.id&&x()};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[a,x]);const d=i.useMemo(()=>{console.log("取引データ:",r),r.forEach((s,o)=>{console.log(`取引 ${o+1}:`,{id:s.id,item:s.item,amount:s.amount,amountType:typeof s.amount,amountStructure:typeof s.amount=="object"?Object.keys(s.amount):"N/A",date:s.date,category:s.category,type:s.type})});const t=s=>{if(typeof s=="number")return s;if(typeof s=="string"){const o=parseFloat(s);return isNaN(o)?0:o}if(typeof s=="object"&&s!==null){const o=s.value||s.amount||s.number||0;if(typeof o=="number")return o;if(typeof o=="string"){const l=parseFloat(o);return isNaN(l)?0:l}return 0}return 0},c=r.filter(s=>{if(s.type==="income")return!0;if(s.type==="expense")return!1;const o=t(s.amount),l=!isNaN(o)&&isFinite(o)&&o>0;return console.log(`取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${o}, 収入判定=${l}`),l}),b=r.filter(s=>{if(s.type==="expense")return!0;if(s.type==="income")return!1;const o=t(s.amount),l=!isNaN(o)&&isFinite(o)&&o<0;return console.log(`取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${o}, 支出判定=${l}`),l}),n=c.reduce((s,o)=>{const l=t(o.amount),f=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`収入計算: ${s} + ${f} = ${s+f}`),s+f},0),m=b.reduce((s,o)=>{const l=t(o.amount),f=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`支出計算: ${s} + ${f} = ${s+f}`),s+f},0),_={total:r.length,income:n,expense:m,balance:n-m};return console.log("統計情報計算結果:",_),console.log("収入取引:",c),console.log("支出取引:",b),_},[r]),A=()=>e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"p-4 bg-red-500 text-white text-center mb-4",children:[e.jsx("p",{children:"ダッシュボードのローディング中..."}),e.jsxs("p",{children:["authLoading: ",y?"true":"false"]}),e.jsxs("p",{children:["isAuthenticated: ",j?"true":"false"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-24 w-full bg-gray-200 dark:bg-gray-700 rounded-xl mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"})]})]});if(y)return console.log("ダッシュボードをスケルトンローディングで表示中 - authLoading:",y),e.jsx(A,{});const E=t=>{const c=["日付","説明","金額","カテゴリ","タイプ","ステータス"],b=t.map(m=>[m.date,`"${m.description}"`,m.amount.toString(),`"${m.category}"`,m.type,m.status]);return[c.join(","),...b.map(m=>m.join(","))].join(`
`)},L=()=>{const t=E(r),c=new Blob(["\uFEFF",t],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(c),n=document.createElement("a");n.setAttribute("href",b),n.setAttribute("download",`取引データ_${new Date().toISOString().split("T")[0]}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},I=async t=>{try{console.log("取引作成を開始:",t);const c=localStorage.getItem("user");if(c)try{const n=JSON.parse(c);t.creator=n.id}catch(n){console.error("ユーザー情報の解析に失敗しました:",n)}if(console.log("creator IDを設定:",t.creator),!t.type){const n=typeof t.amount=="string"?parseFloat(t.amount):t.amount;t.type=n>0?"income":"expense",console.log("typeプロパティを自動設定:",t.type)}const b=await w(t);console.log("取引作成成功:",b),await x(),h(!1)}catch(c){console.error("取引の作成に失敗:",c),alert(`取引の作成に失敗しました: ${c.message||"もう一度お試しください。"}`)}};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-text-main tracking-tight",children:"ダッシュボード"}),e.jsx("p",{className:"text-text-muted mt-1",children:"財務状況の概要と最近の活動"})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:L,disabled:r.length===0,className:`btn-secondary flex-1 sm:flex-none flex items-center justify-center ${r.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"CSV出力"]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex-1 sm:flex-none flex items-center justify-center",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"新規取引"]})]})]}),e.jsx("div",{className:"bg-surface rounded-xl shadow-sm p-4 border border-border hover:shadow-md transition-shadow mb-8",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-medium text-text-muted",children:"総取引数"}),e.jsx("div",{className:"rounded-lg bg-primary/5 p-2",children:e.jsx(S,{className:"w-5 h-5 text-primary"})})]}),e.jsx("div",{className:"text-xl font-bold text-primary mt-1",children:d.total})]}),e.jsxs("div",{className:"border border-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-medium text-text-muted",children:"収入"}),e.jsx("div",{className:"rounded-lg bg-green-500/5 p-2",children:e.jsx(P,{className:"w-5 h-5 text-green-500"})})]}),e.jsxs("div",{className:"text-xl font-bold text-green-500 mt-1",children:["¥",d.income.toLocaleString()]})]}),e.jsxs("div",{className:"border border-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-medium text-text-muted",children:"支出"}),e.jsx("div",{className:"rounded-lg bg-red-500/5 p-2",children:e.jsx(D,{className:"w-5 h-5 text-red-500"})})]}),e.jsxs("div",{className:"text-xl font-bold text-red-500 mt-1",children:["¥",d.expense.toLocaleString()]})]}),e.jsxs("div",{className:"border border-border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-medium text-text-muted",children:"収支"}),e.jsx("div",{className:`rounded-lg p-2 ${d.balance>=0?"bg-green-500/5":"bg-red-500/5"}`,children:e.jsx(B,{className:`w-5 h-5 ${d.balance>=0?"text-green-500":"text-red-500"}`})})]}),e.jsxs("div",{className:`text-xl font-bold mt-1 ${d.balance>=0?"text-green-500":"text-red-500"}`,children:["¥",d.balance.toLocaleString()]})]})]})}),e.jsx(G,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(Z,{transactions:r})}),e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(ee,{transactions:r})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(se,{transactions:r,onOpenCreateModal:()=>h(!0),showCreateButton:!1})}),e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(re,{aiTransactions:k,loading:g})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-surface border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"新規取引作成"}),e.jsx("button",{onClick:()=>h(!1),className:"p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(z,{className:"w-5 h-5 text-text-muted"})})]}),e.jsx(i.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(te,{onSubmit:I,onCancel:()=>h(!1)})})]})})})]})};export{ce as default};
