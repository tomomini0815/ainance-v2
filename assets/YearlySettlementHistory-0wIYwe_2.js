import{a as k,e as S,r as d,j as e,L as C,F as g,P as I,i as P,q as L,T as _,x as A,G as x}from"./index-Cte9M9zr.js";import{P as F,y as f}from"./PreviousYearImportModal-Cmmp6bxV.js";import{A as T}from"./arrow-left-DwSMUrT_.js";import{F as D}from"./funnel-D9FFK2vk.js";import{P as E}from"./pen-tnrC0vqz.js";import{C as B}from"./circle-check-big-DeImdQY4.js";import"./geminiAIService-DQoIspWT.js";import"./loader-circle-DEKlloMj.js";import"./arrow-right-gQUG1Phy.js";import"./save-BOp2MQdj.js";const K=()=>{const{user:s}=k(),{currentBusinessType:n}=S(),[c,m]=d.useState([]),[j,p]=d.useState(!0),[N,a]=d.useState(!1),[M,h]=d.useState(null),l=(n==null?void 0:n.business_type)||"individual",y=l==="corporation"?"法人":"個人事業主",u=async()=>{if(s!=null&&s.id){p(!0);try{const t=await f.getAllByBusinessType(s.id,l);m(t)}catch(t){console.error("Error fetching settlements:",t),x.error("決算データの取得に失敗しました")}finally{p(!1)}}};d.useEffect(()=>{u()},[s==null?void 0:s.id,l]);const w=async(t,i)=>{if(window.confirm(`${i}年度の決算データを削除してもよろしいですか？`))try{await f.delete(t),x.success(`${i}年度のデータを削除しました`),m(r=>r.filter(o=>o.id!==t))}catch(r){console.error("Delete error:",r),x.error("削除に失敗しました")}},b=t=>new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(t);return e.jsx("div",{className:"min-h-screen bg-background text-text-main",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{to:l==="corporation"?"/corporate-tax":"/tax-filing-wizard",className:"p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(T,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(g,{className:"w-7 h-7 text-primary"}),"過去決算データ・引継ぎ管理"]}),e.jsxs("p",{className:"text-text-muted mt-1",children:[y,"としての過去の決算履歴を確認・管理できます"]})]})]}),e.jsxs("button",{onClick:()=>a(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-primary text-white rounded-xl hover:bg-primary/90 transition-all shadow-lg shadow-primary/20 font-bold",children:[e.jsx(I,{className:"w-5 h-5"}),"新規データ追加"]})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-4 mb-6 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted"}),e.jsx("input",{type:"text",placeholder:"年度や金額で検索...",className:"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-xl focus:ring-2 focus:ring-primary outline-none text-sm"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-surface-highlight rounded-xl text-sm font-medium hover:bg-border transition-colors border border-border",children:[e.jsx(D,{className:"w-4 h-4"}),"フィルター"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-text-muted mr-2",children:["全 ",c.length," 件"]})})]}),e.jsx("div",{className:"bg-surface border border-border rounded-2xl overflow-hidden shadow-sm",children:j?e.jsxs("div",{className:"p-12 text-center group",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-text-muted",children:"読み込み中..."})]}):c.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"bg-surface-highlight w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(g,{className:"w-10 h-10 text-text-muted"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"履歴がありません"}),e.jsxs("p",{className:"text-text-muted mb-6",children:["過去の決算書をアップロードするか、手動で入力して",e.jsx("br",{}),"前期からの数値引き継ぎや経営分析を可能にしましょう。"]}),e.jsx("button",{onClick:()=>a(!0),className:"btn-primary px-8 py-3 rounded-xl font-bold",children:"初めてのデータを登録"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-surface-highlight/50 border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider",children:"年度"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider",children:"売上高"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider",children:"当期純利益"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider",children:"主な経費カテゴリ"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-text-muted uppercase tracking-wider text-right",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-border",children:c.map(t=>{var i,r;return e.jsxs("tr",{className:"hover:bg-surface-highlight/30 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary font-bold",children:t.year.toString().slice(-2)}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-text-main",children:[t.year,"年度"]}),e.jsxs("div",{className:"text-xs text-text-muted",children:["登録日: ",new Date(t.created_at||"").toLocaleDateString()]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"font-bold",children:b(t.revenue)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`font-bold ${t.net_income>=0?"text-success":"text-red-500"}`,children:b(t.net_income)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(i=t.category_breakdown)==null?void 0:i.slice(0,2).map((o,v)=>e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-surface-highlight text-[10px] font-medium border border-border",children:o.category},v)),((r=t.category_breakdown)==null?void 0:r.length)>2&&e.jsxs("span",{className:"text-[10px] text-text-muted",children:["+",t.category_breakdown.length-2]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{h(t),a(!0)},className:"p-2 text-text-muted hover:text-primary hover:bg-primary/10 rounded-lg transition-all",title:"編集",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>w(t.id,t.year),className:"p-2 text-text-muted hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-all",title:"削除",children:e.jsx(L,{className:"w-4 h-4"})})]})})]},t.id)})})]})})}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/5 to-secondary/5 border border-primary/10 rounded-2xl p-6",children:[e.jsx(_,{className:"w-8 h-8 text-primary mb-4"}),e.jsx("h4",{className:"font-bold mb-2",children:"引継ぎのメリット"}),e.jsx("p",{className:"text-sm text-text-muted leading-relaxed",children:"前期の数値を登録すると、今期の収支との比較分析が可能になり、経営の健全性をより深く理解できます。"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-success/5 to-primary/5 border border-success/10 rounded-2xl p-6",children:[e.jsx(B,{className:"w-8 h-8 text-success mb-4"}),e.jsx("h4",{className:"font-bold mb-2",children:"自動転記の連携"}),e.jsx("p",{className:"text-sm text-text-muted leading-relaxed",children:"決算書PDFからAIが自動で数値を抽出するため、手入力の手間を最小限に抑えられます。"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/5 to-red-500/5 border border-amber-500/10 rounded-2xl p-6",children:[e.jsx(A,{className:"w-8 h-8 text-amber-500 mb-4"}),e.jsx("h4",{className:"font-bold mb-2",children:"正確な申告準備"}),e.jsx("p",{className:"text-sm text-text-muted leading-relaxed",children:"貸借対照表の期末残高が翌期首残高として正しく引き継がれているか確認するのにも役立ちます。"})]})]}),e.jsx(F,{isOpen:N,onClose:()=>{a(!1),h(null)},userId:(s==null?void 0:s.id)||"",businessType:l,onImportSuccess:()=>{u(),a(!1)}})]})})};export{K as default};
