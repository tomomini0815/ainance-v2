const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-VxeKH72S.js","assets/index-DnAF104x.js","assets/index-DVRxjVKB.css"])))=>i.map(i=>d[i]);
import{c as je,h as Ne,e as ye,r as m,j as e,L as ve,U as X,F as v,X as B,i as we,C as ee,n as D,_ as Se}from"./index-DnAF104x.js";import{R as Ae,a as Ce,g as Re,b as ke,u as Ie}from"./ReceiptResultModal-BbtcFaPF.js";import{T as te}from"./triangle-alert-BsdjQWFb.js";import{A as Oe}from"./arrow-left-Cb8UsmHv.js";import{g as se}from"./motion-DNespqSL.js";import{R as Me}from"./refresh-cw-B_o5dzLx.js";import{C as Te}from"./camera-6_RRsYAF.js";import{A as De}from"./arrow-right-B7dyBLEW.js";import{E as ae}from"./eye-BtnEt6bp.js";import{S as Ee}from"./save-Db5X_nZf.js";import{A as Pe}from"./index-uUOgOGIX.js";import"./zap-BAqf-MHS.js";import"./loader-circle-BQF-TU2d.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],$e=je("file-image",Le),qe=()=>{const{user:g}=Ne(),{currentBusinessType:E}=ye(),[w,S]=m.useState([]),[h,b]=m.useState({isProcessing:!1,retryCount:0}),[f,z]=m.useState(null),[j,N]=m.useState({}),[re,C]=m.useState(!1),[ne,P]=m.useState(!1),[G,L]=m.useState(null),[$,le]=m.useState(""),[U,de]=m.useState("all"),[F,ie]=m.useState("all"),[r,oe]=m.useState(null),[ce,Y]=m.useState(!1);m.useEffect(()=>{(async()=>{if(!(g!=null&&g.uid))return;const a=(await Re(g.uid)).map(d=>({id:d.id,date:d.date,merchant:d.merchant,amount:d.amount,category:d.category,description:d.description,confidence:d.confidence,status:d.status,taxRate:d.tax_rate,confidenceScores:d.confidence_scores}));S(a)})()},[g]);const xe=()=>{C(!0)},me=()=>{C(!1)},H=async t=>{C(!1);const s=URL.createObjectURL(t);b(a=>({...a,imageData:s})),await J(s)},J=async t=>{b(s=>({...s,isProcessing:!0,retryCount:0,progress:0,currentStep:"OCR処理を開始しています..."}));try{const s=await Se(()=>import("./index-VxeKH72S.js").then(n=>n.i),__vite__mapDeps([0,1,2]));b(n=>({...n,progress:10,currentStep:"OCRエンジンを初期化中..."}));const a=new Promise((n,u)=>{setTimeout(()=>u(new Error("OCR処理がタイムアウトしました。画像の解像度が高いか、ネットワークが不安定です。")),45e3)}),d=s.recognize(t,"jpn+eng",{logger:n=>{if(n.status==="recognizing text"){const u=Math.round(n.progress*80)+10;b(y=>({...y,progress:u,currentStep:`テキストを認識中... ${Math.round(n.progress*100)}%`}))}}}),x=await Promise.race([d,a]);console.log("OCR結果:",x.data.text),b(n=>({...n,progress:90,currentStep:"データを抽出中..."}));const i=ue(x.data.text);L({merchant:i.merchant||"不明",date:i.date||new Date().toISOString().split("T")[0],amount:i.amount||0,category:i.category||"雑費",taxRate:i.taxRate||0,confidence:i.confidence||70}),b(n=>({...n,isProcessing:!1,retryCount:0,progress:100,currentStep:"完了"})),P(!0),D.success("レシートの読み取りが完了しました")}catch(s){console.error("OCR処理エラー:",s),b(a=>({...a,isProcessing:!1,retryCount:0,errorMessage:`OCR処理に失敗しました: ${s.message}`})),D.error("レシートの読み取りに失敗しました。もう一度お試しください。")}},ue=t=>{console.log("抽出対象テキスト:",t);const a=(l=>l.replace(/[０-９]/g,c=>String.fromCharCode(c.charCodeAt(0)-65248)).replace(/[Ａ-Ｚａ-ｚ]/g,c=>String.fromCharCode(c.charCodeAt(0)-65248)))(t),d={totalAmount:[/(?:合計|総計|お買上計|領収金額|支払金額|請求金額)[\s:：]*[¥￥]*\s*([0-9,]+)/i,/合\s*計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/小計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/(?:現\s*金|クレ(?:ジット)?|PayPay|d払い|auPAY|LINE\s*Pay)[\s:：]*[¥￥]*\s*([0-9,]+)/i,/[¥￥]\s*([0-9,]+)(?!\s*[\-\+])/],date:[/(\d{4})[年\/\-](\d{1,2})[月\/\-](\d{1,2})[日]?/,/(\d{2,4})[\/\-](\d{1,2})[\/\-](\d{1,2})/,/(\d{4})\.(\d{2})\.(\d{2})/,/(?:令和|R)(\d{1,2})[年\/\-](\d{1,2})[月\/\-](\d{1,2})[日]?/],phone:/(?:TEL|電話|Tel|tel)[:：\s]*(\d{2,4}[-\s]\d{2,4}[-\s]\d{3,4})/,invoice:/(T\d{13})/};let x="不明",i=0;const n=["セブンイレブン","セブン-イレブン","セブン","7-ELEVEN","7-11","7ELEVEN","ローソン","LAWSON","ナチュラルローソン","ローソンストア100","ファミリーマート","ファミマ","FamilyMart","FAMILY MART","ミニストップ","MINISTOP","デイリーヤマザキ","ヤマザキデイリーストア","ニューデイズ","NewDays","ポプラ","くらしハウス","イオン","AEON","マックスバリュ","MaxValu","ザ・ビッグ","まいばすけっと","イトーヨーカドー","ヨーカドー","ItoYokado","ライフ","LIFE","サミット","Summit","西友","SEIYU","マルエツ","Maruetsu","ダイエー","DAIEI","成城石井","成城","カルディ","KALDI","カルディコーヒーファーム","業務スーパー","オーケー","OK","オーケーストア","コープ","COOP","生協","ヤオコー","ベルク","ベイシア","トライアル","ドン・キホーテ","ドンキ","ドンキホーテ","MEGAドンキ","マクドナルド","McDonald's","マック","McDonalds","モスバーガー","モス","MOS BURGER","ロッテリア","LOTTERIA","ケンタッキー","KFC","ケンタッキーフライドチキン","バーガーキング","BURGER KING","フレッシュネスバーガー","サブウェイ","SUBWAY","ミスタードーナツ","ミスド","Mister Donut","スターバックス","スタバ","Starbucks","STARBUCKS","ドトール","DOUTOR","タリーズ","TULLY'S","タリーズコーヒー","コメダ珈琲","コメダ","KOMEDA","サンマルクカフェ","サンマルク","プロント","PRONTO","上島珈琲","カフェ・ド・クリエ","ベローチェ","すき家","すきや","SUKIYA","吉野家","YOSHINOYA","松屋","MATSUYA","なか卯","NAKAU","てんや","大戸屋","OOTOYA","やよい軒","ガスト","GUSTO","サイゼリヤ","Saizeriya","ジョナサン","Jonathan's","バーミヤン","ロイヤルホスト","デニーズ","Denny's","ココス","COCO'S","ビッグボーイ","くら寿司","くらずし","無添くら寿司","スシロー","SUSHIRO","はま寿司","はまずし","かっぱ寿司","かっぱずし","魚べい","サイゼリア","リンガーハット","丸亀製麺","はなまるうどん","天下一品","一風堂","日高屋","王将","餃子の王将","ペッパーランチ","マツモトキヨシ","マツキヨ","matsukiyo","ウエルシア","Welcia","ツルハドラッグ","ツルハ","サンドラッグ","SUNDRUG","スギ薬局","スギヤマ","ココカラファイン","クリエイト","コスモス","セイムス","ダイコクドラッグ","トモズ","ビックカメラ","ビッグカメラ","BIC CAMERA","ヨドバシカメラ","ヨドバシ","Yodobashi","ヤマダ電機","ヤマダデンキ","YAMADA","エディオン","EDION","ケーズデンキ","K's","ジョーシン","Joshin","ノジマ","コジマ","ソフマップ","ベスト電器","ユニクロ","UNIQLO","GU","ジーユー","しまむら","ライトオン","ハニーズ","ZARA","ザラ","H&M","GAP","ギャップ","ユナイテッドアローズ","ビームス","BEAMS","アーバンリサーチ","ニトリ","NITORI","無印良品","MUJI","ダイソー","DAISO","100円ショップ","セリア","Seria","キャンドゥ","Can Do","フランフラン","東急ハンズ","ハンズ","HANDS","ロフト","LOFT","カインズ","CAINZ","コーナン","KOHNAN","コメリ","ビバホーム","ジョイフル本田","ケーヨーデイツー","D2","高島屋","タカシマヤ","伊勢丹","ISETAN","三越","MITSUKOSHI","大丸","DAIMARU","松坂屋","阪急百貨店","阪急","阪神百貨店","阪神","西武","西武百貨店","東武","東武百貨店","小田急百貨店","京王百貨店","近鉄百貨店","紀伊國屋書店","紀伊国屋","ジュンク堂","丸善","TSUTAYA","ツタヤ","ブックオフ","BOOKOFF","有隣堂","三省堂書店","トイザらス","ベビーザらス","ABCマート","アスビー","眼鏡市場","JINS","ジンズ","Zoff","ゾフ","ENEOS","エネオス","出光","Idemitsu","コスモ石油","COSMO","シェル","Shell","エッソ","Esso","モービル","Mobil","Amazon","アマゾン","楽天","Rakuten","メルカリ","ヤフオク","Yahoo!","PayPay"];for(const l of n)if(a.includes(l)){x=l,i=95;break}const u=a.split(`
`).map(l=>l.trim()).filter(l=>l.length>0);if(i<50){const l=a.match(d.phone);if(l){const c=u.findIndex(o=>o.includes(l[1])||o.includes(l[0]));if(c>0)for(let o=Math.max(0,c-3);o<c;o++){const p=u[o];if(p.length>2&&p.length<20&&!p.match(/[\d\/\-\.:\s]+$/)){x=p,i=70;break}}}}if(i===0&&u.length>0){const l=u[0];l.length>1&&!/^[\d\s\-\/\.:¥￥]+$/.test(l)?(x=l,i=50):u.length>1&&(x=u[1],i=40)}let y="",k=0;for(const l of d.date){const c=a.match(l);if(c){let o=c[1];const p=c[2].padStart(2,"0"),Q=c[3].padStart(2,"0");l.toString().includes("令和")||l.toString().includes("R")?o=(parseInt(o)+2018).toString():o.length===2&&(o="20"+o);const K=new Date(`${o}-${p}-${Q}`);if(!isNaN(K.getTime())&&K.getFullYear()>2e3&&K.getFullYear()<2030){y=`${o}-${p}-${Q}`,k=90;break}}}y||(y=new Date().toISOString().split("T")[0],k=10);let A=0,I=0;for(const l of d.totalAmount){const c=a.match(l);if(c){const o=c[1].replace(/[,，]/g,""),p=parseInt(o);if(!isNaN(p)&&p>0){A=p,I=90;break}}}if(A===0){const l=a.match(/[0-9,]+/g);if(l){const c=l.map(o=>parseInt(o.replace(/[,，]/g,""))).filter(o=>!isNaN(o)&&o>0&&o<1e6);c.length>0&&(A=Math.max(...c),I=40)}}let O=10,M=50;a.match(/8%|軽減税率/)?(O=8,M=80):a.match(/10%/)&&(O=10,M=80);const Z=a.match(d.invoice),T=!!Z,q=Math.round((i+k+I+M+(T?20:0))/(T?5:4));return console.log("抽出結果:",{merchant:x,date:y,amount:A,taxRate:O,hasInvoice:T,confidence:q}),{merchant:x,date:y,amount:A,taxRate:O,category:"未分類",description:T?`インボイス登録番号: ${Z[1]}`:"OCRで抽出",confidence:Math.min(100,q),confidenceScores:{merchant:i,date:k,amount:I,taxRate:M}}},he=async t=>{const s=t.target.files;if(s&&s.length>0){const a=s[0],d=new FileReader;d.onload=async x=>{var n;const i=(n=x.target)==null?void 0:n.result;if(i){const u=new Blob([i],{type:a.type});await H(u)}},d.readAsArrayBuffer(a)}},pe=t=>{z(t.id),N({date:t.date,merchant:t.merchant,amount:t.amount,category:t.category,description:t.description})},ge=()=>{f&&j&&(S(t=>t.map(s=>s.id===f?{...s,...j}:s)),z(null),N({}))},V=async t=>{const s=w.find(i=>i.id===t);if(!s||!(g!=null&&g.uid)){console.error("レシートまたはユーザーが見つかりません");return}const a=(E==null?void 0:E.business_type)||"individual";S(i=>i.map(n=>n.id===t?{...n,status:"approved"}:n));const d={id:s.id,user_id:g.uid,date:s.date,merchant:s.merchant,amount:s.amount,category:s.category,description:s.description,confidence:s.confidence,status:"approved",tax_rate:s.taxRate,confidence_scores:s.confidenceScores},x=await ke(t,d,a,g.uid);x.success?(console.log("✅ レシート承認完了: 各テーブルに保存されました"),D.success(`レシートが承認され、${a==="individual"?"個人":"法人"}の取引として記録されました！`)):(console.error("❌ レシート承認エラー:",x.error),S(i=>i.map(n=>n.id===t?{...n,status:"pending"}:n)),D.error(`エラーが発生しました: ${x.error}`))},W=async t=>{S(s=>s.map(a=>a.id===t?{...a,status:"rejected"}:a)),await Ie(t,"rejected")},be=async()=>{if(h.imageData&&h.retryCount<3){b(t=>({...t,retryCount:t.retryCount+1,errorMessage:void 0}));try{await J(h.imageData)}catch(t){console.error("再試行エラー:",t),b(s=>({...s,errorMessage:"再試行に失敗しました"}))}}},_=t=>{oe(t),Y(!0)},R=w.filter(t=>{const s=t.merchant.toLowerCase().includes($.toLowerCase())||t.description.toLowerCase().includes($.toLowerCase()),a=U==="all"||t.status===U,d=F==="all"||t.category===F;return s&&a&&d}),fe=Array.from(new Set(w.map(t=>t.category)));return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&location.protocol!=="https:"&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(te,{className:"w-5 h-5 text-yellow-500 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"モバイル端末からのアクセスについて"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"現在HTTP環境でアクセスしています。カメラ機能を使用するにはHTTPS環境が必要です。 テスト目的であれば、PCのlocalhost環境（http://localhost:5173）でアクセスしてください。"})]})]})}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ve,{to:"/dashboard",className:"mr-4",children:e.jsx(Oe,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"レシート処理"}),e.jsx("p",{className:"text-text-muted",children:"アップロードされたレシートをAIが解析し、自動で仕訳データを作成します"})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 mb-12",children:[e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"bg-surface rounded-xl shadow-sm border border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold text-text-main",children:"レシートをアップロード"})]}),h.isProcessing&&e.jsxs("div",{className:"mb-5 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-500 animate-spin mr-2"}),e.jsx("span",{className:"text-blue-700 font-medium",children:"レシートを処理中です..."})]}),h.currentStep&&e.jsx("div",{className:"text-sm text-blue-600 mb-2",children:h.currentStep}),h.progress!==void 0&&e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${h.progress}%`}})})]}),h.errorMessage&&e.jsxs("div",{className:"mb-5 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-red-700 text-sm",children:h.errorMessage})]}),h.retryCount<3&&e.jsx("button",{onClick:be,className:"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"再試行"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"group border-2 border-dashed border-border rounded-xl p-8 text-center cursor-pointer hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:he,className:"hidden"}),e.jsx(X,{className:"w-10 h-10 text-text-muted group-hover:text-primary mx-auto mb-3 transition-colors"}),e.jsx("p",{className:"text-sm font-semibold text-text-main mb-1",children:"ファイルを選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"PNG, JPG, PDF対応"})]}),e.jsxs("div",{className:"group border-2 border-dashed border-border rounded-xl p-8 text-center cursor-pointer hover:border-primary hover:bg-primary/5 transition-all duration-200",onClick:xe,children:[e.jsx(Te,{className:"w-10 h-10 text-text-muted group-hover:text-primary mx-auto mb-3 transition-colors"}),e.jsx("p",{className:"text-sm font-semibold text-text-main mb-1",children:"カメラで撮影"}),e.jsx("p",{className:"text-xs text-text-muted",children:"その場で撮影"})]}),e.jsxs("div",{className:"group border-2 border-dashed border-border rounded-xl p-8 text-center hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx($e,{className:"w-10 h-10 text-text-muted group-hover:text-primary mx-auto mb-3 transition-colors"}),e.jsx("p",{className:"text-sm font-semibold text-text-main mb-1",children:"ドラッグ&ドロップ"}),e.jsx("p",{className:"text-xs text-text-muted",children:"ここに画像をドロップ"})]})]})]}),e.jsxs(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"bg-surface border border-border rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(v,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold text-text-main",children:"最近のアップロード"})]}),e.jsx("div",{className:"space-y-3",children:w.length>0?w.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background rounded-lg border border-border hover:border-primary/50 hover:shadow-sm transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary flex-shrink-0",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-text-main",children:t.merchant}),e.jsxs("p",{className:"text-sm text-text-muted",children:[t.date," ",t.amount>0?`• ¥${t.amount.toLocaleString()}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-3 py-1.5 rounded-lg text-xs font-semibold border ${t.status==="approved"?"bg-green-500/10 text-green-600 border-green-500/20":t.status==="rejected"?"bg-red-500/10 text-red-600 border-red-500/20":"bg-yellow-500/10 text-yellow-600 border-yellow-500/20"}`,children:t.status==="approved"?"処理完了":t.status==="rejected"?"却下":"処理中"}),e.jsx("button",{onClick:()=>_(t),className:"p-2 text-text-muted hover:text-primary hover:bg-primary/5 rounded-lg transition-all duration-200",children:e.jsx(De,{className:"w-5 h-5"})})]})]},t.id)):e.jsxs("div",{className:"text-center py-12 text-text-muted",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"まだアップロードされたレシートはありません"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[re&&e.jsx(Ae,{onCapture:H,onClose:me}),ce&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"レシート詳細"}),e.jsx("button",{onClick:()=>Y(!1),className:"text-text-muted hover:text-text-muted",children:e.jsx(B,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"日付"}),e.jsx("p",{className:"text-text-main",children:r.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"店舗名"}),e.jsx("p",{className:"text-text-main",children:r.merchant})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"金額"}),e.jsxs("p",{className:"text-text-main",children:["¥",r.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"カテゴリ"}),e.jsx("p",{className:"text-text-main",children:r.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"説明"}),e.jsx("p",{className:"text-text-main",children:r.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${r.confidence>=90?"bg-green-500":r.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[r.confidence,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"ステータス"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.status==="approved"?"bg-green-100 text-green-800":r.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status==="approved"?"承認済み":r.status==="rejected"?"却下":"保留中"})]}),r.taxRate!==void 0&&r.taxRate>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"税率"}),e.jsxs("p",{className:"text-text-main",children:[r.taxRate,"%"]})]}),r.confidenceScores&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度詳細"}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",r.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",r.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",r.confidenceScores.amount||0,"%"]})]})]}),r.aiAnalysis&&e.jsxs("div",{className:"border-t border-border pt-3",children:[e.jsx("h4",{className:"text-sm font-medium text-text-muted mb-2",children:"AI分析結果"}),r.aiAnalysis.category&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"推定カテゴリ"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.category})]}),r.aiAnalysis.expenseType&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"支出種別"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.expenseType})]}),r.aiAnalysis.confidence!==void 0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"AI信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${r.aiAnalysis.confidence>=.9?"bg-green-500":r.aiAnalysis.confidence>=.7?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.aiAnalysis.confidence*100}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[Math.round(r.aiAnalysis.confidence*100),"%"]})]})]}),r.aiAnalysis.insights&&r.aiAnalysis.insights.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"分析インサイト"}),e.jsx("ul",{className:"list-disc pl-4 space-y-1 mt-1",children:r.aiAnalysis.insights.map((t,s)=>e.jsx("li",{className:"text-xs text-text-muted",children:t},s))})]}),r.aiAnalysis.items&&r.aiAnalysis.items.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"商品アイテム"}),e.jsx("div",{className:"mt-1 space-y-1",children:r.aiAnalysis.items.map((t,s)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-text-muted",children:t.name}),e.jsxs("span",{className:"text-text-main",children:["¥",t.price.toLocaleString()]})]},s))})]})]})]})}),e.jsx("div",{className:"p-4 border-t border-border flex justify-end space-x-2",children:e.jsx("button",{onClick:()=>Y(!1),className:"px-4 py-2 bg-border text-text-main rounded-md hover:bg-gray-300 transition-colors",children:"閉じる"})})]})}),e.jsx("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-5 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"店舗名や説明で検索...",className:"w-full pl-11 pr-4 py-2.5 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-background transition-all",value:$,onChange:t=>le(t.target.value)})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{className:"px-4 py-2.5 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-background font-medium text-sm transition-all w-full sm:w-auto",value:U,onChange:t=>de(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのステータス"}),e.jsx("option",{value:"pending",children:"保留中"}),e.jsx("option",{value:"approved",children:"承認済み"}),e.jsx("option",{value:"rejected",children:"却下"})]}),e.jsxs("select",{className:"px-4 py-2.5 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-background font-medium text-sm transition-all w-full sm:w-auto",value:F,onChange:t=>ie(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのカテゴリ"}),fe.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsx("h2",{className:"text-xl font-semibold text-text-main",children:"処理済みレシート"})}),e.jsx("div",{className:"md:hidden p-4 space-y-4",children:R.length===0?e.jsxs("div",{className:"p-8 text-center text-text-muted border border-dashed border-border rounded-lg",children:[e.jsx(v,{className:"w-10 h-10 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"処理済みのレシートはありません"}),e.jsx("p",{className:"text-sm mt-1",children:"新しいレシートをアップロードしてください"})]}):R.map(t=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main",children:t.merchant}),e.jsx("p",{className:"text-sm text-text-muted",children:t.date})]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認":t.status==="rejected"?"却下":"保留"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-lg font-semibold text-text-main",children:["¥",t.amount.toLocaleString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-text-muted",children:t.category}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>_(t),className:"p-2 text-primary hover:text-blue-900 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"詳細",children:e.jsx(ae,{className:"w-5 h-5"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t.id),className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"承認",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>W(t.id),className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-full transition-colors duration-200",title:"却下",children:e.jsx(B,{className:"w-5 h-5"})})]})]})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"店舗名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"信頼度"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"ステータス"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-gray-200",children:R.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-6 py-12 text-center text-text-muted",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"処理済みのレシートはありません"}),e.jsx("p",{className:"text-sm mt-1",children:"新しいレシートをアップロードしてください"})]})}):R.map(t=>e.jsxs("tr",{className:"hover:bg-background",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:f===t.id?e.jsx("input",{type:"date",value:j.date||t.date,onChange:s=>N(a=>({...a,date:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:f===t.id?e.jsx("input",{type:"text",value:j.merchant||t.merchant,onChange:s=>N(a=>({...a,merchant:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.merchant}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:f===t.id?e.jsx("input",{type:"number",value:j.amount||t.amount,onChange:s=>N(a=>({...a,amount:Number(s.target.value)})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):`¥${t.amount.toLocaleString()}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:f===t.id?e.jsxs("select",{value:j.category||t.category,onChange:s=>N(a=>({...a,category:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm",children:[e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"旅費交通費",children:"旅費交通費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"})]}):t.category}),e.jsx("td",{className:"px-6 py-4 text-sm text-text-main max-w-xs truncate",children:f===t.id?e.jsx("input",{type:"text",value:j.description||t.description,onChange:s=>N(a=>({...a,description:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):e.jsxs("div",{children:[e.jsx("div",{children:t.description}),t.taxRate!==void 0&&t.taxRate>0&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["税率: ",t.taxRate,"%"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]}),t.confidenceScores&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",t.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",t.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",t.confidenceScores.amount||0,"%"]})]}),t.aiAnalysis&&t.aiAnalysis.confidence!==void 0&&e.jsx("div",{className:"text-xs text-text-muted mt-1",children:e.jsxs("div",{children:["AI信頼度: ",Math.round(t.aiAnalysis.confidence*100),"%"]})})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認済み":t.status==="rejected"?"却下":"保留中"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("div",{className:"flex space-x-2",children:f===t.id?e.jsx("button",{onClick:ge,className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"保存",children:e.jsx(Ee,{className:"w-5 h-5"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(t),className:"p-2 text-primary hover:text-blue-900 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"詳細",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>pe(t),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-full transition-colors duration-200",title:"編集",children:e.jsx(v,{className:"w-5 h-5"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t.id),className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"承認",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>W(t.id),className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-full transition-colors duration-200",title:"却下",children:e.jsx(B,{className:"w-5 h-5"})})]})]})})})]},t.id))})]})})]}),e.jsx(Pe,{children:ne&&G&&e.jsx(Ce,{receiptData:G,onClose:()=>{P(!1),L(null)},onRetake:()=>{P(!1),L(null),C(!0)}})})]})]})})};export{qe as default};
