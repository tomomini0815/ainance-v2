<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFÂ∫ßÊ®ô„Ç≠„É£„É™„Éñ„É¨„Éº„Çø„Éº - „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÁâà</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .pdf-panel {
            flex: 1;
            overflow: auto;
            position: relative;
            padding: 20px;
            background: #16213e;
        }

        .sidebar {
            width: 380px;
            background: #0f3460;
            padding: 20px;
            overflow-y: auto;
        }

        h1 {
            color: #e94560;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        h2 {
            color: #0abde3;
            margin: 15px 0 10px;
            font-size: 1em;
            border-bottom: 1px solid #2a4a6a;
            padding-bottom: 5px;
        }

        .canvas-wrapper {
            position: relative;
            display: inline-block;
        }

        #pdfCanvas {
            border: 2px solid #e94560;
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.3);
        }

        .draggable-point {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            transition: transform 0.1s, box-shadow 0.1s;
            z-index: 100;
        }

        .draggable-point:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .draggable-point.dragging {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            z-index: 1000;
        }

        .draggable-point.digit {
            background: #e94560;
        }

        .draggable-point.text {
            background: #10ac84;
        }

        .draggable-point.selected {
            border: 3px solid #f1c40f;
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.8);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 4px;
            background: #1a1a2e;
            color: #fff;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px 0;
            width: 100%;
            transition: all 0.2s;
        }

        button:hover {
            transform: scale(1.02);
        }

        .btn-primary {
            background: #e94560;
            color: white;
        }

        .btn-success {
            background: #10ac84;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: #1a1a2e;
        }

        .field-list {
            max-height: 300px;
            overflow-y: auto;
            background: #1a1a2e;
            border-radius: 8px;
            padding: 10px;
        }

        .field-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            background: #2a3a5a;
            font-size: 0.8em;
            cursor: pointer;
        }

        .field-item:hover {
            background: #3a4a6a;
        }

        .field-item.selected {
            background: #f39c1233;
            border: 1px solid #f39c12;
        }

        .field-item .num {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }

        .field-item .num.digit {
            background: #e94560;
        }

        .field-item .num.text {
            background: #10ac84;
        }

        #output {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.7em;
            white-space: pre-wrap;
            max-height: 250px;
            overflow-y: auto;
        }

        .instructions {
            background: rgba(10, 189, 227, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .selected-info {
            background: #f39c1233;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 0.8em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-item .dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="pdf-panel">
            <div class="canvas-wrapper" id="canvasWrapper">
                <canvas id="pdfCanvas"></canvas>
                <!-- Draggable points will be added here -->
            </div>
        </div>

        <div class="sidebar">
            <h1>üìç „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÂ∫ßÊ®ôË™øÊï¥</h1>

            <div class="instructions">
                <strong>‰Ωø„ÅÑÊñπ:</strong><br>
                1. PDF„ÇíË™≠„ÅøËæº„ÇÄ<br>
                2. ÁÇπ„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶Ê≠£„Åó„ÅÑ‰ΩçÁΩÆ„Å´ÁßªÂãï<br>
                3. „ÄåÂ∫ßÊ®ô„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Äç„Åß„Ç≥„Éº„ÉâÂèñÂæó
            </div>

            <div class="input-group">
                <label>PDF„Éï„Ç°„Ç§„É´:</label>
                <input type="file" id="pdfFile" accept=".pdf">
            </div>

            <button class="btn-warning" id="showPoints">ÔøΩ ÁÇπ„ÇíË°®Á§∫</button>

            <div class="selected-info" id="selectedInfo" style="display:none;">
                <strong>ÈÅ∏Êäû‰∏≠:</strong> <span id="selectedName">-</span><br>
                ‰ΩçÁΩÆ: <span id="selectedCoords">-</span>
            </div>

            <h2>üìã „Éï„Ç£„Éº„É´„Éâ‰∏ÄË¶ß</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="dot" style="background:#e94560"></div> Êï∞Â≠ó
                </div>
                <div class="legend-item">
                    <div class="dot" style="background:#10ac84"></div> „ÉÜ„Ç≠„Çπ„Éà
                </div>
            </div>
            <div class="field-list" id="fieldList"></div>

            <h2>üì§ „Ç®„ÇØ„Çπ„Éù„Éº„Éà</h2>
            <button class="btn-success" id="exportCoords">üìã Â∫ßÊ®ô„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
            <div id="output">PDF„ÇíË™≠„ÅøËæº„Çì„ÅßÁÇπ„ÇíÈÖçÁΩÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfDoc = null;
        let scale = 1.5;
        let pdfWidth = 0;
        let pdfHeight = 0;
        let selectedPoint = null;
        let isDragging = false;

        const canvas = document.getElementById('pdfCanvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('canvasWrapper');

        // Field definitions with initial positions
        const fields = [
            // Left column digit boxes
            { id: 'ÊâÄÂæóÈáëÈ°ç_row1', type: 'digit', x: 256, y: 628, label: '1' },
            { id: 'Ê≥ï‰∫∫Á®éÈ°ç_row2', type: 'digit', x: 256, y: 608, label: '2' },
            { id: 'ÁâπÂà•ÊéßÈô§È°ç_row3', type: 'digit', x: 256, y: 588, label: '3' },
            { id: 'Á®éÈ°çÊéßÈô§_row4', type: 'digit', x: 256, y: 568, label: '4' },
            { id: 'Âà©Â≠êÁ®é_row5', type: 'digit', x: 256, y: 548, label: '5' },
            { id: 'ÊéßÈô§Á®éÈ°ç_row6', type: 'digit', x: 256, y: 528, label: '6' },
            { id: 'Áïô‰øùÈáëÈ°ç_row7', type: 'digit', x: 256, y: 508, label: '7' },
            { id: 'Âêå‰∏äÁ®éÈ°ç_row8', type: 'digit', x: 256, y: 488, label: '8' },
            { id: 'Ê≥ï‰∫∫Á®éÈ°çË®à1_row9', type: 'digit', x: 256, y: 468, label: '9' },
            { id: 'row10', type: 'digit', x: 256, y: 448, label: '10' },
            { id: 'row11', type: 'digit', x: 256, y: 428, label: '11' },
            { id: 'row12', type: 'digit', x: 256, y: 408, label: '12' },
            { id: 'Â∑ÆÂºïÊ≥ï‰∫∫Á®éÈ°ç_row13', type: 'digit', x: 256, y: 388, label: '13' },
            { id: '‰∏≠ÈñìÁî≥Âëä_row14', type: 'digit', x: 256, y: 368, label: '14' },
            { id: 'row15', type: 'digit', x: 256, y: 348, label: '15' },
            { id: 'row16', type: 'digit', x: 256, y: 328, label: '16' },
            { id: 'row17', type: 'digit', x: 256, y: 308, label: '17' },
            { id: 'ÊâÄÂæóÂêàË®à_row18', type: 'digit', x: 256, y: 288, label: '18' },
            { id: 'row19', type: 'digit', x: 256, y: 268, label: '19' },
            { id: 'row20', type: 'digit', x: 256, y: 248, label: '20' },
            { id: 'row21', type: 'digit', x: 256, y: 228, label: '21' },
            { id: 'row22', type: 'digit', x: 256, y: 208, label: '22' },
            { id: 'row23', type: 'digit', x: 256, y: 188, label: '23' },
            { id: 'row24', type: 'digit', x: 256, y: 168, label: '24' },
            { id: 'row25', type: 'digit', x: 256, y: 148, label: '25' },
            { id: 'row26', type: 'digit', x: 256, y: 128, label: '26' },
            { id: 'row27', type: 'digit', x: 256, y: 108, label: '27' },
            { id: 'Ê≥ï‰∫∫Á®éÈ°çË®à_row28', type: 'digit', x: 256, y: 88, label: '28' },

            // Text fields
            { id: 'Á®éÂãôÁΩ≤Âêç', type: 'text', x: 95, y: 805, label: 'Á®é' },
            { id: 'Ê≥ï‰∫∫Âêç', type: 'text', x: 68, y: 780, label: 'Ê≥ï' },
            { id: 'Ê≥ï‰∫∫Áï™Âè∑', type: 'text', x: 360, y: 820, label: 'Áï™' },
            { id: 'Á¥çÁ®éÂú∞', type: 'text', x: 68, y: 695, label: 'Á¥ç' },
            { id: 'ÈõªË©±Áï™Âè∑', type: 'text', x: 240, y: 695, label: 'Èõª' },
            { id: '‰ª£Ë°®ËÄÖÊ∞èÂêç', type: 'text', x: 68, y: 665, label: '‰ª£' },
        ];

        // Load PDF
        document.getElementById('pdfFile').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const arrayBuffer = await file.arrayBuffer();
            pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
            await renderPage();
        });

        async function renderPage() {
            const page = await pdfDoc.getPage(1);
            const viewport = page.getViewport({ scale });
            pdfWidth = page.getViewport({ scale: 1 }).width;
            pdfHeight = page.getViewport({ scale: 1 }).height;
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            await page.render({ canvasContext: ctx, viewport }).promise;
        }

        // Convert PDF coords to screen position
        function pdfToScreen(x, y) {
            return {
                left: x * scale,
                top: (pdfHeight - y) * scale
            };
        }

        // Convert screen position to PDF coords
        function screenToPdf(left, top) {
            return {
                x: left / scale,
                y: pdfHeight - (top / scale)
            };
        }

        // Create draggable points
        function createPoints() {
            // Remove existing points
            document.querySelectorAll('.draggable-point').forEach(el => el.remove());

            fields.forEach((field, index) => {
                const pos = pdfToScreen(field.x, field.y);
                const point = document.createElement('div');
                point.className = `draggable-point ${field.type}`;
                point.textContent = field.label;
                point.style.left = pos.left + 'px';
                point.style.top = pos.top + 'px';
                point.dataset.index = index;

                // Drag handlers
                point.addEventListener('mousedown', startDrag);

                wrapper.appendChild(point);
            });

            renderFieldList();
        }

        // Drag functionality
        function startDrag(e) {
            e.preventDefault();
            const point = e.target;
            const index = parseInt(point.dataset.index);

            isDragging = true;
            selectedPoint = point;
            point.classList.add('dragging', 'selected');

            // Update selection
            document.querySelectorAll('.draggable-point').forEach(p => {
                if (p !== point) p.classList.remove('selected');
            });
            document.querySelectorAll('.field-item').forEach(item => {
                item.classList.toggle('selected', parseInt(item.dataset.index) === index);
            });

            updateSelectedInfo(fields[index]);

            const onMouseMove = (e) => {
                if (!isDragging) return;
                const rect = wrapper.getBoundingClientRect();
                const left = e.clientX - rect.left;
                const top = e.clientY - rect.top;

                // Constrain to canvas
                const constrainedLeft = Math.max(0, Math.min(left, canvas.width));
                const constrainedTop = Math.max(0, Math.min(top, canvas.height));

                point.style.left = constrainedLeft + 'px';
                point.style.top = constrainedTop + 'px';

                // Update field data
                const pdfCoords = screenToPdf(constrainedLeft, constrainedTop);
                fields[index].x = Math.round(pdfCoords.x * 10) / 10;
                fields[index].y = Math.round(pdfCoords.y * 10) / 10;

                updateSelectedInfo(fields[index]);
            };

            const onMouseUp = () => {
                isDragging = false;
                point.classList.remove('dragging');
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                renderFieldList();
            };

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        }

        // Update selected info display
        function updateSelectedInfo(field) {
            document.getElementById('selectedInfo').style.display = 'block';
            document.getElementById('selectedName').textContent = field.id;
            document.getElementById('selectedCoords').textContent = `X: ${field.x}, Y: ${field.y}`;
        }

        // Render field list
        function renderFieldList() {
            const list = document.getElementById('fieldList');
            list.innerHTML = fields.map((f, i) => `
                <div class="field-item" data-index="${i}">
                    <div class="num ${f.type}">${f.label}</div>
                    <span>${f.id}</span>
                    <span style="margin-left:auto; color:#888; font-family:monospace;">(${f.x}, ${f.y})</span>
                </div>
            `).join('');

            // Click to select
            list.querySelectorAll('.field-item').forEach(item => {
                item.addEventListener('click', () => {
                    const index = parseInt(item.dataset.index);
                    const point = document.querySelector(`.draggable-point[data-index="${index}"]`);
                    if (point) {
                        document.querySelectorAll('.draggable-point').forEach(p => p.classList.remove('selected'));
                        document.querySelectorAll('.field-item').forEach(i => i.classList.remove('selected'));
                        point.classList.add('selected');
                        item.classList.add('selected');
                        updateSelectedInfo(fields[index]);
                    }
                });
            });
        }

        // Show points button
        document.getElementById('showPoints').addEventListener('click', () => {
            if (!pdfDoc) {
                alert('PDF„ÇíÂÖà„Å´Ë™≠„ÅøËæº„Çì„Åß„Åè„Å†„Åï„ÅÑ');
                return;
            }
            createPoints();
        });

        // Export
        document.getElementById('exportCoords').addEventListener('click', () => {
            const digitFields = fields.filter(f => f.type === 'digit');
            const textFields = fields.filter(f => f.type === 'text');

            let output = '// ===== BEPPYO1 DIGIT BOX FIELDS =====\n';
            output += 'export const BEPPYO1_FIELDS: { [key: string]: DigitBoxConfig } = {\n';

            digitFields.forEach(f => {
                output += `    '${f.id}': {\n`;
                output += `        anchorX: ${f.x},\n`;
                output += `        anchorY: ${f.y},\n`;
                output += `        boxWidth: 16,\n`;
                output += `        boxSpacing: 16,\n`;
                output += `        fontSize: 10,\n`;
                output += `        maxDigits: 12\n`;
                output += `    },\n`;
            });

            output += '};\n\n';
            output += '// ===== BEPPYO1 TEXT FIELDS =====\n';
            output += 'export const BEPPYO1_TEXT_FIELDS: { [key: string]: TextFieldConfig } = {\n';

            textFields.forEach(f => {
                output += `    '${f.id}': { x: ${f.x}, y: ${f.y}, fontSize: 9 },\n`;
            });

            output += '};\n';

            document.getElementById('output').textContent = output;
        });
    </script>
</body>

</html>