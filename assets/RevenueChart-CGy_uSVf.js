import{r as N,j as t,H as z,n as V}from"./index-Cte9M9zr.js";import{f as _,C as A,a as F,L as I,P as Y,e as Q,p as G,c as J,d as K,i as O}from"./index-BGJXM4Re.js";import{C as T}from"./chart-pie-DYAcJCiu.js";import{A as U}from"./activity-BwXN39C0.js";import{g as X}from"./motion-Di5WGlKG.js";A.register(F,I,Y,Q,G,J,K,O);const se=({transactions:x,selectedYear:d})=>{const[a,c]=N.useState("monthly"),$=N.useMemo(()=>{const e={};let r=[];const p=d||new Date().getFullYear();if(a==="monthly")for(let o=0;o<12;o++){const s=new Date(p,o,1),i=`${s.getFullYear()}年${s.getMonth()+1}月`;r.push(i),e[i]={revenue:0,expense:0,count:0}}else if(a==="quarterly")for(let o=1;o<=4;o++){const s=`${p}年 Q${o}`;r.push(s),e[s]={revenue:0,expense:0,count:0}}else if(a==="yearly")for(let o=4;o>=0;o--){const i=`${p-o}年`;r.push(i),e[i]={revenue:0,expense:0,count:0}}x.forEach(o=>{var v,k,w;if(o.approval_status==="pending")return;const s=o.amount,i=typeof s=="number"?s:parseFloat(String(s||"0").replace(/,/g,"")),g=new Date(o.date),u=g.getFullYear(),y=g.getMonth()+1;let l="";if(a==="monthly")l=`${u}年${y}月`;else if(a==="quarterly"){const n=Math.ceil(y/3);l=`${u}年 Q${n}`}else a==="yearly"&&(l=`${u}年`);if(e[l]){e[l].count+=1;let n=i;if((v=o.tags)!=null&&v.includes("depreciation_asset")){const j=(k=o.description)==null?void 0:k.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(j)n=parseInt(j[1].replace(/,/g,""),10);else{const C=(w=o.description)==null?void 0:w.match(/年間償却費: ¥([\d,]+)/);C&&(n=parseInt(C[1].replace(/,/g,""),10))}}o.type==="income"?e[l].revenue+=Math.abs(n):o.type==="expense"?e[l].expense+=Math.abs(n):n>0?e[l].revenue+=n:n<0&&(e[l].expense+=Math.abs(n))}});const S=r.map(o=>e[o].revenue),E=r.map(o=>e[o].expense),q=r.map(o=>e[o].revenue-e[o].expense),P=r.map(o=>e[o].count);return{labels:r,revenue:S,expense:E,profit:q,count:P}},[x,a]),{labels:M,revenue:h,expense:m,profit:B,count:L}=$,f=h.reduce((e,r)=>e+r,0),b=m.reduce((e,r)=>e+r,0),W=f-b,R=L.reduce((e,r)=>e+r,0),D={labels:M,datasets:[{label:"収益",data:h,borderColor:"#06b6d4",backgroundColor:"rgba(6, 182, 212, 0.15)",tension:.4,pointBackgroundColor:"#06b6d4",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:0,pointHoverRadius:6,pointHoverBorderWidth:3,fill:!0},{label:"支出",data:m,borderColor:"#f472b6",backgroundColor:"rgba(244, 114, 182, 0.15)",tension:.4,pointBackgroundColor:"#f472b6",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:0,pointHoverRadius:6,pointHoverBorderWidth:3,fill:!0},{label:"利益",data:B,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.15)",tension:.4,pointBackgroundColor:"#10b981",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:0,pointHoverRadius:6,pointHoverBorderWidth:3,fill:!0,borderDash:[5,5]}]},H={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,boxWidth:9,boxHeight:9,padding:20,color:"#94a3b8",font:{size:12,family:"Inter"}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(15, 23, 42, 0.9)",titleColor:"#f8fafc",bodyColor:"#e2e8f0",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,padding:10,callbacks:{label:function(e){let r=e.dataset.label||"";return r&&(r+=": "),e.parsed.y!==null&&(r+=e.parsed.y.toLocaleString()+"円"),r}}}},scales:{x:{display:!0,grid:{display:!1,color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#64748b",font:{size:11}}},y:{display:!0,grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#64748b",font:{size:11},callback:function(e){return e>=1e6?e/1e6+"M":e>=1e3?e/1e3+"k":e}}}},interaction:{mode:"nearest",axis:"x",intersect:!1}};return t.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-5 border border-border shadow-sm transition-all duration-200 hover:shadow-md h-full flex flex-col",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between mb-4 gap-2",children:[t.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-text-main whitespace-nowrap",children:["収益・支出・利益推移 ",d?`(${d}年度)`:""]}),t.jsxs("div",{className:"flex p-1 bg-surface-highlight rounded-xl w-fit",children:[t.jsxs("button",{onClick:()=>c("monthly"),className:`whitespace-nowrap text-xs px-3 py-1.5 rounded-lg font-bold transition-all flex items-center gap-1.5 ${a==="monthly"?"bg-white dark:bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[t.jsx(z,{className:"w-3.5 h-3.5"}),"月次"]}),t.jsxs("button",{onClick:()=>c("quarterly"),className:`whitespace-nowrap text-xs px-3 py-1.5 rounded-lg font-bold transition-all flex items-center gap-1.5 ${a==="quarterly"?"bg-white dark:bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[t.jsx(T,{className:"w-3.5 h-3.5"}),"四半期"]}),t.jsxs("button",{onClick:()=>c("yearly"),className:`whitespace-nowrap text-xs px-3 py-1.5 rounded-lg font-bold transition-all flex items-center gap-1.5 ${a==="yearly"?"bg-white dark:bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[t.jsx(U,{className:"w-3.5 h-3.5"}),"年次"]})]})]}),t.jsx("div",{className:"chart-container h-64 w-full flex-shrink-0",children:t.jsx(_,{data:D,options:H})}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("h4",{className:"text-sm font-black text-text-main mb-4 flex items-center gap-2.5",children:[t.jsx("div",{className:"w-1.5 h-4 bg-primary rounded-full shadow-sm shadow-primary/30"}),"統計データ"]}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{id:"count",icon:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),label:"総取引数",period:a==="yearly"?"過去5年":"過去1年",value:`${R}件`,color:"from-blue-500/10 to-indigo-500/10",iconColor:"bg-blue-500/15 text-blue-500",borderColor:"border-blue-500/20"},{id:"revenue",icon:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),label:"総収益",period:a==="yearly"?"過去5年":"過去1年",value:`¥${f.toLocaleString()}`,color:"from-cyan-500/10 to-blue-500/10",iconColor:"bg-cyan-500/15 text-cyan-500",borderColor:"border-cyan-500/20"},{id:"expense",icon:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})}),label:"総支出",period:a==="yearly"?"過去5年":"過去1年",value:`¥${b.toLocaleString()}`,color:"from-pink-500/10 to-red-500/10",iconColor:"bg-pink-500/15 text-pink-500",borderColor:"border-pink-500/20"},{id:"profit",icon:t.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",viewBox:"0 0 24 24",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("path",{d:"M12 9.5V17"}),t.jsx("path",{d:"M12 9.5 8 5"}),t.jsx("path",{d:"M12 9.5 16 5"}),t.jsx("path",{d:"M9 12h6"}),t.jsx("path",{d:"M9 15h6"})]}),label:"純利益",period:a==="yearly"?"過去5年":"過去1年",value:`¥${W.toLocaleString()}`,color:"from-emerald-500/10 to-green-500/10",iconColor:"bg-emerald-500/15 text-emerald-500",borderColor:"border-emerald-500/20"}].map((e,r)=>t.jsxs(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.1},className:`relative overflow-hidden bg-gradient-to-br ${e.color} p-2.5 rounded-xl border ${e.borderColor} shadow-sm backdrop-blur-sm group hover:scale-[1.02] transition-transform flex flex-col justify-between min-h-[84px]`,children:[t.jsxs("div",{className:"relative z-10",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[t.jsx("div",{className:`p-1.5 rounded-lg ${e.iconColor} shrink-0`,children:V.cloneElement(e.icon,{className:"w-3.5 h-3.5"})}),t.jsxs("div",{className:"flex flex-col min-w-0",children:[t.jsx("p",{className:"text-[10px] text-slate-900 dark:text-white font-bold truncate leading-tight",children:e.label}),t.jsx("p",{className:"text-[8px] text-gray-400 truncate uppercase tracking-tighter",children:e.period})]})]}),t.jsx("p",{className:"text-base font-black text-text-main truncate tracking-tight",children:e.value})]}),t.jsx("div",{className:`absolute -right-3 -bottom-3 w-10 h-10 rounded-full opacity-10 group-hover:scale-150 transition-transform duration-500 ${e.id==="revenue"?"bg-cyan-500":e.id==="expense"?"bg-pink-500":e.id==="profit"?"bg-emerald-500":"bg-blue-500"}`})]},e.id))})]})]})};export{se as default};
