import{e as g,a as b,l as f,r as c,j as e,L as j}from"./index-0N2qkU5h.js";import{D as N,C as y,A as v,c as w,d as k}from"./index-BzMhKRxs.js";import{T as C}from"./TransactionIcon-CPEuldyC.js";import{A as L}from"./arrow-left-B0TMViCY.js";y.register(v,w,k);const M=()=>{const{currentBusinessType:o}=g(),{user:d}=b(),{transactions:h}=f(d==null?void 0:d.id,o==null?void 0:o.business_type),[r,x]=c.useState(null),i=c.useMemo(()=>h.filter(t=>t.type==="expense"&&t.approval_status!=="pending"&&typeof t.amount=="number"),[h]),l=c.useMemo(()=>{const t={};i.forEach(a=>{const n=Math.abs(a.amount);t[a.category]=(t[a.category]||0)+n});const s=Object.values(t).reduce((a,n)=>a+n,0);return Object.entries(t).map(([a,n])=>({name:a,value:n,percentage:s>0?n/s*100:0})).sort((a,n)=>n.value-a.value)},[i]),p=c.useMemo(()=>{const t=["#6366f1","#8b5cf6","#3b82f6","#0ea5e9","#06b6d4","#14b8a6","#f59e0b","#f97316","#ef4444","#ec4899"];return{labels:l.map(s=>s.name),datasets:[{data:l.map(s=>s.percentage),backgroundColor:l.map((s,a)=>t[a%t.length]),borderWidth:0,cutout:"75%"}]}},[l]),m=c.useMemo(()=>r?i.filter(t=>t.category===r):i,[i,r]),u=l.reduce((t,s)=>t+s.value,0);return e.jsx("div",{className:"min-h-screen bg-background pb-20",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{to:"/dashboard",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:e.jsx(L,{className:"w-6 h-6 text-text-muted"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"支出カテゴリ詳細"}),e.jsx("p",{className:"text-sm text-text-muted",children:"カテゴリ別の支出内訳と詳細分析"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-surface p-6 rounded-2xl border border-border shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-text-main mb-6",children:"支出構成比"}),e.jsxs("div",{className:"relative h-64 mb-6",children:[e.jsx(N,{data:p,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},onClick:(t,s)=>{if(s.length>0){const a=s[0].index;x(l[a].name)}}}}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("p",{className:"text-sm text-text-muted",children:"総支出"}),e.jsxs("p",{className:"text-2xl font-bold text-text-main",children:["¥",u.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-3 overflow-y-auto max-h-96 pr-2 custom-scrollbar",children:[e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors ${r?"hover:bg-surface-highlight border border-transparent":"bg-primary/10 border border-primary/20"}`,onClick:()=>x(null),children:[e.jsx("span",{className:"font-bold text-text-main text-sm",children:"すべて"}),e.jsxs("span",{className:"font-bold text-text-main",children:["¥",u.toLocaleString()]})]}),l.map((t,s)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors ${r===t.name?"bg-primary/10 border border-primary/20":"hover:bg-surface-highlight border border-transparent"}`,onClick:()=>x(t.name===r?null:t.name),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:p.datasets[0].backgroundColor[s]}}),e.jsx("div",{className:"font-medium text-text-main text-sm",children:t.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-text-main",children:["¥",t.value.toLocaleString()]}),e.jsxs("div",{className:"text-xs text-text-muted",children:[t.percentage.toFixed(1),"%"]})]})]},s))]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl border border-border shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-text-main",children:r?`${r} の取引一覧`:"すべての支出取引"}),e.jsxs("span",{className:"bg-surface-highlight px-3 py-1 rounded-full text-xs font-medium text-text-muted",children:[m.length,"件"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-highlight",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"内容"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"})]})}),e.jsxs("tbody",{className:"divide-y divide-border",children:[m.map(t=>e.jsxs("tr",{className:"hover:bg-surface-highlight transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-muted",children:new Date(t.date).toLocaleDateString("ja-JP")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{item:t.item,category:t.category,size:"sm"}),e.jsx("span",{className:"text-sm font-medium text-text-main",children:t.item})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-surface-highlight text-text-secondary border border-border",children:t.category})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-bold text-white",children:["¥",Math.abs(t.amount).toLocaleString()]})]},t.id)),m.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-12 text-center text-text-muted",children:"該当する取引がありません"})})]})]})})]})})]})]})})};export{M as default};
