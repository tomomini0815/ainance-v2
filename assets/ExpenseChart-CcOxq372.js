import{j as e,L as A,C as E}from"./index-Cte9M9zr.js";import{D as L,C as _,A as $,c as D,d as M}from"./index-BGJXM4Re.js";import{A as O}from"./index-DNAwpMfK.js";import{g as T}from"./motion-Di5WGlKG.js";_.register($,D,M);const W=({transactions:y,selectedYear:d})=>{const N=()=>{const a=y.filter(s=>s.type==="expense"&&s.approval_status!=="pending"),t={};a.forEach(s=>{var f,g,b;let o=Math.abs(typeof s.amount=="string"?parseFloat(s.amount):s.amount);if((f=s.tags)!=null&&f.includes("depreciation_asset")){const j=(g=s.description)==null?void 0:g.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(j)o=parseInt(j[1].replace(/,/g,""),10);else{const v=(b=s.description)==null?void 0:b.match(/年間償却費: ¥([\d,]+)/);v&&(o=parseInt(v[1].replace(/,/g,""),10))}}const n=s.category||"その他";t[n]||(t[n]={amount:0,count:0}),t[n].amount+=o,t[n].count+=1});const l=Object.values(t).reduce((s,o)=>s+o.amount,0),p={};return Object.keys(t).forEach(s=>{p[s]=Math.round(t[s].amount/l*100)}),{categoryTotals:t,percentages:p,totalAmount:l}},{percentages:m,categoryTotals:x,totalAmount:w}=N(),r=Object.keys(m),c=Object.values(m),u=r.map(a=>x[a].amount),h=["#6366f1","#8b5cf6","#3b82f6","#0ea5e9","#06b6d4","#14b8a6","#f59e0b","#f97316","#ef4444","#ec4899"],i=r.map((a,t)=>h[t%h.length]),k={labels:r,datasets:[{data:c,backgroundColor:i,borderWidth:0,cutout:"75%"}]},C={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(a){const t=a.label||"",l=u[a.dataIndex];return`${t}: ${a.parsed}% (${l.toLocaleString()}円)`}},backgroundColor:"rgba(15, 23, 42, 0.9)",titleColor:"#f8fafc",bodyColor:"#e2e8f0",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,padding:10}}};return e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-6 border border-border shadow-sm transition-all duration-200 hover:shadow-md h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-text-main",children:["支出カテゴリ ",d?`(${d}年度)`:""]}),e.jsxs(A,{to:"/expense-breakdown",className:"flex items-center text-sm text-primary hover:text-primary/80 transition-colors",children:["詳細を見る",e.jsx(E,{className:"w-4 h-4 ml-1"})]})]}),e.jsxs("div",{className:"chart-container h-64 w-full relative flex-shrink-0",children:[e.jsx(L,{data:k,options:C}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("p",{className:"text-sm text-text-muted",children:"総支出"}),e.jsxs("p",{className:"text-2xl font-bold text-text-main",children:["¥",w.toLocaleString()]})]})]}),e.jsxs("div",{className:"mt-8 flex-1 min-h-0 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:e.jsx("h4",{className:"font-bold text-text-main text-sm",children:"カテゴリ別支出内訳"})}),e.jsx("div",{className:"space-y-2 overflow-y-auto pr-2 custom-scrollbar flex-1 -mr-2",children:e.jsx(O,{mode:"popLayout",children:r.map((a,t)=>e.jsxs(T.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.95},transition:{delay:t*.05},className:"flex items-center justify-between group p-3 rounded-xl hover:bg-surface-highlight/80 border border-transparent hover:border-border/50 transition-all duration-300 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx("div",{className:"w-2 h-2 rounded-full mr-4 shadow-lg group-hover:scale-125 transition-transform",style:{backgroundColor:i[t]}}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold text-text-main truncate group-hover:text-primary transition-colors",children:a}),e.jsxs("span",{className:"text-[10px] text-text-muted",children:[x[a].count||0,"件の取引"]})]})]}),e.jsx("div",{className:"flex items-center gap-4 shrink-0",children:e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:"text-sm font-black text-text-main tracking-tight",children:["¥",u[t].toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-12 bg-surface-highlight rounded-full h-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-current opacity-80",style:{width:`${c[t]}%`,color:i[t]}})}),e.jsxs("span",{className:"text-[10px] font-bold text-text-muted",children:[c[t],"%"]})]})]})})]},a))})})]})]})};export{W as default};
