import{c as fe,r as d,a as Ee,D as _e,l as $e,u as Re,n as Ie,j as e,L as Ae,E as Le,x as Pe,q as ae,p as he,G as I}from"./index-Ca_aGh3E.js";import{T as Fe}from"./TransactionIcon-DyLEqldN.js";import{f as Me}from"./duplicateCheckUtils-CWXwhWaG.js";import{S as ne,d as Be,s as qe,g as Ye}from"./keywordCategoryService-uRvC8p6c.js";import{A as ze}from"./arrow-left-w2g22jH0.js";import{I as le}from"./info-j7UXcPNd.js";import{S as Ve}from"./square-B-A-P8UZ.js";import{M as Oe}from"./mic-CzwslMMe.js";import{S as Ue}from"./send-BMGxxEsS.js";import{C as M}from"./circle-check-big-CBJwaKe3.js";import{S as ge}from"./save-D1FMWJIj.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Je=fe("arrow-up-down",Ge);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ie=fe("circle",Ke),He=({onResult:N,lang:S="ja-JP",continuous:u=!0,interimResults:B=!0}={})=>{const[c,j]=d.useState(!1),[q,_]=d.useState(""),[h,g]=d.useState(null),[A,F]=d.useState(!0),D=d.useRef(null);d.useEffect(()=>{const E=window.SpeechRecognition||window.webkitSpeechRecognition;if(!E){F(!1),g("このブラウザは音声認識をサポートしていません。最新のChromeまたはEdgeをご利用ください。");return}try{const f=new E;f.lang=S,f.continuous=u,f.interimResults=B,f.maxAlternatives=1;let L=0;f.onstart=()=>{j(!0),g(null),L=0},f.onresult=y=>{let o="",v="";for(let x=L;x<y.results.length;++x)y.results[x].isFinal?(o+=y.results[x][0].transcript,L=x+1):v+=y.results[x][0].transcript;o&&(o=o.replace(/[、。]/g,""),_(x=>x+o+" "),N&&N(o))},f.onerror=y=>{console.error("Speech recognition error",y.error),y.error==="no-speech"?g(null):y.error==="not-allowed"?g("マイクの使用が許可されていません。設定を確認してください。"):y.error==="network"?g("ネットワークエラーが発生しました。インターネット接続を確認してください。"):g(`エラーが発生しました: ${y.error}`),j(!1)},f.onend=()=>{j(!1)},D.current=f}catch(f){console.error("Speech recognition initialization failed",f),F(!1),g("音声認識の初期化に失敗しました。")}return()=>{if(D.current)try{D.current.stop()}catch{}}},[S,u,B]);const Y=d.useCallback(()=>{if(D.current)try{g(null),D.current.start()}catch(E){console.warn("Recognition start failed/already started",E)}},[]),z=d.useCallback(()=>{if(D.current)try{D.current.stop()}catch{}},[]),W=d.useCallback(()=>{_("")},[]);return{isListening:c,transcript:q,setTranscript:_,error:h,startListening:Y,stopListening:z,isSupported:A,resetTranscript:W}},it=()=>{const[N,S]=d.useState([]),[u,B]=d.useState(null),[c,j]=d.useState({}),[q,_]=d.useState(!1),[h,g]=d.useState([]),[A,F]=d.useState(null),[D,Y]=d.useState(null),[z,W]=d.useState({key:"created_at",direction:"desc"}),[E,f]=d.useState(!1),[L,y]=d.useState(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}),{user:o}=Ee(),{currentBusinessType:v}=_e(o==null?void 0:o.id),{transactions:x,createTransaction:X,updateTransaction:be,deleteTransaction:oe,approveTransaction:de,fetchTransactions:k}=$e(o==null?void 0:o.id,v==null?void 0:v.business_type),G=Re(),je=t=>{W(s=>({key:t,direction:s.key===t&&s.direction==="desc"?"asc":"desc"}))},Z=Ie.useMemo(()=>N.filter(t=>t.approval_status!=="approved").sort((t,s)=>{const r=z.direction==="asc"?1:-1;if(z.key==="created_at"){const n=t.created_at?new Date(t.created_at).getTime():Date.now(),b=s.created_at?new Date(s.created_at).getTime():Date.now();return(n-b)*r}const l=new Date(t.date).getTime(),i=new Date(s.date).getTime();return(l-i)*r}),[N,z]),{isListening:J,transcript:$,setTranscript:ee,error:te,startListening:ve,stopListening:we,isSupported:se}=He();d.useEffect(()=>{if(te){Y(te);const t=setTimeout(()=>Y(null),5e3);return()=>clearTimeout(t)}},[te]);const Ne=()=>{Y(null),ve()},ye=()=>{we()};d.useEffect(()=>{console.log("ChatToBook - DBから取引データを取得中",{dbTransactionsCount:x.length,dbTransactionIds:x.map(t=>t.id)}),S(t=>{const s=x.map(n=>n.id),r=t.filter(n=>!s.includes(n.id)),l=[...x.filter(n=>{var b;return(b=n.tags)==null?void 0:b.includes("voice")}).map(n=>({id:n.id,date:n.date,description:n.description||n.item||"",amount:n.amount,category:n.category,type:n.type,created_at:n.created_at,updated_at:n.updated_at,approval_status:n.approval_status})),...r],i=l.filter((n,b,R)=>b===R.findIndex(V=>V.id===n.id));return console.log("ChatToBook - 合成された取引データ:",{mergedCount:l.length,uniqueCount:i.length,dbTransactionIds:s,localTempDataCount:r.length}),i})},[x]),d.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionRecordedイベントを受信"),v!=null&&v.id&&(await new Promise(s=>setTimeout(s,100)),k())};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[v,k]),d.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionApprovedイベントを受信"),v!=null&&v.id&&(await new Promise(s=>setTimeout(s,100)),k())};return window.addEventListener("transactionApproved",t),()=>{window.removeEventListener("transactionApproved",t)}},[v,k]);const ke=t=>{console.log("extractTransactionData - text:",t);let s=t.replace(/[、。]/g," ").replace(/\s+/g," ").trim(),r=new Date;if(L){const[p,T,w]=L.split("-").map(Number);r=new Date(p,T-1,w)}const l=/(\d{1,2})月(\d{1,2})日/,i=s.match(l);if(i){const p=parseInt(i[1],10),T=parseInt(i[2],10),w=r.getFullYear();r=new Date(w,p-1,T),r>new Date&&r.setFullYear(w-1),s=s.replace(i[0],"")}else{const p=s.match(/(昨日|一昨日|おととい)/);p&&(p[0]==="昨日"?r.setDate(r.getDate()-1):r.setDate(r.getDate()-2),s=s.replace(p[0],"")),s=s.replace("今日","")}const n=r.getFullYear(),b=String(r.getMonth()+1).padStart(2,"0"),R=String(r.getDate()).padStart(2,"0"),V=`${n}-${b}-${R}`,re=/((?:\d+[,\s]?)+(?:万(?:\s?\d+)*)?(?:千(?:\s?\d+)*)?円?)/g,O=s.match(re);let K=0;if(O&&O.length>0){const p=O.reduce((C,P)=>C.length>=P.length?C:P);s=s.replace(p,"");let T=0,w=p;if(w.includes("万")){const C=w.split("万"),P=C[0],Q=parseFloat(P.replace(/[^\d.]/g,""))||0;T+=Q*1e4,w=C[1]||""}if(w.includes("千")){const C=w.split("千"),P=C[0];let Q=1;P&&(Q=parseFloat(P.replace(/[^\d.]/g,""))||1),T+=Q*1e3,w=C[1]||""}if(w){const C=parseFloat(w.replace(/[^\d.]/g,""))||0;T+=C}K=T}const U=Be(s)||"雑費",H=Ye(U),a=qe(s.trim());let m="今日";return t.includes("昨日")?m="昨日":t.includes("一昨日")||t.includes("おととい")?m="一昨日":i&&(m=`${i[1]}月${i[2]} 日`),{date:V,dateDisplay:m,description:a,amount:K,category:U,type:H}},Te=async()=>{if($.trim()){console.log("processTranscript - transcript:",$),_(!0);try{if(!(o!=null&&o.id)){I.error("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",o),_(!1);return}const t=ke($),s=t.description;console.log("processTranscript - データベースに保存中:",{item:s,amount:t.amount,date:t.date,category:A||t.category,type:t.type});const r=await X({item:s,amount:t.amount,date:t.date,category:A||t.category,type:t.type,creator:o.id,approval_status:"pending",tags:["voice"]});if(console.log("processTranscript - 保存結果:",r),r.error)throw r.error;await k(),window.dispatchEvent(new CustomEvent("transactionRecorded")),I.success(`${s}を保存しました`),console.log("processTranscript - 取引をデータベースに保存しました"),ee(""),F(null),_(!1)}catch(t){if(console.error("取引の保存に失敗しました:",t),t.message.includes("認証セッションが切れました")){I.error("認証セッションが切れました。ログインページにリダイレクトします。"),G("/login");return}I.error("取引の保存に失敗しました: "+t.message),_(!1)}}},ce=t=>{B(t.id),j(t)},me=async()=>{if(u&&c)try{const t=c.description!==void 0?c.description:"",s=await be(u,{date:c.date||"",item:t,description:t,amount:c.amount||0,category:c.category||"未分類",type:c.type||"expense"});if(s.error)throw s.error;S(r=>r.map(l=>l.id===u?{...l,...c,description:t}:l)),await k(),window.dispatchEvent(new CustomEvent("transactionRecorded")),B(null),j({}),console.log("取引の編集を保存しました:",{id:u,description:t})}catch(t){console.error("取引の更新に失敗しました:",t),alert("取引の更新に失敗しました: "+t.message)}},xe=async t=>{try{const s=await oe(t);if(s.error)throw s.error;S(r=>r.filter(l=>l.id!==t)),g(r=>r.filter(l=>l!==t))}catch(s){console.error("取引の削除に失敗しました:",s),alert("取引の削除に失敗しました: "+s.message)}},pe=async t=>{try{if(console.log("recordTransaction - 開始:",t),!(o!=null&&o.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",o);return}console.log("認証されたユーザーID:",o.id),console.log("DBから最新の取引データを取得中..."),await k();const s=x;console.log("DBから取得した最新の取引データ:",s);const r=t.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t.id)&&s.some(l=>l.id===t.id);if(console.log("既存の取引かどうか:",{isExistingTransaction:r,transactionId:t.id,dbTransactionsCount:s.length,dbTransactionIds:s.map(l=>l.id)}),r){console.log("既存取引の承認処理を開始");const l=await de(t.id);if(console.log("承認処理結果:",l),l.error)throw l.error;S(i=>i.map(n=>n.id===t.id?{...n,approval_status:"approved"}:n)),console.log("transactionApprovedイベントを発火"),window.dispatchEvent(new CustomEvent("transactionApproved")),console.log("recordTransaction - 取引を承認しました"),I.success("取引を登録しました。取引履歴から確認できます。",{id:"transaction-registration",duration:6e3}),await k(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}else{console.log("新規取引作成処理を開始");const l=t.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim(),i=await X({item:l,amount:t.amount,date:t.date.trim(),category:t.category,type:t.type,creator:o.id,approval_status:"approved",tags:["voice"]});if(console.log("新規取引作成結果:",i),i.error)throw i.error;S(n=>n.filter(b=>b.id!==t.id)),console.log("recordTransaction - 新規取引を作成しました"),I.success("取引を登録しました。取引履歴から確認できます。",{id:"transaction-registration",duration:6e3}),await k(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}}catch(s){if(console.error("取引の記録に失敗しました:",s),s.message.includes("認証セッションが切れました")){alert("認証セッションが切れました。ログインページにリダイレクトします。"),G("/login");return}alert("取引の記録に失敗しました: "+s.message)}},Ce=async()=>{if(!(o!=null&&o.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",o);return}console.log("認証されたユーザーID:",o.id),console.log("DBから最新の取引データを取得中..."),await k();const t=x;console.log("DBから取得した最新の取引データ:",t);const s=N.filter(r=>h.includes(r.id));if(console.log("bulkRecordTransactions - 選択された取引:",s),console.log("bulkRecordTransactions - 現在のDB取引データ:",t),s.length===0){alert("記録する取引を選択してください");return}try{const r=s.filter(a=>a.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)&&t.some(m=>m.id===a.id)),l=s.filter(a=>!a.id||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)||!t.some(m=>m.id===a.id));console.log("取引分類結果:",{existingCount:r.length,newCount:l.length,existingTransactions:r.map(a=>({id:a.id,item:a.description})),newTransactions:l.map(a=>({id:a.id,item:a.description})),dbTransactionsCount:t.length,dbTransactionIds:t.map(a=>a.id)});const i=r.map(a=>(console.log("承認処理を実行:",a.id),de(a.id))),n=l.map(a=>{console.log("新規作成処理を実行:",a.id);const m=a.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim();return X({item:m,amount:a.amount,date:a.date.trim(),category:a.category,type:a.type,creator:o.id,approval_status:"approved",tags:["voice"]})}),b=await Promise.allSettled(i),R=await Promise.allSettled(n);console.log("bulkRecordTransactions - 承認結果:",b),console.log("bulkRecordTransactions - 作成結果:",R);const V=b.filter(a=>a.status==="fulfilled").length,re=R.filter(a=>a.status==="fulfilled").length,O=b.filter(a=>a.status==="rejected").length,K=R.filter(a=>a.status==="rejected").length,U=V+re,H=O+K;b.forEach((a,m)=>{if(a.status==="rejected"&&(console.error(`取引承認失敗(${m+1}): `,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),G("/login");return}}),R.forEach((a,m)=>{if(a.status==="rejected"&&(console.error(`新規取引作成失敗(${m+1}): `,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),G("/login");return}}),H>0?I.error(`${U} 件の取引が記録されましたが、${H} 件に失敗しました。`,{id:"transaction-registration",duration:6e3}):I.success(`${U} 件の取引を登録しました。取引履歴から確認できます。`,{id:"transaction-registration",duration:6e3}),S(a=>{const m=[...a];for(let p=0;p<m.length;p++)r.some(T=>T.id===m[p].id)&&(m[p]={...m[p],approval_status:"approved"});return m.filter(p=>!l.some(T=>T.id===p.id))}),g([]),await k(),console.log("bulkRecordTransactions - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded")),window.dispatchEvent(new CustomEvent("transactionApproved"))}catch(r){console.error("取引の一括記録中にエラーが発生しました:",r),alert("取引の一括記録に失敗しました: "+r.message)}},Se=async()=>{if(h.length===0){alert("削除する取引を選択してください");return}if(window.confirm(`${h.length} 件の取引を削除してもよろしいですか？`))try{const t=h.map(i=>oe(i)),s=await Promise.allSettled(t),r=s.filter(i=>i.status==="fulfilled").length,l=s.filter(i=>i.status==="rejected").length;s.forEach((i,n)=>{i.status==="rejected"&&console.error(`取引削除失敗(${n+1}): `,i.reason)}),l>0?alert(`${r} 件の取引が正常に削除されましたが、${l} 件の取引の削除に失敗しました。詳細はコンソールを確認してください。`):alert(`${r} 件の取引が正常に削除されました`),S(i=>i.filter(n=>!h.includes(n.id))),g([]),await k()}catch(t){console.error("取引の一括削除中にエラーが発生しました:",t),alert("取引の一括削除に失敗しました: "+t.message)}},ue=t=>{g(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},De=()=>{h.length===N.length&&N.length>0?g([]):g(N.map(t=>t.id))};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Ae,{to:"/dashboard",className:"mr-4",children:e.jsx(ze,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"音声で記録"}),e.jsx("p",{className:"text-text-muted",children:"音声やチャットで簡単に取引を記録できます"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-surface rounded-xl shadow-sm border border-border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main",children:"音声で記録"}),e.jsxs("button",{onClick:E?()=>f(!1):()=>f(!0),className:"lg:hidden flex items-center text-xs text-primary hover:text-primary/80 transition-colors bg-primary/10 px-3 py-1.5 rounded-full",children:[e.jsx(le,{className:"w-3.5 h-3.5 mr-1.5"}),"使い方",e.jsx(Le,{className:`w-3.5 h-3.5 ml-1 transition-transform duration-200 ${E?"rotate-180":""}`})]})]}),e.jsx("div",{className:`lg:hidden overflow-hidden transition-all duration-300 ease-in-out ${E?"max-h-[600px] opacity-100 mb-6":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"bg-surface-highlight/30 rounded-xl p-4 border border-border/50",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-main mb-3 flex items-center",children:[e.jsx(le,{className:"w-4 h-4 mr-2 text-primary"}),"音声記録の使い方"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main text-sm",children:"音声記録開始"}),e.jsx("p",{className:"text-xs text-text-muted",children:"マイクボタンをクリックして、取引内容を話してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"日付選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"必要に応じてカレンダーから日付を選択してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"テキスト確認"}),e.jsx("p",{className:"text-xs text-text-muted",children:"認識されたテキストを確認・編集してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"カテゴリ選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"未選択でもAIが自動認識しますが、選択した方が確実です。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"取引に変換"}),e.jsx("p",{className:"text-xs text-text-muted",children:"「取引に変換」ボタンをクリックして、取引を登録してください。"})]})]})})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("button",{onClick:J?ye:Ne,disabled:!se,title:se?"":"このブラウザは音声認識をサポートしていません",className:`flex items-center justify-center w-16 h-16 rounded-full ${se?J?"bg-red-500 hover:bg-red-600 animate-pulse":"bg-primary hover:bg-primary/90":"bg-gray-400 cursor-not-allowed"} text-white transition-colors shadow-lg shadow-primary/25`,children:J?e.jsx(Ve,{className:"w-8 h-8 fill-current"}):e.jsx(Oe,{className:"w-8 h-8"})})}),D&&e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-red-500",children:D})}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-text-muted",children:J?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("span",{className:"flex h-3 w-3 mr-2",children:[e.jsx("span",{className:"animate-ping absolute h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative h-3 w-3 rounded-full bg-red-500"})]}),"音声認識中... 話してください"]}):"マイクボタンをクリックして開始"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"日付"}),e.jsx("input",{type:"date",value:L,onChange:t=>y(t.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md text-text-main focus:outline-none focus:ring-2 focus:ring-primary mb-4"}),e.jsxs("label",{className:"block text-sm font-medium text-text-muted mb-2",children:["認識テキスト",e.jsx("span",{className:"text-xs font-normal ml-2 text-primary",children:"（例：5月2日 ランチ 1500円）"})]}),e.jsx("textarea",{value:$,onChange:t=>ee(t.target.value),rows:4,className:"w-full px-3 py-2 bg-background border border-border rounded-md text-text-main focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"音声認識されたテキストがここに表示されます..."}),e.jsxs("label",{className:"block text-sm font-medium text-text-muted mt-3 mb-2",children:["カテゴリ選択",e.jsx("span",{className:"ml-2 text-xs text-primary font-normal",children:"未選択でも認識可"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[ne.map(t=>e.jsx("button",{onClick:()=>F(A===t?null:t),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border transition-colors ${A===t?"bg-primary/20 border-primary text-primary":"bg-surface-highlight text-text-main border-border hover:bg-surface-hover"}`,children:t},t)),A&&e.jsx("button",{onClick:()=>F(null),className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-muted border border-border hover:bg-surface-hover transition-colors",children:"クリア"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>ee(""),disabled:!$.trim(),className:`px-4 py-2 rounded-md transition-colors ${$.trim()?"bg-gray-500 text-white hover:bg-gray-600":"bg-surface-highlight text-text-muted cursor-not-allowed"}`,children:"クリア"}),e.jsx("button",{onClick:Te,disabled:!$.trim()||q,className:`flex items-center px-4 py-2 rounded-md transition-colors ${!$.trim()||q?"bg-surface-highlight text-text-muted cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"処理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"取引に変換"]})})]})]}),e.jsxs("div",{className:"hidden lg:block bg-surface rounded-xl shadow-sm border border-border p-4",children:[e.jsx("h2",{className:"text-md font-semibold text-text-main mb-3",children:"使い方"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main group-hover:text-primary transition-colors",children:"音声記録開始"}),e.jsx("p",{className:"text-xs text-text-muted",children:"マイクボタンをクリックして、取引内容を話してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"日付選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"必要に応じてカレンダーから日付を選択してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"テキスト確認"}),e.jsx("p",{className:"text-xs text-text-muted",children:"認識されたテキストを確認・編集してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"カテゴリ選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"未選択でもAIが自動認識しますが、選択した方が確実です。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"取引に変換"}),e.jsx("p",{className:"text-xs text-text-muted",children:"「取引に変換」ボタンをクリックして、取引を登録してください。"})]})]})})]})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-6 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main",children:"取引一覧"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"内容を確認し、表の「登録」ボタンをクリックして記帳を確定してください。"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-primary bg-primary/10 px-2.5 py-1 rounded-lg border border-primary/20",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),Z.length,"件の未完了取引"]}),h.length>0&&e.jsxs("span",{className:"text-sm text-primary",children:[h.length,"件選択中"]})]}),e.jsx("div",{className:"flex space-x-2",children:h.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Se,className:"flex items-center px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),"一括削除 (",h.length,")"]}),e.jsxs("button",{onClick:Ce,className:"flex items-center px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 transition-colors",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"一括承認 (",h.length,")"]})]})})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"block md:hidden space-y-4",children:Z.map(t=>e.jsxs("div",{className:"bg-surface p-3 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>ue(t.id),className:"mr-3",disabled:t.approval_status==="approved",children:h.includes(t.id)?e.jsx(M,{className:"w-5 h-5 text-primary"}):e.jsx(ie,{className:"w-5 h-5 text-text-muted"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-main",children:u===t.id?e.jsx("input",{type:"text",value:c.description!==void 0?c.description:t.description,onChange:s=>j(r=>({...r,description:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.description}),e.jsx("div",{className:"text-sm text-text-muted mt-1",children:u===t.id?e.jsx("input",{type:"date",value:c.date||t.date,onChange:s=>j(r=>({...r,date:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date})]})]}),e.jsx("div",{className:"text-right",children:u===t.id?e.jsx("input",{type:"number",value:c.amount||t.amount,onChange:s=>j(r=>({...r,amount:Number(s.target.value)})),className:"w-24 px-2 py-1 bg-background border border-border rounded text-sm text-text-main text-right"}):e.jsxs("span",{className:`font-medium ${t.type==="income"?"text-green-500":"text-text-main"}`,children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-border",children:[e.jsx("div",{className:"text-sm",children:u===t.id?e.jsxs("select",{value:c.category||t.category,onChange:s=>j(r=>({...r,category:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[ne.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"未分類",children:"未分類"})]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-gray-300 border border-white/5",children:t.category})}),e.jsx("div",{className:"flex gap-2.5",children:u===t.id?e.jsx("button",{onClick:me,className:"w-10 h-10 rounded-full flex items-center justify-center bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500 hover:text-white transition-all shadow-md active:scale-95",children:e.jsx(ge,{className:"w-5 h-5"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>pe(t),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-md active:scale-95 ${t.approval_status==="approved"?"bg-gray-100 text-gray-400 cursor-not-allowed shadow-none":"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ce(t),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-md active:scale-95 ${t.approval_status==="approved"?"bg-gray-100 text-gray-400 cursor-not-allowed shadow-none":"bg-primary/10 text-primary hover:bg-primary hover:text-white"}`,disabled:t.approval_status==="approved",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>xe(t.id),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-md active:scale-95 ${t.approval_status==="approved"?"bg-gray-100 text-gray-400 cursor-not-allowed shadow-none":"bg-rose-500/10 text-rose-500 hover:bg-rose-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:e.jsx(ae,{className:"w-5 h-5"})})]})})]})]},t.id))}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-highlight",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:e.jsx("button",{onClick:De,className:"flex items-center",children:h.length===N.length&&N.length>0?e.jsx(M,{className:"w-4 h-4 text-primary"}):e.jsx(ie,{className:"w-4 h-4 text-text-muted"})})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:e.jsxs("button",{className:"flex items-center gap-1 hover:text-text-main transition-colors",onClick:()=>je("date"),children:["日付",e.jsx(Je,{className:"w-3 h-3"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-border",children:Z.map(t=>e.jsxs("tr",{className:"hover:bg-surface-highlight transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>ue(t.id),className:"flex items-center",disabled:t.approval_status==="approved",children:h.includes(t.id)?e.jsx(M,{className:"w-5 h-5 text-primary"}):e.jsx(ie,{className:"w-5 h-5 text-text-muted"})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:u===t.id?e.jsx("input",{type:"date",value:c.date||t.date,onChange:s=>j(r=>({...r,date:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main max-w-xs",children:u===t.id?e.jsx("input",{type:"text",value:c.description!==void 0?c.description:t.description,onChange:s=>{console.log("説明入力変更:",s.target.value,"editData:",c),j(r=>({...r,description:s.target.value}))},className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{item:t.description||"",category:t.category||"",size:"sm"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.description}),e.jsx("span",{className:"text-[10px] text-text-muted mt-0.5",children:t.category})]})]}),x&&Me(t,x).length>0&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] text-amber-600 dark:text-amber-400 font-bold bg-amber-50 dark:bg-amber-900/20 px-1.5 py-0.5 rounded border border-amber-200 dark:border-amber-800",children:[e.jsx(le,{className:"w-3 h-3"}),"重複の可能性"]})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:u===t.id?e.jsx("input",{type:"number",value:c.amount||t.amount,onChange:s=>j(r=>({...r,amount:Number(s.target.value)})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):e.jsxs("span",{className:t.type==="income"?"text-green-500":"text-text-main",children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:u===t.id?e.jsxs("select",{value:c.category||t.category,onChange:s=>j(r=>({...r,category:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[ne.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"未分類",children:"未分類"})]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-main border border-border whitespace-nowrap",children:t.category})}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:u===t.id?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:me,className:"p-2 bg-green-500/10 text-green-600 rounded-lg hover:bg-green-500 hover:text-white transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap",children:[e.jsx(ge,{className:"w-4 h-4"}),"保存"]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>pe(t),className:`p-2 rounded-lg transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap ${t.approval_status==="approved"?"bg-surface-highlight text-text-muted cursor-not-allowed shadow-none":"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:[e.jsx(M,{className:"w-4 h-4"}),"登録"]}),e.jsxs("button",{onClick:()=>ce(t),className:`p-2 rounded-lg transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap ${t.approval_status==="approved"?"bg-surface-highlight text-text-muted cursor-not-allowed shadow-none":"bg-primary/10 text-primary hover:bg-primary hover:text-white"}`,disabled:t.approval_status==="approved",children:[e.jsx(he,{className:"w-4 h-4"}),"編集"]}),e.jsxs("button",{onClick:()=>xe(t.id),className:`p-2 rounded-lg transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap ${t.approval_status==="approved"?"bg-surface-highlight text-text-muted cursor-not-allowed shadow-none":"bg-rose-500/10 text-rose-500 hover:bg-rose-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:[e.jsx(ae,{className:"w-4 h-4"}),"削除"]})]})})]},t.id))})]})}),N.filter(t=>t.approval_status!=="approved").length===0&&e.jsxs("div",{className:"text-center py-8 text-text-muted",children:[e.jsx("p",{children:"まだ取引がありません"}),e.jsx("p",{className:"text-sm mt-2",children:"音声入力で取引を追加してください"})]})]})]})]})})};export{it as default};
