const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RevenueChart-BTrgo9gG.js","assets/index-9K-405_8.js","assets/index-Cj772eXs.css","assets/index-Pgv9C3--.js","assets/ExpenseChart-D5-28Jd4.js","assets/TransactionTable-D_yEzow3.js","assets/useMySQLTransactions-CVgGoCb0.js","assets/trending-up-DKe50wEw.js","assets/trending-down-C-3yGz5B.js","assets/AITransactionTable-pLSsDXV-.js","assets/brain-DQJJgIdn.js","assets/circle-check-big-B6da5yIn.js","assets/circle-alert-CKoHRha-.js","assets/TransactionForm-kaCMny3A.js","assets/star-aa7P3F36.js","assets/calendar-CUy1vF5d.js","assets/zap-CuUx2zce.js"])))=>i.map(i=>d[i]);
import{c as k,j as e,F as _,L as T,r as t,s as N,a as S,b as A,P as E,R as b,X as L,_ as f}from"./index-9K-405_8.js";import{C as I,B as O}from"./calculator-BC2LNHSl.js";import{C as R}from"./camera-D-PLNDYh.js";import{u as $}from"./useMySQLTransactions-CVgGoCb0.js";import{D}from"./download-CZ5zOA0_.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],M=k("chart-no-axes-column",F);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],V=k("link",P),z=()=>{const a=[{title:"CHAT-TO-BOOK",description:"音声で取引を記録",icon:I,link:"/chat-to-book",color:"bg-purple-500/20",iconColor:"text-purple-500",borderColor:"border-purple-500/30"},{title:"レシート処理",description:"レシートをスキャン",icon:R,link:"/receipt-processing",color:"bg-emerald-500/20",iconColor:"text-emerald-500",borderColor:"border-emerald-500/30"},{title:"請求書作成",description:"新しい請求書を作成",icon:_,link:"/invoice-creation",color:"bg-blue-500/20",iconColor:"text-blue-500",borderColor:"border-blue-500/30"},{title:"取引履歴",description:"すべての取引を確認",icon:M,link:"/transaction-history",color:"bg-amber-500/20",iconColor:"text-amber-500",borderColor:"border-amber-500/30"},{title:"申告サポート",description:"税務申告の準備",icon:O,link:"/tax-filing-support",color:"bg-rose-500/20",iconColor:"text-rose-500",borderColor:"border-rose-500/30"},{title:"連携設定",description:"外部サービス連携",icon:V,link:"/integration-settings",color:"bg-indigo-500/20",iconColor:"text-indigo-500",borderColor:"border-indigo-500/30"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:a.map((s,m)=>e.jsx(T,{to:s.link,className:"bg-white dark:bg-surface rounded-xl p-4 hover:bg-surface-highlight transition-all duration-300 group border border-border hover:border-border-strong hover:-translate-y-1 shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`w-12 h-12 ${s.color} rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300 border ${s.borderColor}`,children:e.jsx(s.icon,{className:`w-6 h-6 ${s.iconColor}`})}),e.jsx("h3",{className:"font-medium text-text-main mb-1 text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-text-muted leading-relaxed",children:s.description})]})},m))})},U=()=>{const[a,s]=t.useState([]),[m,d]=t.useState(!1),g=t.useCallback(()=>(d(!0),N.from("ai_transactions").select("*").order("created_at",{ascending:!1}).then(({data:l,error:r})=>{r?(console.error(`AI取引データの取得に失敗しました: ${r.message}`),s([])):s(l||[]),d(!1)}),()=>{}),[]),y=async(l,r,p)=>{try{const{data:j,error:x}=await N.from("ai_transactions").update({manual_verified:r,learning_feedback:p,updated_at:new Date().toISOString()}).eq("id",l).select().single();if(x)throw x;console.log(r?"AI分類を承認しました":"AI分類を却下しました"),s(v=>v.map(h=>h.id===l?{...h,manual_verified:r}:h))}catch(j){throw console.error("AI取引の確認に失敗しました:",j),j}};return t.useEffect(()=>{const l=g();return()=>{l&&l()}},[g]),{aiTransactions:a,loading:m,fetchAITransactions:g,verifyAITransaction:y}},q=b.lazy(()=>f(()=>import("./RevenueChart-BTrgo9gG.js"),__vite__mapDeps([0,1,2,3]))),B=b.lazy(()=>f(()=>import("./ExpenseChart-D5-28Jd4.js"),__vite__mapDeps([4,1,2,3]))),Q=b.lazy(()=>f(()=>import("./TransactionTable-D_yEzow3.js"),__vite__mapDeps([5,1,2,6,7,8]))),H=b.lazy(()=>f(()=>import("./AITransactionTable-pLSsDXV-.js"),__vite__mapDeps([9,1,2,10,11,12]))),J=b.lazy(()=>f(()=>import("./TransactionForm-kaCMny3A.js"),__vite__mapDeps([13,1,2,14,8,7,15,16]))),Z=()=>{const{currentBusinessType:a}=S(),{transactions:s,createTransaction:m,fetchTransactions:d}=$(a==null?void 0:a.id),{aiTransactions:g,loading:y}=U(),[l,r]=t.useState(!1),{isAuthenticated:p,user:j,loading:x}=A();t.useEffect(()=>{const o=()=>r(!0);return window.addEventListener("openCreateTransactionModal",o),()=>{window.removeEventListener("openCreateTransactionModal",o)}},[]),t.useEffect(()=>{a!=null&&a.id&&d()},[a,d]);const v=()=>e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"p-4 bg-red-500 text-white text-center mb-4",children:[e.jsx("p",{children:"ダッシュボードのローディング中..."}),e.jsxs("p",{children:["authLoading: ",x?"true":"false"]}),e.jsxs("p",{children:["isAuthenticated: ",p?"true":"false"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-24 w-full bg-gray-200 dark:bg-gray-700 rounded-xl mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"})]})]});if(x)return console.log("ダッシュボードをスケルトンローディングで表示中 - authLoading:",x),e.jsx(v,{});const h=o=>{const i=["日付","説明","金額","カテゴリ","タイプ","ステータス"],u=o.map(c=>[c.date,`"${c.description}"`,c.amount.toString(),`"${c.category}"`,c.type,c.status]);return[i.join(","),...u.map(c=>c.join(","))].join(`
`)},w=()=>{const o=h(s),i=new Blob(["\uFEFF",o],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(i),n=document.createElement("a");n.setAttribute("href",u),n.setAttribute("download",`取引データ_${new Date().toISOString().split("T")[0]}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},C=async o=>{try{console.log("取引作成を開始:",o);const i=localStorage.getItem("user");if(i)try{const n=JSON.parse(i);o.creator=n.id}catch(n){console.error("ユーザー情報の解析に失敗しました:",n)}console.log("creator IDを設定:",o.creator);const u=await m(o);console.log("取引作成成功:",u),await d(),r(!1)}catch(i){console.error("取引の作成に失敗:",i),alert(`取引の作成に失敗しました: ${i.message||"もう一度お試しください。"}`)}};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-text-main tracking-tight",children:"ダッシュボード"}),e.jsx("p",{className:"text-text-muted mt-1",children:"財務状況の概要と最近の活動"})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:w,disabled:s.length===0,className:`btn-secondary flex-1 sm:flex-none flex items-center justify-center ${s.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"CSV出力"]}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex-1 sm:flex-none flex items-center justify-center",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"新規取引"]})]})]}),e.jsx(z,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(q,{transactions:s})}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(B,{transactions:s})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(Q,{transactions:s,onOpenCreateModal:()=>r(!0),showCreateButton:!1})}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(H,{aiTransactions:g,loading:y})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-surface border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"新規取引作成"}),e.jsx("button",{onClick:()=>r(!1),className:"p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(L,{className:"w-5 h-5 text-text-muted"})})]}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(J,{onSubmit:C,onCancel:()=>r(!1)})})]})})})]})};export{Z as default};
