import{r as c,s as n}from"./index-B-if9VQJ.js";const h=a=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a),_=a=>{const[u,s]=c.useState([]),[g,i]=c.useState(!1),l=c.useCallback(async()=>{if(!a){s([]);return}i(!0);const e=localStorage.getItem("user");let t="00000000-0000-0000-0000-000000000000";if(e)try{const r=JSON.parse(e);h(r.id)&&(t=r.id)}catch(r){console.error("ユーザー情報の解析に失敗しました:",r)}try{const{data:r,error:o}=await n.from("transactions").select("*").eq("creator",t).eq("business_type_id",a).order("date",{ascending:!1});if(o)throw o;s(r||[]),i(!1)}catch(r){console.error(`取引データの取得に失敗しました: ${r.message}`),s([]),i(!1)}},[a]),m=async e=>{if(!a)throw new Error("業態形態が選択されていません");try{h(e.creator)||(console.warn("無効なcreator IDが検出されました。匿名ユーザーとして処理します。"),e.creator="00000000-0000-0000-0000-000000000000");const t={...e,creator:e.creator||"00000000-0000-0000-0000-000000000000",business_type_id:a};console.log("取引データを保存中:",t);const{data:r,error:o}=await n.from("transactions").insert(t).select().single();if(o)throw o;console.log("取引データ保存成功:",r.id);const f=r;return s(d=>[f,...d]),r.id}catch(t){throw console.error("取引の作成に失敗しました:",t),t.message&&t.message.includes("Failed to fetch")?new Error("ネットワークエラーが発生しました。インターネット接続を確認してください。"):t}},p=async(e,t)=>{try{const{data:r,error:o}=await n.from("transactions").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw o;const f=r;s(d=>d.map(w=>w.id===e?f:w))}catch(r){throw console.error("取引の更新に失敗しました:",r),r}},y=async e=>{try{const{error:t}=await n.from("transactions").delete().eq("id",e);if(t)throw t;s(r=>r.filter(o=>o.id!==e))}catch(t){throw console.error("取引の削除に失敗しました:",t),t}};return c.useEffect(()=>{l()},[l]),{transactions:u,loading:g,fetchTransactions:l,createTransaction:m,updateTransaction:p,deleteTransaction:y}};export{_ as u};
