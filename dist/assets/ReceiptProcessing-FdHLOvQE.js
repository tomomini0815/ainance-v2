const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CCzu4JNc.js","assets/index-DC9j6qQS.js","assets/index-DPU4ag1e.css"])))=>i.map(i=>d[i]);
import{c as we,r as a,h as Ce,e as Se,j as e,L as Re,F as $,X as ee,i as Ae,C as de,n as J,_ as Ee}from"./index-DC9j6qQS.js";import{R as Me,a as ke,g as Ie,b as Oe,u as Te}from"./ReceiptResultModal-B4jTNAmz.js";import{T as ce}from"./triangle-alert-BK8Yz80t.js";import{A as Pe}from"./arrow-left-CD9n3dwC.js";import{a as he,f as De,u as Le,P as $e,L as Ue,g as xe}from"./motion-DfZKToes.js";import{U as me}from"./upload-XPtJxiWO.js";import{R as Fe}from"./refresh-cw-z2_QTiRa.js";import{C as ze}from"./camera-BkgFAINq.js";import{A as Ke}from"./arrow-right-jfSBvqgi.js";import{E as ue}from"./eye-BJPRgJWJ.js";import{S as _e}from"./save-nAq4rB0_.js";import"./zap-CpYx7emd.js";import"./loader-circle-_xpC3LlU.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Be=we("file-image",Ye);function pe(){const l=a.useRef(!1);return he(()=>(l.current=!0,()=>{l.current=!1}),[]),l}function Ge(){const l=pe(),[u,o]=a.useState(0),i=a.useCallback(()=>{l.current&&o(u+1)},[u]);return[a.useCallback(()=>De.postRender(i),[i]),u]}class He extends a.Component{getSnapshotBeforeUpdate(u){const o=this.props.childRef.current;if(o&&u.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=o.offsetHeight||0,i.width=o.offsetWidth||0,i.top=o.offsetTop,i.left=o.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Ve({children:l,isPresent:u}){const o=a.useId(),i=a.useRef(null),j=a.useRef({width:0,height:0,top:0,left:0});return a.useInsertionEffect(()=>{const{width:N,height:y,top:C,left:R}=j.current;if(u||!i.current||!N||!y)return;i.current.dataset.motionPopId=o;const p=document.createElement("style");return document.head.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${N}px !important;
            height: ${y}px !important;
            top: ${C}px !important;
            left: ${R}px !important;
          }
        `),()=>{document.head.removeChild(p)}},[u]),a.createElement(He,{isPresent:u,childRef:i,sizeRef:j},a.cloneElement(l,{ref:i}))}const te=({children:l,initial:u,isPresent:o,onExitComplete:i,custom:j,presenceAffectsLayout:N,mode:y})=>{const C=Le(Je),R=a.useId(),p=a.useMemo(()=>({id:R,initial:u,isPresent:o,custom:j,onExitComplete:f=>{C.set(f,!0);for(const g of C.values())if(!g)return;i&&i()},register:f=>(C.set(f,!1),()=>C.delete(f))}),N?void 0:[o]);return a.useMemo(()=>{C.forEach((f,g)=>C.set(g,!1))},[o]),a.useEffect(()=>{!o&&!C.size&&i&&i()},[o]),y==="popLayout"&&(l=a.createElement(Ve,{isPresent:o},l)),a.createElement($e.Provider,{value:p},l)};function Je(){return new Map}function We(l){return a.useEffect(()=>()=>l(),[])}const D=l=>l.key||"";function Ze(l,u){l.forEach(o=>{const i=D(o);u.set(i,o)})}function qe(l){const u=[];return a.Children.forEach(l,o=>{a.isValidElement(o)&&u.push(o)}),u}const Qe=({children:l,custom:u,initial:o=!0,onExitComplete:i,exitBeforeEnter:j,presenceAffectsLayout:N=!0,mode:y="sync"})=>{const C=a.useContext(Ue).forceRender||Ge()[0],R=pe(),p=qe(l);let f=p;const g=a.useRef(new Map).current,U=a.useRef(f),M=a.useRef(new Map).current,L=a.useRef(!0);if(he(()=>{L.current=!1,Ze(p,M),U.current=f}),We(()=>{L.current=!0,M.clear(),g.clear()}),L.current)return a.createElement(a.Fragment,null,f.map(b=>a.createElement(te,{key:D(b),isPresent:!0,initial:o?void 0:!1,presenceAffectsLayout:N,mode:y},b)));f=[...f];const I=U.current.map(D),O=p.map(D),W=I.length;for(let b=0;b<W;b++){const S=I[b];O.indexOf(S)===-1&&!g.has(S)&&g.set(S,void 0)}return y==="wait"&&g.size&&(f=[]),g.forEach((b,S)=>{if(O.indexOf(S)!==-1)return;const T=M.get(S);if(!T)return;const Z=I.indexOf(S);let r=b;if(!r){const q=()=>{g.delete(S);const z=Array.from(M.keys()).filter(k=>!O.includes(k));if(z.forEach(k=>M.delete(k)),U.current=p.filter(k=>{const K=D(k);return K===S||z.includes(K)}),!g.size){if(R.current===!1)return;C(),i&&i()}};r=a.createElement(te,{key:D(T),isPresent:!1,onExitComplete:q,custom:u,presenceAffectsLayout:N,mode:y},T),g.set(S,r)}f.splice(Z,0,r)}),f=f.map(b=>{const S=b.key;return g.has(S)?b:a.createElement(te,{key:D(b),isPresent:!0,presenceAffectsLayout:N,mode:y},b)}),a.createElement(a.Fragment,null,g.size?f:f.map(b=>a.cloneElement(b)))},mt=()=>{const{user:l}=Ce(),{currentBusinessType:u}=Se(),[o,i]=a.useState([]),[j,N]=a.useState({isProcessing:!1,retryCount:0}),[y,C]=a.useState(null),[R,p]=a.useState({}),[f,g]=a.useState(!1),[U,M]=a.useState(!1),[L,I]=a.useState(null),[O,W]=a.useState(""),[b,S]=a.useState("all"),[T,Z]=a.useState("all"),[r,q]=a.useState(null),[z,k]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(l!=null&&l.uid))return;const n=(await Ie(l.uid)).map(x=>({id:x.id,date:x.date,merchant:x.merchant,amount:x.amount,category:x.category,description:x.description,confidence:x.confidence,status:x.status,taxRate:x.tax_rate,confidenceScores:x.confidence_scores}));i(n)})()},[l]);const K=()=>{g(!0)},fe=()=>{g(!1)},se=async t=>{g(!1);const s=URL.createObjectURL(t);N(n=>({...n,imageData:s})),await ae(s)},ae=async t=>{N(s=>({...s,isProcessing:!0,retryCount:0,progress:0,currentStep:"OCR処理を開始しています..."}));try{const s=await Ee(()=>import("./index-CCzu4JNc.js").then(d=>d.i),__vite__mapDeps([0,1,2]));N(d=>({...d,progress:10,currentStep:"OCRエンジンを初期化中..."}));const n=new Promise((d,A)=>{setTimeout(()=>A(new Error("OCR処理がタイムアウトしました。画像の解像度が高いか、ネットワークが不安定です。")),45e3)}),x=s.recognize(t,"jpn+eng",{logger:d=>{if(d.status==="recognizing text"){const A=Math.round(d.progress*80)+10;N(P=>({...P,progress:A,currentStep:`テキストを認識中... ${Math.round(d.progress*100)}%`}))}}}),w=await Promise.race([x,n]);console.log("OCR結果:",w.data.text),N(d=>({...d,progress:90,currentStep:"データを抽出中..."}));const m=ge(w.data.text);I({merchant:m.merchant||"不明",date:m.date||new Date().toISOString().split("T")[0],amount:m.amount||0,category:m.category||"雑費",taxRate:m.taxRate||0,confidence:m.confidence||70}),N(d=>({...d,isProcessing:!1,retryCount:0,progress:100,currentStep:"完了"})),M(!0),J.success("レシートの読み取りが完了しました")}catch(s){console.error("OCR処理エラー:",s),N(n=>({...n,isProcessing:!1,retryCount:0,errorMessage:`OCR処理に失敗しました: ${s.message}`})),J.error("レシートの読み取りに失敗しました。もう一度お試しください。")}},ge=t=>{console.log("抽出対象テキスト:",t);const n=(c=>c.replace(/[０-９]/g,v=>String.fromCharCode(v.charCodeAt(0)-65248)).replace(/[Ａ-Ｚａ-ｚ]/g,v=>String.fromCharCode(v.charCodeAt(0)-65248)))(t),x={totalAmount:[/(?:合計|総計|お買上計|領収金額|支払金額|請求金額)[\s:：]*[¥￥]*\s*([0-9,]+)/i,/合\s*計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/小計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/(?:現\s*金|クレ(?:ジット)?|PayPay|d払い|auPAY|LINE\s*Pay)[\s:：]*[¥￥]*\s*([0-9,]+)/i,/[¥￥]\s*([0-9,]+)(?!\s*[\-\+])/],date:[/(\d{4})[年\/\-](\d{1,2})[月\/\-](\d{1,2})[日]?/,/(\d{2,4})[\/\-](\d{1,2})[\/\-](\d{1,2})/,/(\d{4})\.(\d{2})\.(\d{2})/,/(?:令和|R)(\d{1,2})[年\/\-](\d{1,2})[月\/\-](\d{1,2})[日]?/],phone:/(?:TEL|電話|Tel|tel)[:：\s]*(\d{2,4}[-\s]\d{2,4}[-\s]\d{3,4})/,invoice:/(T\d{13})/};let w="不明",m=0;const d=["セブンイレブン","セブン-イレブン","セブン","7-ELEVEN","7-11","7ELEVEN","ローソン","LAWSON","ナチュラルローソン","ローソンストア100","ファミリーマート","ファミマ","FamilyMart","FAMILY MART","ミニストップ","MINISTOP","デイリーヤマザキ","ヤマザキデイリーストア","ニューデイズ","NewDays","ポプラ","くらしハウス","イオン","AEON","マックスバリュ","MaxValu","ザ・ビッグ","まいばすけっと","イトーヨーカドー","ヨーカドー","ItoYokado","ライフ","LIFE","サミット","Summit","西友","SEIYU","マルエツ","Maruetsu","ダイエー","DAIEI","成城石井","成城","カルディ","KALDI","カルディコーヒーファーム","業務スーパー","オーケー","OK","オーケーストア","コープ","COOP","生協","ヤオコー","ベルク","ベイシア","トライアル","ドン・キホーテ","ドンキ","ドンキホーテ","MEGAドンキ","マクドナルド","McDonald's","マック","McDonalds","モスバーガー","モス","MOS BURGER","ロッテリア","LOTTERIA","ケンタッキー","KFC","ケンタッキーフライドチキン","バーガーキング","BURGER KING","フレッシュネスバーガー","サブウェイ","SUBWAY","ミスタードーナツ","ミスド","Mister Donut","スターバックス","スタバ","Starbucks","STARBUCKS","ドトール","DOUTOR","タリーズ","TULLY'S","タリーズコーヒー","コメダ珈琲","コメダ","KOMEDA","サンマルクカフェ","サンマルク","プロント","PRONTO","上島珈琲","カフェ・ド・クリエ","ベローチェ","すき家","すきや","SUKIYA","吉野家","YOSHINOYA","松屋","MATSUYA","なか卯","NAKAU","てんや","大戸屋","OOTOYA","やよい軒","ガスト","GUSTO","サイゼリヤ","Saizeriya","ジョナサン","Jonathan's","バーミヤン","ロイヤルホスト","デニーズ","Denny's","ココス","COCO'S","ビッグボーイ","くら寿司","くらずし","無添くら寿司","スシロー","SUSHIRO","はま寿司","はまずし","かっぱ寿司","かっぱずし","魚べい","サイゼリア","リンガーハット","丸亀製麺","はなまるうどん","天下一品","一風堂","日高屋","王将","餃子の王将","ペッパーランチ","マツモトキヨシ","マツキヨ","matsukiyo","ウエルシア","Welcia","ツルハドラッグ","ツルハ","サンドラッグ","SUNDRUG","スギ薬局","スギヤマ","ココカラファイン","クリエイト","コスモス","セイムス","ダイコクドラッグ","トモズ","ビックカメラ","ビッグカメラ","BIC CAMERA","ヨドバシカメラ","ヨドバシ","Yodobashi","ヤマダ電機","ヤマダデンキ","YAMADA","エディオン","EDION","ケーズデンキ","K's","ジョーシン","Joshin","ノジマ","コジマ","ソフマップ","ベスト電器","ユニクロ","UNIQLO","GU","ジーユー","しまむら","ライトオン","ハニーズ","ZARA","ザラ","H&M","GAP","ギャップ","ユナイテッドアローズ","ビームス","BEAMS","アーバンリサーチ","ニトリ","NITORI","無印良品","MUJI","ダイソー","DAISO","100円ショップ","セリア","Seria","キャンドゥ","Can Do","フランフラン","東急ハンズ","ハンズ","HANDS","ロフト","LOFT","カインズ","CAINZ","コーナン","KOHNAN","コメリ","ビバホーム","ジョイフル本田","ケーヨーデイツー","D2","高島屋","タカシマヤ","伊勢丹","ISETAN","三越","MITSUKOSHI","大丸","DAIMARU","松坂屋","阪急百貨店","阪急","阪神百貨店","阪神","西武","西武百貨店","東武","東武百貨店","小田急百貨店","京王百貨店","近鉄百貨店","紀伊國屋書店","紀伊国屋","ジュンク堂","丸善","TSUTAYA","ツタヤ","ブックオフ","BOOKOFF","有隣堂","三省堂書店","トイザらス","ベビーザらス","ABCマート","アスビー","眼鏡市場","JINS","ジンズ","Zoff","ゾフ","ENEOS","エネオス","出光","Idemitsu","コスモ石油","COSMO","シェル","Shell","エッソ","Esso","モービル","Mobil","Amazon","アマゾン","楽天","Rakuten","メルカリ","ヤフオク","Yahoo!","PayPay"];for(const c of d)if(n.includes(c)){w=c,m=95;break}const A=n.split(`
`).map(c=>c.trim()).filter(c=>c.length>0);if(m<50){const c=n.match(x.phone);if(c){const v=A.findIndex(h=>h.includes(c[1])||h.includes(c[0]));if(v>0)for(let h=Math.max(0,v-3);h<v;h++){const E=A[h];if(E.length>2&&E.length<20&&!E.match(/[\d\/\-\.:\s]+$/)){w=E,m=70;break}}}}if(m===0&&A.length>0){const c=A[0];c.length>1&&!/^[\d\s\-\/\.:¥￥]+$/.test(c)?(w=c,m=50):A.length>1&&(w=A[1],m=40)}let P="",Y=0;for(const c of x.date){const v=n.match(c);if(v){let h=v[1];const E=v[2].padStart(2,"0"),ie=v[3].padStart(2,"0");c.toString().includes("令和")||c.toString().includes("R")?h=(parseInt(h)+2018).toString():h.length===2&&(h="20"+h);const X=new Date(`${h}-${E}-${ie}`);if(!isNaN(X.getTime())&&X.getFullYear()>2e3&&X.getFullYear()<2030){P=`${h}-${E}-${ie}`,Y=90;break}}}P||(P=new Date().toISOString().split("T")[0],Y=10);let F=0,B=0;for(const c of x.totalAmount){const v=n.match(c);if(v){const h=v[1].replace(/[,，]/g,""),E=parseInt(h);if(!isNaN(E)&&E>0){F=E,B=90;break}}}if(F===0){const c=n.match(/[0-9,]+/g);if(c){const v=c.map(h=>parseInt(h.replace(/[,，]/g,""))).filter(h=>!isNaN(h)&&h>0&&h<1e6);v.length>0&&(F=Math.max(...v),B=40)}}let G=10,H=50;n.match(/8%|軽減税率/)?(G=8,H=80):n.match(/10%/)&&(G=10,H=80);const le=n.match(x.invoice),V=!!le,oe=Math.round((m+Y+B+H+(V?20:0))/(V?5:4));return console.log("抽出結果:",{merchant:w,date:P,amount:F,taxRate:G,hasInvoice:V,confidence:oe}),{merchant:w,date:P,amount:F,taxRate:G,category:"未分類",description:V?`インボイス登録番号: ${le[1]}`:"OCRで抽出",confidence:Math.min(100,oe),confidenceScores:{merchant:m,date:Y,amount:B,taxRate:H}}},be=async t=>{const s=t.target.files;if(s&&s.length>0){const n=s[0],x=new FileReader;x.onload=async w=>{var d;const m=(d=w.target)==null?void 0:d.result;if(m){const A=new Blob([m],{type:n.type});await se(A)}},x.readAsArrayBuffer(n)}},je=t=>{C(t.id),p({date:t.date,merchant:t.merchant,amount:t.amount,category:t.category,description:t.description})},Ne=()=>{y&&R&&(i(t=>t.map(s=>s.id===y?{...s,...R}:s)),C(null),p({}))},re=async t=>{const s=o.find(m=>m.id===t);if(!s||!(l!=null&&l.uid)){console.error("レシートまたはユーザーが見つかりません");return}const n=(u==null?void 0:u.business_type)||"individual";i(m=>m.map(d=>d.id===t?{...d,status:"approved"}:d));const x={id:s.id,user_id:l.uid,date:s.date,merchant:s.merchant,amount:s.amount,category:s.category,description:s.description,confidence:s.confidence,status:"approved",tax_rate:s.taxRate,confidence_scores:s.confidenceScores},w=await Oe(t,x,n,l.uid);w.success?(console.log("✅ レシート承認完了: 各テーブルに保存されました"),J.success(`レシートが承認され、${n==="individual"?"個人":"法人"}の取引として記録されました！`)):(console.error("❌ レシート承認エラー:",w.error),i(m=>m.map(d=>d.id===t?{...d,status:"pending"}:d)),J.error(`エラーが発生しました: ${w.error}`))},ne=async t=>{i(s=>s.map(n=>n.id===t?{...n,status:"rejected"}:n)),await Te(t,"rejected")},ye=async()=>{if(j.imageData&&j.retryCount<3){N(t=>({...t,retryCount:t.retryCount+1,errorMessage:void 0}));try{await ae(j.imageData)}catch(t){console.error("再試行エラー:",t),N(s=>({...s,errorMessage:"再試行に失敗しました"}))}}},Q=t=>{q(t),k(!0)},_=o.filter(t=>{const s=t.merchant.toLowerCase().includes(O.toLowerCase())||t.description.toLowerCase().includes(O.toLowerCase()),n=b==="all"||t.status===b,x=T==="all"||t.category===T;return s&&n&&x}),ve=Array.from(new Set(o.map(t=>t.category)));return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&location.protocol!=="https:"&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(ce,{className:"w-5 h-5 text-yellow-500 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"モバイル端末からのアクセスについて"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"現在HTTP環境でアクセスしています。カメラ機能を使用するにはHTTPS環境が必要です。 テスト目的であれば、PCのlocalhost環境（http://localhost:5173）でアクセスしてください。"})]})]})}),e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Re,{to:"/dashboard",className:"mr-4",children:e.jsx(Pe,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"レシート処理"}),e.jsx("p",{className:"text-text-muted",children:"アップロードされたレシートをAIが解析し、自動で仕訳データを作成します"})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 mb-12",children:[e.jsxs(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"bg-surface rounded-xl shadow-sm border border-border p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx(me,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold text-text-main",children:"レシートをアップロード"})]}),j.isProcessing&&e.jsxs("div",{className:"mb-5 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-500 animate-spin mr-2"}),e.jsx("span",{className:"text-blue-700 font-medium",children:"レシートを処理中です..."})]}),j.currentStep&&e.jsx("div",{className:"text-sm text-blue-600 mb-2",children:j.currentStep}),j.progress!==void 0&&e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${j.progress}%`}})})]}),j.errorMessage&&e.jsxs("div",{className:"mb-5 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0"}),e.jsx("span",{className:"text-red-700 text-sm",children:j.errorMessage})]}),j.retryCount<3&&e.jsx("button",{onClick:ye,className:"px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium",children:"再試行"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"group border-2 border-dashed border-border rounded-xl p-8 text-center cursor-pointer hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:be,className:"hidden"}),e.jsx(me,{className:"w-10 h-10 text-text-muted group-hover:text-primary mx-auto mb-3 transition-colors"}),e.jsx("p",{className:"text-sm font-semibold text-text-main mb-1",children:"ファイルを選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"PNG, JPG, PDF対応"})]}),e.jsxs("div",{className:"group border-2 border-dashed border-border rounded-xl p-8 text-center cursor-pointer hover:border-primary hover:bg-primary/5 transition-all duration-200",onClick:K,children:[e.jsx(ze,{className:"w-10 h-10 text-text-muted group-hover:text-primary mx-auto mb-3 transition-colors"}),e.jsx("p",{className:"text-sm font-semibold text-text-main mb-1",children:"カメラで撮影"}),e.jsx("p",{className:"text-xs text-text-muted",children:"その場で撮影"})]}),e.jsxs("div",{className:"group border-2 border-dashed border-border rounded-xl p-8 text-center hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(Be,{className:"w-10 h-10 text-text-muted group-hover:text-primary mx-auto mb-3 transition-colors"}),e.jsx("p",{className:"text-sm font-semibold text-text-main mb-1",children:"ドラッグ&ドロップ"}),e.jsx("p",{className:"text-xs text-text-muted",children:"ここに画像をドロップ"})]})]})]}),e.jsxs(xe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"bg-surface border border-border rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx($,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold text-text-main",children:"最近のアップロード"})]}),e.jsx("div",{className:"space-y-3",children:o.length>0?o.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background rounded-lg border border-border hover:border-primary/50 hover:shadow-sm transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center text-primary flex-shrink-0",children:e.jsx($,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-text-main",children:t.merchant}),e.jsxs("p",{className:"text-sm text-text-muted",children:[t.date," ",t.amount>0?`• ¥${t.amount.toLocaleString()}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-3 py-1.5 rounded-lg text-xs font-semibold border ${t.status==="approved"?"bg-green-500/10 text-green-600 border-green-500/20":t.status==="rejected"?"bg-red-500/10 text-red-600 border-red-500/20":"bg-yellow-500/10 text-yellow-600 border-yellow-500/20"}`,children:t.status==="approved"?"処理完了":t.status==="rejected"?"却下":"処理中"}),e.jsx("button",{onClick:()=>Q(t),className:"p-2 text-text-muted hover:text-primary hover:bg-primary/5 rounded-lg transition-all duration-200",children:e.jsx(Ke,{className:"w-5 h-5"})})]})]},t.id)):e.jsxs("div",{className:"text-center py-12 text-text-muted",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"まだアップロードされたレシートはありません"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[f&&e.jsx(Me,{onCapture:se,onClose:fe}),z&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"レシート詳細"}),e.jsx("button",{onClick:()=>k(!1),className:"text-text-muted hover:text-text-muted",children:e.jsx(ee,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"日付"}),e.jsx("p",{className:"text-text-main",children:r.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"店舗名"}),e.jsx("p",{className:"text-text-main",children:r.merchant})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"金額"}),e.jsxs("p",{className:"text-text-main",children:["¥",r.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"カテゴリ"}),e.jsx("p",{className:"text-text-main",children:r.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"説明"}),e.jsx("p",{className:"text-text-main",children:r.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${r.confidence>=90?"bg-green-500":r.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[r.confidence,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"ステータス"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.status==="approved"?"bg-green-100 text-green-800":r.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status==="approved"?"承認済み":r.status==="rejected"?"却下":"保留中"})]}),r.taxRate!==void 0&&r.taxRate>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"税率"}),e.jsxs("p",{className:"text-text-main",children:[r.taxRate,"%"]})]}),r.confidenceScores&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度詳細"}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",r.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",r.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",r.confidenceScores.amount||0,"%"]})]})]}),r.aiAnalysis&&e.jsxs("div",{className:"border-t border-border pt-3",children:[e.jsx("h4",{className:"text-sm font-medium text-text-muted mb-2",children:"AI分析結果"}),r.aiAnalysis.category&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"推定カテゴリ"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.category})]}),r.aiAnalysis.expenseType&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"支出種別"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.expenseType})]}),r.aiAnalysis.confidence!==void 0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"AI信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${r.aiAnalysis.confidence>=.9?"bg-green-500":r.aiAnalysis.confidence>=.7?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.aiAnalysis.confidence*100}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[Math.round(r.aiAnalysis.confidence*100),"%"]})]})]}),r.aiAnalysis.insights&&r.aiAnalysis.insights.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"分析インサイト"}),e.jsx("ul",{className:"list-disc pl-4 space-y-1 mt-1",children:r.aiAnalysis.insights.map((t,s)=>e.jsx("li",{className:"text-xs text-text-muted",children:t},s))})]}),r.aiAnalysis.items&&r.aiAnalysis.items.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"商品アイテム"}),e.jsx("div",{className:"mt-1 space-y-1",children:r.aiAnalysis.items.map((t,s)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-text-muted",children:t.name}),e.jsxs("span",{className:"text-text-main",children:["¥",t.price.toLocaleString()]})]},s))})]})]})]})}),e.jsx("div",{className:"p-4 border-t border-border flex justify-end space-x-2",children:e.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 bg-border text-text-main rounded-md hover:bg-gray-300 transition-colors",children:"閉じる"})})]})}),e.jsx("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-5 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"店舗名や説明で検索...",className:"w-full pl-11 pr-4 py-2.5 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-background transition-all",value:O,onChange:t=>W(t.target.value)})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("select",{className:"px-4 py-2.5 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-background font-medium text-sm transition-all w-full sm:w-auto",value:b,onChange:t=>S(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのステータス"}),e.jsx("option",{value:"pending",children:"保留中"}),e.jsx("option",{value:"approved",children:"承認済み"}),e.jsx("option",{value:"rejected",children:"却下"})]}),e.jsxs("select",{className:"px-4 py-2.5 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary bg-background font-medium text-sm transition-all w-full sm:w-auto",value:T,onChange:t=>Z(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのカテゴリ"}),ve.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsx("h2",{className:"text-xl font-semibold text-text-main",children:"処理済みレシート"})}),e.jsx("div",{className:"md:hidden p-4 space-y-4",children:_.length===0?e.jsxs("div",{className:"p-8 text-center text-text-muted border border-dashed border-border rounded-lg",children:[e.jsx($,{className:"w-10 h-10 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"処理済みのレシートはありません"}),e.jsx("p",{className:"text-sm mt-1",children:"新しいレシートをアップロードしてください"})]}):_.map(t=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main",children:t.merchant}),e.jsx("p",{className:"text-sm text-text-muted",children:t.date})]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認":t.status==="rejected"?"却下":"保留"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-lg font-semibold text-text-main",children:["¥",t.amount.toLocaleString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-text-muted",children:t.category}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>Q(t),className:"p-2 text-primary hover:text-blue-900 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"詳細",children:e.jsx(ue,{className:"w-5 h-5"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>re(t.id),className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"承認",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ne(t.id),className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-full transition-colors duration-200",title:"却下",children:e.jsx(ee,{className:"w-5 h-5"})})]})]})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"店舗名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"信頼度"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"ステータス"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-gray-200",children:_.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-6 py-12 text-center text-text-muted",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"処理済みのレシートはありません"}),e.jsx("p",{className:"text-sm mt-1",children:"新しいレシートをアップロードしてください"})]})}):_.map(t=>e.jsxs("tr",{className:"hover:bg-background",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:y===t.id?e.jsx("input",{type:"date",value:R.date||t.date,onChange:s=>p(n=>({...n,date:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:y===t.id?e.jsx("input",{type:"text",value:R.merchant||t.merchant,onChange:s=>p(n=>({...n,merchant:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.merchant}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:y===t.id?e.jsx("input",{type:"number",value:R.amount||t.amount,onChange:s=>p(n=>({...n,amount:Number(s.target.value)})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):`¥${t.amount.toLocaleString()}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:y===t.id?e.jsxs("select",{value:R.category||t.category,onChange:s=>p(n=>({...n,category:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm",children:[e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"旅費交通費",children:"旅費交通費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"})]}):t.category}),e.jsx("td",{className:"px-6 py-4 text-sm text-text-main max-w-xs truncate",children:y===t.id?e.jsx("input",{type:"text",value:R.description||t.description,onChange:s=>p(n=>({...n,description:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):e.jsxs("div",{children:[e.jsx("div",{children:t.description}),t.taxRate!==void 0&&t.taxRate>0&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["税率: ",t.taxRate,"%"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]}),t.confidenceScores&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",t.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",t.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",t.confidenceScores.amount||0,"%"]})]}),t.aiAnalysis&&t.aiAnalysis.confidence!==void 0&&e.jsx("div",{className:"text-xs text-text-muted mt-1",children:e.jsxs("div",{children:["AI信頼度: ",Math.round(t.aiAnalysis.confidence*100),"%"]})})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認済み":t.status==="rejected"?"却下":"保留中"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("div",{className:"flex space-x-2",children:y===t.id?e.jsx("button",{onClick:Ne,className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"保存",children:e.jsx(_e,{className:"w-5 h-5"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Q(t),className:"p-2 text-primary hover:text-blue-900 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"詳細",children:e.jsx(ue,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>je(t),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-full transition-colors duration-200",title:"編集",children:e.jsx($,{className:"w-5 h-5"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>re(t.id),className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"承認",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ne(t.id),className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-full transition-colors duration-200",title:"却下",children:e.jsx(ee,{className:"w-5 h-5"})})]})]})})})]},t.id))})]})})]}),e.jsx(Qe,{children:U&&L&&e.jsx(ke,{receiptData:L,onClose:()=>{M(!1),I(null)},onRetake:()=>{M(!1),I(null),g(!0)}})})]})]})})};export{mt as default};
