const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BLl8Mo-Q.js","assets/index-JZ6ol5JH.js","assets/index-BEifkQES.css"])))=>i.map(i=>d[i]);
import{c as je,e as Ne,b as ye,r as m,j as e,F as _,X as K,f as ve,g as X,_ as we}from"./index-JZ6ol5JH.js";import{R as Se,a as Ce,b as Ae,g as Re,c as ke,u as Oe}from"./ReceiptResultModal-DpNOg7lO.js";import{T as ee}from"./triangle-alert-5fd7NtS9.js";import{C as te}from"./camera-Xo7IOPmX.js";import{R as se}from"./refresh-cw-pMjdnsSF.js";import{U as Ie}from"./upload-Cd2HrOgX.js";import{A as Me}from"./arrow-right-DLNXcYJb.js";import{E as ae}from"./eye-CjufaJVT.js";import{S as Te}from"./save-BPJy8J9K.js";import"./zap-BOLOvW6b.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Ee=je("file-image",De),ze=()=>{const{user:p}=Ne(),{currentBusinessType:M}=ye(),[v,j]=m.useState([]),[u,f]=m.useState({isProcessing:!1,retryCount:0}),[b,B]=m.useState(null),[N,y]=m.useState({}),[re,C]=m.useState(!1),[ne,T]=m.useState(!1),[G,D]=m.useState(null),[E,le]=m.useState(""),[L,de]=m.useState("all"),[P,oe]=m.useState("all"),[r,ie]=m.useState(null),[ce,U]=m.useState(!1);m.useEffect(()=>{(async()=>{if(!(p!=null&&p.uid))return;const a=(await Re(p.uid)).map(l=>({id:l.id,date:l.date,merchant:l.merchant,amount:l.amount,category:l.category,description:l.description,confidence:l.confidence,status:l.status,taxRate:l.tax_rate,confidenceScores:l.confidence_scores}));j(a)})()},[p]);const z=()=>{C(!0)},xe=()=>{C(!1)},$=async t=>{C(!1),await me(t)},me=async t=>{f({isProcessing:!0,retryCount:0,progress:0,currentStep:"OCR処理を開始しています..."});try{const s=await we(()=>import("./index-BLl8Mo-Q.js").then(n=>n.i),__vite__mapDeps([0,1,2])),a=URL.createObjectURL(t);f(n=>({...n,progress:10,currentStep:"OCRエンジンを初期化中..."}));const l=await s.recognize(a,"jpn+eng",{logger:n=>{if(n.status==="recognizing text"){const x=Math.round(n.progress*80)+10;f(g=>({...g,progress:x,currentStep:`テキストを認識中... ${Math.round(n.progress*100)}%`}))}}});URL.revokeObjectURL(a),console.log("OCR結果:",l.data.text),f(n=>({...n,progress:90,currentStep:"データを抽出中..."}));const i=ue(l.data.text);D({merchant:i.merchant||"不明",date:i.date||new Date().toISOString().split("T")[0],amount:i.amount||0,category:i.category||"雑費",taxRate:i.taxRate||0,confidence:i.confidence||70}),f({isProcessing:!1,retryCount:0,progress:100,currentStep:"完了"}),T(!0)}catch(s){console.error("OCR処理エラー:",s),f({isProcessing:!1,retryCount:0,errorMessage:`OCR処理に失敗しました: ${s.message}`}),alert("レシートの読み取りに失敗しました。もう一度お試しください。")}},ue=t=>{console.log("抽出対象テキスト:",t);const a=(d=>d.replace(/[０-９]/g,c=>String.fromCharCode(c.charCodeAt(0)-65248)).replace(/[Ａ-Ｚａ-ｚ]/g,c=>String.fromCharCode(c.charCodeAt(0)-65248)))(t),l={totalAmount:[/(?:合計|総計|お買上計|領収金額|支払金額|請求金額)[\s:：]*[¥￥]*\s*([0-9,]+)/i,/合\s*計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/小計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/(?:現\s*金|クレ(?:ジット)?|PayPay|d払い|auPAY|LINE\s*Pay)[\s:：]*[¥￥]*\s*([0-9,]+)/i,/[¥￥]\s*([0-9,]+)(?!\s*[\-\+])/],date:[/(\d{4})[年\/\-](\d{1,2})[月\/\-](\d{1,2})[日]?/,/(\d{2,4})[\/\-](\d{1,2})[\/\-](\d{1,2})/,/(\d{4})\.(\d{2})\.(\d{2})/,/(?:令和|R)(\d{1,2})[年\/\-](\d{1,2})[月\/\-](\d{1,2})[日]?/],phone:/(?:TEL|電話|Tel|tel)[:：\s]*(\d{2,4}[-\s]\d{2,4}[-\s]\d{3,4})/,invoice:/(T\d{13})/};let i="不明",n=0;const x=["セブンイレブン","セブン-イレブン","セブン","7-ELEVEN","7-11","7ELEVEN","ローソン","LAWSON","ナチュラルローソン","ローソンストア100","ファミリーマート","ファミマ","FamilyMart","FAMILY MART","ミニストップ","MINISTOP","デイリーヤマザキ","ヤマザキデイリーストア","ニューデイズ","NewDays","ポプラ","くらしハウス","イオン","AEON","マックスバリュ","MaxValu","ザ・ビッグ","まいばすけっと","イトーヨーカドー","ヨーカドー","ItoYokado","ライフ","LIFE","サミット","Summit","西友","SEIYU","マルエツ","Maruetsu","ダイエー","DAIEI","成城石井","成城","カルディ","KALDI","カルディコーヒーファーム","業務スーパー","オーケー","OK","オーケーストア","コープ","COOP","生協","ヤオコー","ベルク","ベイシア","トライアル","ドン・キホーテ","ドンキ","ドンキホーテ","MEGAドンキ","マクドナルド","McDonald's","マック","McDonalds","モスバーガー","モス","MOS BURGER","ロッテリア","LOTTERIA","ケンタッキー","KFC","ケンタッキーフライドチキン","バーガーキング","BURGER KING","フレッシュネスバーガー","サブウェイ","SUBWAY","ミスタードーナツ","ミスド","Mister Donut","スターバックス","スタバ","Starbucks","STARBUCKS","ドトール","DOUTOR","タリーズ","TULLY'S","タリーズコーヒー","コメダ珈琲","コメダ","KOMEDA","サンマルクカフェ","サンマルク","プロント","PRONTO","上島珈琲","カフェ・ド・クリエ","ベローチェ","すき家","すきや","SUKIYA","吉野家","YOSHINOYA","松屋","MATSUYA","なか卯","NAKAU","てんや","大戸屋","OOTOYA","やよい軒","ガスト","GUSTO","サイゼリヤ","Saizeriya","ジョナサン","Jonathan's","バーミヤン","ロイヤルホスト","デニーズ","Denny's","ココス","COCO'S","ビッグボーイ","くら寿司","くらずし","無添くら寿司","スシロー","SUSHIRO","はま寿司","はまずし","かっぱ寿司","かっぱずし","魚べい","サイゼリア","リンガーハット","丸亀製麺","はなまるうどん","天下一品","一風堂","日高屋","王将","餃子の王将","ペッパーランチ","マツモトキヨシ","マツキヨ","matsukiyo","ウエルシア","Welcia","ツルハドラッグ","ツルハ","サンドラッグ","SUNDRUG","スギ薬局","スギヤマ","ココカラファイン","クリエイト","コスモス","セイムス","ダイコクドラッグ","トモズ","ビックカメラ","ビッグカメラ","BIC CAMERA","ヨドバシカメラ","ヨドバシ","Yodobashi","ヤマダ電機","ヤマダデンキ","YAMADA","エディオン","EDION","ケーズデンキ","K's","ジョーシン","Joshin","ノジマ","コジマ","ソフマップ","ベスト電器","ユニクロ","UNIQLO","GU","ジーユー","しまむら","ライトオン","ハニーズ","ZARA","ザラ","H&M","GAP","ギャップ","ユナイテッドアローズ","ビームス","BEAMS","アーバンリサーチ","ニトリ","NITORI","無印良品","MUJI","ダイソー","DAISO","100円ショップ","セリア","Seria","キャンドゥ","Can Do","フランフラン","東急ハンズ","ハンズ","HANDS","ロフト","LOFT","カインズ","CAINZ","コーナン","KOHNAN","コメリ","ビバホーム","ジョイフル本田","ケーヨーデイツー","D2","高島屋","タカシマヤ","伊勢丹","ISETAN","三越","MITSUKOSHI","大丸","DAIMARU","松坂屋","阪急百貨店","阪急","阪神百貨店","阪神","西武","西武百貨店","東武","東武百貨店","小田急百貨店","京王百貨店","近鉄百貨店","紀伊國屋書店","紀伊国屋","ジュンク堂","丸善","TSUTAYA","ツタヤ","ブックオフ","BOOKOFF","有隣堂","三省堂書店","トイザらス","ベビーザらス","ABCマート","アスビー","眼鏡市場","JINS","ジンズ","Zoff","ゾフ","ENEOS","エネオス","出光","Idemitsu","コスモ石油","COSMO","シェル","Shell","エッソ","Esso","モービル","Mobil","Amazon","アマゾン","楽天","Rakuten","メルカリ","ヤフオク","Yahoo!","PayPay"];for(const d of x)if(a.includes(d)){i=d,n=95;break}const g=a.split(`
`).map(d=>d.trim()).filter(d=>d.length>0);if(n<50){const d=a.match(l.phone);if(d){const c=g.findIndex(o=>o.includes(d[1])||o.includes(d[0]));if(c>0)for(let o=Math.max(0,c-3);o<c;o++){const h=g[o];if(h.length>2&&h.length<20&&!h.match(/[\d\/\-\.:\s]+$/)){i=h,n=70;break}}}}if(n===0&&g.length>0){const d=g[0];d.length>1&&!/^[\d\s\-\/\.:¥￥]+$/.test(d)?(i=d,n=50):g.length>1&&(i=g[1],n=40)}let w="",A=0;for(const d of l.date){const c=a.match(d);if(c){let o=c[1];const h=c[2].padStart(2,"0"),Q=c[3].padStart(2,"0");d.toString().includes("令和")||d.toString().includes("R")?o=(parseInt(o)+2018).toString():o.length===2&&(o="20"+o);const Y=new Date(`${o}-${h}-${Q}`);if(!isNaN(Y.getTime())&&Y.getFullYear()>2e3&&Y.getFullYear()<2030){w=`${o}-${h}-${Q}`,A=90;break}}}w||(w=new Date().toISOString().split("T")[0],A=10);let S=0,R=0;for(const d of l.totalAmount){const c=a.match(d);if(c){const o=c[1].replace(/[,，]/g,""),h=parseInt(o);if(!isNaN(h)&&h>0){S=h,R=90;break}}}if(S===0){const d=a.match(/[0-9,]+/g);if(d){const c=d.map(o=>parseInt(o.replace(/[,，]/g,""))).filter(o=>!isNaN(o)&&o>0&&o<1e6);c.length>0&&(S=Math.max(...c),R=40)}}let k=10,O=50;a.match(/8%|軽減税率/)?(k=8,O=80):a.match(/10%/)&&(k=10,O=80);const Z=a.match(l.invoice),I=!!Z,q=Math.round((n+A+R+O+(I?20:0))/(I?5:4));return console.log("抽出結果:",{merchant:i,date:w,amount:S,taxRate:k,hasInvoice:I,confidence:q}),{merchant:i,date:w,amount:S,taxRate:k,category:"未分類",description:I?`インボイス登録番号: ${Z[1]}`:"OCRで抽出",confidence:Math.min(100,q),confidenceScores:{merchant:n,date:A,amount:R,taxRate:O}}},he=async t=>{const s=t.target.files;if(s&&s.length>0){const a=s[0],l=new FileReader;l.onload=async i=>{var x;const n=(x=i.target)==null?void 0:x.result;if(n){const g=new Blob([n],{type:a.type});await $(g)}},l.readAsArrayBuffer(a)}},pe=t=>{B(t.id),y({date:t.date,merchant:t.merchant,amount:t.amount,category:t.category,description:t.description})},ge=()=>{b&&N&&(j(t=>t.map(s=>s.id===b?{...s,...N}:s)),B(null),y({}))},H=async t=>{const s=v.find(n=>n.id===t);if(!s||!(p!=null&&p.uid)){console.error("レシートまたはユーザーが見つかりません");return}const a=(M==null?void 0:M.business_type)||"individual";j(n=>n.map(x=>x.id===t?{...x,status:"approved"}:x));const l={id:s.id,user_id:p.uid,date:s.date,merchant:s.merchant,amount:s.amount,category:s.category,description:s.description,confidence:s.confidence,status:"approved",tax_rate:s.taxRate,confidence_scores:s.confidenceScores},i=await ke(t,l,a,p.uid);i.success?(console.log("✅ レシート承認完了: 各テーブルに保存されました"),alert(`レシートが承認され、${a==="individual"?"個人":"法人"}の取引として記録されました！`)):(console.error("❌ レシート承認エラー:",i.error),j(n=>n.map(x=>x.id===t?{...x,status:"pending"}:x)),alert(`エラーが発生しました: ${i.error}`))},J=async t=>{j(s=>s.map(a=>a.id===t?{...a,status:"rejected"}:a)),await Oe(t,"rejected")},V=async t=>{j(s=>s.map(a=>a.id===t?{...a,merchant:"処理中...",amount:0,description:"再解析中...",confidence:0}:a)),setTimeout(()=>{j(s=>s.map(a=>a.id===t?{...a,merchant:"ファミリーマート",amount:950,description:"再解析完了",confidence:88}:a))},3e3)},fe=async()=>{if(u.imageData&&u.retryCount<3){f(t=>({...t,retryCount:t.retryCount+1,errorMessage:void 0}));try{const s=await(await fetch(u.imageData)).blob();await $(s)}catch(t){console.error("再試行エラー:",t),f(s=>({...s,errorMessage:"再試行に失敗しました"}))}}},F=t=>{ie(t),U(!0)},W=v.filter(t=>{const s=t.merchant.toLowerCase().includes(E.toLowerCase())||t.description.toLowerCase().includes(E.toLowerCase()),a=L==="all"||t.status===L,l=P==="all"||t.category===P;return s&&a&&l}),be=Array.from(new Set(v.map(t=>t.category)));return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&location.protocol!=="https:"&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(ee,{className:"w-5 h-5 text-yellow-500 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"モバイル端末からのアクセスについて"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"現在HTTP環境でアクセスしています。カメラ機能を使用するにはHTTPS環境が必要です。 テスト目的であれば、PCのlocalhost環境（http://localhost:5173）でアクセスしてください。"})]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main tracking-tight",children:"レシート処理"}),e.jsx("p",{className:"text-text-muted mt-1",children:"アップロードされたレシートをAIが解析し、自動で仕訳データを作成します"})]}),e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"レシートをアップロード"}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:z,className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-primary to-indigo-600 text-white rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition-all duration-200 font-bold text-lg",children:[e.jsx(te,{className:"w-6 h-6"}),"カメラでレシートを撮影"]})}),u.isProcessing&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-500 animate-spin mr-2"}),e.jsx("span",{className:"text-blue-700 font-medium",children:"レシートを処理中です..."})]}),u.currentStep&&e.jsxs("div",{className:"text-sm text-primary mb-2",children:["処理ステップ: ",u.currentStep]}),u.progress!==void 0&&e.jsx("div",{className:"w-full bg-border rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${u.progress}%`}})})]}),u.errorMessage&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md flex items-center",children:[e.jsx(ee,{className:"w-5 h-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700",children:u.errorMessage}),u.retryCount<3&&e.jsx("button",{onClick:fe,className:"ml-4 px-3 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors text-sm",children:"再試行"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-purple-400 hover:bg-purple-50 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:he,className:"hidden"}),e.jsx(Ie,{className:"w-8 h-8 text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-muted",children:"ファイルを選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"PNG, JPG, PDF対応"})]}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-purple-400 hover:bg-purple-50 transition-colors",onClick:z,children:[e.jsx(te,{className:"w-8 h-8 text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-muted",children:"カメラで撮影"}),e.jsx("p",{className:"text-xs text-text-muted",children:"その場で撮影"})]}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[e.jsx(Ee,{className:"w-8 h-8 text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-muted",children:"ドラッグ&ドロップ"}),e.jsx("p",{className:"text-xs text-text-muted",children:"ここに画像をドロップ"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-xl font-semibold text-text-main mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-primary"}),"最近のアップロード"]}),e.jsx("div",{className:"space-y-4",children:v.length>0?v.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background rounded-xl border border-border hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-main",children:t.merchant}),e.jsxs("p",{className:"text-sm text-text-muted",children:[t.date," ",t.amount>0?`¥${t.amount.toLocaleString()}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${t.status==="approved"?"bg-green-500/10 text-green-500 border-green-500/20":t.status==="rejected"?"bg-red-500/10 text-red-500 border-red-500/20":"bg-yellow-500/10 text-yellow-500 border-yellow-500/20"}`,children:t.status==="approved"?"処理完了":t.status==="rejected"?"却下":"処理中"}),e.jsx("button",{onClick:()=>F(t),className:"p-2 text-text-muted hover:text-primary transition-colors",children:e.jsx(Me,{className:"w-5 h-5"})})]})]},t.id)):e.jsx("div",{className:"text-center py-8 text-text-muted",children:"まだアップロードされたレシートはありません"})})]})})})]}),re&&e.jsx(Se,{onCapture:$,onClose:xe}),ce&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"レシート詳細"}),e.jsx("button",{onClick:()=>U(!1),className:"text-text-muted hover:text-text-muted",children:e.jsx(K,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"日付"}),e.jsx("p",{className:"text-text-main",children:r.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"店舗名"}),e.jsx("p",{className:"text-text-main",children:r.merchant})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"金額"}),e.jsxs("p",{className:"text-text-main",children:["¥",r.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"カテゴリ"}),e.jsx("p",{className:"text-text-main",children:r.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"説明"}),e.jsx("p",{className:"text-text-main",children:r.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${r.confidence>=90?"bg-green-500":r.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[r.confidence,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"ステータス"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.status==="approved"?"bg-green-100 text-green-800":r.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status==="approved"?"承認済み":r.status==="rejected"?"却下":"保留中"})]}),r.taxRate!==void 0&&r.taxRate>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"税率"}),e.jsxs("p",{className:"text-text-main",children:[r.taxRate,"%"]})]}),r.confidenceScores&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度詳細"}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",r.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",r.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",r.confidenceScores.amount||0,"%"]})]})]}),r.aiAnalysis&&e.jsxs("div",{className:"border-t border-border pt-3",children:[e.jsx("h4",{className:"text-sm font-medium text-text-muted mb-2",children:"AI分析結果"}),r.aiAnalysis.category&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"推定カテゴリ"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.category})]}),r.aiAnalysis.expenseType&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"支出種別"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.expenseType})]}),r.aiAnalysis.confidence!==void 0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"AI信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${r.aiAnalysis.confidence>=.9?"bg-green-500":r.aiAnalysis.confidence>=.7?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.aiAnalysis.confidence*100}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[Math.round(r.aiAnalysis.confidence*100),"%"]})]})]}),r.aiAnalysis.insights&&r.aiAnalysis.insights.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"分析インサイト"}),e.jsx("ul",{className:"list-disc pl-4 space-y-1 mt-1",children:r.aiAnalysis.insights.map((t,s)=>e.jsx("li",{className:"text-xs text-text-muted",children:t},s))})]}),r.aiAnalysis.items&&r.aiAnalysis.items.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"商品アイテム"}),e.jsx("div",{className:"mt-1 space-y-1",children:r.aiAnalysis.items.map((t,s)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-text-muted",children:t.name}),e.jsxs("span",{className:"text-text-main",children:["¥",t.price.toLocaleString()]})]},s))})]})]})]})}),e.jsx("div",{className:"p-4 border-t border-border flex justify-end space-x-2",children:e.jsx("button",{onClick:()=>U(!1),className:"px-4 py-2 bg-border text-text-main rounded-md hover:bg-gray-300 transition-colors",children:"閉じる"})})]})}),e.jsx("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"店舗名や説明で検索...",className:"w-full pl-10 pr-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary",value:E,onChange:t=>le(t.target.value)})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{className:"px-3 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary w-full sm:w-auto",value:L,onChange:t=>de(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのステータス"}),e.jsx("option",{value:"pending",children:"保留中"}),e.jsx("option",{value:"approved",children:"承認済み"}),e.jsx("option",{value:"rejected",children:"却下"})]}),e.jsxs("select",{className:"px-3 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary w-full sm:w-auto",value:P,onChange:t=>oe(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのカテゴリ"}),be.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsx("h2",{className:"text-lg font-semibold",children:"処理済みレシート"})}),e.jsx("div",{className:"md:hidden p-4 space-y-4",children:W.map(t=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main",children:t.merchant}),e.jsx("p",{className:"text-sm text-text-muted",children:t.date})]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認":t.status==="rejected"?"却下":"保留"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-lg font-semibold text-text-main",children:["¥",t.amount.toLocaleString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-text-muted",children:t.category}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>F(t),className:"p-2 text-primary hover:text-blue-900 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"詳細",children:e.jsx(ae,{className:"w-5 h-5"})}),t.merchant==="解析エラー"&&e.jsx("button",{onClick:()=>V(t.id),className:"p-2 text-orange-600 hover:text-orange-900 hover:bg-orange-50 rounded-full transition-colors duration-200",title:"再試行",children:e.jsx(Ce,{className:"w-5 h-5"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>H(t.id),className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"承認",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>J(t.id),className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-full transition-colors duration-200",title:"却下",children:e.jsx(K,{className:"w-5 h-5"})})]})]})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"店舗名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"信頼度"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"ステータス"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-gray-200",children:W.map(t=>e.jsxs("tr",{className:"hover:bg-background",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:b===t.id?e.jsx("input",{type:"date",value:N.date||t.date,onChange:s=>y(a=>({...a,date:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:b===t.id?e.jsx("input",{type:"text",value:N.merchant||t.merchant,onChange:s=>y(a=>({...a,merchant:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.merchant}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:b===t.id?e.jsx("input",{type:"number",value:N.amount||t.amount,onChange:s=>y(a=>({...a,amount:Number(s.target.value)})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):`¥${t.amount.toLocaleString()}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:b===t.id?e.jsxs("select",{value:N.category||t.category,onChange:s=>y(a=>({...a,category:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm",children:[e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"旅費交通費",children:"旅費交通費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"})]}):t.category}),e.jsx("td",{className:"px-6 py-4 text-sm text-text-main max-w-xs truncate",children:b===t.id?e.jsx("input",{type:"text",value:N.description||t.description,onChange:s=>y(a=>({...a,description:s.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):e.jsxs("div",{children:[e.jsx("div",{children:t.description}),t.taxRate!==void 0&&t.taxRate>0&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["税率: ",t.taxRate,"%"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]}),t.confidenceScores&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",t.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",t.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",t.confidenceScores.amount||0,"%"]})]}),t.aiAnalysis&&t.aiAnalysis.confidence!==void 0&&e.jsx("div",{className:"text-xs text-text-muted mt-1",children:e.jsxs("div",{children:["AI信頼度: ",Math.round(t.aiAnalysis.confidence*100),"%"]})})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認済み":t.status==="rejected"?"却下":"保留中"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("div",{className:"flex space-x-2",children:b===t.id?e.jsx("button",{onClick:ge,className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"保存",children:e.jsx(Te,{className:"w-5 h-5"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>F(t),className:"p-2 text-primary hover:text-blue-900 hover:bg-blue-50 rounded-full transition-colors duration-200",title:"詳細",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>pe(t),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-full transition-colors duration-200",title:"編集",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>V(t.id),className:"p-2 text-orange-600 hover:text-orange-900 hover:bg-orange-50 rounded-full transition-colors duration-200",title:"再解析",children:e.jsx(se,{className:"w-5 h-5"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>H(t.id),className:"p-2 text-green-600 hover:text-green-900 hover:bg-green-50 rounded-full transition-colors duration-200",title:"承認",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>J(t.id),className:"p-2 text-red-600 hover:text-red-900 hover:bg-red-50 rounded-full transition-colors duration-200",title:"却下",children:e.jsx(K,{className:"w-5 h-5"})})]})]})})})]},t.id))})]})})]}),ne&&G&&e.jsx(Ae,{receiptData:G,onClose:()=>{T(!1),D(null)},onRetake:()=>{T(!1),D(null),C(!0)}})]})})};export{ze as default};
