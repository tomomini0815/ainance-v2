import{c as Ce,r as l,a as Le,D as Pe,l as Ye,u as Be,n as qe,j as e,L as ze,E as Ve,x as Oe,q as me,p as ke,G as I}from"./index-Dp8kLXFF.js";import{T as Ue}from"./TransactionIcon-CSjoxOTH.js";import{f as Ge}from"./duplicateCheckUtils-CWXwhWaG.js";import{S as xe,d as Je,s as Ke,g as He}from"./keywordCategoryService-PwCRosAr.js";import{A as Qe}from"./arrow-left-CvQkh7k3.js";import{I as te}from"./info-D5q4zrEh.js";import{S as We}from"./square-DOotMDkg.js";import{M as Xe}from"./mic--yhwKoRL.js";import{S as Ze}from"./send-fDR2Qecu.js";import{C as z}from"./circle-check-big-BY7tKmj7.js";import{S as Te}from"./save-fFq-WGpv.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],tt=Ce("arrow-up-down",et);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],pe=Ce("circle",st),rt=({onResult:k,lang:D="ja-JP",continuous:u=!0,interimResults:V=!0}={})=>{const[d,v]=l.useState(!1),[O,A]=l.useState(""),[g,f]=l.useState(null),[M,B]=l.useState(!0),_=l.useRef(null);l.useEffect(()=>{const $=window.SpeechRecognition||window.webkitSpeechRecognition;if(!$){B(!1),f("このブラウザは音声認識をサポートしていません。最新のChromeまたはEdgeをご利用ください。");return}try{const b=new $;b.lang=D,b.continuous=u,b.interimResults=V,b.maxAlternatives=1;let E=0;b.onstart=()=>{v(!0),f(null),E=0},b.onresult=w=>{let C="",re="";for(let h=E;h<w.results.length;++h)w.results[h].isFinal?(C+=w.results[h][0].transcript,E=h+1):re+=w.results[h][0].transcript;C&&(C=C.replace(/[、。]/g,""),A(h=>h+C+" "),k&&k(C))},b.onerror=w=>{console.error("Speech recognition error",w.error),w.error==="no-speech"?f(null):w.error==="not-allowed"?f("マイクの使用が許可されていません。設定を確認してください。"):w.error==="network"?f("ネットワークエラーが発生しました。インターネット接続を確認してください。"):f(`エラーが発生しました: ${w.error}`),v(!1)},b.onend=()=>{v(!1)},_.current=b}catch(b){console.error("Speech recognition initialization failed",b),B(!1),f("音声認識の初期化に失敗しました。")}return()=>{if(_.current)try{_.current.stop()}catch{}}},[D,u,V]);const U=l.useCallback(()=>{if(_.current)try{f(null),_.current.start()}catch($){console.warn("Recognition start failed/already started",$)}},[]),G=l.useCallback(()=>{if(_.current)try{_.current.stop()}catch{}},[]),se=l.useCallback(()=>{A("")},[]);return{isListening:d,transcript:O,setTranscript:A,error:g,startListening:U,stopListening:G,isSupported:M,resetTranscript:se}},ht=()=>{const[k,D]=l.useState([]),[u,V]=l.useState(null),[d,v]=l.useState({}),[O,A]=l.useState(!1),[g,f]=l.useState([]),[M,B]=l.useState(null),[_,U]=l.useState(null),[G,se]=l.useState({key:"created_at",direction:"desc"}),[$,b]=l.useState(!1),[E,w]=l.useState(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}),[C,re]=l.useState(!1),[h,ue]=l.useState(()=>new Date().getFullYear()),[ae,he]=l.useState(!1),{user:c}=Le(),{currentBusinessType:m}=Pe(c==null?void 0:c.id);l.useEffect(()=>{if(m!=null&&m.fiscal_year_start_month){const t=new Date,s=t.getMonth()+1,r=t.getFullYear(),n=m.fiscal_year_start_month;let o=r;s<n&&(o=r-1),ue(o)}},[m]);const F=l.useMemo(()=>{if(!(m!=null&&m.fiscal_year_start_month))return{min:void 0,max:void 0};const t=m.fiscal_year_start_month,s=String(t).padStart(2,"0"),r=`${h}-${s}-01`,n=new Date(h+1,t-1,0),o=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`;return{min:r,max:o}},[h,m]);l.useEffect(()=>{F.min&&F.max&&(E<F.min||E>F.max)&&w(F.min)},[F,E]);const{transactions:R,createTransaction:Q,updateTransaction:Se,deleteTransaction:ge,approveTransaction:fe,fetchTransactions:y}=Ye(c==null?void 0:c.id,m==null?void 0:m.business_type),W=Be(),De=t=>{se(s=>({key:t,direction:s.key===t&&s.direction==="desc"?"asc":"desc"}))},ne=qe.useMemo(()=>k.filter(t=>t.approval_status!=="approved").sort((t,s)=>{const r=G.direction==="asc"?1:-1;if(G.key==="created_at"){const i=t.created_at?new Date(t.created_at).getTime():Date.now(),j=s.created_at?new Date(s.created_at).getTime():Date.now();return(i-j)*r}const n=new Date(t.date).getTime(),o=new Date(s.date).getTime();return(n-o)*r}),[k,G]),{isListening:q,transcript:L,setTranscript:oe,error:ie,startListening:le,stopListening:_e,isSupported:ce}=rt({onResult:t=>{C&&t.trim()&&Ee(t)}}),Ee=async t=>{if(!(c!=null&&c.id)||!t.trim())return;const s=/(\d+(?:万)?(?:千)?(?:円)?)/;if(t.match(s))try{const r=be(t);r.amount>0&&(console.log("ChatToBook - 自動登録を実行:",r),await Q({item:r.description,amount:r.amount,date:r.date,category:M||r.category,type:r.type,creator:c.id,approval_status:"approved",tags:["voice","auto-mode"]}),I.success(`${r.description}を自動登録しました`),y(),window.dispatchEvent(new CustomEvent("transactionRecorded")))}catch(r){console.error("Auto Process Error:",r)}};l.useEffect(()=>{if(ie){U(ie);const t=setTimeout(()=>U(null),5e3);return()=>clearTimeout(t)}},[ie]);const $e=()=>{U(null),he(!0),le()},Re=()=>{he(!1),_e()};l.useEffect(()=>{if(C&&!q&&ae){const t=setTimeout(()=>{ae&&(console.log("ChatToBook - 音声認識を自動再開します"),le())},300);return()=>clearTimeout(t)}},[C,q,ae,le]),l.useEffect(()=>{console.log("ChatToBook - DBから取引データを取得中",{dbTransactionsCount:R.length,dbTransactionIds:R.map(t=>t.id)}),D(t=>{const s=R.map(i=>i.id),r=t.filter(i=>!s.includes(i.id)),n=[...R.filter(i=>{var j;return(j=i.tags)==null?void 0:j.includes("voice")}).map(i=>({id:i.id,date:i.date,description:i.description||i.item||"",amount:i.amount,category:i.category,type:i.type,created_at:i.created_at,updated_at:i.updated_at,approval_status:i.approval_status})),...r],o=n.filter((i,j,P)=>j===P.findIndex(J=>J.id===i.id));return console.log("ChatToBook - 合成された取引データ:",{mergedCount:n.length,uniqueCount:o.length,dbTransactionIds:s,localTempDataCount:r.length}),o})},[R]),l.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionRecordedイベントを受信"),m!=null&&m.id&&(await new Promise(s=>setTimeout(s,100)),y())};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[m,y]),l.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionApprovedイベントを受信"),m!=null&&m.id&&(await new Promise(s=>setTimeout(s,100)),y())};return window.addEventListener("transactionApproved",t),()=>{window.removeEventListener("transactionApproved",t)}},[m,y]);const be=t=>{console.log("extractTransactionData - text:",t);let s=t.replace(/[、。]/g," ").replace(/\s+/g," ").trim(),r=new Date;if(E){const[p,T,N]=E.split("-").map(Number);r=new Date(p,T-1,N)}const n=/(\d{1,2})月(\d{1,2})日/,o=s.match(n);if(o){const p=parseInt(o[1],10),T=parseInt(o[2],10),N=r.getFullYear();r=new Date(N,p-1,T),r>new Date&&r.setFullYear(N-1),s=s.replace(o[0],"")}else{const p=s.match(/(昨日|一昨日|おととい)/);p&&(p[0]==="昨日"?r.setDate(r.getDate()-1):r.setDate(r.getDate()-2),s=s.replace(p[0],"")),s=s.replace("今日","")}const i=r.getFullYear(),j=String(r.getMonth()+1).padStart(2,"0"),P=String(r.getDate()).padStart(2,"0"),J=`${i}-${j}-${P}`,de=/((?:\d+[,\s]?)+(?:万(?:\s?\d+)*)?(?:千(?:\s?\d+)*)?円?)/g,K=s.match(de);let X=0;if(K&&K.length>0){const p=K.reduce((S,Y)=>S.length>=Y.length?S:Y);s=s.replace(p,"");let T=0,N=p;if(N.includes("万")){const S=N.split("万"),Y=S[0],ee=parseFloat(Y.replace(/[^\d.]/g,""))||0;T+=ee*1e4,N=S[1]||""}if(N.includes("千")){const S=N.split("千"),Y=S[0];let ee=1;Y&&(ee=parseFloat(Y.replace(/[^\d.]/g,""))||1),T+=ee*1e3,N=S[1]||""}if(N){const S=parseFloat(N.replace(/[^\d.]/g,""))||0;T+=S}X=T}const H=Je(s)||"雑費",Z=He(H),a=Ke(s.trim());let x="今日";return t.includes("昨日")?x="昨日":t.includes("一昨日")||t.includes("おととい")?x="一昨日":o&&(x=`${o[1]}月${o[2]} 日`),{date:J,dateDisplay:x,description:a,amount:X,category:H,type:Z}},Ie=async()=>{if(L.trim()){console.log("processTranscript - transcript:",L),A(!0);try{if(!(c!=null&&c.id)){I.error("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",c),A(!1);return}const t=be(L),s=t.description;console.log("processTranscript - データベースに保存中:",{item:s,amount:t.amount,date:t.date,category:M||t.category,type:t.type});const r=await Q({item:s,amount:t.amount,date:t.date,category:M||t.category,type:t.type,creator:c.id,approval_status:"pending",tags:["voice"]});if(console.log("processTranscript - 保存結果:",r),r.error)throw r.error;await y(),window.dispatchEvent(new CustomEvent("transactionRecorded")),I.success(`${s}を保存しました`),console.log("processTranscript - 取引をデータベースに保存しました"),oe(""),B(null),A(!1)}catch(t){if(console.error("取引の保存に失敗しました:",t),t.message.includes("認証セッションが切れました")){I.error("認証セッションが切れました。ログインページにリダイレクトします。"),W("/login");return}I.error("取引の保存に失敗しました: "+t.message),A(!1)}}},je=t=>{V(t.id),v(t)},ve=async()=>{if(u&&d)try{const t=d.description!==void 0?d.description:"",s=await Se(u,{date:d.date||"",item:t,description:t,amount:d.amount||0,category:d.category||"未分類",type:d.type||"expense"});if(s.error)throw s.error;D(r=>r.map(n=>n.id===u?{...n,...d,description:t}:n)),await y(),window.dispatchEvent(new CustomEvent("transactionRecorded")),V(null),v({}),console.log("取引の編集を保存しました:",{id:u,description:t})}catch(t){console.error("取引の更新に失敗しました:",t),alert("取引の更新に失敗しました: "+t.message)}},we=async t=>{try{const s=await ge(t);if(s.error)throw s.error;D(r=>r.filter(n=>n.id!==t)),f(r=>r.filter(n=>n!==t))}catch(s){console.error("取引の削除に失敗しました:",s),alert("取引の削除に失敗しました: "+s.message)}},ye=async t=>{try{if(console.log("recordTransaction - 開始:",t),!(c!=null&&c.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",c);return}console.log("認証されたユーザーID:",c.id),console.log("DBから最新の取引データを取得中..."),await y();const s=R;console.log("DBから取得した最新の取引データ:",s);const r=t.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t.id)&&s.some(n=>n.id===t.id);if(console.log("既存の取引かどうか:",{isExistingTransaction:r,transactionId:t.id,dbTransactionsCount:s.length,dbTransactionIds:s.map(n=>n.id)}),r){console.log("既存取引の承認処理を開始");const n=await fe(t.id);if(console.log("承認処理結果:",n),n.error)throw n.error;D(o=>o.map(i=>i.id===t.id?{...i,approval_status:"approved"}:i)),console.log("transactionApprovedイベントを発火"),window.dispatchEvent(new CustomEvent("transactionApproved")),console.log("recordTransaction - 取引を承認しました"),I.success("取引を登録しました。取引履歴から確認できます。",{id:"transaction-registration",duration:6e3}),await y(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}else{console.log("新規取引作成処理を開始");const n=t.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim(),o=await Q({item:n,amount:t.amount,date:t.date.trim(),category:t.category,type:t.type,creator:c.id,approval_status:"approved",tags:["voice"]});if(console.log("新規取引作成結果:",o),o.error)throw o.error;D(i=>i.filter(j=>j.id!==t.id)),console.log("recordTransaction - 新規取引を作成しました"),I.success("取引を登録しました。取引履歴から確認できます。",{id:"transaction-registration",duration:6e3}),await y(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}}catch(s){if(console.error("取引の記録に失敗しました:",s),s.message.includes("認証セッションが切れました")){alert("認証セッションが切れました。ログインページにリダイレクトします。"),W("/login");return}alert("取引の記録に失敗しました: "+s.message)}},Ae=async()=>{if(!(c!=null&&c.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",c);return}console.log("認証されたユーザーID:",c.id),console.log("DBから最新の取引データを取得中..."),await y();const t=R;console.log("DBから取得した最新の取引データ:",t);const s=k.filter(r=>g.includes(r.id));if(console.log("bulkRecordTransactions - 選択された取引:",s),console.log("bulkRecordTransactions - 現在のDB取引データ:",t),s.length===0){alert("記録する取引を選択してください");return}try{const r=s.filter(a=>a.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)&&t.some(x=>x.id===a.id)),n=s.filter(a=>!a.id||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)||!t.some(x=>x.id===a.id));console.log("取引分類結果:",{existingCount:r.length,newCount:n.length,existingTransactions:r.map(a=>({id:a.id,item:a.description})),newTransactions:n.map(a=>({id:a.id,item:a.description})),dbTransactionsCount:t.length,dbTransactionIds:t.map(a=>a.id)});const o=r.map(a=>(console.log("承認処理を実行:",a.id),fe(a.id))),i=n.map(a=>{console.log("新規作成処理を実行:",a.id);const x=a.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim();return Q({item:x,amount:a.amount,date:a.date.trim(),category:a.category,type:a.type,creator:c.id,approval_status:"approved",tags:["voice"]})}),j=await Promise.allSettled(o),P=await Promise.allSettled(i);console.log("bulkRecordTransactions - 承認結果:",j),console.log("bulkRecordTransactions - 作成結果:",P);const J=j.filter(a=>a.status==="fulfilled").length,de=P.filter(a=>a.status==="fulfilled").length,K=j.filter(a=>a.status==="rejected").length,X=P.filter(a=>a.status==="rejected").length,H=J+de,Z=K+X;j.forEach((a,x)=>{if(a.status==="rejected"&&(console.error(`取引承認失敗(${x+1}): `,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),W("/login");return}}),P.forEach((a,x)=>{if(a.status==="rejected"&&(console.error(`新規取引作成失敗(${x+1}): `,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),W("/login");return}}),Z>0?I.error(`${H} 件の取引が記録されましたが、${Z} 件に失敗しました。`,{id:"transaction-registration",duration:6e3}):I.success(`${H} 件の取引を登録しました。取引履歴から確認できます。`,{id:"transaction-registration",duration:6e3}),D(a=>{const x=[...a];for(let p=0;p<x.length;p++)r.some(T=>T.id===x[p].id)&&(x[p]={...x[p],approval_status:"approved"});return x.filter(p=>!n.some(T=>T.id===p.id))}),f([]),await y(),console.log("bulkRecordTransactions - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded")),window.dispatchEvent(new CustomEvent("transactionApproved"))}catch(r){console.error("取引の一括記録中にエラーが発生しました:",r),alert("取引の一括記録に失敗しました: "+r.message)}},Me=async()=>{if(g.length===0){alert("削除する取引を選択してください");return}if(window.confirm(`${g.length} 件の取引を削除してもよろしいですか？`))try{const t=g.map(o=>ge(o)),s=await Promise.allSettled(t),r=s.filter(o=>o.status==="fulfilled").length,n=s.filter(o=>o.status==="rejected").length;s.forEach((o,i)=>{o.status==="rejected"&&console.error(`取引削除失敗(${i+1}): `,o.reason)}),n>0?alert(`${r} 件の取引が正常に削除されましたが、${n} 件の取引の削除に失敗しました。詳細はコンソールを確認してください。`):alert(`${r} 件の取引が正常に削除されました`),D(o=>o.filter(i=>!g.includes(i.id))),f([]),await y()}catch(t){console.error("取引の一括削除中にエラーが発生しました:",t),alert("取引の一括削除に失敗しました: "+t.message)}},Ne=t=>{f(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},Fe=()=>{g.length===k.length&&k.length>0?f([]):f(k.map(t=>t.id))};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ze,{to:"/dashboard",className:"mr-4",children:e.jsx(Qe,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"音声で記録"}),e.jsx("p",{className:"text-text-muted",children:"音声やチャットで簡単に取引を記録できます"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-surface rounded-xl shadow-sm border border-border p-3 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main",children:"音声で記録"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer scale-75 origin-left",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:C,onChange:t=>re(t.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-surface-highlight peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-text-muted whitespace-nowrap",children:"連続モード"})]})]}),e.jsxs("button",{onClick:$?()=>b(!1):()=>b(!0),className:"lg:hidden flex items-center text-[10px] text-primary hover:text-primary/80 transition-colors bg-primary/10 px-2.5 py-1 rounded-full",children:[e.jsx(te,{className:"w-3.5 h-3.5 mr-1.5"}),"使い方",e.jsx(Ve,{className:`w-3.5 h-3.5 ml-1 transition-transform duration-200 ${$?"rotate-180":""}`})]})]}),e.jsx("div",{className:`lg:hidden overflow-hidden transition-all duration-300 ease-in-out ${$?"max-h-[600px] opacity-100 mb-6":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"bg-surface-highlight/30 rounded-xl p-4 border border-border/50",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-main mb-3 flex items-center",children:[e.jsx(te,{className:"w-4 h-4 mr-2 text-primary"}),"音声記録の使い方"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main text-sm",children:"音声記録開始"}),e.jsx("p",{className:"text-xs text-text-muted",children:"マイクボタンをクリックして、取引内容を話してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"日付選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"必要に応じてカレンダーから日付を選択してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"テキスト確認"}),e.jsx("p",{className:"text-xs text-text-muted",children:"認識されたテキストを確認・編集してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"カテゴリ選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"未選択でもAIが自動認識しますが、選択した方が確実です。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3 bg-surface",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"取引に変換"}),e.jsx("p",{className:"text-xs text-text-muted",children:"「取引に変換」ボタンをクリックして、取引を登録してください。"})]})]})})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("button",{onClick:q?Re:$e,disabled:!ce,title:ce?"":"このブラウザは音声認識をサポートしていません",className:`flex items-center justify-center w-16 h-16 rounded-full ${ce?q?"bg-red-500 hover:bg-red-600 animate-pulse":"bg-primary hover:bg-primary/90":"bg-gray-400 cursor-not-allowed"} text-white transition-colors shadow-lg shadow-primary/25`,children:q?e.jsx(We,{className:"w-8 h-8 fill-current"}):e.jsx(Xe,{className:"w-8 h-8"})})}),_&&e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-red-500",children:_})}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-text-muted",children:q?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("span",{className:"flex h-3 w-3 mr-2",children:[e.jsx("span",{className:"animate-ping absolute h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative h-3 w-3 rounded-full bg-red-500"})]}),"音声認識中... 話してください"]}):"マイクボタンをクリックして開始"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"年度"}),e.jsx("select",{value:h,onChange:t=>ue(Number(t.target.value)),className:"w-full px-3 py-2 bg-background border border-border rounded-md text-text-main focus:outline-none focus:ring-2 focus:ring-primary",children:[h+1,h,h-1,h-2].map(t=>e.jsxs("option",{value:t,children:[t,"年度"]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"日付"}),e.jsx("input",{type:"date",value:E,min:F.min,max:F.max,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md text-text-main focus:outline-none focus:ring-2 focus:ring-primary"})]})]}),e.jsxs("label",{className:"block text-sm font-medium text-text-muted mb-2",children:["認識テキスト",e.jsx("span",{className:"text-xs font-normal ml-2 text-primary",children:"（例：5月2日 ランチ 1500円）"})]}),e.jsx("textarea",{value:L,onChange:t=>oe(t.target.value),rows:4,className:"w-full px-3 py-2 bg-background border border-border rounded-md text-text-main focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"音声認識されたテキストがここに表示されます..."}),e.jsxs("label",{className:"block text-sm font-medium text-text-muted mt-3 mb-2",children:["カテゴリ選択",e.jsx("span",{className:"ml-2 text-xs text-primary font-normal",children:"未選択でも認識可"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[xe.map(t=>e.jsx("button",{onClick:()=>B(M===t?null:t),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border transition-colors ${M===t?"bg-primary/20 border-primary text-primary":"bg-surface-highlight text-text-main border-border hover:bg-surface-hover"}`,children:t},t)),M&&e.jsx("button",{onClick:()=>B(null),className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-muted border border-border hover:bg-surface-hover transition-colors",children:"クリア"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>oe(""),disabled:!L.trim(),className:`px-4 py-2 rounded-md transition-colors ${L.trim()?"bg-gray-500 text-white hover:bg-gray-600":"bg-surface-highlight text-text-muted cursor-not-allowed"}`,children:"クリア"}),e.jsx("button",{onClick:Ie,disabled:!L.trim()||O,className:`flex items-center px-4 py-2 rounded-md transition-colors ${!L.trim()||O?"bg-surface-highlight text-text-muted cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:O?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"処理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"取引に変換"]})})]})]}),e.jsxs("div",{className:"hidden lg:block bg-surface rounded-xl shadow-sm border border-border p-6 h-fit sticky top-24",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-lg font-semibold text-text-main",children:"使い方"})]}),e.jsx("div",{className:"space-y-4",children:[{step:1,title:"音声記録開始",desc:"マイクボタンをクリックして、取引内容を話してください。"},{step:2,title:"日付選択",desc:"必要に応じてカレンダーから日付を選択してください。"},{step:3,title:"テキスト確認",desc:"認識されたテキストを確認・編集してください。"},{step:4,title:"カテゴリ選択",desc:"未選択でもAIが自動認識しますが、選択した方が確実です。"},{step:5,title:"取引に変換",desc:"「取引に変換」ボタンをクリックして、取引を登録してください。"}].map(t=>e.jsx("div",{className:"group border border-border rounded-xl p-4 bg-background hover:bg-surface-highlight transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0 group-hover:bg-primary transition-colors duration-300",children:e.jsx("span",{className:"text-primary font-bold text-sm group-hover:text-white",children:t.step})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main text-sm mb-1 group-hover:text-primary transition-colors",children:t.title}),e.jsx("p",{className:"text-xs text-text-muted leading-relaxed",children:t.desc})]})]})},t.step))})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-3 md:p-6 mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main",children:"取引一覧"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"内容を確認し、表の「登録」ボタンをクリックして記帳を確定してください。"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm font-medium text-primary bg-primary/10 px-2.5 py-1 rounded-lg border border-primary/20",children:[e.jsx(Oe,{className:"w-3.5 h-3.5"}),ne.length,"件の未完了取引"]}),g.length>0&&e.jsxs("span",{className:"text-sm text-primary",children:[g.length,"件選択中"]})]}),e.jsx("div",{className:"flex space-x-2",children:g.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Me,className:"flex items-center px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition-colors",children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),"一括削除 (",g.length,")"]}),e.jsxs("button",{onClick:Ae,className:"flex items-center px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 transition-colors",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"一括承認 (",g.length,")"]})]})})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"block md:hidden space-y-4",children:ne.map(t=>e.jsxs("div",{className:"bg-surface p-3 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>Ne(t.id),className:"mr-3",disabled:t.approval_status==="approved",children:g.includes(t.id)?e.jsx(z,{className:"w-5 h-5 text-primary"}):e.jsx(pe,{className:"w-5 h-5 text-text-muted"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-main",children:u===t.id?e.jsx("input",{type:"text",value:d.description!==void 0?d.description:t.description,onChange:s=>v(r=>({...r,description:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.description}),e.jsx("div",{className:"text-sm text-text-muted mt-1",children:u===t.id?e.jsx("input",{type:"date",value:d.date||t.date,onChange:s=>v(r=>({...r,date:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date})]})]}),e.jsx("div",{className:"text-right",children:u===t.id?e.jsx("input",{type:"number",value:d.amount||t.amount,onChange:s=>v(r=>({...r,amount:Number(s.target.value)})),className:"w-24 px-2 py-1 bg-background border border-border rounded text-sm text-text-main text-right"}):e.jsxs("span",{className:`font-medium ${t.type==="income"?"text-green-500":"text-text-main"}`,children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-border",children:[e.jsx("div",{className:"text-sm",children:u===t.id?e.jsxs("select",{value:d.category||t.category,onChange:s=>v(r=>({...r,category:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[xe.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"未分類",children:"未分類"})]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-gray-300 border border-white/5",children:t.category})}),e.jsx("div",{className:"flex gap-2.5",children:u===t.id?e.jsx("button",{onClick:ve,className:"w-10 h-10 rounded-full flex items-center justify-center bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500 hover:text-white transition-all shadow-md active:scale-95",children:e.jsx(Te,{className:"w-5 h-5"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ye(t),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-md active:scale-95 ${t.approval_status==="approved"?"bg-gray-100 text-gray-400 cursor-not-allowed shadow-none":"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>je(t),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-md active:scale-95 ${t.approval_status==="approved"?"bg-gray-100 text-gray-400 cursor-not-allowed shadow-none":"bg-primary/10 text-primary hover:bg-primary hover:text-white"}`,disabled:t.approval_status==="approved",children:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>we(t.id),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-md active:scale-95 ${t.approval_status==="approved"?"bg-gray-100 text-gray-400 cursor-not-allowed shadow-none":"bg-rose-500/10 text-rose-500 hover:bg-rose-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:e.jsx(me,{className:"w-5 h-5"})})]})})]})]},t.id))}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-highlight",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:e.jsx("button",{onClick:Fe,className:"flex items-center",children:g.length===k.length&&k.length>0?e.jsx(z,{className:"w-4 h-4 text-primary"}):e.jsx(pe,{className:"w-4 h-4 text-text-muted"})})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:e.jsxs("button",{className:"flex items-center gap-1 hover:text-text-main transition-colors",onClick:()=>De("date"),children:["日付",e.jsx(tt,{className:"w-3 h-3"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-border",children:ne.map(t=>e.jsxs("tr",{className:"hover:bg-surface-highlight transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>Ne(t.id),className:"flex items-center",disabled:t.approval_status==="approved",children:g.includes(t.id)?e.jsx(z,{className:"w-5 h-5 text-primary"}):e.jsx(pe,{className:"w-5 h-5 text-text-muted"})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:u===t.id?e.jsx("input",{type:"date",value:d.date||t.date,onChange:s=>v(r=>({...r,date:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main max-w-xs",children:u===t.id?e.jsx("input",{type:"text",value:d.description!==void 0?d.description:t.description,onChange:s=>{console.log("説明入力変更:",s.target.value,"editData:",d),v(r=>({...r,description:s.target.value}))},className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{item:t.description||"",category:t.category||"",size:"sm"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.description}),e.jsx("span",{className:"text-[10px] text-text-muted mt-0.5",children:t.category})]})]}),R&&Ge(t,R).length>0&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"inline-flex items-center gap-1 text-[10px] text-amber-600 dark:text-amber-400 font-bold bg-amber-50 dark:bg-amber-900/20 px-1.5 py-0.5 rounded border border-amber-200 dark:border-amber-800",children:[e.jsx(te,{className:"w-3 h-3"}),"重複の可能性"]})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:u===t.id?e.jsx("input",{type:"number",value:d.amount||t.amount,onChange:s=>v(r=>({...r,amount:Number(s.target.value)})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):e.jsxs("span",{className:t.type==="income"?"text-green-500":"text-text-main",children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:u===t.id?e.jsxs("select",{value:d.category||t.category,onChange:s=>v(r=>({...r,category:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[xe.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"未分類",children:"未分類"})]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-main border border-border whitespace-nowrap",children:t.category})}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:u===t.id?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:ve,className:"p-2 bg-green-500/10 text-green-600 rounded-lg hover:bg-green-500 hover:text-white transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap",children:[e.jsx(Te,{className:"w-4 h-4"}),"保存"]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ye(t),className:`p-2 rounded-lg transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap ${t.approval_status==="approved"?"bg-surface-highlight text-text-muted cursor-not-allowed shadow-none":"bg-emerald-500/10 text-emerald-500 hover:bg-emerald-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:[e.jsx(z,{className:"w-4 h-4"}),"登録"]}),e.jsxs("button",{onClick:()=>je(t),className:`p-2 rounded-lg transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap ${t.approval_status==="approved"?"bg-surface-highlight text-text-muted cursor-not-allowed shadow-none":"bg-primary/10 text-primary hover:bg-primary hover:text-white"}`,disabled:t.approval_status==="approved",children:[e.jsx(ke,{className:"w-4 h-4"}),"編集"]}),e.jsxs("button",{onClick:()=>we(t.id),className:`p-2 rounded-lg transition-all shadow-sm flex items-center gap-1 text-xs whitespace-nowrap ${t.approval_status==="approved"?"bg-surface-highlight text-text-muted cursor-not-allowed shadow-none":"bg-rose-500/10 text-rose-500 hover:bg-rose-500 hover:text-white"}`,disabled:t.approval_status==="approved",children:[e.jsx(me,{className:"w-4 h-4"}),"削除"]})]})})]},t.id))})]})}),k.filter(t=>t.approval_status!=="approved").length===0&&e.jsxs("div",{className:"text-center py-8 text-text-muted",children:[e.jsx("p",{children:"まだ取引がありません"}),e.jsx("p",{className:"text-sm mt-2",children:"音声入力で取引を追加してください"})]})]})]})]})})};export{ht as default};
