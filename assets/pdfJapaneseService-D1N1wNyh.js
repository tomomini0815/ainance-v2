const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfDigitBoxService-CYqxL1Fb.js","assets/pdfAutoFillService-34BIRZFS.js","assets/index-0N2qkU5h.js","assets/index-Dotk837K.css","assets/pdfAnchorDetector-AviESCSu.js"])))=>i.map(i=>d[i]);
import{_ as oe}from"./index-0N2qkU5h.js";import{P as J,r,f as ie,a as le}from"./pdfAutoFillService-34BIRZFS.js";const se={交通費:"旅費交通費",旅費交通費:"旅費交通費",通信費:"通信費",水道光熱費:"水道光熱費",消耗品費:"消耗品費",接待交際費:"接待交際費",広告宣伝費:"広告宣伝費",地代家賃:"地代家賃",外注費:"外注工賃",給与:"給料賃金",雑費:"雑費",減価償却費:"減価償却費",修繕費:"修繕費",保険料:"損害保険料",福利厚生費:"福利厚生費",支払利息:"支払利息",租税公課:"租税公課",荷造運賃:"荷造運賃",その他:"雑費",未分類:"雑費","Travel & Transportation":"旅費交通費",Communication:"通信費",Utilities:"水道光熱費",Supplies:"消耗品費",Entertainment:"接待交際費",Advertising:"広告宣伝費",Rent:"地代家賃",Outsourcing:"外注工賃",Salaries:"給料賃金",Miscellaneous:"雑費",Depreciation:"減価償却費",Repairs:"修繕費",Insurance:"損害保険料",Benefits:"福利厚生費",Interest:"支払利息","Taxes & Dues":"租税公課",Shipping:"荷造運賃",Other:"雑費",Uncategorized:"雑費"};async function te(o){o.registerFontkit(ie);try{const g=await fetch("/fonts/NotoSansCJKjp-Regular.otf").then(m=>m.arrayBuffer()),p=await fetch("/fonts/NotoSansCJKjp-Bold.otf").then(m=>m.arrayBuffer()),l=await o.embedFont(g),i=await o.embedFont(p);return{regular:l,bold:i}}catch(g){console.error("日本語フォントのロードに失敗:",g);const p=g instanceof Error?g.message:String(g);throw new Error(`日本語フォントのロードに失敗しました (${p})。public/fonts/にフォントファイルを正しく配置してください。`)}}function C(o){return o===0?"0":o.toLocaleString("ja-JP")}function ne(o){return`令和${o-2018}年`}async function ge(o){const g=await J.create(),p=g.addPage([595.28,841.89]),{regular:l,bold:i}=await te(g),{width:m,height:y}=p.getSize(),c={primary:r(.1,.2,.4),secondary:r(.15,.3,.5),text:r(.1,.1,.1),muted:r(.45,.45,.45),line:r(.6,.6,.6),headerBg:r(.92,.94,.98),highlight:r(.94,.96,1),green:r(.15,.55,.25),red:r(.75,.2,.2),lightGreen:r(.88,.96,.88),lightRed:r(1,.93,.93)},n=18,s=24,a={text:(T,B,D,d={})=>{p.drawText(T,{x:B,y:D,size:d.size||10,font:d.font||l,color:d.color||c.text})},line:(T,B,D,d,u=.5)=>{p.drawLine({start:{x:T,y:B},end:{x:D,y:d},thickness:u,color:c.line})},rect:(T,B,D,d,u)=>{p.drawRectangle({x:T,y:B,width:D,height:d,color:u})}};a.rect(0,y-60,m,60,c.primary),a.text("法 人 税 申 告 書",190,y-38,{size:24,font:i,color:r(1,1,1)}),a.text("（参考資料）",390,y-38,{size:12,color:r(.8,.85,.9)});let t=y-78;a.text(`${o.companyName||"会社名"}`,50,t,{size:13,font:i}),a.text(`${o.fiscalYear}年度（${ne(o.fiscalYear)}度）`,300,t,{size:11}),a.text(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,450,t,{size:9,color:c.muted}),t-=20,a.line(40,t,555,t,1.5),t-=15,a.rect(40,t-s,515,s,c.secondary),a.text("第1部　法人情報",50,t-17,{size:12,font:i,color:r(1,1,1)}),t-=s+8,[["会社名（商号）",o.companyName||"―"],["代表者氏名",o.representativeName||"―"],["法人番号",o.corporateNumber||"―"],["本店所在地",o.address||"―"],["資本金",o.capital?`${C(o.capital)}円`:"―"]].forEach(([T,B],D)=>{D%2===0&&a.rect(40,t-n,515,n,c.highlight),a.line(40,t-n,555,t-n),a.text(T,55,t-n+5,{size:10}),a.text(B,200,t-n+5,{size:10}),t-=n}),t-=15,a.rect(40,t-s,515,s,c.secondary),a.text("第2部　損益の計算",50,t-17,{size:12,font:i,color:r(1,1,1)}),t-=s+8,a.rect(40,t-n-2,515,n+2,c.highlight),a.line(40,t-n-2,555,t-n-2),a.text("売上高",55,t-n+3,{size:11}),a.text(`${C(o.revenue)}円`,450,t-n+3,{size:11}),t-=n+4,a.line(40,t-n,555,t-n),a.text("売上原価・経費合計",55,t-n+5,{size:10}),a.text(`${C(o.expenses)}円`,450,t-n+5,{size:10}),t-=n+2,a.rect(40,t-n-4,515,n+4,c.lightGreen),a.line(40,t-n-4,555,t-n-4,1),a.line(40,t,555,t,1),a.text("当期純利益",55,t-n+1,{size:12,font:i}),a.text(`${C(o.netIncome)}円`,440,t-n+1,{size:12,font:i,color:o.netIncome>=0?c.green:c.red}),t-=n+20,a.rect(40,t-s,515,s,c.secondary),a.text("第3部　税額の計算",50,t-17,{size:12,font:i,color:r(1,1,1)}),t-=s+8;const F=o.taxableIncome,R=F<=8e6?.15:.232,M=Math.floor(F*R),w=Math.floor(M*.103),x=Math.floor(F*.07),N=M+w+x;return[{label:"課税所得金額",value:`${C(F)}円`,highlight:!0},{label:`法人税額（税率${(R*100).toFixed(1)}%）`,value:`${C(M)}円`},{label:"地方法人税（10.3%）",value:`${C(w)}円`},{label:"事業税（概算7%）",value:`${C(x)}円`}].forEach((T,B)=>{T.highlight?a.rect(40,t-n,515,n,c.highlight):B%2===1&&a.rect(40,t-n,515,n,r(.98,.98,.98)),a.line(40,t-n,555,t-n),a.text(T.label,55,t-n+5,{size:10}),a.text(T.value,450,t-n+5,{size:10}),t-=n}),t-=8,a.rect(40,t-n-8,515,n+8,c.lightRed),a.line(40,t-n-8,555,t-n-8,1.5),a.line(40,t,555,t,1.5),a.text("税額合計（概算）",55,t-n-1,{size:13,font:i}),a.text(`${C(N)}円`,430,t-n-1,{size:13,font:i,color:c.red}),a.line(40,75,555,75),a.text("※ この書類はAinanceで作成した参考資料です。",45,58,{size:9,color:c.muted}),a.text("※ 正式な申告には税理士への相談またはe-Taxをご利用ください。",45,44,{size:9,color:c.muted}),g.save()}async function he(o){const g=await J.create(),p=g.addPage([595.28,841.89]),{regular:l,bold:i}=await te(g),{width:m,height:y}=p.getSize(),c={primary:r(.1,.2,.4),secondary:r(.15,.3,.5),text:r(.1,.1,.1),muted:r(.45,.45,.45),line:r(.6,.6,.6),headerBg:r(.92,.94,.98),highlight:r(.94,.96,1),green:r(.15,.55,.25),red:r(.75,.2,.2),lightGreen:r(.88,.96,.88),lightBlue:r(.88,.93,1)},n=16,s=20,a=22,t={text:(b,z,$,A={})=>{p.drawText(b,{x:z,y:$,size:A.size||9,font:A.font||l,color:A.color||c.text})},line:(b,z,$,A,ee=.5)=>{p.drawLine({start:{x:b,y:z},end:{x:$,y:A},thickness:ee,color:c.line})},rect:(b,z,$,A,ee)=>{p.drawRectangle({x:b,y:z,width:$,height:A,color:ee})}};t.rect(0,y-55,m,55,c.primary),t.text("決 算 報 告 書",210,y-35,{size:22,font:i,color:r(1,1,1)}),t.text("（財務三表）",360,y-35,{size:14,color:r(.85,.85,.9)});let e=y-72;t.text(`${o.companyName||"会社名"}`,50,e,{size:12,font:i}),t.text(`${o.fiscalYear}年度（${ne(o.fiscalYear)}度）`,280,e,{size:10}),t.text(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,450,e,{size:9,color:c.muted}),e-=18,t.line(40,e,555,e,1.5),e-=12;const F=o.revenue-o.expenses,R=o.revenue-Math.floor(o.expenses*.4),M=F+Math.floor(o.revenue*.01)-Math.floor(o.expenses*.02),w=Math.floor(o.revenue*.2),x=Math.floor(o.revenue*.15),N=Math.floor(o.revenue*.1),P=Math.floor(o.revenue*.2),T=w+x+N+P,B=Math.floor(o.expenses*.2),D=Math.floor(o.expenses*.15),d=B+D,u=o.capital||1e6,Y=T-d-u,f=Math.floor(o.expenses*.1),G=o.netIncome+f,W=-Math.floor(o.revenue*.05),H=-Math.floor(D*.1),L=G+W+H,h=40,_=250,S=e;t.rect(h,e-a,_,a,c.secondary),t.text("損益計算書（P/L）",h+70,e-15,{size:11,font:i,color:r(1,1,1)}),e-=a+4,[{label:"売上高",value:o.revenue,isHighlight:!0},{label:"売上原価",value:Math.floor(o.expenses*.4)},{label:"売上総利益",value:R,isSubtotal:!0},{label:"販売費及び一般管理費",value:Math.floor(o.expenses*.6)},{label:"営業利益",value:F,isSubtotal:!0,color:F>=0?c.green:c.red},{label:"営業外収益",value:Math.floor(o.revenue*.01)},{label:"営業外費用",value:Math.floor(o.expenses*.02)},{label:"経常利益",value:M,isSubtotal:!0},{label:"当期純利益",value:o.netIncome,isTotal:!0,color:o.netIncome>=0?c.green:c.red}].forEach(b=>{const z=b.isTotal?n+4:n;b.isTotal?t.rect(h,e-z,_,z,c.lightGreen):b.isSubtotal?t.rect(h,e-z,_,z,c.headerBg):b.isHighlight&&t.rect(h,e-z,_,z,c.highlight),t.line(h,e-z,h+_,e-z),t.text(b.label,h+8,e-z+5,{size:b.isTotal?10:9,font:b.isSubtotal||b.isTotal?i:l}),t.text(`${C(b.value)}`,h+_-60,e-z+5,{size:b.isTotal?10:9,font:b.isSubtotal||b.isTotal?i:l,color:b.color||c.text}),e-=z});const E=e;e=S;const I=305,k=250,O=122;t.rect(I,e-a,k,a,c.secondary),t.text("貸借対照表（B/S）",I+70,e-15,{size:11,font:i,color:r(1,1,1)}),e-=a+4,t.rect(I,e-s,O,s,r(.85,.9,.95)),t.text("資産の部",I+35,e-14,{size:10,font:i}),t.rect(I+O+6,e-s,O,s,r(.95,.9,.88)),t.text("負債・純資産の部",I+O+15,e-14,{size:10,font:i}),e-=s+2;const X=[{label:"流動資産",isSection:!0},{label:"　現金預金",value:w},{label:"　売掛金",value:x},{label:"　棚卸資産",value:N},{label:"固定資産",isSection:!0},{label:"　有形固定資産",value:P},{label:"資産合計",value:T,isTotal:!0}],K=[{label:"流動負債",isSection:!0},{label:"　買掛金",value:B},{label:"　短期借入金",value:D},{label:"純資産の部",isSection:!0},{label:"　資本金",value:u},{label:"　利益剰余金",value:Y},{label:"負債純資産合計",value:T,isTotal:!0}];let j=e,U=e;X.forEach(b=>{const z=b.isTotal?n+2:n-1;b.isTotal?t.rect(I,j-z,O,z,c.lightGreen):b.isSection&&t.rect(I,j-z,O,z,c.highlight),t.line(I,j-z,I+O,j-z),t.text(b.label,I+4,j-z+4,{size:8,font:b.isSection||b.isTotal?i:l}),b.value!==void 0&&t.text(C(b.value),I+O-45,j-z+4,{size:8,font:b.isTotal?i:l}),j-=z}),K.forEach(b=>{const z=b.isTotal?n+2:n-1,$=I+O+6;b.isTotal?t.rect($,U-z,O,z,c.lightGreen):b.isSection&&t.rect($,U-z,O,z,c.highlight),t.line($,U-z,$+O,U-z),t.text(b.label,$+4,U-z+4,{size:8,font:b.isSection||b.isTotal?i:l}),b.value!==void 0&&t.text(C(b.value),$+O-48,U-z+4,{size:8,font:b.isTotal?i:l}),U-=z}),e=Math.min(E,j,U)-20,t.rect(40,e-a,m-80,a,c.secondary),t.text("キャッシュ・フロー計算書（C/F）",200,e-15,{size:11,font:i,color:r(1,1,1)}),e-=a+6;const V=165,re=10;return[{title:"営業活動によるCF",items:[{label:"税引前当期純利益",value:o.netIncome},{label:"減価償却費",value:f},{label:"売上債権の増減",value:-Math.floor(x*.1)},{label:"仕入債務の増減",value:Math.floor(B*.1)}],total:G},{title:"投資活動によるCF",items:[{label:"固定資産の取得",value:W},{label:"投資有価証券の取得",value:0}],total:W},{title:"財務活動によるCF",items:[{label:"借入金の返済",value:H},{label:"配当金の支払",value:0}],total:H}].forEach((b,z)=>{const $=40+z*(V+re);let A=e;t.rect($,A-s,V,s,c.headerBg),t.line($,A-s,$+V,A-s),t.text(b.title,$+25,A-14,{size:9,font:i}),A-=s+2,b.items.forEach(ee=>{t.line($,A-n,$+V,A-n),t.text(ee.label,$+6,A-n+5,{size:8}),t.text(C(ee.value),$+V-50,A-n+5,{size:8}),A-=n}),t.rect($,A-n-2,V,n+2,c.lightBlue),t.line($,A-n-2,$+V,A-n-2,1),t.text("小計",$+6,A-n+3,{size:9,font:i}),t.text(C(b.total),$+V-50,A-n+3,{size:9,font:i,color:b.total>=0?c.green:c.red})}),e=e-(s+n*4+n+2+15),t.rect(40,e-s,m-80,s,c.lightGreen),t.line(40,e-s,555,e-s,1.5),t.line(40,e,555,e,1.5),t.text("現金及び現金同等物の増減額",50,e-14,{size:11,font:i}),t.text(`${C(L)}円`,440,e-14,{size:11,font:i,color:L>=0?c.green:c.red}),e-=s+5,t.line(40,e-n,555,e-n),t.text("現金及び現金同等物の期末残高",50,e-n+5,{size:10}),t.text(`${C(w+L)}円`,440,e-n+5,{size:10,font:i}),t.line(40,70,555,70),t.text("※ この決算報告書はAinanceで作成した参考資料です。",45,55,{size:8,color:c.muted}),t.text("※ 貸借対照表・キャッシュフロー計算書は売上・経費データからの概算です。正確な作成には税理士へご相談ください。",45,43,{size:8,color:c.muted}),g.save()}async function xe(o){var i,m,y,c;const p=await fetch(`/templates/kakutei1&2.pdf?t=${Date.now()}`).then(n=>n.arrayBuffer()),l={name:o.name,address:o.address,phone:o.phone,tradeName:o.tradeName,revenue:o.revenue,expenses:o.expenses,netIncome:o.netIncome,businessIncome:o.netIncome,totalIncome:o.netIncome,taxableIncome:o.taxableIncome,estimatedTax:o.estimatedTax,fiscalYear:o.fiscalYear,isBlueReturn:!!o.isBlueReturn,expensesByCategory:o.expensesByCategory,deductions:{basic:(i=o.deductions)==null?void 0:i.basic,blueReturn:(m=o.deductions)==null?void 0:m.blueReturn,socialInsurance:(y=o.deductions)==null?void 0:y.socialInsurance,lifeInsurance:(c=o.deductions)==null?void 0:c.lifeInsurance}};return await le(p,l)}async function de(o){var e;const g=await J.create(),p=g.addPage([595.28,841.89]),{regular:l,bold:i}=await te(g),{width:m,height:y}=p.getSize(),c={primary:r(.2,.4,.8),text:r(.1,.1,.1),muted:r(.4,.4,.4),line:r(.5,.5,.5),highlight:r(.95,.95,1),green:r(.2,.6,.3)},n=(F,R,M,w={})=>{p.drawText(F,{x:R,y:M,size:w.size||10,font:w.font||l,color:w.color||c.text})},s=(F,R,M,w,x=.5)=>{p.drawLine({start:{x:F,y:R},end:{x:M,y:w},thickness:x,color:c.line})},a=(F,R,M,w,x)=>{p.drawRectangle({x:F,y:R,width:M,height:w,color:x})};a(0,y-60,m,60,c.primary),n("青色申告決算書",200,y-40,{size:20,font:i,color:r(1,1,1)}),n("（一般用）",340,y-40,{size:12,color:r(.9,.9,.9)});let t=y-85;if(n(`${ne(o.fiscalYear)}分　所得税青色申告決算書`,50,t,{size:11,font:i}),o.tradeName&&n(`屋号: ${o.tradeName}`,350,t,{size:10}),n(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,450,t,{size:9,color:c.muted}),t-=30,s(50,t,545,t,1),t-=25,n("損益計算書",50,t,{size:12,font:i,color:c.primary}),t-=20,a(50,t-5,495,20,c.highlight),s(50,t-5,545,t-5),n("売上（収入）金額　①",60,t,{font:i}),n(`${C(o.revenue)}円`,450,t,{font:i}),t-=30,n("経費",50,t,{size:11,font:i}),t-=20,a(50,t-15,495,15,r(.9,.9,.9)),s(50,t,545,t),s(50,t-15,545,t-15),n("勘定科目",60,t-11,{font:i,size:9}),n("金額",470,t-11,{font:i,size:9}),t-=18,o.expensesByCategory.forEach((F,R)=>{const M=se[F.category]||F.category||"雑費";R%2===0&&a(50,t-15,495,15,r(.98,.98,.98)),s(50,t-15,545,t-15),n(M,60,t-11,{size:9}),n(C(F.amount),450,t-11,{size:9}),t-=15,t<200}),a(50,t-18,495,18,r(.95,.95,.95)),s(50,t-18,545,t-18),n("経費合計　㉑",60,t-13,{font:i}),n(`${C(o.expenses)}円`,445,t-13,{font:i}),t-=30,s(50,t-5,545,t-5),n("差引金額　① - ㉑",60,t),n(`${C(o.netIncome)}円`,450,t),t-=25,(e=o.deductions)!=null&&e.blueReturn){s(50,t-5,545,t-5),n("青色申告特別控除額",60,t),n(`${C(o.deductions.blueReturn)}円`,450,t),t-=25;const F=Math.max(0,o.netIncome-o.deductions.blueReturn);a(50,t-8,495,25,r(.95,1,.95)),s(50,t-8,545,t-8,1),s(50,t+17,545,t+17,1),n("所得金額　㊸",60,t+2,{font:i,size:11}),n(`${C(F)}円`,440,t+2,{font:i,size:11,color:c.green})}return s(50,60,545,60),n("※ この書類はAinanceで作成した参考資料です。",50,45,{size:8,color:c.muted}),n("※ 正式な申告には国税庁「確定申告書等作成コーナー」をご利用ください。",50,33,{size:8,color:c.muted}),g.save()}async function be(o){const g=await J.create(),p=50,l=841.89,i=595.28;let m=g.addPage([i,l]);const{regular:y,bold:c}=await te(g),n={primary:r(.1,.2,.4),text:r(.1,.1,.1),muted:r(.4,.4,.4),line:r(.8,.8,.8),headerBg:r(.95,.95,.98)};let s=l-p;const a=(w,x,N,P=10,T=y,B=n.text)=>{m.drawText(w,{x,y:N,size:P,font:T,color:B})},t=(w,x,N,P)=>{if(!w)return[];const T=w.split(""),B=[];let D="";for(let d=0;d<T.length;d++){const u=T[d];N.widthOfTextAtSize(D+u,x)<P?D+=u:(B.push(D),D=u)}return B.push(D),B},e=w=>s-w<p?(m=g.addPage([i,l]),s=l-p,!0):!1;e(80),a("補 助 金 申 請 書 （案）",p,s,18,c),s-=30,a(`申請補助金: ${o.subsidyName}`,p,s,12,c,n.primary),s-=20,a(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,p,s,10,y,n.muted),s-=10,m.drawLine({start:{x:p,y:s},end:{x:i-p,y:s},thickness:1,color:n.primary}),s-=30;const F=i-p*2,R=10,M=16;for(const w of o.sections){e(40),m.drawRectangle({x:p,y:s-20,width:F,height:24,color:n.headerBg}),a(w.title,p+10,s-14,11,c,n.primary),s-=35;const x=w.content.split(`
`);for(const N of x){const P=t(N,R,y,F);for(const T of P)e(M),a(T,p,s,R,y),s-=M;s-=5}s-=15}return g.save()}async function ye(o){const g=await J.create(),{regular:p,bold:l}=await te(g),i={primary:r(.1,.2,.4),secondary:r(.15,.3,.5),text:r(.1,.1,.1),muted:r(.45,.45,.45),line:r(.6,.6,.6),headerBg:r(.92,.94,.98),highlight:r(.94,.96,1),lightGreen:r(.88,.96,.88),lightRed:r(1,.93,.93)},m=h=>({text:(_,S,v,E={})=>{const I=E.size||10,k=E.font||p,O=E.color||i.text;let X=S;if(E.align==="right"){const K=k.widthOfTextAtSize(_,I);X-=K}else if(E.align==="center"){const K=k.widthOfTextAtSize(_,I);X-=K/2}h.drawText(_,{x:X,y:v,size:I,font:k,color:O})},line:(_,S,v,E,I=.5)=>{h.drawLine({start:{x:_,y:S},end:{x:v,y:E},thickness:I,color:i.line})},rect:(_,S,v,E,I)=>{h.drawRectangle({x:_,y:S,width:v,height:E,color:I})},currency:(_,S,v,E=10)=>{const I=C(_),k=p,O=k.widthOfTextAtSize(I,E);h.drawText(I,{x:S-O,y:v,size:E,font:k,color:i.text})}}),y=g.addPage([595.28,841.89]),c=m(y),{width:n,height:s}=y.getSize();c.rect(0,s-150,n,150,i.primary),c.text("法人税申告書報告書",n/2,s-80,{size:28,font:l,color:r(1,1,1),align:"center"}),c.text(`${ne(new Date().getFullYear())}度版`,n/2,s-120,{size:14,color:r(.9,.9,1),align:"center"}),c.text("会社名:",100,s-300,{size:14,color:i.muted}),c.text("（会社名未設定）",200,s-300,{size:18,font:l}),c.text("作成日:",100,s-350,{size:14,color:i.muted}),c.text(new Date().toLocaleDateString("ja-JP"),200,s-350,{size:18}),c.text("※ 本資料はAinanceで作成された参考資料です。",n/2,100,{size:10,color:i.muted,align:"center"}),c.text("正式な税務申告には、税理士の確認またはe-Taxをご利用ください。",n/2,80,{size:10,color:i.muted,align:"center"});const a=g.addPage([595.28,841.89]),t=m(a);q(t,"別表一（一）","各事業年度の所得に係る申告書",s,n,i,l);let e=s-100;Q(t,"申告額の計算",e,n,i,l),e-=25;const F=(h,_,S,v,E=!1)=>{h.rect(50,v-20,300,20,E?i.headerBg:r(1,1,1)),h.rect(350,v-20,195,20,E?i.headerBg:r(1,1,1)),h.line(50,v-20,545,v-20),h.line(50,v,545,v),h.line(50,v,50,v-20),h.line(350,v,350,v-20),h.line(545,v,545,v-20),h.text(_,60,v-14,{size:10,font:E?l:p}),typeof S=="number"?h.currency(S,535,v-14,10):h.text(S,360,v-14,{size:10})};F(t,"1. 別表四の所得金額又は欠損金額",o.beppyo4.taxableIncome,e),e-=20,F(t,"2. 欠損金又は災害損失金の控除額",0,e),e-=20,F(t,"3. 翌期へ繰り越す欠損金又は災害損失金",0,e),e-=20,F(t,"4. 課税標準額 (1-2)",Math.max(0,o.beppyo1.taxableIncome),e),e-=20,e-=10,F(t,"5. 課税標準額に対する法人税額",o.beppyo1.corporateTaxAmount,e),e-=20,F(t,"6. 控除税額（所得税額等）",o.beppyo1.specialTaxCredit,e),e-=20,F(t,"7. 差引所得に対する法人税額 (5-6)",Math.max(0,o.beppyo1.corporateTaxAmount-o.beppyo1.specialTaxCredit),e),e-=20;const R=Math.floor(o.beppyo1.corporateTaxAmount*.103);F(t,"8. 地方法人税額（課税標準法人税額 × 10.3%）",R,e),e-=20,F(t,"9. 中間申告分の法人税額",o.beppyo1.interimPayment,e),e-=20;const M=Math.max(0,o.beppyo1.corporateTaxAmount-o.beppyo1.specialTaxCredit+R-o.beppyo1.interimPayment);F(t,"10. 差引確定法人税額",M,e,!0),e-=20;const w=g.addPage([595.28,841.89]),x=m(w);q(x,"別表四","所得の金額の計算に関する明細書",s,n,i,l),e=s-100,Q(x,"損益の計算",e,n,i,l),e-=25,x.rect(50,e-20,250,20,i.headerBg),x.rect(300,e-20,120,20,i.headerBg),x.rect(420,e-20,125,20,i.headerBg),x.text("区分",150,e-14,{size:10,font:l,align:"center"}),x.text("総額",360,e-14,{size:10,font:l,align:"center"}),x.text("処分（留保）",480,e-14,{size:10,font:l,align:"center"}),x.line(50,e,545,e),x.line(50,e-20,545,e-20),x.line(50,e,50,e-20),x.line(300,e,300,e-20),x.line(420,e,420,e-20),x.line(545,e,545,e-20),e-=20;const N=(h,_,S)=>{x.line(50,e-20,545,e-20),x.line(50,e,50,e-20),x.line(300,e,300,e-20),x.line(420,e,420,e-20),x.line(545,e,545,e-20),x.text(h,60,e-14,{size:9}),x.currency(_,410,e-14,9),x.currency(S,535,e-14,9),e-=20};N("1. 当期純利益",o.beppyo4.netIncomeFromPL,o.beppyo4.netIncomeFromPL),o.beppyo4.additions.forEach(h=>{N(`(加) ${h.description}`,h.amount,h.amount)}),o.beppyo4.subtractions.forEach(h=>{N(`(減) ${h.description}`,h.amount,h.amount)}),x.rect(50,e-20,495,20,i.highlight),N("所得金額 (総額 + 加算 - 減算)",o.beppyo4.taxableIncome,o.beppyo4.taxableIncome);const P=g.addPage([595.28,841.89]),T=m(P);q(T,"別表五(一)","利益積立金額の計算に関する明細書",s,n,i,l),e=s-100;const B=20;Q(T,"利益積立金額",e,n,i,l),e-=25;const D=(h,_,S,v=!1)=>{T.rect(50,S-20,250,20,v?i.headerBg:r(1,1,1)),T.rect(300,S-20,245,20,v?i.headerBg:r(1,1,1)),T.line(50,S-20,545,S-20),T.line(50,S,545,S),T.line(50,S,50,S-20),T.line(300,S,300,S-20),T.line(545,S,545,S-20),T.text(h,60,S-14,{size:10,font:v?l:p}),T.currency(_,535,S-14,10)};D("期首利益積立金額",o.beppyo5.retainedEarningsBegin,e),e-=20,D("当期増加額",o.beppyo5.currentIncrease,e),e-=20,D("当期減少額",o.beppyo5.currentDecrease,e),e-=20,D("期末利益積立金額",o.beppyo5.retainedEarningsEnd,e,!0),e-=20,e-=20,Q(T,"資本金等の額",e,n,i,l),e-=25,D("期首資本金等の額",o.beppyo5.capitalBegin,e),e-=20,D("期末資本金等の額",o.beppyo5.capitalEnd,e,!0),e-=20;const d=g.addPage([595.28,841.89]),u=m(d);q(u,"別表五(二)","租税公課の納付状況等に関する明細書",s,n,i,l),e=s-100,Q(u,"納付状況",e,n,i,l),e-=25,u.rect(50,e-20,300,20,r(1,1,1)),u.rect(350,e-20,195,20,r(1,1,1)),u.line(50,e,545,e),u.line(50,e-20,545,e-20),u.line(50,e,50,e-20),u.line(350,e,350,e-20),u.line(545,e,545,e-20),u.text("当期納付税額計",60,e-14,{size:10}),u.currency(o.beppyo5_2.totalPaid,535,e-14,10),e-=20,e-=10,u.rect(50,e-20,190,20,i.headerBg),u.rect(240,e-20,150,20,i.headerBg),u.rect(390,e-20,155,20,i.headerBg),u.line(50,e,545,e),u.line(50,e-20,545,e-20),u.line(50,e,50,e-20),u.line(240,e,240,e-20),u.line(390,e,390,e-20),u.line(545,e,545,e-20),u.text("税目",110,e-15,{size:9,font:l,align:"center"}),u.text("納付日",315,e-15,{size:9,font:l,align:"center"}),u.text("金額",460,e-15,{size:9,font:l,align:"center"}),e-=20,o.beppyo5_2.items.forEach(h=>{u.rect(50,e-20,190,20,r(1,1,1)),u.rect(240,e-20,150,20,r(1,1,1)),u.rect(390,e-20,155,20,r(1,1,1)),u.line(50,e,545,e),u.line(50,e-20,545,e-20),u.line(50,e,50,e-20),u.line(240,e,240,e-20),u.line(390,e,390,e-20),u.line(545,e,545,e-20),u.text(h.description,60,e-15,{size:9}),u.text(h.paymentDate,315,e-15,{size:9,align:"center"}),u.currency(h.amount,535,e-15,9),e-=20});const Y=g.addPage([595.28,841.89]),f=m(Y);q(f,"別表二","同族会社等の判定に関する明細書",s,n,i,l),e=s-100,Q(f,"基本情報",e,n,i,l),e-=25,f.rect(50,e-20,300,20,i.headerBg),f.rect(350,e-20,195,20,r(1,1,1)),f.line(50,e,545,e),f.line(50,e-20,545,e-20),f.line(50,e,50,e-20),f.line(350,e,350,e-20),f.line(545,e,545,e-20),f.text("発行済株式総数",60,e-14,{size:10,font:l}),f.currency(o.beppyo2.totalShares,535,e-14,10),e-=20,f.rect(50,e-20,300,20,i.headerBg),f.rect(350,e-20,195,20,r(1,1,1)),f.line(50,e,545,e),f.line(50,e-20,545,e-20),f.line(50,e,50,e-20),f.line(350,e,350,e-20),f.line(545,e,545,e-20),f.text("同族会社判定",60,e-14,{size:10,font:l}),f.text(o.beppyo2.isFamilyCompany?"該当":"非該当",360,e-14,{size:10}),e-=40,Q(f,"株主一覧",e,n,i,l),e-=25,f.rect(50,e-20,190,20,i.headerBg),f.rect(240,e-20,100,20,i.headerBg),f.rect(340,e-20,100,20,i.headerBg),f.rect(440,e-20,105,20,i.headerBg),f.line(50,e,545,e),f.line(50,e-20,545,e-20),f.line(50,e,50,e-20),f.line(240,e,240,e-20),f.line(340,e,340,e-20),f.line(440,e,440,e-20),f.line(545,e,545,e-20),f.text("株主名",60,e-15,{size:9,font:l}),f.text("持株数",320,e-15,{size:9,font:l,align:"right"}),f.text("割合",420,e-15,{size:9,font:l,align:"right"}),f.text("関係",450,e-15,{size:9,font:l}),e-=20,o.beppyo2.shareholders.forEach(h=>{f.rect(50,e-20,190,20,r(1,1,1)),f.rect(240,e-20,100,20,r(1,1,1)),f.rect(340,e-20,100,20,r(1,1,1)),f.rect(440,e-20,105,20,r(1,1,1)),f.line(50,e,545,e),f.line(50,e-20,545,e-20),f.line(50,e,50,e-20),f.line(240,e,240,e-20),f.line(340,e,340,e-20),f.line(440,e,440,e-20),f.line(545,e,545,e-20),f.text(h.name,60,e-15,{size:9}),f.currency(h.shares,330,e-15,9);const _=o.beppyo2.totalShares>0?(h.shares/o.beppyo2.totalShares*100).toFixed(1)+"%":"-";f.text(_,430,e-15,{size:9,align:"right"}),f.text(h.relationship,450,e-15,{size:9}),e-=20});const G=g.addPage([595.28,841.89]),W=m(G);q(W,"別表十五","交際費等の損金算入に関する明細書",s,n,i,l),e=s-100,Z(W,"1. 交際費等の支出額",o.beppyo15.socialExpenses,e,n,i,B),e-=B,Z(W,"2. うち接待飲食費",o.beppyo15.deductibleExpenses,e,n,i,B),e-=B,Z(W,"3. 損金算入限度額",o.beppyo15.deductionLimit,e,n,i,B,!0),e-=B,Z(W,"4. 損金不算入額",o.beppyo15.excessAmount,e,n,i,B,!0),e-=B;const H=g.addPage([595.28,841.89]),L=m(H);return q(L,"別表十六","減価償却資産の償却額の計算に関する明細書",s,n,i,l),e=s-100,Z(L,"当期償却実施額計",o.beppyo16.totalDepreciation,e,n,i,B),e-=B,Z(L,"償却限度額計",o.beppyo16.totalAllowable,e,n,i,B),e-=B,Z(L,"償却超過額",o.beppyo16.excessAmount,e,n,i,B,!0),e-=B,e-=20,L.rect(50,e-20,n-100,20,i.headerBg),L.text("資産名",60,e-15,{size:9,font:l}),L.text("取得価額",250,e-15,{size:9,font:l}),L.text("期末帳簿価額",380,e-15,{size:9,font:l}),e-=20,o.beppyo16.assets.forEach(h=>{L.line(50,e,n-50,e),L.text(h.name,60,e-15,{size:9}),L.currency(h.acquisitionCost,320,e-15,9),L.currency(h.bookValueEnd,450,e-15,9),e-=20}),g.save()}function ce(o){const g=[];return typeof o.beppyo4.taxableIncome!="number"&&g.push("所得金額が数値ではありません"),o.beppyo1.corporateTaxAmount<0&&g.push("法人税額が負数です"),o.beppyo4.taxableIncome>999999999999&&g.push("所得金額が桁あふれしています(上限12桁)"),g}async function ae(o,g){var B,D;const p=g.replace("_debug",""),l=g.includes("_debug");if(["beppyo1","beppyo4","beppyo5_1","beppyo5_2","beppyo15","beppyo16"].includes(p)){const{fillBeppyo1WithDigitBoxes:d,fillBeppyo4WithDigitBoxes:u,fillBeppyo5_1WithDigitBoxes:Y,fillBeppyo5_2WithDigitBoxes:f,fillBeppyo15WithDigitBoxes:G,fillBeppyo16WithDigitBoxes:W,DEFAULT_CALIBRATION:H}=await oe(async()=>{const{fillBeppyo1WithDigitBoxes:E,fillBeppyo4WithDigitBoxes:I,fillBeppyo5_1WithDigitBoxes:k,fillBeppyo5_2WithDigitBoxes:O,fillBeppyo15WithDigitBoxes:X,fillBeppyo16WithDigitBoxes:K,DEFAULT_CALIBRATION:j}=await import("./pdfDigitBoxService-CYqxL1Fb.js");return{fillBeppyo1WithDigitBoxes:E,fillBeppyo4WithDigitBoxes:I,fillBeppyo5_1WithDigitBoxes:k,fillBeppyo5_2WithDigitBoxes:O,fillBeppyo15WithDigitBoxes:X,fillBeppyo16WithDigitBoxes:K,DEFAULT_CALIBRATION:j}},__vite__mapDeps([0,1,2,3])),h={beppyo1:"/templates/beppyo1_official.pdf",beppyo4:"/templates/beppyo4_official.pdf",beppyo5_1:"/templates/beppyo5_1_official.pdf",beppyo5_2:"/templates/beppyo5_2_official.pdf",beppyo15:"/templates/beppyo15_official.pdf",beppyo16:"/templates/beppyo16_official.pdf"}[p],_=await fetch(`${h}?t=${Date.now()}`).then(E=>E.arrayBuffer()).then(E=>new Uint8Array(E)),S={globalShiftX:((B=o.calibration)==null?void 0:B.globalShiftX)||H.globalShiftX,globalShiftY:((D=o.calibration)==null?void 0:D.globalShiftY)||H.globalShiftY,digitCenterOffsetX:0,digitCenterOffsetY:0};let v;if(p==="beppyo1"?v=await d(_,o,S,l):p==="beppyo4"?v=await u(_,o,S,l):p==="beppyo5_1"?v=await Y(_,o,S,l):p==="beppyo5_2"?v=await f(_,o,S,l):p==="beppyo15"?v=await G(_,o,S,l):p==="beppyo16"&&(v=await W(_,o,S,l)),v)return console.log(`[${p}] Digit-box filling complete:`,v.report),v.pdfBytes}const{fillAcroFormFields:m,hasAcroFormFields:y,formatTaxNumber:c}=await oe(async()=>{const{fillAcroFormFields:d,hasAcroFormFields:u,formatTaxNumber:Y}=await import("./pdfFormFillerService-BHFsCl5O.js");return{fillAcroFormFields:d,hasAcroFormFields:u,formatTaxNumber:Y}},[]),{fillByTextAnchors:n}=await oe(async()=>{const{fillByTextAnchors:d}=await import("./pdfAnchorDetector-AviESCSu.js");return{fillByTextAnchors:d}},__vite__mapDeps([4,1,2,3])),{getTemplateCoordinates:s,getFieldMappingsForTemplate:a}=await oe(async()=>{const{getTemplateCoordinates:d,getFieldMappingsForTemplate:u}=await import("./pdfTemplateRegistry-BehEEBCD.js");return{getTemplateCoordinates:d,getFieldMappingsForTemplate:u}},[]),t={timestamp:new Date().toISOString(),template:g,loadSuccess:!1,hasAcroForm:!1,passedDataValidation:!1,mappings:[],errors:[]},e=ce(o);e.length>0?(t.errors.push(...e),console.warn("[PDF Validation] Pre-fill check failed:",e)):t.passedDataValidation=!0;const R={beppyo1:"/templates/beppyo1_official.pdf",beppyo4:"/templates/beppyo4_official.pdf",beppyo5_1:"/templates/beppyo5_1_official.pdf",beppyo5_2:"/templates/beppyo5_2_official.pdf",beppyo15:"/templates/beppyo15_official.pdf",beppyo16:"/templates/beppyo16_official.pdf"}[p];if(!R)throw new Error(`Unknown template type: ${p}`);const M=await fetch(`${R}?t=${Date.now()}`).then(d=>d.arrayBuffer()).then(d=>new Uint8Array(d));let w;try{w=await J.load(M,{ignoreEncryption:!0,throwOnInvalidObject:!1}),t.loadSuccess=!0}catch(d){if(p==="beppyo1"){const u=await fetch("/templates/beppyo1_official.pdf").then(Y=>Y.arrayBuffer());w=await J.load(new Uint8Array(u),{ignoreEncryption:!0,throwOnInvalidObject:!1}),t.loadSuccess=!0}else throw d}w.registerFontkit(ie);const{regular:x}=await te(w),N=w.getPages()[0];console.log(`
[PDF Filling] Starting 3-tier approach for ${p}`);let P=null;if(y(w)){if(console.log("[Tier 1] AcroForm fields detected, attempting to fill..."),t.hasAcroForm=!0,P=await m(w,o,p),P.success&&P.filledFields.length>0)return console.log(`[Tier 1] ✓ SUCCESS: Filled ${P.filledFields.length} fields via AcroForm`),t.mappings.push(...P.filledFields.map(d=>({key:d,value:"filled",method:"AcroForm"}))),w.save();console.log(`[Tier 1] ✗ FAILED: ${P.errors.join(", ")}`),t.errors.push(...P.errors)}else console.log("[Tier 1] No AcroForm fields found, skipping to Tier 2");console.log("[Tier 2] Attempting text anchor-based filling...");try{const d=await n(N,o,p,x);if(d.success&&d.filledFields.length>0)return console.log(`[Tier 2] ✓ SUCCESS: Filled ${d.filledFields.length} fields via anchors`),t.mappings.push(...d.filledFields.map(u=>({key:u,value:"filled",method:"Anchor"}))),w.save();console.log(`[Tier 2] ✗ FAILED: ${d.errors.join(", ")}`),t.errors.push(...d.errors)}catch(d){console.log(`[Tier 2] ✗ ERROR: ${d.message}`),t.errors.push(`Tier 2 error: ${d.message}`)}console.log("[Tier 3] Attempting fixed coordinate filling...");const T=s(p);if(T){const d=a(p,o);let u=0;for(const[Y,f]of d.entries()){const G=T.fields.get(Y);if(!G){t.errors.push(`No coordinates for field: ${Y}`);continue}try{const W=typeof f=="number"?c(f):String(f),H=10;let L=G.x;if(G.align==="right"){const h=x.widthOfTextAtSize(W,H);L-=h}else if(G.align==="center"){const h=x.widthOfTextAtSize(W,H);L-=h/2}N.drawText(W,{x:L,y:G.y,size:H,font:x,color:r(0,0,.5)}),u++,t.mappings.push({key:Y,value:f,method:"FixedCoord",coordinate:{x:G.x,y:G.y}}),console.log(`[Tier 3] ✓ Filled "${Y}" = "${W}" at (${G.x}, ${G.y})`)}catch(W){t.errors.push(`Failed to fill ${Y}: ${W.message}`)}}if(u>0)return console.log(`[Tier 3] ✓ SUCCESS: Filled ${u} fields via fixed coordinates`),w.save();console.log("[Tier 3] ✗ FAILED: No fields filled")}else console.log(`[Tier 3] ✗ No template coordinates found for ${p}`),t.errors.push(`No template coordinates for ${p}`);return console.error("[PDF Filling] All tiers failed!"),console.table(t.mappings),console.error("Errors:",t.errors),w.save()}async function me(o){const g=await J.create();g.registerFontkit(ie);const p=[{type:"beppyo1",name:"別表一"},{type:"beppyo4",name:"別表四"},{type:"beppyo5_1",name:"別表五一"},{type:"beppyo15",name:"別表十五"},{type:"beppyo16",name:"別表十六"}],l=[],i=[];for(const m of p)try{const y=await ae(o,m.type),c=await J.load(y),[n]=await g.copyPages(c,[0]);g.addPage(n),i.push(m.name)}catch(y){l.push(`${m.name}: ${y.message}`)}if(i.length===0)throw new Error(`公式テンプレートの読み込みにすべて失敗しました。
詳細:
${l.join(`
`)}`);return{pdfBytes:await g.save(),errors:l,successes:i}}function q(o,g,p,l,i,m,y){o.rect(0,l-70,i,70,m.primary),o.text(g,50,l-45,{size:24,font:y,color:r(1,1,1)}),o.text(p,200,l-45,{size:12,color:r(.9,.9,1)})}function Q(o,g,p,l,i,m){o.rect(50,p-20,l-100,20,i.secondary),o.text(g,60,p-15,{size:10,font:m,color:r(1,1,1)})}function Z(o,g,p,l,i,m,y,c=!1){c&&o.rect(50,l-y,i-100,y,m.highlight),o.line(50,l-y,i-50,l-y),o.text(g,60,l-y+6,{size:10}),o.currency(p,i-60,l-y+6,10),o.line(50,l,50,l-y),o.line(i-50,l,i-50,l-y)}export{xe as a,de as b,ge as c,he as d,ye as e,me as f,be as g,ae as h};
