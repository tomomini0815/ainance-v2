import{r as l}from"./pdfAutoFillService-Da9w_cIX.js";import"./index-CIKZNbWN.js";async function u(n,e,t,i){const s={success:!1,filledFields:[],skippedFields:[],errors:[],method:"Anchor"};try{const o=await y(n);if(o.size===0)return s.errors.push("No text anchors detected in PDF"),s;console.log(`[Anchor] Detected ${o.size} text anchors`);const r=a(t,e);for(const[c,p]of r.entries())try{x(n,c,String(p),o,i)?(s.filledFields.push(c),console.log(`[Anchor] ✓ Filled "${c}" = "${p}"`)):s.skippedFields.push(c)}catch(h){s.errors.push(`Failed to fill "${c}": ${h.message}`)}s.success=s.filledFields.length>0}catch(o){s.errors.push(`Anchor detection failed: ${o.message}`)}return s}async function y(n){const e=new Map;try{const t=[{text:"所得金額",x:100,y:700,width:80,height:20},{text:"法人税額",x:100,y:680,width:80,height:20},{text:"控除税額",x:100,y:660,width:80,height:20},{text:"中間納付",x:100,y:640,width:80,height:20},{text:"差引税額",x:100,y:620,width:80,height:20},{text:"当期利益",x:100,y:600,width:80,height:20},{text:"加算",x:100,y:580,width:80,height:20},{text:"減算",x:100,y:560,width:80,height:20},{text:"交際費",x:100,y:540,width:80,height:20},{text:"償却実施額",x:100,y:520,width:80,height:20}];for(const i of t)e.set(i.text,i)}catch(t){console.error("[Anchor] Text detection failed:",t)}return e}function x(n,e,t,i,s){const o=i.get(e);if(!o)return!1;const r=o.x+o.width+20,c=o.y;return n.drawText(t,{x:r,y:c,size:10,font:s,color:l(0,0,.5)}),!0}function a(n,e){const t=new Map;switch(n){case"beppyo1":t.set("所得金額",e.beppyo4.taxableIncome),t.set("法人税額",e.beppyo1.corporateTaxAmount),t.set("控除税額",e.beppyo1.specialTaxCredit),t.set("中間納付",e.beppyo1.interimPayment),t.set("差引税額",e.beppyo1.corporateTaxAmount-e.beppyo1.specialTaxCredit-e.beppyo1.interimPayment);break;case"beppyo4":const i=e.beppyo4.additions.reduce((o,r)=>o+r.amount,0),s=e.beppyo4.subtractions.reduce((o,r)=>o+r.amount,0);t.set("当期利益",e.beppyo4.netIncomeFromPL),t.set("加算",i),t.set("減算",s),t.set("所得金額",e.beppyo4.taxableIncome);break;case"beppyo15":t.set("交際費",e.beppyo15.socialExpenses),t.set("接待飲食費",e.beppyo15.deductibleExpenses),t.set("損金算入限度額",e.beppyo15.deductionLimit);break;case"beppyo16":t.set("償却実施額",e.beppyo16.totalDepreciation),t.set("償却限度額",e.beppyo16.totalAllowable),t.set("償却超過額",e.beppyo16.excessAmount);break}return t}export{y as detectTextAnchors,u as fillByTextAnchors};
