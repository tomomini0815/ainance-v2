const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfDigitBoxService-Dc6Ajx2V.js","assets/pdfAutoFillService-PLPbwm7Q.js","assets/index-Cte9M9zr.js","assets/index-Cboc0yrr.css","assets/pdfAnchorDetector-O2ZZzLPb.js"])))=>i.map(i=>d[i]);
import{_ as ie}from"./index-Cte9M9zr.js";import{P as J,r,f as le,a as ge}from"./pdfAutoFillService-PLPbwm7Q.js";const ue={交通費:"旅費交通費",旅費交通費:"旅費交通費",通信費:"通信費",水道光熱費:"水道光熱費",消耗品費:"消耗品費",接待交際費:"接待交際費",広告宣伝費:"広告宣伝費",地代家賃:"地代家賃",外注費:"外注工賃",給与:"給料賃金",雑費:"雑費",減価償却費:"減価償却費",修繕費:"修繕費",保険料:"損害保険料",福利厚生費:"福利厚生費",支払利息:"支払利息",租税公課:"租税公課",荷造運賃:"荷造運賃",その他:"雑費",未分類:"雑費","Travel & Transportation":"旅費交通費",Communication:"通信費",Utilities:"水道光熱費",Supplies:"消耗品費",Entertainment:"接待交際費",Advertising:"広告宣伝費",Rent:"地代家賃",Outsourcing:"外注工賃",Salaries:"給料賃金",Miscellaneous:"雑費",Depreciation:"減価償却費",Repairs:"修繕費",Insurance:"損害保険料",Benefits:"福利厚生費",Interest:"支払利息","Taxes & Dues":"租税公課",Shipping:"荷造運賃",Other:"雑費",Uncategorized:"雑費"};async function ne(o){o.registerFontkit(le);try{const u=await fetch("/fonts/NotoSansCJKjp-Regular.otf").then(w=>w.arrayBuffer()),p=await fetch("/fonts/NotoSansCJKjp-Bold.otf").then(w=>w.arrayBuffer()),l=await o.embedFont(u),i=await o.embedFont(p);return{regular:l,bold:i}}catch(u){console.error("日本語フォントのロードに失敗:",u);const p=u instanceof Error?u.message:String(u);throw new Error(`日本語フォントのロードに失敗しました (${p})。public/fonts/にフォントファイルを正しく配置してください。`)}}function C(o){return o===0?"0":o.toLocaleString("ja-JP")}function re(o){return`令和${o-2018}年`}async function me(o){const u=await J.create(),p=u.addPage([595.28,841.89]),{regular:l,bold:i}=await ne(u),{width:w,height:y}=p.getSize(),c={primary:r(.1,.2,.4),secondary:r(.15,.3,.5),text:r(.1,.1,.1),muted:r(.45,.45,.45),line:r(.6,.6,.6),headerBg:r(.92,.94,.98),highlight:r(.94,.96,1),green:r(.15,.55,.25),red:r(.75,.2,.2),lightGreen:r(.88,.96,.88),lightRed:r(1,.93,.93)},n=18,s=24,a={text:(v,S,E,b={})=>{p.drawText(v,{x:S,y:E,size:b.size||10,font:b.font||l,color:b.color||c.text})},line:(v,S,E,b,f=.5)=>{p.drawLine({start:{x:v,y:S},end:{x:E,y:b},thickness:f,color:c.line})},rect:(v,S,E,b,f)=>{p.drawRectangle({x:v,y:S,width:E,height:b,color:f})}};a.rect(0,y-60,w,60,c.primary),a.text("法 人 税 申 告 書",190,y-38,{size:24,font:i,color:r(1,1,1)}),a.text("（参考資料）",390,y-38,{size:12,color:r(.8,.85,.9)});let t=y-78;a.text(`${o.companyName||"会社名"}`,50,t,{size:13,font:i}),a.text(`${o.fiscalYear}年度（${re(o.fiscalYear)}度）`,300,t,{size:11}),a.text(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,450,t,{size:9,color:c.muted}),t-=20,a.line(40,t,555,t,1.5),t-=15,a.rect(40,t-s,515,s,c.secondary),a.text("第1部　法人情報",50,t-17,{size:12,font:i,color:r(1,1,1)}),t-=s+8,[["会社名（商号）",o.companyName||"―"],["代表者氏名",o.representativeName||"―"],["法人番号",o.corporateNumber||"―"],["本店所在地",o.address||"―"],["資本金",o.capital?`${C(o.capital)}円`:"―"]].forEach(([v,S],E)=>{E%2===0&&a.rect(40,t-n,515,n,c.highlight),a.line(40,t-n,555,t-n),a.text(v,55,t-n+5,{size:10}),a.text(S,200,t-n+5,{size:10}),t-=n}),t-=15,a.rect(40,t-s,515,s,c.secondary),a.text("第2部　損益の計算",50,t-17,{size:12,font:i,color:r(1,1,1)}),t-=s+8,a.rect(40,t-n-2,515,n+2,c.highlight),a.line(40,t-n-2,555,t-n-2),a.text("売上高",55,t-n+3,{size:11}),a.text(`${C(o.revenue)}円`,450,t-n+3,{size:11}),t-=n+4,a.line(40,t-n,555,t-n),a.text("売上原価・経費合計",55,t-n+5,{size:10}),a.text(`${C(o.expenses)}円`,450,t-n+5,{size:10}),t-=n+2,a.rect(40,t-n-4,515,n+4,c.lightGreen),a.line(40,t-n-4,555,t-n-4,1),a.line(40,t,555,t,1),a.text("当期純利益",55,t-n+1,{size:12,font:i}),a.text(`${C(o.netIncome)}円`,440,t-n+1,{size:12,font:i,color:o.netIncome>=0?c.green:c.red}),t-=n+20,a.rect(40,t-s,515,s,c.secondary),a.text("第3部　税額の計算",50,t-17,{size:12,font:i,color:r(1,1,1)}),t-=s+8;const F=o.taxableIncome,A=F<=8e6?.15:.232,L=Math.floor(F*A),B=Math.floor(L*.103),x=Math.floor(F*.07),N=L+B+x;return[{label:"課税所得金額",value:`${C(F)}円`,highlight:!0},{label:`法人税額（税率${(A*100).toFixed(1)}%）`,value:`${C(L)}円`},{label:"地方法人税（10.3%）",value:`${C(B)}円`},{label:"事業税（概算7%）",value:`${C(x)}円`}].forEach((v,S)=>{v.highlight?a.rect(40,t-n,515,n,c.highlight):S%2===1&&a.rect(40,t-n,515,n,r(.98,.98,.98)),a.line(40,t-n,555,t-n),a.text(v.label,55,t-n+5,{size:10}),a.text(v.value,450,t-n+5,{size:10}),t-=n}),t-=8,a.rect(40,t-n-8,515,n+8,c.lightRed),a.line(40,t-n-8,555,t-n-8,1.5),a.line(40,t,555,t,1.5),a.text("税額合計（概算）",55,t-n-1,{size:13,font:i}),a.text(`${C(N)}円`,430,t-n-1,{size:13,font:i,color:c.red}),a.line(40,75,555,75),a.text("※ この書類はAinanceで作成した参考資料です。",45,58,{size:9,color:c.muted}),a.text("※ 正式な申告には税理士への相談またはe-Taxをご利用ください。",45,44,{size:9,color:c.muted}),u.save()}async function we(o){const u=await J.create(),p=u.addPage([595.28,841.89]),{regular:l,bold:i}=await ne(u),{width:w,height:y}=p.getSize(),c={primary:r(.1,.2,.4),secondary:r(.15,.3,.5),text:r(.1,.1,.1),muted:r(.45,.45,.45),line:r(.6,.6,.6),headerBg:r(.92,.94,.98),highlight:r(.94,.96,1),green:r(.15,.55,.25),red:r(.75,.2,.2),lightGreen:r(.88,.96,.88),lightBlue:r(.88,.93,1)},n=16,s=20,a=22,t={text:(d,T,D,$={})=>{p.drawText(d,{x:T,y:D,size:$.size||9,font:$.font||l,color:$.color||c.text})},line:(d,T,D,$,oe=.5)=>{p.drawLine({start:{x:d,y:T},end:{x:D,y:$},thickness:oe,color:c.line})},rect:(d,T,D,$,oe)=>{p.drawRectangle({x:d,y:T,width:D,height:$,color:oe})}};t.rect(0,y-55,w,55,c.primary),t.text("決 算 報 告 書",210,y-35,{size:22,font:i,color:r(1,1,1)}),t.text("（財務三表）",360,y-35,{size:14,color:r(.85,.85,.9)});let e=y-72;t.text(`${o.companyName||"会社名"}`,50,e,{size:12,font:i}),t.text(`${o.fiscalYear}年度（${re(o.fiscalYear)}度）`,280,e,{size:10}),t.text(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,450,e,{size:9,color:c.muted}),e-=18,t.line(40,e,555,e,1.5),e-=12;const F=o.operatingIncome??o.revenue-o.expenses,A=o.costOfSales??0,L=o.grossProfit??o.revenue-A,B=o.nonOperatingIncome??0,x=o.nonOperatingExpenses??0,N=o.ordinaryIncome??F+B-x,O=o.cash??o.beginningCash??0,v=(o.accountsReceivable??0)+(o.beginningReceivable??0),S=(o.inventory??0)+(o.beginningInventory??0),E=(o.fixedAssets??0)+(o.beginningFixedAssets??0),b=o.totalAssets??O+v+S+E,f=(o.accountsPayable??0)+(o.beginningPayable??0),W=(o.shortTermLoans??0)+(o.beginningShortTermLoans??0),g=(o.longTermLoans??0)+(o.beginningLongTermLoans??0),G=o.totalLiabilities??f+W+g,Y=o.capital||o.beginningCapital||o.estimatedCapital||0,j=o.beginningRetainedEarnings??0,P=o.retainedEarnings??j+o.netIncome,h=o.depreciation??0,I=o.netIncome+h,z=0,m=0,_=I+z+m,R=40,H=250,K=e;t.rect(R,e-a,H,a,c.secondary),t.text("損益計算書（P/L）",R+70,e-15,{size:11,font:i,color:r(1,1,1)}),e-=a+4,[{label:"売上高",value:o.revenue,isHighlight:!0},{label:"売上原価",value:A},{label:"売上総利益",value:L,isSubtotal:!0},{label:"販売費及び一般管理費",value:o.operatingExpenses||o.expenses-A},{label:"営業利益",value:F,isSubtotal:!0,color:F>=0?c.green:c.red},{label:"営業外収益",value:B},{label:"営業外費用",value:x},{label:"経常利益",value:N,isSubtotal:!0},{label:"当期純利益",value:o.netIncome,isTotal:!0,color:o.netIncome>=0?c.green:c.red}].forEach(d=>{const T=d.isTotal?n+4:n;d.isTotal?t.rect(R,e-T,H,T,c.lightGreen):d.isSubtotal?t.rect(R,e-T,H,T,c.headerBg):d.isHighlight&&t.rect(R,e-T,H,T,c.highlight),t.line(R,e-T,R+H,e-T),t.text(d.label,R+8,e-T+5,{size:d.isTotal?10:9,font:d.isSubtotal||d.isTotal?i:l}),t.text(`${C(d.value)}`,R+H-60,e-T+5,{size:d.isTotal?10:9,font:d.isSubtotal||d.isTotal?i:l,color:d.color||c.text}),e-=T});const q=e;e=K;const k=305,se=250,M=122;t.rect(k,e-a,se,a,c.secondary),t.text("貸借対照表（B/S）",k+70,e-15,{size:11,font:i,color:r(1,1,1)}),e-=a+4,t.rect(k,e-s,M,s,r(.85,.9,.95)),t.text("資産の部",k+35,e-14,{size:10,font:i}),t.rect(k+M+6,e-s,M,s,r(.95,.9,.88)),t.text("負債・純資産の部",k+M+15,e-14,{size:10,font:i}),e-=s+2;const ce=[{label:"流動資産",isSection:!0},{label:"　現金預金",value:O},{label:"　売掛金",value:v},{label:"　棚卸資産",value:S},{label:"固定資産",isSection:!0},{label:"　有形固定資産",value:E},{label:"資産合計",value:b,isTotal:!0}],ae=G+Y+P,pe=[{label:"流動負債",isSection:!0},{label:"　買掛金",value:f},{label:"　短期借入金",value:W},{label:"純資産の部",isSection:!0},{label:"　資本金",value:Y},{label:"　利益剰余金",value:P},{label:"負債純資産合計",value:ae,isTotal:!0}];let U=e,V=e;ce.forEach(d=>{const T=d.isTotal?n+2:n-1;d.isTotal?t.rect(k,U-T,M,T,c.lightGreen):d.isSection&&t.rect(k,U-T,M,T,c.highlight),t.line(k,U-T,k+M,U-T),t.text(d.label,k+4,U-T+4,{size:8,font:d.isSection||d.isTotal?i:l}),d.value!==void 0&&t.text(C(d.value),k+M-45,U-T+4,{size:8,font:d.isTotal?i:l}),U-=T}),pe.forEach(d=>{const T=d.isTotal?n+2:n-1,D=k+M+6;d.isTotal?t.rect(D,V-T,M,T,c.lightGreen):d.isSection&&t.rect(D,V-T,M,T,c.highlight),t.line(D,V-T,D+M,V-T),t.text(d.label,D+4,V-T+4,{size:8,font:d.isSection||d.isTotal?i:l}),d.value!==void 0&&t.text(C(d.value),D+M-48,V-T+4,{size:8,font:d.isTotal?i:l}),V-=T}),e=Math.min(q,U,V)-20,t.rect(40,e-a,w-80,a,c.secondary),t.text("キャッシュ・フロー計算書（C/F）",200,e-15,{size:11,font:i,color:r(1,1,1)}),e-=a+6;const X=165,fe=10;return[{title:"営業活動によるCF",items:[{label:"税引前当期純利益",value:o.netIncome},{label:"減価償却費",value:h},{label:"売上債権の増減",value:-Math.floor(v*.1)},{label:"仕入債務の増減",value:Math.floor(f*.1)}],total:I},{title:"投資活動によるCF",items:[{label:"固定資産の取得",value:z},{label:"投資有価証券の取得",value:0}],total:z},{title:"財務活動によるCF",items:[{label:"借入金の返済",value:m},{label:"配当金の支払",value:0}],total:m}].forEach((d,T)=>{const D=40+T*(X+fe);let $=e;t.rect(D,$-s,X,s,c.headerBg),t.line(D,$-s,D+X,$-s),t.text(d.title,D+25,$-14,{size:9,font:i}),$-=s+2,d.items.forEach(oe=>{t.line(D,$-n,D+X,$-n),t.text(oe.label,D+6,$-n+5,{size:8}),t.text(C(oe.value),D+X-50,$-n+5,{size:8}),$-=n}),t.rect(D,$-n-2,X,n+2,c.lightBlue),t.line(D,$-n-2,D+X,$-n-2,1),t.text("小計",D+6,$-n+3,{size:9,font:i}),t.text(C(d.total),D+X-50,$-n+3,{size:9,font:i,color:d.total>=0?c.green:c.red})}),e=e-(s+n*4+n+2+15),t.rect(40,e-s,w-80,s,c.lightGreen),t.line(40,e-s,555,e-s,1.5),t.line(40,e,555,e,1.5),t.text("現金及び現金同等物の増減額",50,e-14,{size:11,font:i}),t.text(`${C(_)}円`,440,e-14,{size:11,font:i,color:_>=0?c.green:c.red}),e-=s+5,t.line(40,e-n,555,e-n),t.text("現金及び現金同等物の期末残高",50,e-n+5,{size:10}),t.text(`${C(O+_)}円`,440,e-n+5,{size:10,font:i}),t.line(40,70,555,70),t.text("※ この決算報告書はAinanceで作成した参考資料です。",45,55,{size:8,color:c.muted}),t.text("※ 貸借対照表・キャッシュフロー計算書は売上・経費データからの概算です。正確な作成には税理士へご相談ください。",45,43,{size:8,color:c.muted}),u.save()}async function ze(o){var i,w,y,c;const p=await fetch(`/templates/kakutei1&2.pdf?t=${Date.now()}`).then(n=>n.arrayBuffer()),l={name:o.name,address:o.address,phone:o.phone,tradeName:o.tradeName,revenue:o.revenue,expenses:o.expenses,netIncome:o.netIncome,businessIncome:o.netIncome,totalIncome:o.netIncome,taxableIncome:o.taxableIncome,estimatedTax:o.estimatedTax,fiscalYear:o.fiscalYear,isBlueReturn:!!o.isBlueReturn,expensesByCategory:o.expensesByCategory,deductions:{basic:(i=o.deductions)==null?void 0:i.basic,blueReturn:(w=o.deductions)==null?void 0:w.blueReturn,socialInsurance:(y=o.deductions)==null?void 0:y.socialInsurance,lifeInsurance:(c=o.deductions)==null?void 0:c.lifeInsurance}};return await ge(p,l)}async function Te(o){var e;const u=await J.create(),p=u.addPage([595.28,841.89]),{regular:l,bold:i}=await ne(u),{width:w,height:y}=p.getSize(),c={primary:r(.2,.4,.8),text:r(.1,.1,.1),muted:r(.4,.4,.4),line:r(.5,.5,.5),highlight:r(.95,.95,1),green:r(.2,.6,.3)},n=(F,A,L,B={})=>{p.drawText(F,{x:A,y:L,size:B.size||10,font:B.font||l,color:B.color||c.text})},s=(F,A,L,B,x=.5)=>{p.drawLine({start:{x:F,y:A},end:{x:L,y:B},thickness:x,color:c.line})},a=(F,A,L,B,x)=>{p.drawRectangle({x:F,y:A,width:L,height:B,color:x})};a(0,y-60,w,60,c.primary),n("青色申告決算書",200,y-40,{size:20,font:i,color:r(1,1,1)}),n("（一般用）",340,y-40,{size:12,color:r(.9,.9,.9)});let t=y-85;if(n(`${re(o.fiscalYear)}分　所得税青色申告決算書`,50,t,{size:11,font:i}),o.tradeName&&n(`屋号: ${o.tradeName}`,350,t,{size:10}),n(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,450,t,{size:9,color:c.muted}),t-=30,s(50,t,545,t,1),t-=25,n("損益計算書",50,t,{size:12,font:i,color:c.primary}),t-=20,a(50,t-5,495,20,c.highlight),s(50,t-5,545,t-5),n("売上（収入）金額　①",60,t,{font:i}),n(`${C(o.revenue)}円`,450,t,{font:i}),t-=30,n("経費",50,t,{size:11,font:i}),t-=20,a(50,t-15,495,15,r(.9,.9,.9)),s(50,t,545,t),s(50,t-15,545,t-15),n("勘定科目",60,t-11,{font:i,size:9}),n("金額",470,t-11,{font:i,size:9}),t-=18,o.expensesByCategory.forEach((F,A)=>{const L=ue[F.category]||F.category||"雑費";A%2===0&&a(50,t-15,495,15,r(.98,.98,.98)),s(50,t-15,545,t-15),n(L,60,t-11,{size:9}),n(C(F.amount),450,t-11,{size:9}),t-=15,t<200}),a(50,t-18,495,18,r(.95,.95,.95)),s(50,t-18,545,t-18),n("経費合計　㉑",60,t-13,{font:i}),n(`${C(o.expenses)}円`,445,t-13,{font:i}),t-=30,s(50,t-5,545,t-5),n("差引金額　① - ㉑",60,t),n(`${C(o.netIncome)}円`,450,t),t-=25,(e=o.deductions)!=null&&e.blueReturn){s(50,t-5,545,t-5),n("青色申告特別控除額",60,t),n(`${C(o.deductions.blueReturn)}円`,450,t),t-=25;const F=Math.max(0,o.netIncome-o.deductions.blueReturn);a(50,t-8,495,25,r(.95,1,.95)),s(50,t-8,545,t-8,1),s(50,t+17,545,t+17,1),n("所得金額　㊸",60,t+2,{font:i,size:11}),n(`${C(F)}円`,440,t+2,{font:i,size:11,color:c.green})}return s(50,60,545,60),n("※ この書類はAinanceで作成した参考資料です。",50,45,{size:8,color:c.muted}),n("※ 正式な申告には国税庁「確定申告書等作成コーナー」をご利用ください。",50,33,{size:8,color:c.muted}),u.save()}async function Be(o){const u=await J.create(),p=50,l=841.89,i=595.28;let w=u.addPage([i,l]);const{regular:y,bold:c}=await ne(u),n={primary:r(.1,.2,.4),text:r(.1,.1,.1),muted:r(.4,.4,.4),line:r(.8,.8,.8),headerBg:r(.95,.95,.98)};let s=l-p;const a=(B,x,N,O=10,v=y,S=n.text)=>{w.drawText(B,{x,y:N,size:O,font:v,color:S})},t=(B,x,N,O)=>{if(!B)return[];const v=B.split(""),S=[];let E="";for(let b=0;b<v.length;b++){const f=v[b];N.widthOfTextAtSize(E+f,x)<O?E+=f:(S.push(E),E=f)}return S.push(E),S},e=B=>s-B<p?(w=u.addPage([i,l]),s=l-p,!0):!1;e(80),a("補 助 金 申 請 書 （案）",p,s,18,c),s-=30,a(`申請補助金: ${o.subsidyName}`,p,s,12,c,n.primary),s-=20,a(`作成日: ${new Date().toLocaleDateString("ja-JP")}`,p,s,10,y,n.muted),s-=10,w.drawLine({start:{x:p,y:s},end:{x:i-p,y:s},thickness:1,color:n.primary}),s-=30;const F=i-p*2,A=10,L=16;for(const B of o.sections){e(40),w.drawRectangle({x:p,y:s-20,width:F,height:24,color:n.headerBg}),a(B.title,p+10,s-14,11,c,n.primary),s-=35;const x=B.content.split(`
`);for(const N of x){const O=t(N,A,y,F);for(const v of O)e(L),a(v,p,s,A,y),s-=L;s-=5}s-=15}return u.save()}async function ve(o){const u=await J.create(),{regular:p,bold:l}=await ne(u),i={primary:r(.1,.2,.4),secondary:r(.15,.3,.5),text:r(.1,.1,.1),muted:r(.45,.45,.45),line:r(.6,.6,.6),headerBg:r(.92,.94,.98),highlight:r(.94,.96,1),lightGreen:r(.88,.96,.88),lightRed:r(1,.93,.93)},w=h=>({text:(I,z,m,_={})=>{const R=_.size||10,H=_.font||p,K=_.color||i.text;let te=z;if(_.align==="right"){const q=H.widthOfTextAtSize(I,R);te-=q}else if(_.align==="center"){const q=H.widthOfTextAtSize(I,R);te-=q/2}h.drawText(I,{x:te,y:m,size:R,font:H,color:K})},line:(I,z,m,_,R=.5)=>{h.drawLine({start:{x:I,y:z},end:{x:m,y:_},thickness:R,color:i.line})},rect:(I,z,m,_,R)=>{h.drawRectangle({x:I,y:z,width:m,height:_,color:R})},currency:(I,z,m,_=10)=>{const R=C(I),H=p,K=H.widthOfTextAtSize(R,_);h.drawText(R,{x:z-K,y:m,size:_,font:H,color:i.text})}}),y=u.addPage([595.28,841.89]),c=w(y),{width:n,height:s}=y.getSize();c.rect(0,s-150,n,150,i.primary),c.text("法人税申告書報告書",n/2,s-80,{size:28,font:l,color:r(1,1,1),align:"center"}),c.text(`${re(new Date().getFullYear())}度版`,n/2,s-120,{size:14,color:r(.9,.9,1),align:"center"}),c.text("会社名:",100,s-300,{size:14,color:i.muted}),c.text("（会社名未設定）",200,s-300,{size:18,font:l}),c.text("作成日:",100,s-350,{size:14,color:i.muted}),c.text(new Date().toLocaleDateString("ja-JP"),200,s-350,{size:18}),c.text("※ 本資料はAinanceで作成された参考資料です。",n/2,100,{size:10,color:i.muted,align:"center"}),c.text("正式な税務申告には、税理士の確認またはe-Taxをご利用ください。",n/2,80,{size:10,color:i.muted,align:"center"});const a=u.addPage([595.28,841.89]),t=w(a);Q(t,"別表一（一）","各事業年度の所得に係る申告書",s,n,i,l);let e=s-100;Z(t,"申告額の計算",e,n,i,l),e-=25;const F=(h,I,z,m,_=!1)=>{h.rect(50,m-20,300,20,_?i.headerBg:r(1,1,1)),h.rect(350,m-20,195,20,_?i.headerBg:r(1,1,1)),h.line(50,m-20,545,m-20),h.line(50,m,545,m),h.line(50,m,50,m-20),h.line(350,m,350,m-20),h.line(545,m,545,m-20),h.text(I,60,m-14,{size:10,font:_?l:p}),typeof z=="number"?h.currency(z,535,m-14,10):h.text(z,360,m-14,{size:10})};F(t,"1. 別表四の所得金額又は欠損金額",o.beppyo4.taxableIncome,e),e-=20,F(t,"2. 欠損金又は災害損失金の控除額",0,e),e-=20,F(t,"3. 翌期へ繰り越す欠損金又は災害損失金",0,e),e-=20,F(t,"4. 課税標準額 (1-2)",Math.max(0,o.beppyo1.taxableIncome),e),e-=20,e-=10,F(t,"5. 課税標準額に対する法人税額",o.beppyo1.corporateTaxAmount,e),e-=20,F(t,"6. 控除税額（所得税額等）",o.beppyo1.specialTaxCredit,e),e-=20,F(t,"7. 差引所得に対する法人税額 (5-6)",Math.max(0,o.beppyo1.corporateTaxAmount-o.beppyo1.specialTaxCredit),e),e-=20;const A=Math.floor(o.beppyo1.corporateTaxAmount*.103);F(t,"8. 地方法人税額（課税標準法人税額 × 10.3%）",A,e),e-=20,F(t,"9. 中間申告分の法人税額",o.beppyo1.interimPayment,e),e-=20;const L=Math.max(0,o.beppyo1.corporateTaxAmount-o.beppyo1.specialTaxCredit+A-o.beppyo1.interimPayment);F(t,"10. 差引確定法人税額",L,e,!0),e-=20;const B=u.addPage([595.28,841.89]),x=w(B);Q(x,"別表四","所得の金額の計算に関する明細書",s,n,i,l),e=s-100,Z(x,"損益の計算",e,n,i,l),e-=25,x.rect(50,e-20,250,20,i.headerBg),x.rect(300,e-20,120,20,i.headerBg),x.rect(420,e-20,125,20,i.headerBg),x.text("区分",150,e-14,{size:10,font:l,align:"center"}),x.text("総額",360,e-14,{size:10,font:l,align:"center"}),x.text("処分（留保）",480,e-14,{size:10,font:l,align:"center"}),x.line(50,e,545,e),x.line(50,e-20,545,e-20),x.line(50,e,50,e-20),x.line(300,e,300,e-20),x.line(420,e,420,e-20),x.line(545,e,545,e-20),e-=20;const N=(h,I,z)=>{x.line(50,e-20,545,e-20),x.line(50,e,50,e-20),x.line(300,e,300,e-20),x.line(420,e,420,e-20),x.line(545,e,545,e-20),x.text(h,60,e-14,{size:9}),x.currency(I,410,e-14,9),x.currency(z,535,e-14,9),e-=20};N("1. 当期純利益",o.beppyo4.netIncomeFromPL,o.beppyo4.netIncomeFromPL),o.beppyo4.additions.forEach(h=>{N(`(加) ${h.description}`,h.amount,h.amount)}),o.beppyo4.subtractions.forEach(h=>{N(`(減) ${h.description}`,h.amount,h.amount)}),x.rect(50,e-20,495,20,i.highlight),N("所得金額 (総額 + 加算 - 減算)",o.beppyo4.taxableIncome,o.beppyo4.taxableIncome);const O=u.addPage([595.28,841.89]),v=w(O);Q(v,"別表五(一)","利益積立金額の計算に関する明細書",s,n,i,l),e=s-100;const S=20;Z(v,"利益積立金額",e,n,i,l),e-=25;const E=(h,I,z,m=!1)=>{v.rect(50,z-20,250,20,m?i.headerBg:r(1,1,1)),v.rect(300,z-20,245,20,m?i.headerBg:r(1,1,1)),v.line(50,z-20,545,z-20),v.line(50,z,545,z),v.line(50,z,50,z-20),v.line(300,z,300,z-20),v.line(545,z,545,z-20),v.text(h,60,z-14,{size:10,font:m?l:p}),v.currency(I,535,z-14,10)};E("期首利益積立金額",o.beppyo5.retainedEarningsBegin,e),e-=20,E("当期増加額",o.beppyo5.currentIncrease,e),e-=20,E("当期減少額",o.beppyo5.currentDecrease,e),e-=20,E("期末利益積立金額",o.beppyo5.retainedEarningsEnd,e,!0),e-=20,e-=20,Z(v,"資本金等の額",e,n,i,l),e-=25,E("期首資本金等の額",o.beppyo5.capitalBegin,e),e-=20,E("期末資本金等の額",o.beppyo5.capitalEnd,e,!0),e-=20;const b=u.addPage([595.28,841.89]),f=w(b);Q(f,"別表五(二)","租税公課の納付状況等に関する明細書",s,n,i,l),e=s-100,Z(f,"納付状況",e,n,i,l),e-=25,f.rect(50,e-20,300,20,r(1,1,1)),f.rect(350,e-20,195,20,r(1,1,1)),f.line(50,e,545,e),f.line(50,e-20,545,e-20),f.line(50,e,50,e-20),f.line(350,e,350,e-20),f.line(545,e,545,e-20),f.text("当期納付税額計",60,e-14,{size:10}),f.currency(o.beppyo5_2.totalPaid,535,e-14,10),e-=20,e-=10,f.rect(50,e-20,190,20,i.headerBg),f.rect(240,e-20,150,20,i.headerBg),f.rect(390,e-20,155,20,i.headerBg),f.line(50,e,545,e),f.line(50,e-20,545,e-20),f.line(50,e,50,e-20),f.line(240,e,240,e-20),f.line(390,e,390,e-20),f.line(545,e,545,e-20),f.text("税目",110,e-15,{size:9,font:l,align:"center"}),f.text("納付日",315,e-15,{size:9,font:l,align:"center"}),f.text("金額",460,e-15,{size:9,font:l,align:"center"}),e-=20,o.beppyo5_2.items.forEach(h=>{f.rect(50,e-20,190,20,r(1,1,1)),f.rect(240,e-20,150,20,r(1,1,1)),f.rect(390,e-20,155,20,r(1,1,1)),f.line(50,e,545,e),f.line(50,e-20,545,e-20),f.line(50,e,50,e-20),f.line(240,e,240,e-20),f.line(390,e,390,e-20),f.line(545,e,545,e-20),f.text(h.description,60,e-15,{size:9}),f.text(h.paymentDate,315,e-15,{size:9,align:"center"}),f.currency(h.amount,535,e-15,9),e-=20});const W=u.addPage([595.28,841.89]),g=w(W);Q(g,"別表二","同族会社等の判定に関する明細書",s,n,i,l),e=s-100,Z(g,"基本情報",e,n,i,l),e-=25,g.rect(50,e-20,300,20,i.headerBg),g.rect(350,e-20,195,20,r(1,1,1)),g.line(50,e,545,e),g.line(50,e-20,545,e-20),g.line(50,e,50,e-20),g.line(350,e,350,e-20),g.line(545,e,545,e-20),g.text("発行済株式総数",60,e-14,{size:10,font:l}),g.currency(o.beppyo2.totalShares,535,e-14,10),e-=20,g.rect(50,e-20,300,20,i.headerBg),g.rect(350,e-20,195,20,r(1,1,1)),g.line(50,e,545,e),g.line(50,e-20,545,e-20),g.line(50,e,50,e-20),g.line(350,e,350,e-20),g.line(545,e,545,e-20),g.text("同族会社判定",60,e-14,{size:10,font:l}),g.text(o.beppyo2.isFamilyCompany?"該当":"非該当",360,e-14,{size:10}),e-=40,Z(g,"株主一覧",e,n,i,l),e-=25,g.rect(50,e-20,190,20,i.headerBg),g.rect(240,e-20,100,20,i.headerBg),g.rect(340,e-20,100,20,i.headerBg),g.rect(440,e-20,105,20,i.headerBg),g.line(50,e,545,e),g.line(50,e-20,545,e-20),g.line(50,e,50,e-20),g.line(240,e,240,e-20),g.line(340,e,340,e-20),g.line(440,e,440,e-20),g.line(545,e,545,e-20),g.text("株主名",60,e-15,{size:9,font:l}),g.text("持株数",320,e-15,{size:9,font:l,align:"right"}),g.text("割合",420,e-15,{size:9,font:l,align:"right"}),g.text("関係",450,e-15,{size:9,font:l}),e-=20,o.beppyo2.shareholders.forEach(h=>{g.rect(50,e-20,190,20,r(1,1,1)),g.rect(240,e-20,100,20,r(1,1,1)),g.rect(340,e-20,100,20,r(1,1,1)),g.rect(440,e-20,105,20,r(1,1,1)),g.line(50,e,545,e),g.line(50,e-20,545,e-20),g.line(50,e,50,e-20),g.line(240,e,240,e-20),g.line(340,e,340,e-20),g.line(440,e,440,e-20),g.line(545,e,545,e-20),g.text(h.name,60,e-15,{size:9}),g.currency(h.shares,330,e-15,9);const I=o.beppyo2.totalShares>0?(h.shares/o.beppyo2.totalShares*100).toFixed(1)+"%":"-";g.text(I,430,e-15,{size:9,align:"right"}),g.text(h.relationship,450,e-15,{size:9}),e-=20});const G=u.addPage([595.28,841.89]),Y=w(G);Q(Y,"別表十五","交際費等の損金算入に関する明細書",s,n,i,l),e=s-100,ee(Y,"1. 交際費等の支出額",o.beppyo15.socialExpenses,e,n,i,S),e-=S,ee(Y,"2. うち接待飲食費",o.beppyo15.deductibleExpenses,e,n,i,S),e-=S,ee(Y,"3. 損金算入限度額",o.beppyo15.deductionLimit,e,n,i,S,!0),e-=S,ee(Y,"4. 損金不算入額",o.beppyo15.excessAmount,e,n,i,S,!0),e-=S;const j=u.addPage([595.28,841.89]),P=w(j);return Q(P,"別表十六","減価償却資産の償却額の計算に関する明細書",s,n,i,l),e=s-100,ee(P,"当期償却実施額計",o.beppyo16.totalDepreciation,e,n,i,S),e-=S,ee(P,"償却限度額計",o.beppyo16.totalAllowable,e,n,i,S),e-=S,ee(P,"償却超過額",o.beppyo16.excessAmount,e,n,i,S,!0),e-=S,e-=20,P.rect(50,e-20,n-100,20,i.headerBg),P.text("資産名",60,e-15,{size:9,font:l}),P.text("取得価額",250,e-15,{size:9,font:l}),P.text("期末帳簿価額",380,e-15,{size:9,font:l}),e-=20,o.beppyo16.assets.forEach(h=>{P.line(50,e,n-50,e),P.text(h.name,60,e-15,{size:9}),P.currency(h.acquisitionCost,320,e-15,9),P.currency(h.bookValueEnd,450,e-15,9),e-=20}),u.save()}function he(o){const u=[];return typeof o.beppyo4.taxableIncome!="number"&&u.push("所得金額が数値ではありません"),o.beppyo1.corporateTaxAmount<0&&u.push("法人税額が負数です"),o.beppyo4.taxableIncome>999999999999&&u.push("所得金額が桁あふれしています(上限12桁)"),u}async function xe(o,u){var S,E;const p=u.replace("_debug",""),l=u.includes("_debug");if(["beppyo1","beppyo4","beppyo5_1","beppyo5_2","beppyo15","beppyo16"].includes(p)){const{fillBeppyo1WithDigitBoxes:b,fillBeppyo4WithDigitBoxes:f,fillBeppyo5_1WithDigitBoxes:W,fillBeppyo5_2WithDigitBoxes:g,fillBeppyo15WithDigitBoxes:G,fillBeppyo16WithDigitBoxes:Y,DEFAULT_CALIBRATION:j}=await ie(async()=>{const{fillBeppyo1WithDigitBoxes:_,fillBeppyo4WithDigitBoxes:R,fillBeppyo5_1WithDigitBoxes:H,fillBeppyo5_2WithDigitBoxes:K,fillBeppyo15WithDigitBoxes:te,fillBeppyo16WithDigitBoxes:q,DEFAULT_CALIBRATION:k}=await import("./pdfDigitBoxService-Dc6Ajx2V.js");return{fillBeppyo1WithDigitBoxes:_,fillBeppyo4WithDigitBoxes:R,fillBeppyo5_1WithDigitBoxes:H,fillBeppyo5_2WithDigitBoxes:K,fillBeppyo15WithDigitBoxes:te,fillBeppyo16WithDigitBoxes:q,DEFAULT_CALIBRATION:k}},__vite__mapDeps([0,1,2,3])),h={beppyo1:"/templates/beppyo1_official.pdf",beppyo4:"/templates/beppyo4_official.pdf",beppyo5_1:"/templates/beppyo5_1_official.pdf",beppyo5_2:"/templates/beppyo5_2_official.pdf",beppyo15:"/templates/beppyo15_official.pdf",beppyo16:"/templates/beppyo16_official.pdf"}[p],I=await fetch(`${h}?t=${Date.now()}`).then(_=>_.arrayBuffer()).then(_=>new Uint8Array(_)),z={globalShiftX:((S=o.calibration)==null?void 0:S.globalShiftX)||j.globalShiftX,globalShiftY:((E=o.calibration)==null?void 0:E.globalShiftY)||j.globalShiftY,digitCenterOffsetX:0,digitCenterOffsetY:0};let m;if(p==="beppyo1"?m=await b(I,o,z,l):p==="beppyo4"?m=await f(I,o,z,l):p==="beppyo5_1"?m=await W(I,o,z,l):p==="beppyo5_2"?m=await g(I,o,z,l):p==="beppyo15"?m=await G(I,o,z,l):p==="beppyo16"&&(m=await Y(I,o,z,l)),m)return console.log(`[${p}] Digit-box filling complete:`,m.report),m.pdfBytes}const{fillAcroFormFields:w,hasAcroFormFields:y,formatTaxNumber:c}=await ie(async()=>{const{fillAcroFormFields:b,hasAcroFormFields:f,formatTaxNumber:W}=await import("./pdfFormFillerService-BHFsCl5O.js");return{fillAcroFormFields:b,hasAcroFormFields:f,formatTaxNumber:W}},[]),{fillByTextAnchors:n}=await ie(async()=>{const{fillByTextAnchors:b}=await import("./pdfAnchorDetector-O2ZZzLPb.js");return{fillByTextAnchors:b}},__vite__mapDeps([4,1,2,3])),{getTemplateCoordinates:s,getFieldMappingsForTemplate:a}=await ie(async()=>{const{getTemplateCoordinates:b,getFieldMappingsForTemplate:f}=await import("./pdfTemplateRegistry-BehEEBCD.js");return{getTemplateCoordinates:b,getFieldMappingsForTemplate:f}},[]),t={timestamp:new Date().toISOString(),template:u,loadSuccess:!1,hasAcroForm:!1,passedDataValidation:!1,mappings:[],errors:[]},e=he(o);e.length>0?(t.errors.push(...e),console.warn("[PDF Validation] Pre-fill check failed:",e)):t.passedDataValidation=!0;const A={beppyo1:"/templates/beppyo1_official.pdf",beppyo4:"/templates/beppyo4_official.pdf",beppyo5_1:"/templates/beppyo5_1_official.pdf",beppyo5_2:"/templates/beppyo5_2_official.pdf",beppyo15:"/templates/beppyo15_official.pdf",beppyo16:"/templates/beppyo16_official.pdf"}[p];if(!A)throw new Error(`Unknown template type: ${p}`);const L=await fetch(`${A}?t=${Date.now()}`).then(b=>b.arrayBuffer()).then(b=>new Uint8Array(b));let B;try{B=await J.load(L,{ignoreEncryption:!0,throwOnInvalidObject:!1}),t.loadSuccess=!0}catch(b){if(p==="beppyo1"){const f=await fetch("/templates/beppyo1_official.pdf").then(W=>W.arrayBuffer());B=await J.load(new Uint8Array(f),{ignoreEncryption:!0,throwOnInvalidObject:!1}),t.loadSuccess=!0}else throw b}B.registerFontkit(le);const{regular:x}=await ne(B),N=B.getPages()[0];console.log(`
[PDF Filling] Starting 3-tier approach for ${p}`);let O=null;if(y(B)){if(console.log("[Tier 1] AcroForm fields detected, attempting to fill..."),t.hasAcroForm=!0,O=await w(B,o,p),O.success&&O.filledFields.length>0)return console.log(`[Tier 1] ✓ SUCCESS: Filled ${O.filledFields.length} fields via AcroForm`),t.mappings.push(...O.filledFields.map(b=>({key:b,value:"filled",method:"AcroForm"}))),B.save();console.log(`[Tier 1] ✗ FAILED: ${O.errors.join(", ")}`),t.errors.push(...O.errors)}else console.log("[Tier 1] No AcroForm fields found, skipping to Tier 2");console.log("[Tier 2] Attempting text anchor-based filling...");try{const b=await n(N,o,p,x);if(b.success&&b.filledFields.length>0)return console.log(`[Tier 2] ✓ SUCCESS: Filled ${b.filledFields.length} fields via anchors`),t.mappings.push(...b.filledFields.map(f=>({key:f,value:"filled",method:"Anchor"}))),B.save();console.log(`[Tier 2] ✗ FAILED: ${b.errors.join(", ")}`),t.errors.push(...b.errors)}catch(b){console.log(`[Tier 2] ✗ ERROR: ${b.message}`),t.errors.push(`Tier 2 error: ${b.message}`)}console.log("[Tier 3] Attempting fixed coordinate filling...");const v=s(p);if(v){const b=a(p,o);let f=0;for(const[W,g]of b.entries()){const G=v.fields.get(W);if(!G){t.errors.push(`No coordinates for field: ${W}`);continue}try{const Y=typeof g=="number"?c(g):String(g),j=10;let P=G.x;if(G.align==="right"){const h=x.widthOfTextAtSize(Y,j);P-=h}else if(G.align==="center"){const h=x.widthOfTextAtSize(Y,j);P-=h/2}N.drawText(Y,{x:P,y:G.y,size:j,font:x,color:r(0,0,.5)}),f++,t.mappings.push({key:W,value:g,method:"FixedCoord",coordinate:{x:G.x,y:G.y}}),console.log(`[Tier 3] ✓ Filled "${W}" = "${Y}" at (${G.x}, ${G.y})`)}catch(Y){t.errors.push(`Failed to fill ${W}: ${Y.message}`)}}if(f>0)return console.log(`[Tier 3] ✓ SUCCESS: Filled ${f} fields via fixed coordinates`),B.save();console.log("[Tier 3] ✗ FAILED: No fields filled")}else console.log(`[Tier 3] ✗ No template coordinates found for ${p}`),t.errors.push(`No template coordinates for ${p}`);return console.error("[PDF Filling] All tiers failed!"),console.table(t.mappings),console.error("Errors:",t.errors),B.save()}async function Se(o){const u=await J.create();u.registerFontkit(le);const p=[{type:"beppyo1",name:"別表一"},{type:"beppyo4",name:"別表四"},{type:"beppyo5_1",name:"別表五一"},{type:"beppyo15",name:"別表十五"},{type:"beppyo16",name:"別表十六"}],l=[],i=[];for(const w of p)try{const y=await xe(o,w.type),c=await J.load(y),[n]=await u.copyPages(c,[0]);u.addPage(n),i.push(w.name)}catch(y){l.push(`${w.name}: ${y.message}`)}if(i.length===0)throw new Error(`公式テンプレートの読み込みにすべて失敗しました。
詳細:
${l.join(`
`)}`);return{pdfBytes:await u.save(),errors:l,successes:i}}function Q(o,u,p,l,i,w,y){o.rect(0,l-70,i,70,w.primary),o.text(u,50,l-45,{size:24,font:y,color:r(1,1,1)}),o.text(p,200,l-45,{size:12,color:r(.9,.9,1)})}function Z(o,u,p,l,i,w){o.rect(50,p-20,l-100,20,i.secondary),o.text(u,60,p-15,{size:10,font:w,color:r(1,1,1)})}function ee(o,u,p,l,i,w,y,c=!1){c&&o.rect(50,l-y,i-100,y,w.highlight),o.line(50,l-y,i-50,l-y),o.text(u,60,l-y+6,{size:10}),o.currency(p,i-60,l-y+6,10),o.line(50,l,50,l-y),o.line(i-50,l,i-50,l-y)}export{ze as a,Te as b,me as c,we as d,ve as e,Se as f,Be as g,xe as h};
