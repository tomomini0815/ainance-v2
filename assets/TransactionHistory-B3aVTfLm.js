import{c as me,e as he,a as ue,k as pe,l as ge,r as n,I as be,j as e,L as fe,P as je,F as H,T as we,f as Ne,X as Q,i as ye,q as U,H as ve,p as Z,J as ke,C as Ce}from"./index-DswpKyhs.js";import{T as B}from"./TransactionIcon-yIlove_q.js";import{T as Se}from"./TransactionForm-DkiwJ7TR.js";import Me from"./OmniEntryPortal-DqihKsEk.js";import{A as Le}from"./arrow-left-gdWbSuNE.js";import{J as Te}from"./japanese-yen-DdKaBain.js";import{F as $e}from"./funnel-CvPnkOJ5.js";import{A as Pe}from"./activity-CvbKIB8x.js";import{R as ee}from"./repeat-BGPOityo.js";import{W as _e}from"./wallet-HNoGVoZs.js";import{C as De}from"./clock-Ddp8eeLX.js";import"./keywordCategoryService-9yZ-pShI.js";import"./star-BejM2s-9.js";import"./zap-DUeSvkim.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],Ae=me("list",Fe),Ke=()=>{const{currentBusinessType:c}=he(),{user:E}=ue(),{selectedYear:W}=pe(),{transactions:y,loading:te,updateTransaction:se,deleteTransaction:R,fetchTransactions:b}=ge(E==null?void 0:E.id,c==null?void 0:c.business_type),[v,z]=n.useState(""),[re,j]=n.useState(!1),[D,S]=n.useState(null),[h,M]=n.useState([]),[I,ae]=n.useState(!1),[k,X]=n.useState(""),[o,q]=n.useState({start:"",end:""}),[x,Y]=n.useState({min:"",max:""}),[J,ie]=n.useState("date"),[F,ne]=n.useState("desc"),[m,A]=n.useState("all"),[u,w]=n.useState(1),V=10;n.useEffect(()=>{c!=null&&c.id&&b()},[c,b]);const G=be();n.useEffect(()=>{const s=new URLSearchParams(G.search).get("search");s&&z(s)},[G.search]),n.useEffect(()=>{const t=async()=>{c!=null&&c.id&&(await new Promise(s=>setTimeout(s,100)),b())};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[c,b]),n.useEffect(()=>{const t=async()=>{console.log("transactionApprovedイベントを受信"),c!=null&&c.id&&(await new Promise(s=>setTimeout(s,100)),b())};return window.addEventListener("transactionApproved",t),()=>{window.removeEventListener("transactionApproved",t)}},[c,b]);const le=n.useMemo(()=>{const t=y.map(s=>s.category);return Array.from(new Set(t)).filter(Boolean)},[y]),p=n.useMemo(()=>{let t=[...y];return t=t.filter(s=>s.approval_status!=="pending"),m==="depreciation"&&(t=t.filter(s=>{var i;return(i=s.tags)==null?void 0:i.includes("depreciation_asset")})),v&&(t=t.filter(s=>s.item&&s.item.toLowerCase().includes(v.toLowerCase())||s.description&&s.description.toLowerCase().includes(v.toLowerCase())||s.category&&s.category.toLowerCase().includes(v.toLowerCase()))),k&&(t=t.filter(s=>s.category===k)),o.start&&(t=t.filter(s=>s.date>=o.start)),o.end&&(t=t.filter(s=>s.date<=o.end)),x.min&&(t=t.filter(s=>s.amount>=Number(x.min))),x.max&&(t=t.filter(s=>s.amount<=Number(x.max))),t.sort((s,i)=>{let d,l;switch(J){case"amount":d=s.amount,l=i.amount;break;case"item":d=s.item.toLowerCase(),l=i.item.toLowerCase();break;case"created_at":d=s.created_at?new Date(s.created_at):new Date(0),l=i.created_at?new Date(i.created_at):new Date(0);break;default:d=new Date(s.date),l=new Date(i.date)}return F==="asc"?d>l?1:-1:d<l?1:-1}),t=t.filter(s=>new Date(s.date).getFullYear()===W),t},[y,v,k,o,x,J,F,m,W]),C=Math.ceil(p.length/V),g=n.useMemo(()=>{const t=(u-1)*V,s=t+V;return p.slice(t,s)},[p,u]),N=n.useMemo(()=>{const t=r=>{if(typeof r=="number")return r;if(typeof r=="string"){const a=parseFloat(r.replace(/,/g,""));return isNaN(a)?0:a}return 0},s=p.filter(r=>{if(r.type==="income")return!0;if(r.type==="expense")return!1;const a=t(r.amount);return!isNaN(a)&&isFinite(a)&&a>0}),i=p.filter(r=>{if(r.type==="expense")return!0;if(r.type==="income")return!1;const a=t(r.amount);return!isNaN(a)&&isFinite(a)&&a<0}),d=s.reduce((r,a)=>{var L,T,$;let f=t(a.amount);if((L=a.tags)!=null&&L.includes("depreciation_asset")){const P=(T=a.description)==null?void 0:T.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(P)f=parseInt(P[1].replace(/,/g,""),10);else{const _=($=a.description)==null?void 0:$.match(/年間償却費: ¥([\d,]+)/);_&&(f=parseInt(_[1].replace(/,/g,""),10))}}return r+Math.abs(f)},0),l=i.reduce((r,a)=>{var L,T,$;let f=t(a.amount);if((L=a.tags)!=null&&L.includes("depreciation_asset")){const P=(T=a.description)==null?void 0:T.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(P)f=parseInt(P[1].replace(/,/g,""),10);else{const _=($=a.description)==null?void 0:$.match(/年間償却費: ¥([\d,]+)/);_&&(f=parseInt(_[1].replace(/,/g,""),10))}}return r+Math.abs(f)},0);return{total:p.length,income:d,expense:l,balance:d-l,pendingCount:y.filter(r=>r.approval_status==="pending").length,depreciationCount:p.filter(r=>{var a;return(a=r.tags)==null?void 0:a.includes("depreciation_asset")}).length,allCount:p.length}},[p,y]),de=()=>{h.length===g.length?M([]):M(g.map(t=>t.id))},K=t=>{h.includes(t)?M(h.filter(s=>s!==t)):M([...h,t])},ce=async()=>{if(window.confirm(`${h.length} 件の取引を削除してもよろしいですか？`))try{for(const t of h)await R(t);M([])}catch(t){console.error("一括削除に失敗:",t)}},oe=async t=>{if(D)try{const s=await se(D.id,t);if(s.error)throw s.error;await new Promise(i=>setTimeout(i,100)),await b(),window.dispatchEvent(new CustomEvent("transactionRecorded")),S(null),j(!1)}catch(s){console.error("取引の更新に失敗:",s),alert(`取引の更新に失敗しました: ${s.message||"不明なエラーが発生しました"} `)}},xe=()=>{X(""),q({start:"",end:""}),Y({min:"",max:""}),z("")},O=n.useMemo(()=>{let t=0;return k&&t++,(o.start||o.end)&&t++,(x.min||x.max)&&t++,t},[k,o,x]);return te?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-text-muted",children:"データを読み込んでいます..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{to:"/dashboard",className:"mr-3 p-1.5 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(Le,{className:"w-5 h-5 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-text-main",children:"取引履歴"}),e.jsx("p",{className:"hidden sm:block text-xs text-text-muted mt-0.5",children:"すべての取引履歴を確認・管理できます"})]})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn-primary flex items-center px-3 py-1.5 text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(je,{className:"w-4 h-4 mr-1.5"}),"新規取引"]})]}),e.jsx("div",{className:"bg-surface rounded-xl shadow-sm p-2 border border-border hover:shadow-md transition-shadow mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"border border-border rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] font-medium text-text-muted",children:"総取引数"}),e.jsx("div",{className:"rounded-lg bg-primary/5 p-1",children:e.jsx(H,{className:"w-3.5 h-3.5 text-primary"})})]}),e.jsx("div",{className:"text-base sm:text-lg font-bold text-primary mt-0.5",children:N.total})]}),e.jsxs("div",{className:"border border-border rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] font-medium text-text-muted",children:"収入"}),e.jsx("div",{className:"rounded-lg bg-green-500/5 p-1",children:e.jsx(we,{className:"w-3.5 h-3.5 text-green-500"})})]}),e.jsxs("div",{className:"text-base sm:text-lg font-bold text-green-500 mt-0.5",children:[N.income.toLocaleString(),"円"]})]}),e.jsxs("div",{className:"border border-border rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] font-medium text-text-muted",children:"支出"}),e.jsx("div",{className:"rounded-lg bg-red-500/5 p-1",children:e.jsx(Ne,{className:"w-3.5 h-3.5 text-red-500"})})]}),e.jsxs("div",{className:"text-base sm:text-lg font-bold text-red-500 mt-0.5",children:[N.expense.toLocaleString(),"円"]})]}),e.jsxs("div",{className:"border border-border rounded-lg p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] font-medium text-text-muted",children:"収支"}),e.jsx("div",{className:`rounded-lg p-1 ${N.balance>=0?"bg-green-500/5":"bg-red-500/5"}`,children:e.jsx(Te,{className:`w-3.5 h-3.5 ${N.balance>=0?"text-green-500":"text-red-500"}`})})]}),e.jsxs("div",{className:`text-base sm:text-lg font-bold mt-0.5 ${N.balance>=0?"text-green-500":"text-red-500"}`,children:[N.balance.toLocaleString(),"円"]})]})]})}),e.jsx("div",{className:"bg-surface rounded-xl shadow-sm border border-border mb-4 overflow-hidden",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("select",{value:J,onChange:t=>ie(t.target.value),className:"px-2 py-1.5 border border-border rounded-lg bg-background text-[11px] text-text-main focus:ring-1 focus:ring-primary outline-none",children:[e.jsx("option",{value:"date",children:"日付"}),e.jsx("option",{value:"amount",children:"金額"}),e.jsx("option",{value:"item",children:"項目"}),e.jsx("option",{value:"created_at",children:"追加日"})]})}),e.jsx("button",{onClick:()=>ne(F==="asc"?"desc":"asc"),className:"p-1.5 text-[10px] bg-surface-highlight text-text-muted rounded hover:bg-border transition-colors border border-transparent hover:border-border",children:F==="asc"?"昇順":"降順"}),e.jsx("div",{className:"h-6 w-px bg-border mx-0.5"}),e.jsxs("button",{onClick:()=>ae(!I),className:`px-2.5 py-1.5 text-xs rounded-lg transition-colors flex items-center space-x-1.5 border ${I?"bg-primary/10 text-primary border-primary/20":"bg-surface-highlight text-text-muted border-transparent hover:bg-border"}`,children:[e.jsx($e,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"フィルター"}),O>0&&e.jsx("span",{className:"bg-primary text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center",children:O})]}),O>0&&e.jsx("button",{onClick:xe,className:"px-2 py-1.5 text-xs bg-surface-highlight text-text-muted rounded-lg hover:bg-border transition-colors flex items-center",title:"フィルターをクリア",children:e.jsx(Q,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"relative flex-1 min-w-[140px] sm:max-w-xs ml-auto",children:[e.jsx(ye,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 text-text-muted w-3.5 h-3.5"}),e.jsx("input",{type:"text",value:v,onChange:t=>z(t.target.value),placeholder:"検索...",className:"w-full pl-8 pr-3 py-1.5 border border-border rounded-lg focus:ring-1 focus:ring-primary focus:border-primary bg-background focus:bg-surface transition-colors text-xs text-text-main placeholder-text-muted"})]})]}),h.length>0&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-border flex items-center justify-between",children:[e.jsxs("span",{className:"text-[10px] text-text-muted",children:[h.length,"件選択中"]}),e.jsxs("button",{onClick:ce,className:"px-2 py-1 text-[10px] bg-red-500/10 text-red-600 rounded hover:bg-red-500 hover:text-white transition-colors flex items-center",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"削除"]})]}),I&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"カテゴリ"}),e.jsxs("select",{value:k,onChange:t=>X(t.target.value),className:"w-full px-2 py-1 border border-border rounded bg-background text-[11px] text-text-main",children:[e.jsx("option",{value:"",children:"すべて"}),le.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"開始日"}),e.jsx("input",{type:"date",value:o.start,onChange:t=>q({...o,start:t.target.value}),className:"w-full px-2 py-1 border border-border rounded bg-background text-[11px] text-text-main"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"終了日"}),e.jsx("input",{type:"date",value:o.end,onChange:t=>q({...o,end:t.target.value}),className:"w-full px-2 py-1 border border-border rounded bg-background text-[11px] text-text-main"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"最小金額"}),e.jsx("input",{type:"number",value:x.min,onChange:t=>Y({...x,min:t.target.value}),className:"w-full px-2 py-1 border border-border rounded bg-background text-[11px] text-text-main"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"最大金額"}),e.jsx("input",{type:"number",value:x.max,onChange:t=>Y({...x,max:t.target.value}),className:"w-full px-2 py-1 border border-border rounded bg-background text-[11px] text-text-main"})]})]})})]})}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border overflow-hidden",children:[e.jsxs("div",{className:"block md:hidden divide-y divide-border",children:[e.jsx("div",{className:"p-3 border-b border-border bg-surface-highlight/30",children:e.jsxs("div",{className:"flex bg-surface-highlight p-1 rounded-xl border border-border w-full",children:[e.jsxs("button",{onClick:()=>{A("all"),w(1)},className:`flex-1 flex items-center justify-center gap-2 py-1.5 text-xs font-bold rounded-lg transition-all ${m==="all"?"bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[e.jsx(Ae,{className:"w-3.5 h-3.5"}),"全ての取引"]}),e.jsxs("button",{onClick:()=>{A("depreciation"),w(1)},className:`flex-1 flex items-center justify-center gap-2 py-1.5 text-xs font-bold rounded-lg transition-all ${m==="depreciation"?"bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),"減価償却資産"]})]})}),g.length>0?g.map(t=>e.jsxs("div",{className:"p-4 hover:bg-surface-highlight/50 transition-colors",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:h.includes(t.id),onChange:s=>{s.stopPropagation(),K(t.id)},onClick:s=>s.stopPropagation(),className:"rounded border-border text-primary focus:ring-primary h-4 w-4 bg-background mr-3"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-400 font-medium uppercase tracking-wider",children:[e.jsx(ve,{className:"w-2.5 h-2.5 opacity-40"}),e.jsx("span",{children:new Date(t.date).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"})})]})]})}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsx(B,{item:t.item,category:t.category,size:"sm"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 min-w-0 ml-2",children:[e.jsx("div",{className:"font-medium text-text-main truncate text-sm",children:t.item}),t.recurring&&e.jsxs("div",{className:"flex items-center gap-1 px-1 py-0.5 rounded bg-primary/10 text-primary text-[10px] font-bold border border-primary/20 shrink-0",children:[e.jsx(ee,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:{daily:"毎日",weekly:"毎週",monthly:"毎月",yearly:"毎年"}[t.recurring_frequency||"monthly"]})]})]})]}),e.jsx("div",{className:"text-right ml-3 shrink-0",children:e.jsxs("div",{className:`font-bold text-sm ${t.type==="income"?"text-green-500":"text-text-main"}`,children:[t.type==="expense"?"-":t.type==="income"?"+":"",t.amount.toLocaleString(),"円"]})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-8 shrink-0"})," ",e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium bg-surface-highlight text-text-secondary border border-border truncate",children:t.category})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),S(t),j(!0)},className:"w-11 h-11 rounded-full flex items-center justify-center bg-primary/10 text-primary hover:bg-primary hover:text-white transition-all shadow-md active:scale-95",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),R(t.id)},className:"w-11 h-11 rounded-full flex items-center justify-center bg-rose-500/10 text-rose-500 hover:bg-rose-500 hover:text-white transition-all shadow-md active:scale-95",children:e.jsx(U,{className:"w-5 h-5"})})]})]})]},t.id)):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-text-muted mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-text-main mb-1",children:"取引が見つかりません"}),e.jsx("p",{className:"text-text-muted",children:"条件に一致する取引がありません"})]})]}),e.jsxs("div",{className:"hidden md:block overflow-x-auto",children:[e.jsxs("div",{className:"flex bg-white dark:bg-[#2a3245] p-1 rounded-full border border-slate-200 dark:border-slate-800 w-fit shadow-md mt-4 mb-4 ml-4",children:[e.jsxs("button",{onClick:()=>{A("all"),w(1)},className:`flex items-center gap-2.5 px-6 py-2 text-xs font-medium rounded-full transition-all duration-300 ${m==="all"?"bg-slate-100 dark:bg-[#1e293b] text-primary dark:text-indigo-400 shadow-sm":"text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx(_e,{className:`w-4 h-4 ${m==="all"?"text-primary dark:text-indigo-400":"text-slate-400"}`}),e.jsx("span",{children:"全ての取引"})]}),e.jsxs("button",{onClick:()=>{A("depreciation"),w(1)},className:`flex items-center gap-2.5 px-6 py-2 text-xs font-medium rounded-full transition-all duration-300 ${m==="depreciation"?"bg-slate-100 dark:bg-[#1e293b] text-primary dark:text-indigo-400 shadow-sm":"text-slate-500 dark:text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 hover:bg-slate-50 dark:hover:bg-white/5"}`,children:[e.jsx(De,{className:`w-4 h-4 ${m==="depreciation"?"text-primary dark:text-indigo-400":"text-slate-500"}`}),e.jsx("span",{className:m==="depreciation"?"":"opacity-75",children:"減価償却資産"})]})]}),e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-[#2a3245]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left w-12",children:e.jsx("input",{type:"checkbox",checked:h.length===g.length&&g.length>0,onChange:de,className:"rounded border-border text-primary focus:ring-primary h-4 w-4 bg-background"})}),e.jsx("th",{className:"px-4 py-3 text-left text-[10px] font-medium text-text-muted uppercase tracking-wider",children:"項目"}),e.jsx("th",{className:"px-4 py-3 text-right text-[10px] font-medium text-text-muted uppercase tracking-wider",children:"金額"}),m==="depreciation"&&e.jsx("th",{className:"px-4 py-3 text-right text-[10px] font-medium text-text-muted uppercase tracking-wider",children:"取得価額"}),e.jsx("th",{className:"px-4 py-3 text-center text-[10px] font-medium text-text-muted uppercase tracking-wider hidden sm:table-cell",children:"日付"}),e.jsx("th",{className:"px-4 py-3 text-center text-[10px] font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-4 py-3 text-center text-[10px] font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-border",children:g.length>0?g.map(t=>e.jsxs("tr",{className:"hover:bg-surface-highlight transition-colors",children:[e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:h.includes(t.id),onChange:()=>K(t.id),className:"rounded border-border text-primary focus:ring-primary h-4 w-4 bg-background"})}),e.jsx("td",{className:"px-4 py-3 text-left",children:e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(B,{item:t.item,category:t.category,size:"xs"}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-main truncate max-w-[200px]",title:t.item,children:t.item}),t.recurring&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded bg-primary/10 text-primary text-[10px] font-bold border border-primary/20 shrink-0",children:[e.jsx(ee,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:{daily:"毎日",weekly:"毎週",monthly:"毎月",yearly:"毎年"}[t.recurring_frequency||"monthly"]})]})]}),e.jsx("span",{className:"text-[10px] text-text-muted truncate max-w-[200px] font-medium",children:t.category})]})]})}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-right text-sm font-bold text-text-main",children:(()=>{var s,i,d;if((s=t.tags)!=null&&s.includes("depreciation_asset")){const l=(i=t.description)==null?void 0:i.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(l)return`¥${l[1]}`;const r=(d=t.description)==null?void 0:d.match(/年間償却費: ¥([\d,]+)/);return r?`¥${r[1]}`:`¥${t.amount.toLocaleString()}`}return`${t.type==="income"?"+":"-"}¥${t.amount.toLocaleString()}`})()}),m==="depreciation"&&e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-right text-sm font-medium text-text-muted",children:(()=>{var s,i,d,l;if((s=t.tags)!=null&&s.includes("depreciation_asset")){const r=(i=t.description)==null?void 0:i.match(/取得価額:¥([\d,]+)/);return r?`¥${r[1]}`:((d=t.description)==null?void 0:d.match(/年間償却費: ¥([\d,]+)/))?`¥${t.amount.toLocaleString()}`:((l=t.description)==null?void 0:l.match(/今期\(\d+年\)償却額:¥([\d,]+)/))?"(不明)":`¥${t.amount.toLocaleString()}`}return`¥${t.amount.toLocaleString()}`})()}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-center text-[11px] text-text-muted hidden sm:table-cell",children:new Date(t.date).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-center",children:e.jsx("span",{className:"whitespace-nowrap px-2 py-0.5 inline-flex text-[10px] leading-4 font-medium rounded-full bg-slate-500/10 text-text-secondary",children:t.category})}),e.jsx("td",{className:"px-4 py-2.5 whitespace-nowrap text-sm font-medium text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>{S(t),j(!0)},className:"px-3 py-2 bg-primary/10 text-primary rounded-lg hover:bg-primary hover:text-white transition-all shadow-sm flex items-center gap-1 text-sm whitespace-nowrap",children:[e.jsx(Z,{className:"w-4 h-4"}),"編集"]}),e.jsxs("button",{onClick:()=>R(t.id),className:"px-3 py-2 bg-rose-500/10 text-rose-500 rounded-lg hover:bg-rose-500 hover:text-white transition-all shadow-sm flex items-center gap-1 text-sm whitespace-nowrap",children:[e.jsx(U,{className:"w-4 h-4"}),"削除"]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:m==="depreciation"?7:6,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(H,{className:"w-12 h-12 text-text-muted mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-text-main mb-1",children:"取引が見つかりません"}),e.jsx("p",{className:"text-text-muted",children:"条件に一致する取引がありません"})]})})})})]})]}),g.length>0&&e.jsxs("div",{className:"flex items-center justify-center mt-6 space-x-2 pb-8",children:[e.jsx("button",{onClick:()=>w(Math.max(1,u-1)),disabled:u===1,className:`p-2 rounded-lg transition-colors ${u===1?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-text-secondary hover:bg-surface-highlight"}`,children:e.jsx(ke,{className:"w-4 h-4"})}),(()=>{let t=Math.max(1,u-2),s=Math.min(C,t+4);s-t<4&&(t=Math.max(1,s-4));const i=Array.from({length:s-t+1}).map((d,l)=>{const r=t+l;return r<=0||r>C?null:e.jsx("button",{onClick:()=>w(r),className:`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-medium transition-all ${u===r?"bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary/90":"bg-surface text-text-muted hover:bg-surface-highlight hover:text-text-main border border-border"}`,children:r},r)});return s<C&&i.push(e.jsx("span",{className:"w-8 h-8 flex items-center justify-center text-text-muted",children:"..."},"ellipsis")),i})(),e.jsx("button",{onClick:()=>w(Math.min(C,u+1)),disabled:u===C,className:`p-2 rounded-lg transition-colors ${u===C?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-text-secondary hover:bg-surface-highlight"}`,children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]}),re&&e.jsx("div",{className:"z-50",children:D?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-surface rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-xl border border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"取引を編集"}),e.jsx("button",{onClick:()=>{j(!1),S(null)},className:"p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(Q,{className:"w-5 h-5 text-text-muted"})})]}),e.jsx(Se,{transaction:D,onSubmit:oe,onCancel:()=>{j(!1),S(null)}})]})})}):e.jsx(Me,{onClose:()=>j(!1),onSuccess:()=>b()})})]})};export{Ke as default};
