const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RevenueChart-BqHAjN27.js","assets/index-DC9j6qQS.js","assets/index-DPU4ag1e.css","assets/index-gZjsp2Cm.js","assets/ExpenseChart-BanrHvlV.js","assets/TransactionTable-CnUT9MyP.js","assets/TransactionForm-k3xI6Ohe.js","assets/clock-CFnOWHxx.js","assets/calendar-CfZosn71.js","assets/star-Bfps7j_J.js","assets/zap-CpYx7emd.js"])))=>i.map(i=>d[i]);
import{c as v,j as e,F as S,S as N,L as T,e as L,a as I,f as F,r as c,P as O,g as p,X as R,_ as f}from"./index-DC9j6qQS.js";import{C as V}from"./calculator-D2Z7G-c6.js";import{C as P}from"./camera-BkgFAINq.js";import{A as M}from"./AIStatusComponents-C3IVy00L.js";import{D as z}from"./download-62ciAMmU.js";import"./brain-_jgWI6uD.js";import"./circle-alert-BG9Y9ZOA.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],J=v("chart-no-axes-column",D);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],q=v("link",U),K=()=>{const o=[{title:"CHAT-TO-BOOK",description:"音声で取引を記録",icon:V,link:"/chat-to-book",color:"bg-purple-500/20",iconColor:"text-purple-500",borderColor:"border-purple-500/30"},{title:"レシート処理",description:"レシートをスキャン",icon:P,link:"/receipt-processing",color:"bg-emerald-500/20",iconColor:"text-emerald-500",borderColor:"border-emerald-500/30"},{title:"請求書作成",description:"新しい請求書を作成",icon:S,link:"/invoice-creation",color:"bg-blue-500/20",iconColor:"text-blue-500",borderColor:"border-blue-500/30"},{title:"取引履歴",description:"すべての取引を確認",icon:J,link:"/transaction-history",color:"bg-amber-500/20",iconColor:"text-amber-500",borderColor:"border-amber-500/30"},{title:"補助金マッチング",description:"AI補助金提案",icon:q,link:"/subsidy-matching",color:"bg-rose-500/20",iconColor:"text-rose-500",borderColor:"border-rose-500/30"},{title:"確定申告サポート",description:"AIで確定申告をサポート",icon:N,link:"/tax-filing-wizard",color:"bg-indigo-500/20",iconColor:"text-indigo-500",borderColor:"border-indigo-500/30"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:o.map((m,h)=>e.jsx(T,{to:m.link,className:"bg-white dark:bg-surface rounded-xl p-4 hover:bg-surface-highlight transition-all duration-300 group border border-border hover:border-border-strong hover:-translate-y-1 shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`w-12 h-12 ${m.color} rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300 border ${m.borderColor}`,children:e.jsx(m.icon,{className:`w-6 h-6 ${m.iconColor}`})}),e.jsx("h3",{className:"font-medium text-text-main mb-1 text-sm",children:m.title}),e.jsx("p",{className:"text-xs text-text-muted leading-relaxed",children:m.description})]})},h))})},G=p.lazy(()=>f(()=>import("./RevenueChart-BqHAjN27.js"),__vite__mapDeps([0,1,2,3]))),H=p.lazy(()=>f(()=>import("./ExpenseChart-BanrHvlV.js"),__vite__mapDeps([4,1,2,3]))),Q=p.lazy(()=>f(()=>import("./TransactionTable-CnUT9MyP.js"),__vite__mapDeps([5,1,2]))),X=p.lazy(()=>f(()=>import("./TransactionForm-k3xI6Ohe.js"),__vite__mapDeps([6,1,2,7,8,9,10]))),re=()=>{const{currentBusinessType:o}=L(),{isAuthenticated:m,user:h,loading:y}=I(),{transactions:i,loading:w,createTransaction:k,fetchTransactions:g}=F(h==null?void 0:h.id,o==null?void 0:o.business_type),[C,b]=c.useState(!1);console.log("ダッシュボード - currentBusinessType:",o),console.log("ダッシュボード - transactions:",i),console.log("ダッシュボード - loading:",w),console.log("ダッシュボード - authUser:",h),c.useEffect(()=>{const t=()=>b(!0);return window.addEventListener("openCreateTransactionModal",t),()=>{window.removeEventListener("openCreateTransactionModal",t)}},[]),c.useEffect(()=>{o!=null&&o.id&&(console.log("ダッシュボード - データ再取得を実行"),g())},[o,g]),c.useEffect(()=>{console.log("ダッシュボード - transactions状態が更新されました:",i)},[i]),c.useEffect(()=>{const t=async()=>{console.log("ダッシュボード - transactionRecordedイベントを受信"),o!=null&&o.id&&(await new Promise(n=>setTimeout(n,100)),g())};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[o,g]),c.useEffect(()=>{const t=async()=>{console.log("ダッシュボード - transactionApprovedイベントを受信"),o!=null&&o.id&&(await new Promise(n=>setTimeout(n,100)),g())};return window.addEventListener("transactionApproved",t),()=>{window.removeEventListener("transactionApproved",t)}},[o,g]),c.useMemo(()=>{console.log("ダッシュボード - 取引データ:",i),i.forEach((s,r)=>{console.log(`ダッシュボード - 取引 ${r+1}:`,{id:s.id,item:s.item,amount:s.amount,amountType:typeof s.amount,amountStructure:typeof s.amount=="object"?Object.keys(s.amount):"N/A",date:s.date,category:s.category,type:s.type})});const t=s=>{if(typeof s=="number")return s;if(typeof s=="string"){const r=parseFloat(s);return isNaN(r)?0:r}if(typeof s=="object"&&s!==null){const r=s.value||s.amount||s.number||0;if(typeof r=="number")return r;if(typeof r=="string"){const l=parseFloat(r);return isNaN(l)?0:l}return 0}return 0},n=i.filter(s=>{if(s.type==="income")return!0;if(s.type==="expense")return!1;const r=t(s.amount),l=!isNaN(r)&&isFinite(r)&&r>0;return console.log(`ダッシュボード - 取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${r}, 収入判定=${l}`),l}),x=i.filter(s=>{if(s.type==="expense")return!0;if(s.type==="income")return!1;const r=t(s.amount),l=!isNaN(r)&&isFinite(r)&&r<0;return console.log(`ダッシュボード - 取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${r}, 支出判定=${l}`),l}),a=n.reduce((s,r)=>{const l=t(r.amount),u=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`ダッシュボード - 収入計算: ${s} + ${u} = ${s+u}`),s+u},0),d=x.reduce((s,r)=>{const l=t(r.amount),u=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`ダッシュボード - 支出計算: ${s} + ${u} = ${s+u}`),s+u},0),j={total:i.length,income:a,expense:d,balance:a-d};return console.log("ダッシュボード - 統計情報計算結果:",j),console.log("ダッシュボード - 収入取引:",n),console.log("ダッシュボード - 支出取引:",x),j},[i]);const _=()=>e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"p-4 bg-red-500 text-white text-center mb-4",children:[e.jsx("p",{children:"ダッシュボードのローディング中..."}),e.jsxs("p",{children:["authLoading: ",y?"true":"false"]}),e.jsxs("p",{children:["isAuthenticated: ",m?"true":"false"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-24 w-full bg-gray-200 dark:bg-gray-700 rounded-xl mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"})]})]});if(y)return console.log("ダッシュボードをスケルトンローディングで表示中 - authLoading:",y),e.jsx(_,{});const E=t=>{const n=["日付","説明","金額","カテゴリ","タイプ","ステータス"],x=t.map(d=>[d.date,`"${d.description}"`,d.amount.toString(),`"${d.category}"`,d.type,d.status]);return[n.join(","),...x.map(d=>d.join(","))].join(`
`)},$=()=>{const t=E(i),n=new Blob(["\uFEFF",t],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(n),a=document.createElement("a");a.setAttribute("href",x),a.setAttribute("download",`取引データ_${new Date().toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},A=async t=>{try{console.log("取引作成を開始:",t);const n=localStorage.getItem("user");if(n)try{const a=JSON.parse(n);t.creator=a.id}catch(a){console.error("ユーザー情報の解析に失敗しました:",a)}if(console.log("creator IDを設定:",t.creator),!t.type){const a=typeof t.amount=="string"?parseFloat(t.amount):t.amount;t.type=a>0?"income":"expense",console.log("typeプロパティを自動設定:",t.type)}const x=await k(t);console.log("取引作成成功:",x),await g(),window.dispatchEvent(new CustomEvent("transactionRecorded")),b(!1)}catch(n){console.error("取引の作成に失敗:",n),alert(`取引の作成に失敗しました: ${n.message||"もう一度お試しください。"}`)}};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main tracking-tight",children:"ダッシュボード"}),e.jsx("p",{className:"text-text-muted mt-1",children:"財務状況の概要と最近の活動"})]})}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:$,disabled:i.length===0,className:`btn-ghost flex-1 sm:flex-none flex items-center justify-center ${i.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"CSV出力"]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex-1 sm:flex-none flex items-center justify-center",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"新規取引"]})]})]}),e.jsx(K,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(G,{transactions:i})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(H,{transactions:i})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(Q,{transactions:i,onOpenCreateModal:()=>b(!0),showCreateButton:!1})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-6 border border-border shadow-sm transition-all duration-200 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-text-main",children:"AI分析"})]}),e.jsx(M,{})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-xl",children:e.jsx("p",{className:"text-sm text-text-muted",children:"AIを有効にするとレシートの自動分類精度が向上します。"})}),e.jsx("div",{className:"text-xs text-text-muted",children:".envファイルにGemini API Keyを設定してください"})]})]})})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-surface border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"新規取引作成"}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(R,{className:"w-5 h-5 text-text-muted"})})]}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(X,{onSubmit:A,onCancel:()=>b(!1)})})]})})})]})};export{re as default};
