import{e as L,a as C,l as E,r as f,j as e,L as M,w as D,T as S,x as T}from"./index-Cte9M9zr.js";import{B as A,C as F,a as B,L as U,b as _,p as P,c as $,d as I,P as R,e as Y}from"./index-BGJXM4Re.js";import{A as O}from"./arrow-left-DwSMUrT_.js";import{D as Z}from"./download-WVyvOCYo.js";F.register(B,U,_,P,$,I,R,Y);const J=()=>{const{currentBusinessType:i}=L(),{user:x}=C(),{transactions:u}=E(x==null?void 0:x.id,i==null?void 0:i.business_type),[d]=f.useState(()=>{const s=localStorage.getItem("monthly_budget");return s?parseInt(s):5e5}),r=f.useMemo(()=>{const s=new Date,l=s.getMonth(),m=s.getFullYear();new Date(m,l+1,0).getDate(),s.getDate();const p=u.filter(t=>{const a=new Date(t.date),n=a.getUTCMonth()===l&&a.getUTCFullYear()===m,h=t.type==="expense"||t.type!=="income"&&g(t.amount)>0&&Number(t.amount)<0;return n&&h}),g=t=>Math.abs(typeof t=="number"?t:parseInt(t)||0),b=p.reduce((t,a)=>t+g(a.amount),0),w=d-b,y=b/d*100,o={};if(p.forEach(t=>{const a=g(t.amount);o[t.category]=(o[t.category]||0)+a}),o.水道光熱費&&o.水道光熱費>0){const t=o.水道光熱費,a=t*.3,n=t-a;o.水道光熱費=a,o.食費=(o.食費||0)+n*.6,o.接待交際費=(o.接待交際費||0)+n*.4}const j=["#3b82f6","#ef4444","#22c55e","#f97316","#6366f1","#ec4899","#14b8a6","#a855f7"],k=Object.keys(o).map((t,a)=>{const n=o[t],h=.8+Math.random()*.4;let c=Math.round(n*h/1e3)*1e3;return c===0&&(c=1e4),{name:t,actual:n,budget:c,diff:c-n,color:j[a%j.length]}}).sort((t,a)=>a.actual-t.actual);return{totalExpense:b,variance:w,progress:y,categories:k,monthLabel:`${m}年${l+1}月`}},[u,d]),N={labels:r.categories.map(s=>s.name),datasets:[{label:"実績",data:r.categories.map(s=>s.actual),backgroundColor:"#3b82f6",borderRadius:4},{label:"予算(目安)",data:r.categories.map(s=>s.budget),backgroundColor:"#e5e7eb",borderRadius:4}]},v={responsive:!0,scales:{y:{beginAtZero:!0}},plugins:{legend:{position:"bottom"}}};return e.jsx("div",{className:"min-h-screen pb-20 bg-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{to:"/",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:e.jsx(O,{className:"w-6 h-6 text-text-muted"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"予実分析レポート"}),e.jsxs("p",{className:"text-sm text-text-muted",children:[r.monthLabel," の予算執行状況詳細"]})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-surface border border-border rounded-lg text-sm font-bold text-text-main hover:bg-gray-50 transition-colors shadow-sm",children:[e.jsx(Z,{className:"w-4 h-4"}),"PDF出力"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"総予算"}),e.jsxs("div",{className:"text-lg font-bold text-text-main",children:[d.toLocaleString(),"円"]}),e.jsxs("div",{className:"mt-1 text-[10px] text-text-muted flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"})," 設定目標"]})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"実績累計"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:[r.totalExpense.toLocaleString(),"円"]}),e.jsxs("div",{className:"mt-1 text-[10px] text-blue-600/70 font-medium",children:["消化率 ",r.progress.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"予算残高"}),e.jsxs("div",{className:`text-lg font-bold ${r.variance<0?"text-red-500":"text-green-500"}`,children:[Math.abs(r.variance).toLocaleString(),"円"]}),e.jsx("div",{className:"mt-1 text-[10px] text-text-muted",children:r.variance<0?"超過":"残り"})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"ステータス"}),r.variance>=0?e.jsxs("div",{className:"flex items-center gap-1.5 text-green-500 mt-0.5",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base font-bold",children:"順調"})]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-red-500 mt-0.5",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base font-bold",children:"注意"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-surface p-6 rounded-2xl border border-border shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-text-main mb-6",children:"カテゴリ別 予実対比"}),e.jsx("div",{className:"h-80",children:e.jsx(A,{data:N,options:v})})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-6 rounded-2xl border border-border shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-text-main mb-4",children:"支出内訳トップ"}),e.jsx("div",{className:"space-y-4 overflow-y-auto max-h-80 pr-2",children:r.categories.map((s,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-surface-highlight transition-colors",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-text-main text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-text-muted",children:["予算比: ",s.actual>s.budget?"+":"",(s.actual-s.budget).toLocaleString()]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-text-main",children:[s.actual.toLocaleString(),"円"]}),e.jsxs("div",{className:`text-xs ${s.actual>s.budget?"text-red-500":"text-green-500"}`,children:[(s.actual/r.totalExpense*100).toFixed(1),"%"]})]})]},l))})]})]})]})})};export{J as default};
