import{c as se,r as p,a as me,l as pe,d as ue,u as he,j as e,L as ge,T as M}from"./index-ANsWalRW.js";import{A as fe}from"./arrow-left-CzwRZ0lz.js";import{S as be}from"./square-idD2fsbT.js";import{S as ye}from"./send-BV7PqHYZ.js";import{C as _}from"./circle-check-big-7dW2Outk.js";import{S as ee}from"./save-bpZG0GMV.js";import{P as te}from"./pen-line-BE5MJvM_.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],O=se("circle",ve);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],we=se("mic",je),De=()=>{const[E,D]=p.useState(!1),[k,$]=p.useState(""),[y,j]=p.useState([]),[c,U]=p.useState(null),[i,v]=p.useState({}),[L,q]=p.useState(!1),[m,S]=p.useState([]),[R,A]=p.useState(null),[H,I]=p.useState(null),T=p.useRef(null),{user:d}=me(),{currentBusinessType:h}=pe(d==null?void 0:d.id),{transactions:w,createTransaction:J,updateTransaction:re,deleteTransaction:K,approveTransaction:W,fetchTransactions:g}=ue(d==null?void 0:d.id,h==null?void 0:h.business_type),F=he();p.useEffect(()=>{if(!("webkitSpeechRecognition"in window)){console.log("Web Speech API is not supported in this browser."),I("音声認識がこのブラウザでサポートされていません。ChromeまたはEdgeをご使用ください。");return}const t=new window.webkitSpeechRecognition;return t.continuous=!0,t.interimResults=!0,t.lang="ja-JP",t.onresult=r=>{let s="";for(let o=r.resultIndex;o<r.results.length;o++){const n=r.results[o][0].transcript;r.results[o].isFinal&&(s+=n+" ")}s&&$(o=>o+s)},t.onerror=r=>{console.error("音声認識エラー:",r.error),D(!1),I(null);let s="音声認識中にエラーが発生しました。";switch(r.error){case"no-speech":s="音声が検出されませんでした。もう一度お試しください。";break;case"audio-capture":s="音声入力デバイスが見つかりません。";break;case"not-allowed":s="音声認識の使用が許可されていません。ブラウザの設定をご確認ください。";break;case"service-not-allowed":s="音声認識サービスの使用が許可されていません。";break;case"bad-grammar":s="音声認識中に文法エラーが発生しました。";break;case"language-not-supported":s="指定された言語はサポートされていません。";break}I(s)},t.onend=()=>{D(!1)},T.current=t,()=>{T.current&&T.current.stop()}},[]),p.useEffect(()=>{console.log("ChatToBook - DBから取引データを取得中",{dbTransactionsCount:w.length,dbTransactionIds:w.map(t=>t.id)}),j(t=>{const r=w.map(l=>l.id),s=t.filter(l=>!r.includes(l.id)),o=[...w.map(l=>({id:l.id,date:l.date,description:l.description||l.item||"",amount:l.amount,category:l.category,type:l.type,created_at:l.created_at,updated_at:l.updated_at,approval_status:l.approval_status})),...s],n=o.filter((l,f,b)=>f===b.findIndex(P=>P.id===l.id));return console.log("ChatToBook - 合成された取引データ:",{mergedCount:o.length,uniqueCount:n.length,dbTransactionIds:r,localTempDataCount:s.length}),n})},[w]),p.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionRecordedイベントを受信"),h!=null&&h.id&&(await new Promise(r=>setTimeout(r,100)),g())};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[h,g]),p.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionApprovedイベントを受信"),h!=null&&h.id&&(await new Promise(r=>setTimeout(r,100)),g())};return window.addEventListener("transactionApproved",t),()=>{window.removeEventListener("transactionApproved",t)}},[h,g]);const ae=()=>{T.current&&(I(null),T.current.start(),D(!0))},oe=()=>{T.current&&(T.current.stop(),D(!1))},ne=t=>{console.log("extractTransactionData - text:",t);const r=/(\d+(?:万)?(?:千)?(?:円)?)/g,s=t.match(r),o=[{keywords:["売上"],category:"業務委託収入",type:"income",priority:10},{keywords:["給与"],category:"給与",type:"income",priority:9},{keywords:["消耗品","文具","コピー","オフィス用品"],category:"消耗品費",type:"expense",priority:10},{keywords:["接待","会食","食事","ディナー","ランチ"],category:"接待交際費",type:"expense",priority:9},{keywords:["交通費","電車","バス","タクシー"],category:"旅費交通費",type:"expense",priority:7},{keywords:["食費","ランチ","ディナー","コーヒー"],category:"食費",type:"expense",priority:6},{keywords:["通信費","電話料金"],category:"通信費",type:"expense",priority:5},{keywords:["光熱費","電気","ガス","水道"],category:"水道光熱費",type:"expense",priority:5},{keywords:["修繕","修理"],category:"修繕費",type:"expense",priority:4},{keywords:["保険"],category:"保険料",type:"expense",priority:4},{keywords:["手数料"],category:"支払手数料",type:"expense",priority:4},{keywords:["新聞","図書"],category:"新聞図書費",type:"expense",priority:3},{keywords:["外注"],category:"外注費",type:"expense",priority:3},{keywords:["税金"],category:"租税公課",type:"expense",priority:3},{keywords:["広告","宣伝"],category:"広告宣伝費",type:"expense",priority:2},{keywords:["地代","家賃"],category:"地代家賃",type:"expense",priority:2},{keywords:["費用","費"],category:"雑費",type:"expense",priority:1}];let n="雑費",l="expense",f=0;for(const u of o)for(const N of u.keywords)t.includes(N)&&u.priority>f&&(n=u.category,l=u.type,f=u.priority);let b=0;if(s&&s.length>0){const u=s[0];if(u.includes("万")){const N=parseFloat(u.replace("万",""));b=isNaN(N)?0:N*1e4}else if(u.includes("千")){const N=parseFloat(u.replace("千",""));b=isNaN(N)?0:N*1e3}else b=parseFloat(u.replace(/[^\d]/g,""))||0}return{date:new Date().toISOString().split("T")[0],description:t,amount:b,category:n,type:l}},le=()=>{k.trim()&&(console.log("processTranscript - transcript:",k),q(!0),setTimeout(()=>{const t=ne(k),s={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){const n=Math.random()*16|0;return(o=="x"?n:n&3|8).toString(16)}),...t,category:R||t.category};j(o=>[s,...o]),$(""),A(null),q(!1)},1e3))},z=t=>{U(t.id),v(t)},G=async()=>{if(c&&i)try{const t=await re(c,{date:i.date||"",item:i.description!==void 0?i.description:"",amount:i.amount||0,category:i.category||"未分類",type:i.type||"expense"});if(t.error)throw t.error;j(r=>r.map(s=>s.id===c?{...s,...i}:s)),await g(),console.log("handleSave - dbTransactions:",w),j(r=>{const s=[...r],o=s.findIndex(n=>n.id===c);if(o!==-1){const n=w.find(l=>l.id===c);n&&(s[o]={...s[o],...n})}return s}),U(null),v({})}catch(t){console.error("取引の更新に失敗しました:",t),alert("取引の更新に失敗しました: "+t.message)}},Q=async t=>{try{const r=await K(t);if(r.error)throw r.error;j(s=>s.filter(o=>o.id!==t)),S(s=>s.filter(o=>o!==t))}catch(r){console.error("取引の削除に失敗しました:",r),alert("取引の削除に失敗しました: "+r.message)}},V=async t=>{try{if(console.log("recordTransaction - 開始:",t),!(d!=null&&d.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",d);return}console.log("認証されたユーザーID:",d.id),console.log("DBから最新の取引データを取得中..."),await g();const r=w;console.log("DBから取得した最新の取引データ:",r);const s=t.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t.id)&&r.some(o=>o.id===t.id);if(console.log("既存の取引かどうか:",{isExistingTransaction:s,transactionId:t.id,dbTransactionsCount:r.length,dbTransactionIds:r.map(o=>o.id)}),s){console.log("既存取引の承認処理を開始");const o=await W(t.id);if(console.log("承認処理結果:",o),o.error)throw o.error;j(n=>n.map(l=>l.id===t.id?{...l,approval_status:"approved"}:l)),console.log("transactionApprovedイベントを発火"),window.dispatchEvent(new CustomEvent("transactionApproved")),console.log("recordTransaction - 取引を承認しました"),alert("取引が正常に承認されました"),await g(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}else{console.log("新規取引作成処理を開始");const o=t.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim(),n=await J({item:o,amount:t.amount,date:t.date,category:t.category,type:t.type,creator:d.id,approval_status:"approved"});if(console.log("新規取引作成結果:",n),n.error)throw n.error;j(l=>l.filter(f=>f.id!==t.id)),console.log("recordTransaction - 新規取引を作成しました"),alert("取引が正常に作成されました"),await g(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}}catch(r){if(console.error("取引の記録に失敗しました:",r),r.message.includes("認証セッションが切れました")){alert("認証セッションが切れました。ログインページにリダイレクトします。"),F("/login");return}alert("取引の記録に失敗しました: "+r.message)}},ie=async()=>{if(!(d!=null&&d.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",d);return}console.log("認証されたユーザーID:",d.id),console.log("DBから最新の取引データを取得中..."),await g();const t=w;console.log("DBから取得した最新の取引データ:",t);const r=y.filter(s=>m.includes(s.id));if(console.log("bulkRecordTransactions - 選択された取引:",r),console.log("bulkRecordTransactions - 現在のDB取引データ:",t),r.length===0){alert("記録する取引を選択してください");return}try{const s=r.filter(a=>a.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)&&t.some(x=>x.id===a.id)),o=r.filter(a=>!a.id||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)||!t.some(x=>x.id===a.id));console.log("取引分類結果:",{existingCount:s.length,newCount:o.length,existingTransactions:s.map(a=>({id:a.id,item:a.description})),newTransactions:o.map(a=>({id:a.id,item:a.description})),dbTransactionsCount:t.length,dbTransactionIds:t.map(a=>a.id)});const n=s.map(a=>(console.log("承認処理を実行:",a.id),W(a.id))),l=o.map(a=>{console.log("新規作成処理を実行:",a.id);const x=a.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim();return J({item:x,amount:a.amount,date:a.date,category:a.category,type:a.type,creator:d.id,approval_status:"approved"})}),f=await Promise.allSettled(n),b=await Promise.allSettled(l);console.log("bulkRecordTransactions - 承認結果:",f),console.log("bulkRecordTransactions - 作成結果:",b);const P=f.filter(a=>a.status==="fulfilled").length,u=b.filter(a=>a.status==="fulfilled").length,N=f.filter(a=>a.status==="rejected").length,xe=b.filter(a=>a.status==="rejected").length,Y=P+u,Z=N+xe;f.forEach((a,x)=>{if(a.status==="rejected"&&(console.error(`取引承認失敗 (${x+1}):`,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),F("/login");return}}),b.forEach((a,x)=>{if(a.status==="rejected"&&(console.error(`新規取引作成失敗 (${x+1}):`,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),F("/login");return}}),Z>0?alert(`${Y}件の取引が正常に記録されましたが、${Z}件の取引の記録に失敗しました。詳細はコンソールを確認してください。`):alert(`${Y}件の取引が正常に記録されました`),j(a=>{const x=[...a];for(let C=0;C<x.length;C++)s.some(B=>B.id===x[C].id)&&(x[C]={...x[C],approval_status:"approved"});return x.filter(C=>!o.some(B=>B.id===C.id))}),S([]),await g(),console.log("bulkRecordTransactions - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded")),window.dispatchEvent(new CustomEvent("transactionApproved"))}catch(s){console.error("取引の一括記録中にエラーが発生しました:",s),alert("取引の一括記録に失敗しました: "+s.message)}},de=async()=>{if(m.length===0){alert("削除する取引を選択してください");return}if(window.confirm(`${m.length}件の取引を削除してもよろしいですか？`))try{const t=m.map(n=>K(n)),r=await Promise.allSettled(t),s=r.filter(n=>n.status==="fulfilled").length,o=r.filter(n=>n.status==="rejected").length;r.forEach((n,l)=>{n.status==="rejected"&&console.error(`取引削除失敗 (${l+1}):`,n.reason)}),o>0?alert(`${s}件の取引が正常に削除されましたが、${o}件の取引の削除に失敗しました。詳細はコンソールを確認してください。`):alert(`${s}件の取引が正常に削除されました`),j(n=>n.filter(l=>!m.includes(l.id))),S([]),await g()}catch(t){console.error("取引の一括削除中にエラーが発生しました:",t),alert("取引の一括削除に失敗しました: "+t.message)}},X=t=>{S(r=>r.includes(t)?r.filter(s=>s!==t):[...r,t])},ce=()=>{m.length===y.length&&y.length>0?S([]):S(y.map(t=>t.id))};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ge,{to:"/dashboard",className:"mr-4",children:e.jsx(fe,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"CHAT-TO-BOOK"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-surface rounded-xl shadow-sm border border-border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main mb-4",children:"音声入力"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("button",{onClick:E?oe:ae,className:`flex items-center justify-center w-16 h-16 rounded-full ${E?"bg-red-500 hover:bg-red-600 animate-pulse":"bg-primary hover:bg-primary/90"} text-white transition-colors shadow-lg shadow-primary/25`,children:E?e.jsx(be,{className:"w-8 h-8"}):e.jsx(we,{className:"w-8 h-8"})})}),H&&e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-red-500",children:H})}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-text-muted",children:E?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("span",{className:"flex h-3 w-3 mr-2",children:[e.jsx("span",{className:"animate-ping absolute h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative h-3 w-3 rounded-full bg-red-500"})]}),"音声認識中... 話してください"]}):"マイクボタンをクリックして開始"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"認識テキスト"}),e.jsx("textarea",{value:k,onChange:t=>$(t.target.value),rows:4,className:"w-full px-3 py-2 bg-background border border-border rounded-md text-text-main focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"音声認識されたテキストがここに表示されます..."}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[["売上","給与","交通費","食費","消耗品費","接待交際費","通信費","水道光熱費","雑費","未分類"].map(t=>e.jsx("button",{onClick:()=>A(R===t?null:t),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border transition-colors ${R===t?"bg-primary/20 border-primary text-primary":"bg-surface-highlight text-text-main border-border hover:bg-surface-hover"}`,children:t},t)),R&&e.jsx("button",{onClick:()=>A(null),className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-muted border border-border hover:bg-surface-hover transition-colors",children:"クリア"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>$(""),disabled:!k.trim(),className:`px-4 py-2 rounded-md transition-colors ${k.trim()?"bg-gray-500 text-white hover:bg-gray-600":"bg-surface-highlight text-text-muted cursor-not-allowed"}`,children:"クリア"}),e.jsx("button",{onClick:le,disabled:!k.trim()||L,className:`flex items-center px-4 py-2 rounded-md transition-colors ${!k.trim()||L?"bg-surface-highlight text-text-muted cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"処理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"取引に変換"]})})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-4",children:[e.jsx("h2",{className:"text-md font-semibold text-text-main mb-3",children:"使い方"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"音声入力開始"}),e.jsx("p",{className:"text-xs text-text-muted",children:"マイクボタンをクリックして、取引内容を話してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"テキスト確認"}),e.jsx("p",{className:"text-xs text-text-muted",children:"認識されたテキストを確認・編集してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"取引に変換"}),e.jsx("p",{className:"text-xs text-text-muted",children:"「取引に変換」ボタンをクリックして、取引を登録してください。"})]})]})})]})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main mb-4",children:"取引一覧"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("p",{className:"text-sm text-text-muted",children:[y.length,"件の取引"]}),m.length>0&&e.jsxs("span",{className:"text-sm text-primary",children:[m.length,"件選択中"]})]}),e.jsx("div",{className:"flex space-x-2",children:m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:de,className:"flex items-center px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition-colors",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"一括削除 (",m.length,")"]}),e.jsxs("button",{onClick:ie,className:"flex items-center px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 transition-colors",children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),"一括承認 (",m.length,")"]})]})})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"block md:hidden space-y-4",children:y.map(t=>e.jsxs("div",{className:"bg-surface p-4 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>X(t.id),className:"mr-3",disabled:t.approval_status==="approved",children:m.includes(t.id)?e.jsx(_,{className:"w-5 h-5 text-primary"}):e.jsx(O,{className:"w-5 h-5 text-text-muted"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-main",children:c===t.id?e.jsx("input",{type:"text",value:i.description!==void 0?i.description:t.description,onChange:r=>v(s=>({...s,description:r.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.description}),e.jsx("div",{className:"text-sm text-text-muted mt-1",children:c===t.id?e.jsx("input",{type:"date",value:i.date||t.date,onChange:r=>v(s=>({...s,date:r.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date})]})]}),e.jsx("div",{className:"text-right",children:c===t.id?e.jsx("input",{type:"number",value:i.amount||t.amount,onChange:r=>v(s=>({...s,amount:Number(r.target.value)})),className:"w-24 px-2 py-1 bg-background border border-border rounded text-sm text-text-main text-right"}):e.jsxs("span",{className:`font-medium ${t.type==="income"?"text-green-500":"text-red-500"}`,children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-3 pt-3 border-t border-border",children:[e.jsx("div",{className:"text-sm",children:c===t.id?e.jsxs("select",{value:i.category||t.category,onChange:r=>v(s=>({...s,category:r.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[e.jsx("option",{value:"売上",children:"売上"}),e.jsx("option",{value:"給与",children:"給与"}),e.jsx("option",{value:"交通費",children:"交通費"}),e.jsx("option",{value:"食費",children:"食費"}),e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"}),e.jsx("option",{value:"雑費",children:"雑費"}),e.jsx("option",{value:"未分類",children:"未分類"})]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-muted",children:t.category})}),e.jsx("div",{className:"flex space-x-2",children:c===t.id?e.jsx("button",{onClick:G,className:"p-2 text-green-500 hover:text-green-600 bg-surface-highlight rounded-full",children:e.jsx(ee,{className:"w-4 h-4"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t),className:`p-2 rounded-full bg-surface-highlight ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-green-500 hover:text-green-600"}`,disabled:t.approval_status==="approved",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t),className:`p-2 rounded-full bg-surface-highlight ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-primary hover:text-primary/80"}`,disabled:t.approval_status==="approved",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(t.id),className:`p-2 rounded-full bg-surface-highlight ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-red-500 hover:text-red-600"}`,disabled:t.approval_status==="approved",children:e.jsx(M,{className:"w-4 h-4"})})]})})]})]},t.id))}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-highlight",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:e.jsx("button",{onClick:ce,className:"flex items-center",children:m.length===y.length&&y.length>0?e.jsx(_,{className:"w-4 h-4 text-primary"}):e.jsx(O,{className:"w-4 h-4 text-text-muted"})})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-border",children:y.map(t=>e.jsxs("tr",{className:"hover:bg-surface-highlight transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>X(t.id),className:"flex items-center",disabled:t.approval_status==="approved",children:m.includes(t.id)?e.jsx(_,{className:"w-5 h-5 text-primary"}):e.jsx(O,{className:"w-5 h-5 text-text-muted"})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:c===t.id?e.jsx("input",{type:"date",value:i.date||t.date,onChange:r=>v(s=>({...s,date:r.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main max-w-xs",children:c===t.id?e.jsx("input",{type:"text",value:i.description!==void 0?i.description:t.description,onChange:r=>v(s=>({...s,description:r.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.description}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:c===t.id?e.jsx("input",{type:"number",value:i.amount||t.amount,onChange:r=>v(s=>({...s,amount:Number(r.target.value)})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):e.jsxs("span",{className:t.type==="income"?"text-green-500":"text-red-500",children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:c===t.id?e.jsxs("select",{value:i.category||t.category,onChange:r=>v(s=>({...s,category:r.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[e.jsx("option",{value:"売上",children:"売上"}),e.jsx("option",{value:"給与",children:"給与"}),e.jsx("option",{value:"交通費",children:"交通費"}),e.jsx("option",{value:"食費",children:"食費"}),e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"}),e.jsx("option",{value:"雑費",children:"雑費"}),e.jsx("option",{value:"未分類",children:"未分類"})]}):t.category}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:c===t.id?e.jsx("button",{onClick:G,className:"text-green-500 hover:text-green-600 mr-2",children:e.jsx(ee,{className:"w-4 h-4"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t),className:`mr-2 ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-green-500 hover:text-green-600"}`,disabled:t.approval_status==="approved",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t),className:`mr-2 ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-primary hover:text-primary/80"}`,disabled:t.approval_status==="approved",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(t.id),className:t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-red-500 hover:text-red-600",disabled:t.approval_status==="approved",children:e.jsx(M,{className:"w-4 h-4"})})]})})]},t.id))})]})}),y.filter(t=>t.approval_status!=="approved").length===0&&e.jsxs("div",{className:"text-center py-8 text-text-muted",children:[e.jsx("p",{children:"まだ取引がありません"}),e.jsx("p",{className:"text-sm mt-2",children:"音声入力で取引を追加してください"})]})]})]})]})})};export{De as default};
