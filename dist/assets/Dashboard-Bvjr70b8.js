const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RevenueChart-DHC6wBGK.js","assets/index-Y298rBAR.js","assets/index-Bnnn_V3n.css","assets/index-CW8wB1e9.js","assets/ExpenseChart-VGzjsla_.js","assets/TransactionTable-h82zbT3y.js","assets/TransactionForm-BaTFxfUh.js","assets/clock-C1BjEixr.js","assets/calendar-CHvkqMbz.js","assets/star-DdynT8Kb.js","assets/zap-DsKMj2j8.js"])))=>i.map(i=>d[i]);
import{c as v,j as e,F as A,L as S,a as T,b as L,d as O,r as c,P as F,R as p,X as R,_ as f}from"./index-Y298rBAR.js";import{C as I,B as V}from"./calculator-DaoJCoN2.js";import{C as M}from"./camera-CDnca7H9.js";import{D as P}from"./download-CM_hF1rz.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],D=v("chart-no-axes-column",z);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],U=v("link",J),q=()=>{const o=[{title:"CHAT-TO-BOOK",description:"音声で取引を記録",icon:I,link:"/chat-to-book",color:"bg-purple-500/20",iconColor:"text-purple-500",borderColor:"border-purple-500/30"},{title:"レシート処理",description:"レシートをスキャン",icon:M,link:"/receipt-processing",color:"bg-emerald-500/20",iconColor:"text-emerald-500",borderColor:"border-emerald-500/30"},{title:"請求書作成",description:"新しい請求書を作成",icon:A,link:"/invoice-creation",color:"bg-blue-500/20",iconColor:"text-blue-500",borderColor:"border-blue-500/30"},{title:"取引履歴",description:"すべての取引を確認",icon:D,link:"/transaction-history",color:"bg-amber-500/20",iconColor:"text-amber-500",borderColor:"border-amber-500/30"},{title:"申告サポート",description:"税務申告の準備",icon:V,link:"/tax-filing-support",color:"bg-rose-500/20",iconColor:"text-rose-500",borderColor:"border-rose-500/30"},{title:"連携設定",description:"外部サービス連携",icon:U,link:"/integration-settings",color:"bg-indigo-500/20",iconColor:"text-indigo-500",borderColor:"border-indigo-500/30"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:o.map((m,h)=>e.jsx(S,{to:m.link,className:"bg-white dark:bg-surface rounded-xl p-4 hover:bg-surface-highlight transition-all duration-300 group border border-border hover:border-border-strong hover:-translate-y-1 shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`w-12 h-12 ${m.color} rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300 border ${m.borderColor}`,children:e.jsx(m.icon,{className:`w-6 h-6 ${m.iconColor}`})}),e.jsx("h3",{className:"font-medium text-text-main mb-1 text-sm",children:m.title}),e.jsx("p",{className:"text-xs text-text-muted leading-relaxed",children:m.description})]})},h))})},H=p.lazy(()=>f(()=>import("./RevenueChart-DHC6wBGK.js"),__vite__mapDeps([0,1,2,3]))),K=p.lazy(()=>f(()=>import("./ExpenseChart-VGzjsla_.js"),__vite__mapDeps([4,1,2,3]))),Q=p.lazy(()=>f(()=>import("./TransactionTable-h82zbT3y.js"),__vite__mapDeps([5,1,2]))),X=p.lazy(()=>f(()=>import("./TransactionForm-BaTFxfUh.js"),__vite__mapDeps([6,1,2,7,8,9,10]))),Z=()=>{const{currentBusinessType:o}=T(),{isAuthenticated:m,user:h,loading:y}=L(),{transactions:i,loading:N,createTransaction:w,fetchTransactions:x}=O(h==null?void 0:h.id,o==null?void 0:o.business_type),[k,b]=c.useState(!1);console.log("ダッシュボード - currentBusinessType:",o),console.log("ダッシュボード - transactions:",i),console.log("ダッシュボード - loading:",N),console.log("ダッシュボード - authUser:",h),c.useEffect(()=>{const r=()=>b(!0);return window.addEventListener("openCreateTransactionModal",r),()=>{window.removeEventListener("openCreateTransactionModal",r)}},[]),c.useEffect(()=>{o!=null&&o.id&&(console.log("ダッシュボード - データ再取得を実行"),x())},[o,x]),c.useEffect(()=>{console.log("ダッシュボード - transactions状態が更新されました:",i)},[i]),c.useEffect(()=>{const r=async()=>{console.log("ダッシュボード - transactionRecordedイベントを受信"),o!=null&&o.id&&(await new Promise(a=>setTimeout(a,100)),x())};return window.addEventListener("transactionRecorded",r),()=>{window.removeEventListener("transactionRecorded",r)}},[o,x]),c.useEffect(()=>{const r=async()=>{console.log("ダッシュボード - transactionApprovedイベントを受信"),o!=null&&o.id&&(await new Promise(a=>setTimeout(a,100)),x())};return window.addEventListener("transactionApproved",r),()=>{window.removeEventListener("transactionApproved",r)}},[o,x]),c.useMemo(()=>{console.log("ダッシュボード - 取引データ:",i),i.forEach((s,t)=>{console.log(`ダッシュボード - 取引 ${t+1}:`,{id:s.id,item:s.item,amount:s.amount,amountType:typeof s.amount,amountStructure:typeof s.amount=="object"?Object.keys(s.amount):"N/A",date:s.date,category:s.category,type:s.type})});const r=s=>{if(typeof s=="number")return s;if(typeof s=="string"){const t=parseFloat(s);return isNaN(t)?0:t}if(typeof s=="object"&&s!==null){const t=s.value||s.amount||s.number||0;if(typeof t=="number")return t;if(typeof t=="string"){const l=parseFloat(t);return isNaN(l)?0:l}return 0}return 0},a=i.filter(s=>{if(s.type==="income")return!0;if(s.type==="expense")return!1;const t=r(s.amount),l=!isNaN(t)&&isFinite(t)&&t>0;return console.log(`ダッシュボード - 取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${t}, 収入判定=${l}`),l}),g=i.filter(s=>{if(s.type==="expense")return!0;if(s.type==="income")return!1;const t=r(s.amount),l=!isNaN(t)&&isFinite(t)&&t<0;return console.log(`ダッシュボード - 取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${t}, 支出判定=${l}`),l}),n=a.reduce((s,t)=>{const l=r(t.amount),u=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`ダッシュボード - 収入計算: ${s} + ${u} = ${s+u}`),s+u},0),d=g.reduce((s,t)=>{const l=r(t.amount),u=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`ダッシュボード - 支出計算: ${s} + ${u} = ${s+u}`),s+u},0),j={total:i.length,income:n,expense:d,balance:n-d};return console.log("ダッシュボード - 統計情報計算結果:",j),console.log("ダッシュボード - 収入取引:",a),console.log("ダッシュボード - 支出取引:",g),j},[i]);const C=()=>e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"p-4 bg-red-500 text-white text-center mb-4",children:[e.jsx("p",{children:"ダッシュボードのローディング中..."}),e.jsxs("p",{children:["authLoading: ",y?"true":"false"]}),e.jsxs("p",{children:["isAuthenticated: ",m?"true":"false"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-24 w-full bg-gray-200 dark:bg-gray-700 rounded-xl mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"})]})]});if(y)return console.log("ダッシュボードをスケルトンローディングで表示中 - authLoading:",y),e.jsx(C,{});const _=r=>{const a=["日付","説明","金額","カテゴリ","タイプ","ステータス"],g=r.map(d=>[d.date,`"${d.description}"`,d.amount.toString(),`"${d.category}"`,d.type,d.status]);return[a.join(","),...g.map(d=>d.join(","))].join(`
`)},E=()=>{const r=_(i),a=new Blob(["\uFEFF",r],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(a),n=document.createElement("a");n.setAttribute("href",g),n.setAttribute("download",`取引データ_${new Date().toISOString().split("T")[0]}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},$=async r=>{try{console.log("取引作成を開始:",r);const a=localStorage.getItem("user");if(a)try{const n=JSON.parse(a);r.creator=n.id}catch(n){console.error("ユーザー情報の解析に失敗しました:",n)}if(console.log("creator IDを設定:",r.creator),!r.type){const n=typeof r.amount=="string"?parseFloat(r.amount):r.amount;r.type=n>0?"income":"expense",console.log("typeプロパティを自動設定:",r.type)}const g=await w(r);console.log("取引作成成功:",g),await x(),window.dispatchEvent(new CustomEvent("transactionRecorded")),b(!1)}catch(a){console.error("取引の作成に失敗:",a),alert(`取引の作成に失敗しました: ${a.message||"もう一度お試しください。"}`)}};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main tracking-tight",children:"ダッシュボード"}),e.jsx("p",{className:"text-text-muted mt-1",children:"財務状況の概要と最近の活動"})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:E,disabled:i.length===0,className:`btn-ghost flex-1 sm:flex-none flex items-center justify-center ${i.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"CSV出力"]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex-1 sm:flex-none flex items-center justify-center",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"新規取引"]})]})]}),e.jsx(q,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(H,{transactions:i})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(K,{transactions:i})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(Q,{transactions:i,onOpenCreateModal:()=>b(!0),showCreateButton:!1})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-6 border border-border shadow-sm transition-all duration-200 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main",children:"AI推奨取引"}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"h-4 w-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"})})]}),e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((r,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-800 rounded-lg animate-pulse",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 dark:bg-gray-700 rounded"})]},a))})]})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-surface border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"新規取引作成"}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(R,{className:"w-5 h-5 text-text-muted"})})]}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(X,{onSubmit:$,onCancel:()=>b(!1)})})]})})})]})};export{Z as default};
