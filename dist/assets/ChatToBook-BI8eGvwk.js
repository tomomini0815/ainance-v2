import{c as se,r as p,a as me,o as pe,f as ue,u as he,j as e,L as ge,l as M}from"./index-Bk0qIUw9.js";import{A as fe}from"./arrow-left-BVrre4MH.js";import{S as be}from"./square-xwudp9LS.js";import{S as ye}from"./send-DtHPJsdL.js";import{C as E}from"./circle-check-big-DV4FML3H.js";import{S as ee}from"./save-CDU1kOYo.js";import{P as te}from"./pen-line-LybC0DkY.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],O=se("circle",ve);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],we=se("mic",je),De=()=>{const[_,D]=p.useState(!1),[w,$]=p.useState(""),[y,N]=p.useState([]),[x,U]=p.useState(null),[i,v]=p.useState({}),[L,q]=p.useState(!1),[m,S]=p.useState([]),[R,A]=p.useState(null),[H,I]=p.useState(null),k=p.useRef(null),{user:d}=me(),{currentBusinessType:h}=pe(d==null?void 0:d.id),{transactions:T,createTransaction:J,updateTransaction:re,deleteTransaction:K,approveTransaction:W,fetchTransactions:g}=ue(d==null?void 0:d.id,h==null?void 0:h.business_type),F=he();p.useEffect(()=>{if(!("webkitSpeechRecognition"in window)){console.log("Web Speech API is not supported in this browser."),I("音声認識がこのブラウザでサポートされていません。ChromeまたはEdgeをご使用ください。");return}const t=new window.webkitSpeechRecognition;return t.continuous=!0,t.interimResults=!0,t.lang="ja-JP",t.onresult=s=>{let r="";for(let o=s.resultIndex;o<s.results.length;o++){const l=s.results[o][0].transcript;s.results[o].isFinal&&(r+=l+" ")}r&&$(o=>o+r)},t.onerror=s=>{console.error("音声認識エラー:",s.error),D(!1),I(null);let r="音声認識中にエラーが発生しました。";switch(s.error){case"no-speech":r="音声が検出されませんでした。もう一度お試しください。";break;case"audio-capture":r="音声入力デバイスが見つかりません。";break;case"not-allowed":r="音声認識の使用が許可されていません。ブラウザの設定をご確認ください。";break;case"service-not-allowed":r="音声認識サービスの使用が許可されていません。";break;case"bad-grammar":r="音声認識中に文法エラーが発生しました。";break;case"language-not-supported":r="指定された言語はサポートされていません。";break}I(r)},t.onend=()=>{D(!1)},k.current=t,()=>{k.current&&k.current.stop()}},[]),p.useEffect(()=>{console.log("ChatToBook - DBから取引データを取得中",{dbTransactionsCount:T.length,dbTransactionIds:T.map(t=>t.id)}),N(t=>{const s=T.map(n=>n.id),r=t.filter(n=>!s.includes(n.id)),o=[...T.map(n=>({id:n.id,date:n.date,description:n.description||n.item||"",amount:n.amount,category:n.category,type:n.type,created_at:n.created_at,updated_at:n.updated_at,approval_status:n.approval_status})),...r],l=o.filter((n,f,b)=>f===b.findIndex(P=>P.id===n.id));return console.log("ChatToBook - 合成された取引データ:",{mergedCount:o.length,uniqueCount:l.length,dbTransactionIds:s,localTempDataCount:r.length}),l})},[T]),p.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionRecordedイベントを受信"),h!=null&&h.id&&(await new Promise(s=>setTimeout(s,100)),g())};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[h,g]),p.useEffect(()=>{const t=async()=>{console.log("ChatToBook - transactionApprovedイベントを受信"),h!=null&&h.id&&(await new Promise(s=>setTimeout(s,100)),g())};return window.addEventListener("transactionApproved",t),()=>{window.removeEventListener("transactionApproved",t)}},[h,g]);const ae=()=>{k.current&&(I(null),k.current.start(),D(!0))},oe=()=>{k.current&&(k.current.stop(),D(!1))},ne=t=>{console.log("extractTransactionData - text:",t);const s=/(\d+(?:万)?(?:千)?(?:円)?)/g,r=t.match(s),o=[{keywords:["売上"],category:"業務委託収入",type:"income",priority:10},{keywords:["給与"],category:"給与",type:"income",priority:9},{keywords:["消耗品","文具","コピー","オフィス用品"],category:"消耗品費",type:"expense",priority:10},{keywords:["接待","会食","食事","ディナー","ランチ"],category:"接待交際費",type:"expense",priority:9},{keywords:["交通費","電車","バス","タクシー"],category:"旅費交通費",type:"expense",priority:7},{keywords:["食費","ランチ","ディナー","コーヒー"],category:"食費",type:"expense",priority:6},{keywords:["通信費","電話料金"],category:"通信費",type:"expense",priority:5},{keywords:["光熱費","電気","ガス","水道"],category:"水道光熱費",type:"expense",priority:5},{keywords:["修繕","修理"],category:"修繕費",type:"expense",priority:4},{keywords:["保険"],category:"保険料",type:"expense",priority:4},{keywords:["手数料"],category:"支払手数料",type:"expense",priority:4},{keywords:["新聞","図書"],category:"新聞図書費",type:"expense",priority:3},{keywords:["外注"],category:"外注費",type:"expense",priority:3},{keywords:["税金"],category:"租税公課",type:"expense",priority:3},{keywords:["広告","宣伝"],category:"広告宣伝費",type:"expense",priority:2},{keywords:["地代","家賃"],category:"地代家賃",type:"expense",priority:2},{keywords:["費用","費"],category:"雑費",type:"expense",priority:1}];let l="雑費",n="expense",f=0;for(const u of o)for(const j of u.keywords)t.includes(j)&&u.priority>f&&(l=u.category,n=u.type,f=u.priority);let b=0;if(r&&r.length>0){const u=r[0];if(u.includes("万")){const j=parseFloat(u.replace("万",""));b=isNaN(j)?0:j*1e4}else if(u.includes("千")){const j=parseFloat(u.replace("千",""));b=isNaN(j)?0:j*1e3}else b=parseFloat(u.replace(/[^\d]/g,""))||0}return{date:new Date().toISOString().split("T")[0],description:t,amount:b,category:l,type:n}},le=()=>{w.trim()&&(console.log("processTranscript - transcript:",w),q(!0),setTimeout(()=>{const t=ne(w),r={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){const l=Math.random()*16|0;return(o=="x"?l:l&3|8).toString(16)}),...t,category:R||t.category};N(o=>[r,...o]),$(""),A(null),q(!1)},1e3))},z=t=>{U(t.id),v(t)},G=async()=>{if(x&&i)try{const t=i.description!==void 0?i.description:"",s=await re(x,{date:i.date||"",item:t,description:t,amount:i.amount||0,category:i.category||"未分類",type:i.type||"expense"});if(s.error)throw s.error;N(r=>r.map(o=>o.id===x?{...o,...i,description:t}:o)),await g(),window.dispatchEvent(new CustomEvent("transactionRecorded")),U(null),v({}),console.log("取引の編集を保存しました:",{id:x,description:t})}catch(t){console.error("取引の更新に失敗しました:",t),alert("取引の更新に失敗しました: "+t.message)}},Q=async t=>{try{const s=await K(t);if(s.error)throw s.error;N(r=>r.filter(o=>o.id!==t)),S(r=>r.filter(o=>o!==t))}catch(s){console.error("取引の削除に失敗しました:",s),alert("取引の削除に失敗しました: "+s.message)}},V=async t=>{try{if(console.log("recordTransaction - 開始:",t),!(d!=null&&d.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",d);return}console.log("認証されたユーザーID:",d.id),console.log("DBから最新の取引データを取得中..."),await g();const s=T;console.log("DBから取得した最新の取引データ:",s);const r=t.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t.id)&&s.some(o=>o.id===t.id);if(console.log("既存の取引かどうか:",{isExistingTransaction:r,transactionId:t.id,dbTransactionsCount:s.length,dbTransactionIds:s.map(o=>o.id)}),r){console.log("既存取引の承認処理を開始");const o=await W(t.id);if(console.log("承認処理結果:",o),o.error)throw o.error;N(l=>l.map(n=>n.id===t.id?{...n,approval_status:"approved"}:n)),console.log("transactionApprovedイベントを発火"),window.dispatchEvent(new CustomEvent("transactionApproved")),console.log("recordTransaction - 取引を承認しました"),alert("取引が正常に承認されました"),await g(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}else{console.log("新規取引作成処理を開始");const o=t.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim(),l=await J({item:o,amount:t.amount,date:t.date,category:t.category,type:t.type,creator:d.id,approval_status:"approved"});if(console.log("新規取引作成結果:",l),l.error)throw l.error;N(n=>n.filter(f=>f.id!==t.id)),console.log("recordTransaction - 新規取引を作成しました"),alert("取引が正常に作成されました"),await g(),console.log("recordTransaction - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded"))}}catch(s){if(console.error("取引の記録に失敗しました:",s),s.message.includes("認証セッションが切れました")){alert("認証セッションが切れました。ログインページにリダイレクトします。"),F("/login");return}alert("取引の記録に失敗しました: "+s.message)}},ie=async()=>{if(!(d!=null&&d.id)){alert("ユーザーが認証されていません。ログインしてください。"),console.error("ユーザーが認証されていません。userオブジェクト:",d);return}console.log("認証されたユーザーID:",d.id),console.log("DBから最新の取引データを取得中..."),await g();const t=T;console.log("DBから取得した最新の取引データ:",t);const s=y.filter(r=>m.includes(r.id));if(console.log("bulkRecordTransactions - 選択された取引:",s),console.log("bulkRecordTransactions - 現在のDB取引データ:",t),s.length===0){alert("記録する取引を選択してください");return}try{const r=s.filter(a=>a.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)&&t.some(c=>c.id===a.id)),o=s.filter(a=>!a.id||!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a.id)||!t.some(c=>c.id===a.id));console.log("取引分類結果:",{existingCount:r.length,newCount:o.length,existingTransactions:r.map(a=>({id:a.id,item:a.description})),newTransactions:o.map(a=>({id:a.id,item:a.description})),dbTransactionsCount:t.length,dbTransactionIds:t.map(a=>a.id)});const l=r.map(a=>(console.log("承認処理を実行:",a.id),W(a.id))),n=o.map(a=>{console.log("新規作成処理を実行:",a.id);const c=a.description.replace(/(\d+(?:万)?(?:千)?(?:円)?)/g,"").trim();return J({item:c,amount:a.amount,date:a.date,category:a.category,type:a.type,creator:d.id,approval_status:"approved"})}),f=await Promise.allSettled(l),b=await Promise.allSettled(n);console.log("bulkRecordTransactions - 承認結果:",f),console.log("bulkRecordTransactions - 作成結果:",b);const P=f.filter(a=>a.status==="fulfilled").length,u=b.filter(a=>a.status==="fulfilled").length,j=f.filter(a=>a.status==="rejected").length,xe=b.filter(a=>a.status==="rejected").length,Y=P+u,Z=j+xe;f.forEach((a,c)=>{if(a.status==="rejected"&&(console.error(`取引承認失敗 (${c+1}):`,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),F("/login");return}}),b.forEach((a,c)=>{if(a.status==="rejected"&&(console.error(`新規取引作成失敗 (${c+1}):`,a.reason),a.reason.message.includes("認証セッションが切れました"))){alert("認証セッションが切れました。ログインページにリダイレクトします。"),F("/login");return}}),Z>0?alert(`${Y}件の取引が正常に記録されましたが、${Z}件の取引の記録に失敗しました。詳細はコンソールを確認してください。`):alert(`${Y}件の取引が正常に記録されました`),N(a=>{const c=[...a];for(let C=0;C<c.length;C++)r.some(B=>B.id===c[C].id)&&(c[C]={...c[C],approval_status:"approved"});return c.filter(C=>!o.some(B=>B.id===C.id))}),S([]),await g(),console.log("bulkRecordTransactions - データ再取得完了"),window.dispatchEvent(new CustomEvent("transactionRecorded")),window.dispatchEvent(new CustomEvent("transactionApproved"))}catch(r){console.error("取引の一括記録中にエラーが発生しました:",r),alert("取引の一括記録に失敗しました: "+r.message)}},de=async()=>{if(m.length===0){alert("削除する取引を選択してください");return}if(window.confirm(`${m.length}件の取引を削除してもよろしいですか？`))try{const t=m.map(l=>K(l)),s=await Promise.allSettled(t),r=s.filter(l=>l.status==="fulfilled").length,o=s.filter(l=>l.status==="rejected").length;s.forEach((l,n)=>{l.status==="rejected"&&console.error(`取引削除失敗 (${n+1}):`,l.reason)}),o>0?alert(`${r}件の取引が正常に削除されましたが、${o}件の取引の削除に失敗しました。詳細はコンソールを確認してください。`):alert(`${r}件の取引が正常に削除されました`),N(l=>l.filter(n=>!m.includes(n.id))),S([]),await g()}catch(t){console.error("取引の一括削除中にエラーが発生しました:",t),alert("取引の一括削除に失敗しました: "+t.message)}},X=t=>{S(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},ce=()=>{m.length===y.length&&y.length>0?S([]):S(y.map(t=>t.id))};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ge,{to:"/dashboard",className:"mr-4",children:e.jsx(fe,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"CHAT-TO-BOOK"}),e.jsx("p",{className:"text-text-muted",children:"音声やチャットで簡単に取引を記録できます"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-surface rounded-xl shadow-sm border border-border p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main mb-4",children:"音声入力"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("button",{onClick:_?oe:ae,className:`flex items-center justify-center w-16 h-16 rounded-full ${_?"bg-red-500 hover:bg-red-600 animate-pulse":"bg-primary hover:bg-primary/90"} text-white transition-colors shadow-lg shadow-primary/25`,children:_?e.jsx(be,{className:"w-8 h-8"}):e.jsx(we,{className:"w-8 h-8"})})}),H&&e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-red-500",children:H})}),e.jsx("div",{className:"text-center mb-4",children:e.jsx("p",{className:"text-sm text-text-muted",children:_?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("span",{className:"flex h-3 w-3 mr-2",children:[e.jsx("span",{className:"animate-ping absolute h-3 w-3 rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative h-3 w-3 rounded-full bg-red-500"})]}),"音声認識中... 話してください"]}):"マイクボタンをクリックして開始"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-muted mb-2",children:"認識テキスト"}),e.jsx("textarea",{value:w,onChange:t=>$(t.target.value),rows:4,className:"w-full px-3 py-2 bg-background border border-border rounded-md text-text-main focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"音声認識されたテキストがここに表示されます..."}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[["売上","給与","交通費","食費","消耗品費","接待交際費","通信費","水道光熱費","雑費","未分類"].map(t=>e.jsx("button",{onClick:()=>A(R===t?null:t),className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border transition-colors ${R===t?"bg-primary/20 border-primary text-primary":"bg-surface-highlight text-text-main border-border hover:bg-surface-hover"}`,children:t},t)),R&&e.jsx("button",{onClick:()=>A(null),className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-muted border border-border hover:bg-surface-hover transition-colors",children:"クリア"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>$(""),disabled:!w.trim(),className:`px-4 py-2 rounded-md transition-colors ${w.trim()?"bg-gray-500 text-white hover:bg-gray-600":"bg-surface-highlight text-text-muted cursor-not-allowed"}`,children:"クリア"}),e.jsx("button",{onClick:le,disabled:!w.trim()||L,className:`flex items-center px-4 py-2 rounded-md transition-colors ${!w.trim()||L?"bg-surface-highlight text-text-muted cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"処理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"取引に変換"]})})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-4",children:[e.jsx("h2",{className:"text-md font-semibold text-text-main mb-3",children:"使い方"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"音声入力開始"}),e.jsx("p",{className:"text-xs text-text-muted",children:"マイクボタンをクリックして、取引内容を話してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"テキスト確認"}),e.jsx("p",{className:"text-xs text-text-muted",children:"認識されたテキストを確認・編集してください。"})]})]})}),e.jsx("div",{className:"border border-border rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:e.jsx("span",{className:"text-primary font-bold text-xs",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main text-sm mb-1",children:"取引に変換"}),e.jsx("p",{className:"text-xs text-text-muted",children:"「取引に変換」ボタンをクリックして、取引を登録してください。"})]})]})})]})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main mb-4",children:"取引一覧"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("p",{className:"text-sm text-text-muted",children:[y.length,"件の取引"]}),m.length>0&&e.jsxs("span",{className:"text-sm text-primary",children:[m.length,"件選択中"]})]}),e.jsx("div",{className:"flex space-x-2",children:m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:de,className:"flex items-center px-3 py-1 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition-colors",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"一括削除 (",m.length,")"]}),e.jsxs("button",{onClick:ie,className:"flex items-center px-3 py-1 bg-green-600 text-white rounded-md text-sm hover:bg-green-700 transition-colors",children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"一括承認 (",m.length,")"]})]})})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"block md:hidden space-y-4",children:y.map(t=>e.jsxs("div",{className:"bg-surface p-4 rounded-lg shadow-sm border border-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>X(t.id),className:"mr-3",disabled:t.approval_status==="approved",children:m.includes(t.id)?e.jsx(E,{className:"w-5 h-5 text-primary"}):e.jsx(O,{className:"w-5 h-5 text-text-muted"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-main",children:x===t.id?e.jsx("input",{type:"text",value:i.description!==void 0?i.description:t.description,onChange:s=>v(r=>({...r,description:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.description}),e.jsx("div",{className:"text-sm text-text-muted mt-1",children:x===t.id?e.jsx("input",{type:"date",value:i.date||t.date,onChange:s=>v(r=>({...r,date:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date})]})]}),e.jsx("div",{className:"text-right",children:x===t.id?e.jsx("input",{type:"number",value:i.amount||t.amount,onChange:s=>v(r=>({...r,amount:Number(s.target.value)})),className:"w-24 px-2 py-1 bg-background border border-border rounded text-sm text-text-main text-right"}):e.jsxs("span",{className:`font-medium ${t.type==="income"?"text-green-500":"text-red-500"}`,children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-3 pt-3 border-t border-border",children:[e.jsx("div",{className:"text-sm",children:x===t.id?e.jsxs("select",{value:i.category||t.category,onChange:s=>v(r=>({...r,category:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[e.jsx("option",{value:"売上",children:"売上"}),e.jsx("option",{value:"給与",children:"給与"}),e.jsx("option",{value:"交通費",children:"交通費"}),e.jsx("option",{value:"食費",children:"食費"}),e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"}),e.jsx("option",{value:"雑費",children:"雑費"}),e.jsx("option",{value:"未分類",children:"未分類"})]}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-surface-highlight text-text-muted",children:t.category})}),e.jsx("div",{className:"flex space-x-2",children:x===t.id?e.jsx("button",{onClick:G,className:"p-2 text-green-500 hover:text-green-600 bg-surface-highlight rounded-full",children:e.jsx(ee,{className:"w-4 h-4"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t),className:`p-2 rounded-full bg-surface-highlight ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-green-500 hover:text-green-600"}`,disabled:t.approval_status==="approved",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t),className:`p-2 rounded-full bg-surface-highlight ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-primary hover:text-primary/80"}`,disabled:t.approval_status==="approved",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(t.id),className:`p-2 rounded-full bg-surface-highlight ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-red-500 hover:text-red-600"}`,disabled:t.approval_status==="approved",children:e.jsx(M,{className:"w-4 h-4"})})]})})]})]},t.id))}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-surface-highlight",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:e.jsx("button",{onClick:ce,className:"flex items-center",children:m.length===y.length&&y.length>0?e.jsx(E,{className:"w-4 h-4 text-primary"}):e.jsx(O,{className:"w-4 h-4 text-text-muted"})})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-border",children:y.map(t=>e.jsxs("tr",{className:"hover:bg-surface-highlight transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>X(t.id),className:"flex items-center",disabled:t.approval_status==="approved",children:m.includes(t.id)?e.jsx(E,{className:"w-5 h-5 text-primary"}):e.jsx(O,{className:"w-5 h-5 text-text-muted"})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:x===t.id?e.jsx("input",{type:"date",value:i.date||t.date,onChange:s=>v(r=>({...r,date:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.date}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main max-w-xs",children:x===t.id?e.jsx("input",{type:"text",value:i.description!==void 0?i.description:t.description,onChange:s=>{console.log("説明入力変更:",s.target.value,"editData:",i),v(r=>({...r,description:s.target.value}))},className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):t.description}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:x===t.id?e.jsx("input",{type:"number",value:i.amount||t.amount,onChange:s=>v(r=>({...r,amount:Number(s.target.value)})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main"}):e.jsxs("span",{className:t.type==="income"?"text-green-500":"text-red-500",children:[t.type==="income"?"+":"-","¥",t.amount.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-text-main",children:x===t.id?e.jsxs("select",{value:i.category||t.category,onChange:s=>v(r=>({...r,category:s.target.value})),className:"w-full px-2 py-1 bg-background border border-border rounded text-sm text-text-main",children:[e.jsx("option",{value:"売上",children:"売上"}),e.jsx("option",{value:"給与",children:"給与"}),e.jsx("option",{value:"交通費",children:"交通費"}),e.jsx("option",{value:"食費",children:"食費"}),e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"}),e.jsx("option",{value:"雑費",children:"雑費"}),e.jsx("option",{value:"未分類",children:"未分類"})]}):t.category}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:x===t.id?e.jsx("button",{onClick:G,className:"text-green-500 hover:text-green-600 mr-2",children:e.jsx(ee,{className:"w-4 h-4"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t),className:`mr-2 ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-green-500 hover:text-green-600"}`,disabled:t.approval_status==="approved",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>z(t),className:`mr-2 ${t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-primary hover:text-primary/80"}`,disabled:t.approval_status==="approved",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(t.id),className:t.approval_status==="approved"?"text-gray-400 cursor-not-allowed":"text-red-500 hover:text-red-600",disabled:t.approval_status==="approved",children:e.jsx(M,{className:"w-4 h-4"})})]})})]},t.id))})]})}),y.filter(t=>t.approval_status!=="approved").length===0&&e.jsxs("div",{className:"text-center py-8 text-text-muted",children:[e.jsx("p",{children:"まだ取引がありません"}),e.jsx("p",{className:"text-sm mt-2",children:"音声入力で取引を追加してください"})]})]})]})]})})};export{De as default};
