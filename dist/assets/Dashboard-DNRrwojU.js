const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RevenueChart-bDoKdaxG.js","assets/index-JZ6ol5JH.js","assets/index-BEifkQES.css","assets/index-C1RuS0X8.js","assets/ExpenseChart-fwyMlDJn.js","assets/TransactionTable-CWjVZtyF.js","assets/TransactionForm-BEIOExGM.js","assets/clock-JAoXRtNj.js","assets/calendar-BhzatbzU.js","assets/star-Bx4oywP1.js","assets/zap-BOLOvW6b.js"])))=>i.map(i=>d[i]);
import{c as v,j as e,F as A,L as S,b as T,a as L,d as O,r as c,P as F,R as p,S as I,X as R,_ as f}from"./index-JZ6ol5JH.js";import{C as V}from"./calculator-zh04_thZ.js";import{C as M}from"./camera-Xo7IOPmX.js";import{B as P}from"./book-open-KMKdWj8g.js";import{A as z}from"./AIStatusComponents-izsPGFeg.js";import"./geminiAIService-ChQR1WGd.js";import{D}from"./download-BBhr8FL2.js";import"./circle-check-big-DBqXLT9V.js";import"./zap-BOLOvW6b.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],U=v("chart-no-axes-column",J);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],B=v("link",q),G=()=>{const o=[{title:"CHAT-TO-BOOK",description:"音声で取引を記録",icon:V,link:"/chat-to-book",color:"bg-purple-500/20",iconColor:"text-purple-500",borderColor:"border-purple-500/30"},{title:"レシート処理",description:"レシートをスキャン",icon:M,link:"/receipt-processing",color:"bg-emerald-500/20",iconColor:"text-emerald-500",borderColor:"border-emerald-500/30"},{title:"請求書作成",description:"新しい請求書を作成",icon:A,link:"/invoice-creation",color:"bg-blue-500/20",iconColor:"text-blue-500",borderColor:"border-blue-500/30"},{title:"取引履歴",description:"すべての取引を確認",icon:U,link:"/transaction-history",color:"bg-amber-500/20",iconColor:"text-amber-500",borderColor:"border-amber-500/30"},{title:"申告サポート",description:"税務申告の準備",icon:P,link:"/tax-filing-support",color:"bg-rose-500/20",iconColor:"text-rose-500",borderColor:"border-rose-500/30"},{title:"連携設定",description:"外部サービス連携",icon:B,link:"/integration-settings",color:"bg-indigo-500/20",iconColor:"text-indigo-500",borderColor:"border-indigo-500/30"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:o.map((m,h)=>e.jsx(S,{to:m.link,className:"bg-white dark:bg-surface rounded-xl p-4 hover:bg-surface-highlight transition-all duration-300 group border border-border hover:border-border-strong hover:-translate-y-1 shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`w-12 h-12 ${m.color} rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300 border ${m.borderColor}`,children:e.jsx(m.icon,{className:`w-6 h-6 ${m.iconColor}`})}),e.jsx("h3",{className:"font-medium text-text-main mb-1 text-sm",children:m.title}),e.jsx("p",{className:"text-xs text-text-muted leading-relaxed",children:m.description})]})},h))})},H=p.lazy(()=>f(()=>import("./RevenueChart-bDoKdaxG.js"),__vite__mapDeps([0,1,2,3]))),K=p.lazy(()=>f(()=>import("./ExpenseChart-fwyMlDJn.js"),__vite__mapDeps([4,1,2,3]))),Q=p.lazy(()=>f(()=>import("./TransactionTable-CWjVZtyF.js"),__vite__mapDeps([5,1,2]))),X=p.lazy(()=>f(()=>import("./TransactionForm-BEIOExGM.js"),__vite__mapDeps([6,1,2,7,8,9,10]))),ae=()=>{const{currentBusinessType:o}=T(),{isAuthenticated:m,user:h,loading:j}=L(),{transactions:i,loading:N,createTransaction:w,fetchTransactions:g}=O(h==null?void 0:h.id,o==null?void 0:o.business_type),[k,b]=c.useState(!1);console.log("ダッシュボード - currentBusinessType:",o),console.log("ダッシュボード - transactions:",i),console.log("ダッシュボード - loading:",N),console.log("ダッシュボード - authUser:",h),c.useEffect(()=>{const t=()=>b(!0);return window.addEventListener("openCreateTransactionModal",t),()=>{window.removeEventListener("openCreateTransactionModal",t)}},[]),c.useEffect(()=>{o!=null&&o.id&&(console.log("ダッシュボード - データ再取得を実行"),g())},[o,g]),c.useEffect(()=>{console.log("ダッシュボード - transactions状態が更新されました:",i)},[i]),c.useEffect(()=>{const t=async()=>{console.log("ダッシュボード - transactionRecordedイベントを受信"),o!=null&&o.id&&(await new Promise(n=>setTimeout(n,100)),g())};return window.addEventListener("transactionRecorded",t),()=>{window.removeEventListener("transactionRecorded",t)}},[o,g]),c.useEffect(()=>{const t=async()=>{console.log("ダッシュボード - transactionApprovedイベントを受信"),o!=null&&o.id&&(await new Promise(n=>setTimeout(n,100)),g())};return window.addEventListener("transactionApproved",t),()=>{window.removeEventListener("transactionApproved",t)}},[o,g]),c.useMemo(()=>{console.log("ダッシュボード - 取引データ:",i),i.forEach((s,r)=>{console.log(`ダッシュボード - 取引 ${r+1}:`,{id:s.id,item:s.item,amount:s.amount,amountType:typeof s.amount,amountStructure:typeof s.amount=="object"?Object.keys(s.amount):"N/A",date:s.date,category:s.category,type:s.type})});const t=s=>{if(typeof s=="number")return s;if(typeof s=="string"){const r=parseFloat(s);return isNaN(r)?0:r}if(typeof s=="object"&&s!==null){const r=s.value||s.amount||s.number||0;if(typeof r=="number")return r;if(typeof r=="string"){const l=parseFloat(r);return isNaN(l)?0:l}return 0}return 0},n=i.filter(s=>{if(s.type==="income")return!0;if(s.type==="expense")return!1;const r=t(s.amount),l=!isNaN(r)&&isFinite(r)&&r>0;return console.log(`ダッシュボード - 取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${r}, 収入判定=${l}`),l}),x=i.filter(s=>{if(s.type==="expense")return!0;if(s.type==="income")return!1;const r=t(s.amount),l=!isNaN(r)&&isFinite(r)&&r<0;return console.log(`ダッシュボード - 取引ID ${s.id}: type=${s.type}, 元のamount=${JSON.stringify(s.amount)}, 数値化後=${r}, 支出判定=${l}`),l}),a=n.reduce((s,r)=>{const l=t(r.amount),u=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`ダッシュボード - 収入計算: ${s} + ${u} = ${s+u}`),s+u},0),d=x.reduce((s,r)=>{const l=t(r.amount),u=!isNaN(l)&&isFinite(l)?Math.abs(l):0;return console.log(`ダッシュボード - 支出計算: ${s} + ${u} = ${s+u}`),s+u},0),y={total:i.length,income:a,expense:d,balance:a-d};return console.log("ダッシュボード - 統計情報計算結果:",y),console.log("ダッシュボード - 収入取引:",n),console.log("ダッシュボード - 支出取引:",x),y},[i]);const C=()=>e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"p-4 bg-red-500 text-white text-center mb-4",children:[e.jsx("p",{children:"ダッシュボードのローディング中..."}),e.jsxs("p",{children:["authLoading: ",j?"true":"false"]}),e.jsxs("p",{children:["isAuthenticated: ",m?"true":"false"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-24 w-full bg-gray-200 dark:bg-gray-700 rounded-xl mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"})]})]});if(j)return console.log("ダッシュボードをスケルトンローディングで表示中 - authLoading:",j),e.jsx(C,{});const _=t=>{const n=["日付","説明","金額","カテゴリ","タイプ","ステータス"],x=t.map(d=>[d.date,`"${d.description}"`,d.amount.toString(),`"${d.category}"`,d.type,d.status]);return[n.join(","),...x.map(d=>d.join(","))].join(`
`)},E=()=>{const t=_(i),n=new Blob(["\uFEFF",t],{type:"text/csv;charset=utf-8;"}),x=URL.createObjectURL(n),a=document.createElement("a");a.setAttribute("href",x),a.setAttribute("download",`取引データ_${new Date().toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},$=async t=>{try{console.log("取引作成を開始:",t);const n=localStorage.getItem("user");if(n)try{const a=JSON.parse(n);t.creator=a.id}catch(a){console.error("ユーザー情報の解析に失敗しました:",a)}if(console.log("creator IDを設定:",t.creator),!t.type){const a=typeof t.amount=="string"?parseFloat(t.amount):t.amount;t.type=a>0?"income":"expense",console.log("typeプロパティを自動設定:",t.type)}const x=await w(t);console.log("取引作成成功:",x),await g(),window.dispatchEvent(new CustomEvent("transactionRecorded")),b(!1)}catch(n){console.error("取引の作成に失敗:",n),alert(`取引の作成に失敗しました: ${n.message||"もう一度お試しください。"}`)}};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main tracking-tight",children:"ダッシュボード"}),e.jsx("p",{className:"text-text-muted mt-1",children:"財務状況の概要と最近の活動"})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:E,disabled:i.length===0,className:`btn-ghost flex-1 sm:flex-none flex items-center justify-center ${i.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"CSV出力"]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex-1 sm:flex-none flex items-center justify-center",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"新規取引"]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(H,{transactions:i})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(K,{transactions:i})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(Q,{transactions:i,onOpenCreateModal:()=>b(!0),showCreateButton:!1})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-6 border border-border shadow-sm transition-all duration-200 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold text-text-main",children:"AI分析"})]}),e.jsx(z,{})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-purple-500/10 to-blue-500/10 rounded-xl border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-text-main",children:"AI分析 有効"})]}),e.jsx("p",{className:"text-sm text-text-muted",children:"レシートスキャン時にGemini AIが自動で勘定科目を分類します。"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-xs text-text-muted mb-1",children:"高精度分類"}),e.jsx("div",{className:"text-sm font-semibold text-text-main",children:"95%+"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-xs text-text-muted mb-1",children:"処理時間"}),e.jsx("div",{className:"text-sm font-semibold text-text-main",children:"〜3秒"})]})]})]})]})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-surface border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"新規取引作成"}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(R,{className:"w-5 h-5 text-text-muted"})})]}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(X,{onSubmit:$,onCancel:()=>b(!1)})})]})})})]})};export{ae as default};
