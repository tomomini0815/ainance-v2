import{c as xe,a as oe,e as pe,l as he,u as ue,r as p,n as be,j as e,L as w,F as C,G as f,p as je,x as U,d as fe,U as M}from"./index-Cte9M9zr.js";import{P as Ne,y as W}from"./PreviousYearImportModal-Cmmp6bxV.js";import{y as ge}from"./yearlyBalanceSheetService-emvamZi3.js";import{g as ye,c as ve,a as we,f as r,b as Ce,e as _e}from"./CorporateTaxService-wsKGjjao.js";import{a as B,C as D,i as V}from"./CsvExportService-CY4l6FiV.js";import{D as Te}from"./DepreciationCalculator-CFrmSYxb.js";import{c as ke,d as Ee}from"./pdfJapaneseService-Dtu4oZrB.js";import{W as Ie}from"./WizardProgress-DC-23g1d.js";import{A as z}from"./arrow-left-DwSMUrT_.js";import{B as I}from"./building-2-DENfUFEz.js";import{B as Y}from"./book-open-C0O9y1LO.js";import{C as Pe}from"./calculator-BmbL7nmW.js";import{W as Se}from"./wallet-DJVgKRs0.js";import{D as Oe}from"./download-WVyvOCYo.js";import{A as E}from"./arrow-right-gQUG1Phy.js";import{C as q}from"./circle-check-big-DeImdQY4.js";import{R as y}from"./refresh-cw-B5YdYT7O.js";import{W as Ae}from"./wrench-CcSPWBxu.js";import{I as G}from"./info-CEKsND1J.js";import{C as Fe}from"./copy-ThNu6tuH.js";import"./geminiAIService-DQoIspWT.js";import"./loader-circle-DEKlloMj.js";import"./save-BOp2MQdj.js";import"./circle-question-mark-D8QNNe1k.js";import"./pdfAutoFillService-PLPbwm7Q.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M11 17h3v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a3.16 3.16 0 0 0 2-2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1a5 5 0 0 0-2-4V3a4 4 0 0 0-3.2 1.6l-.3.4H11a6 6 0 0 0-6 6v1a5 5 0 0 0 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1z",key:"1piglc"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M2 8v1a2 2 0 0 0 2 2h1",key:"1env43"}]],$e=xe("piggy-bank",Le),k=[{id:1,title:"会社情報",icon:I,description:"会社基本情報の入力"},{id:2,title:"減価償却",icon:Pe,description:"資産の登録と計算"},{id:3,title:"損益計算",icon:C,description:"売上・経費の確認"},{id:4,title:"法人税計算",icon:$e,description:"法人税等の計算"},{id:5,title:"消費税確認",icon:Se,description:"消費税の確認"},{id:6,title:"書類作成",icon:Oe,description:"PDF出力"}],Me=({corporateInfo:s,setCorporateInfo:t,handleInfoChange:a,handleTranscribe:x,prevYearSettlement:o,setIsImportModalOpen:b})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-surface border border-border rounded-xl p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-text-main mb-1",children:"前期データの引き継ぎ"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"前期の決算データを取り込むことで、今期の収支比較やBSの期首残高設定がスムーズに行えます。"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[o?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-success font-medium",children:[e.jsx(q,{className:"w-4 h-4"}),o.year,"年度のデータが取込済みです"]}):e.jsxs("button",{onClick:()=>b(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm font-medium",children:[e.jsx(M,{className:"w-4 h-4"}),"前期データをインポート"]}),e.jsxs(w,{to:"/settlement-history",className:"inline-flex items-center gap-2 px-4 py-2 bg-surface-highlight border border-border text-text-muted hover:text-text-main rounded-lg transition-colors text-sm font-medium",children:[e.jsx(C,{className:"w-4 h-4"}),"履歴・引継ぎ管理"]})]})]})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main mb-1",children:"会社基本情報"}),e.jsx("p",{className:"text-text-muted",children:"法人税申告に必要な会社情報を入力してください。"})]}),e.jsxs("button",{onClick:x,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary/10 border border-primary/20 rounded-lg hover:bg-primary/20 transition-colors text-primary text-sm font-medium whitespace-nowrap",children:[e.jsx(y,{className:"w-4 h-4"}),"登録データから転記"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-text-main mb-2",children:["会社名 ",e.jsx("span",{className:"text-error",children:"*"})]}),e.jsx("input",{type:"text",value:s.companyName,onChange:m=>t({...s,companyName:m.target.value}),className:"input-base",placeholder:"株式会社〇〇"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"代表者名"}),e.jsx("input",{type:"text",value:s.representativeName,onChange:m=>t({...s,representativeName:m.target.value}),className:"input-base",placeholder:"山田 太郎"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"法人番号"}),e.jsx("input",{type:"text",value:s.corporateNumber,onChange:m=>t({...s,corporateNumber:m.target.value}),className:"input-base",placeholder:"1234567890123"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"資本金"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted",children:"¥"}),e.jsx("input",{type:"number",value:s.capital,onChange:m=>t({...s,capital:Number(m.target.value)}),className:"input-base pl-8"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"所在地"}),e.jsx("input",{type:"text",value:s.address,onChange:m=>t({...s,address:m.target.value}),className:"input-base",placeholder:"東京都渋谷区..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"事業年度（開始）"}),e.jsx("input",{type:"date",value:s.fiscalYearStart,onChange:m=>a({fiscalYearStart:m.target.value}),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"事業年度（終了）"}),e.jsx("input",{type:"date",value:s.fiscalYearEnd,onChange:m=>a({fiscalYearEnd:m.target.value}),className:"input-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-main mb-2",children:"所轄税務署"}),e.jsx("input",{type:"text",value:s.taxOffice||"",onChange:m=>a({taxOffice:m.target.value}),className:"input-base",placeholder:"例：芝税務署"})]})]}),e.jsxs("div",{className:"bg-info-light border border-info/20 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-info flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-main font-medium",children:"中小法人の税制優遇"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"資本金1億円以下の中小法人は、年800万円以下の所得に対して15%の軽減税率が適用されます。"})]})]})]}),We=({assets:s,onDepreciationCalculate:t,handleTranscribe:a})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main mb-1",children:"減価償却資産の登録"}),e.jsx("p",{className:"text-text-muted",children:"10万円以上の資産や、減価償却が必要な資産を登録してください。"})]}),e.jsxs("button",{onClick:a,className:"flex items-center justify-center gap-2 px-4 py-2 bg-primary/10 border border-primary/20 rounded-lg hover:bg-primary/20 transition-colors text-primary text-sm font-medium whitespace-nowrap",children:[e.jsx(y,{className:"w-4 h-4"}),"取引データから転記"]})]}),e.jsx(Te,{initialAssets:s,onCalculate:t})]}),Be=({financialData:s,corporateInfo:t,prevYearSettlement:a,showComparison:x,setShowComparison:o})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main mb-4",children:"損益計算書"}),e.jsxs("p",{className:"text-text-muted mb-6",children:[t.fiscalYear,"年度の取引データから自動集計した結果です。"]})]}),a&&e.jsxs("div",{className:"flex items-center justify-between bg-surface border border-border rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-text-main block",children:["前期 (",a.year,"年度) と比較"]}),e.jsx("span",{className:"text-xs text-text-muted",children:"収益・費用の増減を確認できます"})]})]}),e.jsx("button",{onClick:()=>o(!x),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ${x?"bg-primary":"bg-border"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${x?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-success-light border border-success/20 rounded-xl p-5",children:[e.jsx("p",{className:"text-sm text-success font-medium",children:"売上高"}),e.jsx("p",{className:"text-2xl font-bold text-text-main mt-1",children:r(s.revenue)}),x&&a&&e.jsxs("p",{className:`text-xs mt-2 font-medium ${s.revenue>=a.revenue?"text-success":"text-error"}`,children:[s.revenue>=a.revenue?"↑":"↓",r(Math.abs(s.revenue-a.revenue)),e.jsxs("span",{className:"text-text-muted ml-1 font-normal",children:["(",a.year,"度: ",r(a.revenue),")"]})]})]}),e.jsxs("div",{className:"bg-error-light border border-error/20 rounded-xl p-5",children:[e.jsx("p",{className:"text-sm text-error font-medium",children:"販管費"}),e.jsx("p",{className:"text-2xl font-bold text-text-main mt-1",children:r(s.operatingExpenses)}),x&&a&&e.jsxs("p",{className:`text-xs mt-2 font-medium ${s.operatingExpenses<=a.operating_expenses?"text-success":"text-error"}`,children:[s.operatingExpenses<=a.operating_expenses?"↓":"↑",r(Math.abs(s.operatingExpenses-a.operating_expenses)),e.jsxs("span",{className:"text-text-muted ml-1 font-normal",children:["(",a.year,"度: ",r(a.operating_expenses),")"]})]})]}),e.jsxs("div",{className:"bg-primary-light border border-primary/20 rounded-xl p-5",children:[e.jsx("p",{className:"text-sm text-primary font-medium",children:"経常利益"}),e.jsx("p",{className:"text-2xl font-bold text-text-main mt-1",children:r(s.ordinaryIncome)}),x&&a&&e.jsxs("p",{className:`text-xs mt-2 font-medium ${s.ordinaryIncome>=a.net_income?"text-success":"text-error"}`,children:[s.ordinaryIncome>=a.net_income?"↑":"↓",r(Math.abs(s.ordinaryIncome-a.net_income))]})]})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-xl p-5",children:[e.jsx("h4",{className:"font-medium text-text-main mb-4",children:"損益計算書"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-border",children:[e.jsx("span",{className:"text-text-muted",children:"売上高"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.revenue)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-border",children:[e.jsx("span",{className:"text-text-muted",children:"売上原価"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.costOfSales)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-border bg-surface-highlight px-2 -mx-2",children:[e.jsx("span",{className:"font-medium text-text-main",children:"売上総利益"}),e.jsx("span",{className:"font-bold text-text-main",children:r(s.grossProfit)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-border",children:[e.jsx("span",{className:"text-text-muted",children:"販売費及び一般管理費"}),e.jsx("span",{className:"font-medium text-error",children:r(s.operatingExpenses)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-border bg-primary-light px-2 -mx-2",children:[e.jsx("span",{className:"font-medium text-text-main",children:"営業利益"}),e.jsx("span",{className:"font-bold text-primary",children:r(s.operatingIncome)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-border",children:[e.jsx("span",{className:"text-text-muted",children:"営業外損益"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.nonOperatingIncome-s.nonOperatingExpenses)})]}),e.jsxs("div",{className:"flex justify-between py-2 bg-success-light px-2 -mx-2 rounded",children:[e.jsx("span",{className:"font-bold text-text-main",children:"税引前当期純利益"}),e.jsx("span",{className:"font-bold text-success",children:r(s.incomeBeforeTax)})]})]})]}),s.expensesByCategory.length>0&&e.jsxs("div",{className:"bg-surface border border-border rounded-xl p-5",children:[e.jsx("h4",{className:"font-medium text-text-main mb-4",children:"経費内訳（上位5件）"}),e.jsx("div",{className:"space-y-3",children:s.expensesByCategory.slice(0,5).map((b,m)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-surface-highlight rounded-lg flex items-center justify-center text-sm font-medium text-text-muted",children:m+1}),e.jsx("span",{className:"text-text-main",children:b.category})]}),e.jsx("span",{className:"font-medium text-text-main",children:r(b.amount)})]},m))})]})]}),De=({taxResult:s,corporateInfo:t,handleCopy:a,copiedField:x})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main mb-4",children:"法人税等の計算"}),e.jsx("p",{className:"text-text-muted mb-6",children:"課税所得に基づいて法人税等を自動計算しました。"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-surface border border-border rounded-xl p-5",children:[e.jsx("p",{className:"text-sm text-text-muted",children:"課税所得"}),e.jsx("p",{className:"text-2xl font-bold text-text-main mt-1",children:r(s.taxableIncome)})]}),e.jsxs("div",{className:"bg-primary-light border border-primary/20 rounded-xl p-5",children:[e.jsx("p",{className:"text-sm text-primary font-medium",children:"法人税等合計"}),e.jsx("p",{className:"text-2xl font-bold text-text-main mt-1",children:r(s.totalTax)}),e.jsxs("p",{className:"text-xs text-text-muted mt-2",children:["実効税率: ",Ce(s.effectiveTaxRate)]})]})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-xl divide-y divide-border",children:[e.jsx("div",{className:"p-4",children:e.jsx("h4",{className:"font-medium text-text-main",children:"法人税等の内訳"})}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-main",children:"法人税"}),t.capital<=1e8&&e.jsx("span",{className:"ml-2 text-xs text-success bg-success-light px-2 py-0.5 rounded",children:"中小法人軽減"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-text-main",children:r(s.corporateTax)}),e.jsx("button",{onClick:()=>a(s.corporateTax,"corporateTax"),className:`p-1.5 rounded transition-colors ${x==="corporateTax"?"bg-success text-white":"hover:bg-surface-highlight text-text-muted"}`,children:x==="corporateTax"?e.jsx(fe,{className:"w-4 h-4"}):e.jsx(Fe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"地方法人税"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.localCorporateTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"法人住民税"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.corporateInhabitantTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"法人事業税"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.businessTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center bg-primary-light",children:[e.jsx("span",{className:"font-bold text-text-main",children:"税金合計"}),e.jsx("span",{className:"font-bold text-primary text-lg",children:r(s.totalTax)})]})]}),e.jsxs("div",{className:"bg-success-light border border-success/20 rounded-xl p-5 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-text-main",children:"当期純利益"}),e.jsx("span",{className:"text-2xl font-bold text-success",children:r(s.netIncome)})]}),s.taxableIncome<=0&&e.jsxs("div",{className:"bg-warning-light border border-warning/20 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-main font-medium",children:"課税所得がありません"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"今期は課税所得がないため、法人税は発生しません（均等割のみ発生）。"})]})]})]}),Ve=({consumptionTaxResult:s})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main mb-4",children:"消費税の確認"}),e.jsx("p",{className:"text-text-muted mb-6",children:"売上・仕入に係る消費税を集計しました。"})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-xl divide-y divide-border",children:[e.jsx("div",{className:"p-4",children:e.jsx("h4",{className:"font-medium text-text-main",children:"消費税計算"})}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"課税売上高"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.taxableRevenue)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"売上に係る消費税"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.outputTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"課税仕入高"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.taxablePurchases)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"仕入に係る消費税"}),e.jsx("span",{className:"font-medium text-error",children:r(s.inputTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center bg-primary-light",children:[e.jsx("span",{className:"font-bold text-text-main",children:"納付消費税額（国税）"}),e.jsx("span",{className:"font-bold text-primary",children:r(s.netConsumptionTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-main",children:"地方消費税"}),e.jsx("span",{className:"font-medium text-text-main",children:r(s.localConsumptionTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center bg-success-light",children:[e.jsx("span",{className:"font-bold text-text-main",children:"消費税等合計"}),e.jsx("span",{className:"font-bold text-success text-lg",children:r(s.totalConsumptionTax)})]})]}),e.jsxs("div",{className:"bg-info-light border border-info/20 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-info flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-main font-medium",children:"免税事業者の確認"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"基準期間の課税売上高が1,000万円以下の場合、消費税の納税義務が免除される場合があります。"})]})]})]}),ze=({corporateInfo:s,financialData:t,taxResult:a,isLoading:x,generatePDF:o,handleOpenInEditor:b})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-text-main mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-primary"}),"書類の作成・ダウンロード"]}),e.jsx("p",{className:"text-text-muted mb-6",children:"入力内容を確認して、必要な書類をダウンロードしてください。"})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-xl divide-y divide-border",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-muted",children:"会社名"}),e.jsx("span",{className:"font-medium text-text-main",children:s.companyName||"（未入力）"})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-muted",children:"事業年度"}),e.jsxs("span",{className:"font-medium text-text-main",children:[s.fiscalYear,"年度"]})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-muted",children:"売上高"}),e.jsx("span",{className:"font-medium text-success",children:r(t.revenue)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-muted",children:"営業外収益"}),e.jsx("span",{className:"font-medium text-success",children:r(t.nonOperatingIncome)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-muted",children:"経常利益"}),e.jsx("span",{className:"font-medium text-primary",children:r(t.ordinaryIncome)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("span",{className:"text-text-muted",children:"法人税等"}),e.jsx("span",{className:"font-medium text-error",children:r(a.totalTax)})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center bg-success-light",children:[e.jsx("span",{className:"font-bold text-text-main",children:"当期純利益"}),e.jsx("span",{className:"font-bold text-success",children:r(a.netIncome)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>o("financial"),disabled:x,className:"flex items-center justify-center gap-2 p-6 bg-surface border border-border rounded-xl hover:border-primary hover:bg-primary-light transition-colors",children:[x?e.jsx(y,{className:"w-6 h-6 animate-spin text-primary"}):e.jsx(C,{className:"w-6 h-6 text-primary"}),e.jsx("div",{className:"text-left",children:e.jsx("p",{className:"text-sm text-text-muted",children:"損益計算書・貸借対照表"})})]}),e.jsxs("button",{onClick:()=>{if(t){const m=B.generateFinancialStatementCSV({...s,...t,fiscalYear:s.fiscalYear,taxableIncome:a.taxableIncome,estimatedTax:a.totalTax});B.downloadCSV(m,`financial_statements_${s.companyName}_${s.fiscalYear}.csv`),f.success("財務諸表CSVを出力しました")}},disabled:x,className:"flex items-center justify-center gap-2 p-6 bg-surface border border-border rounded-xl hover:border-primary hover:bg-primary-light transition-colors",children:[e.jsx(Y,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-text-main",children:"財務諸表データ(CSV)"}),e.jsx("p",{className:"text-sm text-text-muted",children:"e-Tax取込用"})]})]}),e.jsxs("button",{onClick:()=>o("corporate"),disabled:x,className:"flex items-center justify-center gap-2 p-6 bg-surface border border-border rounded-xl hover:border-primary hover:bg-primary-light transition-colors",children:[x?e.jsx(y,{className:"w-6 h-6 animate-spin text-primary"}):e.jsx(I,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-text-main",children:"法人税申告書"}),e.jsx("p",{className:"text-sm text-text-muted",children:"法人税の概要"})]})]})]}),e.jsx("div",{className:"bg-surface-highlight rounded-xl p-5 border border-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-text-main flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary"}),"申告書を詳細に編集する"]}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"別表の調整や、細かい数字の修正が必要な場合は、詳細エディタをご利用ください。"})]}),e.jsxs("button",{onClick:b,className:"btn-secondary whitespace-nowrap",children:["詳細エディタで開く",e.jsx(E,{className:"w-4 h-4 ml-2"})]})]})}),e.jsxs("div",{className:"bg-warning-light border border-warning/20 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(U,{className:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-main font-medium",children:"ご注意"}),e.jsx("p",{className:"text-sm text-text-muted mt-1",children:"この書類は参考資料です。正式な法人税申告は税理士にご相談いただくか、 e-Taxにて提出してください。"})]})]}),e.jsx("div",{className:"bg-surface border border-border rounded-xl p-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-text-muted"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-main",children:"PDF座標キャリブレーター"}),e.jsx("p",{className:"text-sm text-text-muted",children:"公式PDFフォームの座標調整ツール"})]})]}),e.jsxs("a",{href:"/tools/coordinate_picker.html",target:"_blank",rel:"noopener noreferrer",className:"btn-ghost text-sm flex items-center gap-1",children:["開く",e.jsx(E,{className:"w-4 h-4"})]})]})})]}),hs=()=>{const{user:s}=oe(),{currentBusinessType:t}=pe(),{transactions:a}=he(s==null?void 0:s.id,t==null?void 0:t.business_type),x=ue(),[o,b]=p.useState(1),[m,P]=p.useState(!1),[H,S]=p.useState(null),[O,A]=p.useState(null),[d,Z]=p.useState(null),[J,F]=p.useState(!1),[K,Q]=p.useState(!1);be.useEffect(()=>{(async()=>{if(s!=null&&s.id&&(t!=null&&t.business_type))try{const l=await W.getLatest(s.id,t.business_type);A(l);const h=await ge.getByYear(s.id,t.business_type,(l==null?void 0:l.year)||new Date().getFullYear()-1);h&&(Z(h),v(u=>({...u,capital:h.net_assets_capital||u.capital})))}catch(l){console.error("前年度データの取得に失敗しました:",l)}})()},[s==null?void 0:s.id,t==null?void 0:t.business_type]);const X=()=>{if(window.confirm(`現在の計算結果を詳細エディタに転記して開きますか？
（エディタの既存データは上書きされます）`)){const c=D.calculateDataFromTransactions(a,i);D.saveData({...V,...c,companyInfo:{...V.companyInfo,corporateName:i.companyName,representativeName:i.representativeName,corporateNumber:i.corporateNumber||"",address:i.address||"",taxOffice:i.taxOffice||"",capitalAmount:i.capital,fiscalYearStart:i.fiscalYearStart,fiscalYearEnd:i.fiscalYearEnd}}),x("/corporate-tax/input")}},_=new Date().getFullYear(),[i,v]=p.useState({companyName:"",representativeName:"",corporateNumber:"",address:"",taxOffice:"",capital:1e7,fiscalYearStart:`${_-1}-04-01`,fiscalYearEnd:`${_}-03-31`,fiscalYear:_-1,employeeCount:1}),R=c=>{v(l=>({...l,...c}))},[ee,L]=p.useState([]),[j,se]=p.useState(0),te=(c,l)=>{se(c),L(l)},n=p.useMemo(()=>{const c={retainedEarnings:(d==null?void 0:d.net_assets_retained_earnings_total)||0,capital:(d==null?void 0:d.net_assets_capital)||i.capital,cash:(d==null?void 0:d.assets_current_cash)||0,receivable:d!=null&&d.assets_current_total?d.assets_current_total-(d.assets_current_cash||0):0,inventory:0,fixedAssets:d!=null&&d.assets_total?d.assets_total-(d.assets_current_total||0):0,payable:(d==null?void 0:d.liabilities_total)||0,shortTermLoans:0,longTermLoans:0},l=ye(a,i.fiscalYear,c);if(j>0){const h=l.expensesByCategory.findIndex(u=>u.category==="減価償却費");h>=0?l.expensesByCategory[h].amount+=j:l.expensesByCategory.push({category:"減価償却費",amount:j}),l.operatingExpenses+=j,l.operatingIncome-=j,l.ordinaryIncome-=j,l.incomeBeforeTax-=j,l.expensesByCategory.sort((u,T)=>T.amount-u.amount)}return l},[a,i.fiscalYear,j]),N=p.useMemo(()=>ve(n,i),[n,i]),ae=p.useMemo(()=>we(n.revenue,n.operatingExpenses),[n]),re=()=>{o<k.length&&b(o+1)},ne=()=>{o>1&&b(o-1)},ie=()=>{if(!t){f.error("登録された事業情報が見つかりません。連携設定で登録してください。");return}v(c=>({...c,companyName:t.company_name||c.companyName,representativeName:t.representative_name||c.representativeName,corporateNumber:t.tax_number||c.corporateNumber,address:t.address||c.address})),f.success("事業情報を転記しました")},le=()=>{if(!a||a.length===0){f.error("取引データが見つかりません。");return}const c=_e(a,i.fiscalYear);if(c.length===0){f.error("転記可能な減価償却資産（タグ: depreciation_asset）が見つかりません。");return}L(c),f.success(`${c.length}件の減価償却資産を転記しました`)},ce=async(c,l)=>{try{await navigator.clipboard.writeText(String(c).replace(/[¥,]/g,"")),S(l),setTimeout(()=>S(null),2e3)}catch(h){console.error("コピーに失敗しました:",h)}},me=async c=>{P(!0);try{const l={companyName:i.companyName||"（会社名未入力）",representativeName:i.representativeName,address:i.address,corporateNumber:i.corporateNumber,capital:i.capital,businessType:"corporation",revenue:n.revenue,expenses:n.operatingExpenses,netIncome:N.netIncome,expensesByCategory:n.expensesByCategory,fiscalYear:i.fiscalYear,taxableIncome:N.taxableIncome,estimatedTax:N.totalTax,costOfSales:n.costOfSales,grossProfit:n.grossProfit,operatingExpenses:n.operatingExpenses,operatingIncome:n.operatingIncome,nonOperatingIncome:n.nonOperatingIncome,nonOperatingExpenses:n.nonOperatingExpenses,ordinaryIncome:n.ordinaryIncome,cash:n.cash,accountsReceivable:n.accountsReceivable,inventory:n.inventory,fixedAssets:n.fixedAssets,totalAssets:n.totalAssets,accountsPayable:n.accountsPayable,shortTermLoans:n.shortTermLoans,longTermLoans:n.longTermLoans,totalLiabilities:n.totalLiabilities,beginningRetainedEarnings:n.beginningRetainedEarnings,beginningCapital:n.beginningCapital,depreciation:j};let h,u;c==="corporate"?(h=await ke(l),u=`法人税申告書_${i.fiscalYear}年度.pdf`):(h=await Ee(l),u=`決算報告書_${i.fiscalYear}年度.pdf`);const T=new Blob([h],{type:"application/pdf"}),$=URL.createObjectURL(T),g=document.createElement("a");g.href=$,g.download=u,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.open($,"_blank")}catch(l){console.error("PDF生成エラー:",l)}finally{P(!1)}},de=()=>{switch(o){case 1:return e.jsx(Me,{corporateInfo:i,setCorporateInfo:v,handleInfoChange:R,handleTranscribe:ie,prevYearSettlement:O,setIsImportModalOpen:F});case 2:return e.jsx(We,{assets:ee,onDepreciationCalculate:te,handleTranscribe:le});case 3:return e.jsx(Be,{financialData:n,corporateInfo:i,prevYearSettlement:O,showComparison:K,setShowComparison:Q});case 4:return e.jsx(De,{taxResult:N,corporateInfo:i,handleCopy:ce,copiedField:H});case 5:return e.jsx(Ve,{consumptionTaxResult:ae});case 6:return e.jsx(ze,{corporateInfo:i,financialData:n,taxResult:N,isLoading:m,generatePDF:me,handleOpenInEditor:X});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("main",{className:"w-full px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(w,{to:"/dashboard",className:"mr-4 p-2 rounded-lg hover:bg-surface-highlight transition-colors",children:e.jsx(z,{className:"w-6 h-6 text-text-muted hover:text-text-main"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-text-main flex items-center gap-2",children:[e.jsx(I,{className:"w-7 h-7 text-primary"}),"法人税申告サポート"]}),e.jsx("p",{className:"text-text-muted mt-1",children:"法人決算・税務申告のサポート"})]})]}),e.jsxs(w,{to:"/corporate-tax-guide",className:"flex items-center gap-2 px-4 py-2 bg-primary/10 border border-primary/20 rounded-lg hover:bg-primary/20 transition-colors text-primary",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"申告ガイド"})]})]}),e.jsx(Ie,{currentStep:o,steps:k.map(c=>({number:c.id,title:c.title,description:c.description}))}),e.jsx("div",{className:"bg-surface rounded-xl border border-border p-6 md:p-8 mb-8 shadow-sm",children:de()}),e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsxs("button",{onClick:ne,disabled:o===1,className:`btn-ghost ${o===1?"invisible":""}`,children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"戻る"]}),o<k.length?e.jsxs("button",{onClick:re,className:"btn-primary min-w-[200px]",children:["次へ進む",e.jsx(E,{className:"w-5 h-5 ml-2"})]}):e.jsxs(w,{to:"/dashboard",className:"btn-primary min-w-[200px]",children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"ダッシュボードへ"]})]})]}),e.jsx(Ne,{isOpen:J,onClose:()=>F(!1),userId:(s==null?void 0:s.id)||"",businessType:(t==null?void 0:t.business_type)||"corporation",onImportSuccess:()=>{s!=null&&s.id&&(t!=null&&t.business_type)&&W.getLatest(s.id,t.business_type).then(A),f.success("前期データをインポートしました")}})]})};export{hs as default};
