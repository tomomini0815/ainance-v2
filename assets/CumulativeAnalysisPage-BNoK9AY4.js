import{e as C,a as k,l as S,r as p,j as e,L,w as E,T as M,x as A,$ as T,f as B}from"./index-BcSqN67S.js";import{B as _,C as $,a as D,L as F,b as I,p as P,c as O,d as U,P as R,e as q}from"./index-abWvnmry.js";import{A as z}from"./arrow-left-DdT9VhUy.js";import{D as H}from"./download-CFylH2lV.js";$.register(D,F,I,P,O,U,R,q);const Q=()=>{const{currentBusinessType:i}=C(),{user:x}=k(),{transactions:h}=S(x==null?void 0:x.id,i==null?void 0:i.business_type),[u]=p.useState(()=>{const r=localStorage.getItem("monthly_budget");return r?parseInt(r):5e5}),s=p.useMemo(()=>{const r=t=>typeof t=="number"?Math.abs(t):typeof t=="string"?Math.abs(parseInt(t.replace(/,/g,""))||0):0,l=h.map(t=>{var a;if((a=t.tags)!=null&&a.includes("depreciation_asset")&&t.description){const n=t.description.match(/今期.*?償却額:¥([0-9,]+)/);if(n){const o=parseInt(n[1].replace(/,/g,""),10);return{...t,amount:o}}}return t}).filter(t=>{const a=t.amount,n=typeof a=="string"?a:String(a||0),o=parseFloat(n.replace(/,/g,""));return(t.type==="expense"||t.type!=="income"&&o<0)&&t.approval_status!=="rejected"}),m=l.reduce((t,a)=>t+r(a.amount),0),v=new Set(l.map(t=>{const a=new Date(t.date);return`${a.getUTCFullYear()}-${a.getUTCMonth()}`})),b=Math.max(1,v.size),c=u*b,N=c-m,w=m/c*100,d={};l.forEach(t=>{const a=r(t.amount),n=t.category||"未分類";d[n]=(d[n]||0)+a});const g=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ef4444","#ec4899","#14b8a6","#06b6d4"],y=Object.keys(d).map((t,a)=>{const n=d[t],o=c/Math.max(Object.keys(d).length,1);return{name:t,actual:n,budget:o,diff:o-n,color:g[a%g.length]}}).sort((t,a)=>a.actual-t.actual);return{totalExpense:m,cumulativeBudget:c,variance:N,progress:w,categories:y,monthCount:b}},[h,u]),j={labels:s.categories.map(r=>r.name),datasets:[{label:"累計実績",data:s.categories.map(r=>r.actual),backgroundColor:"#10b981",borderRadius:4}]},f={responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}};return e.jsx("div",{className:"min-h-screen pb-20 bg-background",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{to:"/",className:"p-2 hover:bg-surface-highlight rounded-full transition-colors border border-border",children:e.jsx(z,{className:"w-6 h-6 text-text-muted"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"累計予算分析レポート"}),e.jsxs("p",{className:"text-sm text-text-muted",children:["全期間（",s.monthCount,"ヶ月分）の累計予実状況"]})]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-surface border border-border rounded-lg text-sm font-bold text-text-main hover:bg-gray-50 transition-colors shadow-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"レポート出力"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"累計予算合計"}),e.jsxs("div",{className:"text-lg font-bold text-text-main",children:[s.cumulativeBudget.toLocaleString(),"円"]}),e.jsxs("div",{className:"mt-1 text-[10px] text-text-muted flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3"})," ",s.monthCount,"ヶ月分"]})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"累計支出実績"}),e.jsxs("div",{className:"text-lg font-bold text-emerald-500",children:[s.totalExpense.toLocaleString(),"円"]}),e.jsxs("div",{className:"mt-1 text-[10px] text-emerald-500/70 font-medium",children:["消化率 ",s.progress.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"累計予算残高"}),e.jsxs("div",{className:`text-lg font-bold ${s.variance<0?"text-red-500":"text-green-500"}`,children:[Math.abs(s.variance).toLocaleString(),"円"]}),e.jsx("div",{className:"mt-1 text-[10px] text-text-muted",children:s.variance<0?"超過":"残り"})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-3 rounded-xl border border-border shadow-sm",children:[e.jsx("div",{className:"text-[10px] text-text-muted mb-0.5",children:"総合状況"}),s.variance>=0?e.jsxs("div",{className:"flex items-center gap-1.5 text-green-500 mt-0.5",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base font-bold",children:"予算内"})]}):e.jsxs("div",{className:"flex items-center gap-1.5 text-red-500 mt-0.5",children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base font-bold",children:"警告"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-surface p-6 rounded-2xl border border-border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-text-main",children:"累計支出内訳（カテゴリ別）"}),e.jsx(T,{className:"w-5 h-5 text-text-muted"})]}),e.jsx("div",{className:"h-80",children:e.jsx(_,{data:j,options:f})})]}),e.jsxs("div",{className:"bg-white dark:bg-surface p-6 rounded-2xl border border-border shadow-sm flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-text-main mb-4",children:"累計ランキング"}),e.jsx("div",{className:"space-y-4 overflow-y-auto flex-1 pr-2 custom-scrollbar",children:s.categories.map((r,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-surface-highlight transition-colors border border-transparent hover:border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-bold text-text-main text-sm truncate",children:r.name}),e.jsx("div",{className:"text-[10px] text-text-muted",children:"累計割合"})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("div",{className:"font-bold text-text-main",children:[r.actual.toLocaleString(),"円"]}),e.jsxs("div",{className:"text-xs text-emerald-500",children:[(r.actual/s.totalExpense*100).toFixed(1),"%"]})]})]},l))})]})]}),e.jsx("div",{className:"bg-primary/5 rounded-2xl p-6 border border-primary/20",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-surface rounded-xl shadow-sm",children:e.jsx(B,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold text-text-main mb-1",children:"累計分析のアドバイス"}),e.jsxs("p",{className:"text-sm text-text-muted leading-relaxed",children:["全期間（",s.monthCount,"ヶ月）の累計支出は、月ごとの変動を吸収した長期的な財務健全性を示します。",s.variance>=0?`現在、累計予算（${s.cumulativeBudget.toLocaleString()}円）に対して${Math.abs(s.variance).toLocaleString()}円の余裕があります。長期的な投資や節税対策などを検討する余地があります。`:`累計予算を${Math.abs(s.variance).toLocaleString()}円超過しています。固定費の見直しや、大きな支出が発生した月の原因を特定することで、将来的な改善が期待できます。`]})]})]})})]})})};export{Q as default};
