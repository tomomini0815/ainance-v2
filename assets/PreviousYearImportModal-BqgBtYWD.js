import{K as f,r as N,j as e,F as V,X as le,U as oe,S as ie,P as ce,q as de,d as z,G as w}from"./index-BcSqN67S.js";import{analyzePLDocumentWithVision as me}from"./geminiAIService-DQoIspWT.js";import{L as K}from"./loader-circle-zlJjn_E2.js";import{A as ue}from"./arrow-right-BEJ899Mp.js";import{S as xe}from"./scale-BUeyyMAu.js";import{A as _e}from"./arrow-left-DdT9VhUy.js";import{S as pe}from"./save-BCLCohis.js";const T={async getByYear(a,l,r){const{data:c,error:s}=await f.from("yearly_settlements").select("*").eq("user_id",a).eq("business_type",l).eq("year",r).single();if(s){if(s.code==="PGRST116")return null;throw console.error("getYearlySettlement Error:",s),s}return c},async getAllByBusinessType(a,l){const{data:r,error:c}=await f.from("yearly_settlements").select("*").eq("user_id",a).eq("business_type",l).order("year",{ascending:!1});if(c)throw console.error("getAllYearlySettlements Error:",c),c;return r||[]},async getLatest(a,l){const{data:r,error:c}=await f.from("yearly_settlements").select("*").eq("user_id",a).eq("business_type",l).order("year",{ascending:!1}).limit(1).maybeSingle();if(c)throw console.error("getLatestYearlySettlement Error:",c),c;return r},async save(a){console.log("--- yearlySettlementService.save Start ---",a);const{data:l,error:r}=await f.from("yearly_settlements").upsert({...a,updated_at:new Date().toISOString()},{onConflict:"user_id,business_type,year"}).select().single();if(r)throw console.error("saveYearlySettlement Error Full:",r),console.error("Error Details:",r.details),console.error("Error Hint:",r.hint),console.error("Error Code:",r.code),r;return console.log("saveYearlySettlement Success:",l),l},mapAiResultToSettlement(a,l,r,c={}){console.log("--- AI Result Mapping Start ---"),console.log("Raw AI Result:",JSON.stringify(a,null,2));const s=o=>{if(o==null||o==="")return 0;if(typeof o=="number")return o;const m=o;let i=String(o).replace(/[$,¥円\s,()]/g,""),h=!1;(i.startsWith("△")||i.startsWith("▲")||i.startsWith("-"))&&(h=!0,i=i.substring(1));let g=1;i.includes("千万")?(g=1e7,i=i.replace("千万","")):i.includes("百万")?(g=1e6,i=i.replace("百万","")):i.includes("千")?(g=1e3,i=i.replace("千","")):i.includes("万")&&(g=1e4,i=i.replace("万",""));const k=parseFloat(i),S=isNaN(k)?0:k*g,C=h?-S:S;return isNaN(k)&&console.warn(`parseNum: Could not parse "${m}" as number`),Math.floor(C)},n=o=>{if(!(!a||typeof a!="object"))for(const m of o){if(a[m]!==void 0&&a[m]!==null)return a[m];const i=m.toLowerCase(),h=Object.keys(a).find(g=>g.toLowerCase()===i);if(h)return a[h]}},p=o=>Array.isArray(o)?o.map(m=>({category:String(m.category||m.name||m.項目||m.科目||"その他").trim(),amount:s(m.amount||m.value||m.price||m.金額)})).filter(m=>m.category&&m.amount!==0):[],u={user_id:l,business_type:r,year:s(n(["year","年度","決算年度","target_year"]))||new Date().getFullYear()-1,revenue:s(n(["revenue","sales","total_revenue","売上","売上高","収入金額","営業収益"])),cost_of_sales:s(n(["cost_of_sales","purchases","売上原価","仕入","仕入高","当期商品仕入高"])),operating_expenses:s(n(["operating_expenses","expenses","sga_expenses","販管費","販売費及び一般管理費","経費合計","営業費用"])),non_operating_income:s(n(["non_operating_income","営業外収益"])),non_operating_expenses:s(n(["non_operating_expenses","営業外費用","営業外支出"])),extraordinary_income:s(n(["extraordinary_income","特別利益","特別収益"])),extraordinary_loss:s(n(["extraordinary_loss","特別損失","特別支出"])),income_before_tax:s(n(["income_before_tax","税引前当期純利益","税金等調整前当期純利益"])),net_income:s(n(["net_income","profit","net_profit","当期純利益","利益"])),balance_sheet:{retained_earnings:s(n(["retained_earnings","net_assets_retained_earnings","利益剰余金","繰越利益剰余金","利益積立金"])),capital:s(n(["capital","net_assets_capital","資本金","資本金等の額"])),assets_current_cash:s(n(["assets_current_cash","cash","cash_and_equivalents","現金預金","現預金"])),assets_current_receivable:s(n(["assets_current_receivable","receivable","accounts_receivable","売掛金"])),assets_current_inventory:s(n(["assets_current_inventory","inventory","棚卸資産","商品"])),assets_fixed_total:s(n(["assets_fixed_total","fixed_assets","tangible_fixed_assets","有形固定資産"])),liabilities_current_payable:s(n(["liabilities_current_payable","payable","accounts_payable","買掛金"])),liabilities_short_term_loans:s(n(["liabilities_short_term_loans","short_term_loans","短期借入金"])),liabilities_long_term_loans:s(n(["liabilities_long_term_loans","long_term_loans","長期借入金"])),assets_total:s(n(["assets_total","資産の部合計","資産合計"])),liabilities_total:s(n(["liabilities_total","負債の部合計","負債合計"])),net_assets_total:s(n(["net_assets_total","純資産の部合計","純資産合計","自己資本"]))},category_breakdown:p(a.category_breakdown||a.items||a.内訳||a.項目別||[]),status:"draft",metadata:{...c,confidence:a.confidence}};return console.log("Mapped Settlement Data:",u),console.log("--- AI Result Mapping End ---"),u},async delete(a){const{error:l}=await f.from("yearly_settlements").delete().eq("id",a);if(l)throw console.error("deleteYearlySettlement Error:",l),l},async updateStatus(a,l){const{error:r}=await f.from("yearly_settlements").update({status:l,updated_at:new Date().toISOString()}).eq("id",a);if(r)throw console.error("updateStatus Settlement Error:",r),r}},we={async getByYear(a,l,r){const{data:c,error:s}=await f.from("yearly_balance_sheets").select("*").eq("user_id",a).eq("business_type",l).eq("year",r).single();if(s){if(s.code==="PGRST116")return null;throw console.error("getYearlyBalanceSheet Error:",s),s}return c},async getAllByBusinessType(a,l){const{data:r,error:c}=await f.from("yearly_balance_sheets").select("*").eq("user_id",a).eq("business_type",l).order("year",{ascending:!1});if(c)throw console.error("getAllYearlyBalanceSheets Error:",c),c;return r||[]},async save(a){console.log("--- yearlyBalanceSheetService.save Start ---",a);const{data:l,error:r}=await f.from("yearly_balance_sheets").upsert({...a,updated_at:new Date().toISOString()},{onConflict:"user_id,business_type,year"}).select().single();if(r)throw console.error("saveYearlyBalanceSheet Error Full:",r),console.error("Error Details:",r.details),console.error("Error Hint:",r.hint),console.error("Error Code:",r.code),r;return console.log("saveYearlyBalanceSheet Success:",l),l},mapAiResultToBS(a,l,r,c={}){console.log("--- BS Result Mapping Start ---");const s=u=>{if(u==null||u==="")return 0;if(typeof u=="number")return u;let o=String(u).replace(/[$,¥円\s,()]/g,""),m=!1;(o.startsWith("△")||o.startsWith("▲")||o.startsWith("-"))&&(m=!0,o=o.substring(1));let i=1;o.includes("千万")?i=1e7:o.includes("百万")?i=1e6:o.includes("千")?i=1e3:o.includes("万")&&(i=1e4);const h=parseFloat(o.replace(/[千万万円]/g,"")),g=isNaN(h)?0:h*i;return Math.floor(m?-g:g)},n=u=>{if(!(!a||typeof a!="object"))for(const o of u){if(a[o]!==void 0&&a[o]!==null)return a[o];const m=o.toLowerCase(),i=Object.keys(a).find(h=>h.toLowerCase()===m);if(i)return a[i]}},p={user_id:l,business_type:r,year:s(n(["year","年度","決算年度"]))||new Date().getFullYear()-1,assets_current_cash:s(n(["assets_current_cash","現金及び預金","現金預金"])),assets_current_receivable:s(n(["assets_current_receivable","売掛金"])),assets_current_inventory:s(n(["assets_current_inventory","棚卸資産","商品"])),assets_current_total:s(n(["assets_current_total","流動資産合計"])),assets_fixed_total:s(n(["assets_fixed_total","固定資産合計","有形固定資産"])),assets_total:s(n(["assets_total","資産の部合計","資産合計"])),liabilities_current_payable:s(n(["liabilities_current_payable","買掛金"])),liabilities_short_term_loans:s(n(["liabilities_short_term_loans","短期借入金"])),liabilities_long_term_loans:s(n(["liabilities_long_term_loans","長期借入金"])),liabilities_total:s(n(["liabilities_total","負債の部合計","負債合計","負債及び欠損金合計"])),net_assets_capital:s(n(["net_assets_capital","資本金"])),net_assets_retained_earnings:s(n(["net_assets_retained_earnings","繰越利益剰余金"])),net_assets_retained_earnings_total:s(n(["net_assets_retained_earnings_total","利益剰余金合計","その他利益剰余金合計"])),net_assets_shareholders_equity:s(n(["net_assets_shareholders_equity","株主資本合計"])),net_assets_total:s(n(["net_assets_total","純資産の部合計","純資産合計"])),liabilities_and_net_assets_total:s(n(["liabilities_and_net_assets_total","負債及び純資産の部合計","負債純資産合計"])),status:"draft",metadata:{...c,confidence:a.confidence}};return console.log("Mapped BS Data:",p),p},async updateStatus(a,l){const{error:r}=await f.from("yearly_balance_sheets").update({status:l,updated_at:new Date().toISOString()}).eq("id",a);if(r)throw console.error("updateStatus BS Error:",r),r},async delete(a){const{error:l}=await f.from("yearly_balance_sheets").delete().eq("id",a);if(l)throw console.error("deleteYearlyBS Error:",l),l}},he={async uploadFinancialDocument(a,l,r,c){try{const s=l.name.split(".").pop(),n=`${r}_${c}_${Date.now()}.${s}`,p=`${a}/${n}`;console.log("Uploading file to:",p);const{data:u,error:o}=await f.storage.from("financial_documents").upload(p,l,{cacheControl:"3600",upsert:!1});if(o)throw console.error("Storage Upload Error:",o),o;return console.log("File uploaded successfully:",u.path),u.path}catch(s){throw console.error("uploadFinancialDocument Error:",s),s}},async getSignedUrl(a){try{if(!a)return null;const{data:l,error:r}=await f.storage.from("financial_documents").createSignedUrl(a,3600);return r?(console.error("Get Signed URL Error:",r),null):l.signedUrl}catch(l){return console.error("getSignedUrl Error:",l),null}}},Se=({isOpen:a,onClose:l,userId:r,businessType:c,onImportSuccess:s,initialData:n})=>{var B,q,Y,P,L,$,M,U,G,W;const[p,u]=N.useState(1),[o,m]=N.useState(!1),[i,h]=N.useState(!1),[g,k]=N.useState(!1),[S,C]=N.useState(null),[J,D]=N.useState(!1),E=N.useRef(null),[d,y]=N.useState({user_id:r,business_type:c,year:new Date().getFullYear()-1,revenue:0,cost_of_sales:0,operating_expenses:0,non_operating_income:0,non_operating_expenses:0,extraordinary_income:0,extraordinary_loss:0,income_before_tax:0,net_income:0,category_breakdown:[],metadata:{},document_path:void 0,status:"draft"});if(N.useEffect(()=>{if(a){if(n){const{id:t,created_at:x,updated_at:_,...b}=n;y({...b,user_id:r}),D(!0),u(2)}else u(1),C(null),D(!1),y({user_id:r,business_type:c,year:new Date().getFullYear()-1,revenue:0,cost_of_sales:0,operating_expenses:0,non_operating_income:0,non_operating_expenses:0,extraordinary_income:0,extraordinary_loss:0,income_before_tax:0,net_income:0,category_breakdown:[],metadata:{},document_path:void 0,status:"draft"});m(!1),h(!1)}},[a,r,c,n]),!a)return null;const F=async t=>{if(!t)return;const x=t.type.startsWith("image/"),_=t.type==="application/pdf";if(!x&&!_){w.error("画像ファイル（JPG/PNG）またはPDFファイルのみ対応しています");return}C(t),m(!0);try{const b=new FileReader;b.onloadend=async()=>{const I=b.result,O=await me(I);if(O){const ne=T.mapAiResultToSettlement(O,r,c,{fileName:t.name});y(ne),u(2),w.success("解析が完了しました。内容を確認してください。")}else w.error("解析に失敗しました。手動で入力してください。"),u(2);m(!1)},b.readAsDataURL(t)}catch(b){console.error("File Analysis Error:",b),w.error("解析中にエラーが発生しました"),m(!1),u(2)}},H=t=>{var _;const x=(_=t.target.files)==null?void 0:_[0];x&&F(x)},X=t=>{t.preventDefault(),t.stopPropagation(),!o&&p===1&&k(!0)},Q=t=>{t.preventDefault(),t.stopPropagation(),k(!1)},Z=t=>{var x;if(t.preventDefault(),t.stopPropagation(),k(!1),!o&&p===1){const _=(x=t.dataTransfer.files)==null?void 0:x[0];_&&F(_)}},R=async()=>{h(!0);try{if(!d.year||d.year<2e3||d.year>2100){w.error("有効な年度を入力してください"),h(!1);return}let t;if(S)try{w.loading("ファイルをアップロード中...",{id:"upload-toast"}),t=await he.uploadFinancialDocument(r,S,d.year,"pl"),t&&w.success("ファイルのアップロード完了",{id:"upload-toast"})}catch(_){console.error("File Upload Error:",_),w.error("ファイルのアップロードに失敗しました",{id:"upload-toast"})}const x={...d,document_path:t||d.document_path};await T.save(x),s(),u(3),h(!1)}catch(t){console.error("Save Error:",t),w.error("保存に失敗しました"),h(!1)}},ee=()=>{C(null),y({...d,year:new Date().getFullYear()-1}),u(2)},te=()=>{u(1),C(null),y({...d,year:new Date().getFullYear()-1,revenue:0,cost_of_sales:0,operating_expenses:0,non_operating_income:0,non_operating_expenses:0,extraordinary_income:0,extraordinary_loss:0,income_before_tax:0,net_income:0,category_breakdown:[],balance_sheet:{assets_current_cash:0,assets_current_receivable:0,assets_current_inventory:0,assets_fixed_total:0,liabilities_current_payable:0,liabilities_short_term_loans:0,liabilities_long_term_loans:0,assets_total:0,liabilities_total:0,net_assets_total:0},document_path:void 0,status:"draft"})},v=(t,x)=>{y(_=>({..._,balance_sheet:{..._.balance_sheet||{},[t]:x}}))},j=(t,x)=>{y(_=>({..._,[t]:x}))},se=()=>{y(t=>({...t,category_breakdown:[...t.category_breakdown,{category:"",amount:0,percentage:0}]}))},A=(t,x,_)=>{y(b=>{const I=[...b.category_breakdown];return I[t]={...I[t],[x]:_},{...b,category_breakdown:I}})},ae=t=>{y(x=>({...x,category_breakdown:x.category_breakdown.filter((_,b)=>b!==t)}))},re=()=>e.jsx("div",{className:"flex items-center justify-center mb-8",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`
                        flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm
                        ${p>=t?"bg-primary text-white":"bg-surface-highlight text-text-muted"}
                        transition-colors duration-300
                    `,children:p>t?e.jsx(z,{className:"w-5 h-5"}):t}),e.jsxs("span",{className:`ml-2 text-sm font-medium ${p>=t?"text-text-main":"text-text-muted"}`,children:[t===1&&"アップロード",t===2&&"データ確認",t===3&&"完了"]}),t<3&&e.jsx("div",{className:`w-12 h-0.5 mx-4 ${p>t?"bg-primary":"bg-surface-highlight"}`})]},t))});return e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface border border-border rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col shadow-2xl",onDragOver:X,onDragLeave:Q,onDrop:Z,children:[e.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-text-main flex items-center",children:[e.jsx(V,{className:"w-5 h-5 mr-2 text-primary"}),c==="corporation"?"前年度決算データのインポート":"前年度申告データのインポート"]}),e.jsx("button",{onClick:l,className:"text-text-muted hover:text-text-main transition-colors",children:e.jsx(le,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[re(),p===1&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[400px]",children:[e.jsxs("div",{onClick:()=>{var t;return(t=E.current)==null?void 0:t.click()},className:`
                                    w-full max-w-2xl text-center p-12 rounded-2xl border-2 border-dashed cursor-pointer transition-all duration-300
                                    ${g?"border-primary bg-primary/10 scale-[1.02]":"border-border hover:border-primary/50 hover:bg-surface-highlight"}
                                `,children:[e.jsx("input",{type:"file",ref:E,className:"hidden",accept:"image/*,.pdf",onChange:H}),e.jsx("div",{className:"bg-primary/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",children:o?e.jsx(K,{className:"w-10 h-10 text-primary animate-spin"}):e.jsx(oe,{className:"w-10 h-10 text-primary"})}),e.jsx("h3",{className:"text-xl font-bold text-text-main mb-2",children:o?"AI解析中...":c==="corporation"?"決算書をアップロード":"申告・決算書をアップロード"}),e.jsx("p",{className:"text-text-muted mb-6",children:o?"画像を解析してデータを抽出しています":"PDFまたは画像ファイル（JPG/PNG）をドラッグ＆ドロップ"}),!o&&e.jsx("button",{className:"btn-primary px-8 py-3 rounded-full shadow-lg hover:shadow-primary/25",children:"ファイルを選択"})]}),e.jsxs("div",{className:"mt-8 flex items-center w-full max-w-2xl",children:[e.jsx("div",{className:"h-px bg-border flex-1"}),e.jsx("span",{className:"px-4 text-text-muted text-sm",children:"または"}),e.jsx("div",{className:"h-px bg-border flex-1"})]}),e.jsxs("button",{onClick:ee,className:"mt-8 flex items-center text-text-muted hover:text-primary transition-colors font-medium group",children:["手動で入力する",e.jsx(ue,{className:"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"})]})]}),p===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface-highlight/30 rounded-lg p-4 mb-6 border border-border/50",children:[e.jsxs("h3",{className:"text-sm font-semibold text-text-main mb-2 flex items-center",children:[e.jsx(ie,{className:"w-4 h-4 text-primary mr-2"}),"データ確認・修正"]}),e.jsx("p",{className:"text-sm text-text-muted",children:J?"データを修正して保存してください。":S?"AI解析によって抽出されたデータです。誤りがないか確認し、必要に応じて修正してください。":"手動でデータを入力してください。"}),S&&e.jsxs("div",{className:"mt-3 flex items-center text-xs text-text-muted bg-surface/50 p-2 rounded border border-border",children:[e.jsx(V,{className:"w-3 h-3 mr-2"}),"参照ファイル: ",S.name]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"対象年度"}),e.jsx("input",{type:"number",value:d.year,onChange:t=>j("year",parseInt(t.target.value)),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"売上高"}),e.jsx("input",{type:"number",value:d.revenue,onChange:t=>j("revenue",parseInt(t.target.value)),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"売上原価"}),e.jsx("input",{type:"number",value:d.cost_of_sales,onChange:t=>j("cost_of_sales",parseInt(t.target.value)),className:"input-field"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"販売費及び一般管理費"}),e.jsx("input",{type:"number",value:d.operating_expenses,onChange:t=>j("operating_expenses",parseInt(t.target.value)),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"営業外収益"}),e.jsx("input",{type:"number",value:d.non_operating_income,onChange:t=>j("non_operating_income",parseInt(t.target.value)),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"営業外費用"}),e.jsx("input",{type:"number",value:d.non_operating_expenses,onChange:t=>j("non_operating_expenses",parseInt(t.target.value)),className:"input-field"})]})]})]}),e.jsxs("div",{className:"bg-surface-highlight/10 rounded-xl p-5 border border-border mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-text-main flex items-center",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500 mr-2"}),"主要カテゴリ別内訳（任意）"]}),e.jsxs("button",{onClick:se,className:"text-xs flex items-center text-primary hover:text-primary-light transition-colors",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),"カテゴリを追加"]})]}),e.jsxs("div",{className:"space-y-3",children:[d.category_breakdown.map((t,x)=>e.jsxs("div",{className:"flex items-center gap-3 bg-surface-highlight/20 p-3 rounded-lg border border-border/50 group",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"カテゴリ名（例: 商品売上）",value:t.category,onChange:_=>A(x,"category",_.target.value),className:"w-full bg-transparent border-none p-0 text-sm focus:ring-0 text-text-main placeholder-text-muted/50"})}),e.jsxs("div",{className:"w-32 relative",children:[e.jsx("span",{className:"absolute left-2 top-1/2 -translate-y-1/2 text-text-muted text-xs",children:"¥"}),e.jsx("input",{type:"number",placeholder:"金額",value:t.amount,onChange:_=>A(x,"amount",parseInt(_.target.value)),className:"w-full bg-surface-highlight/50 border border-border rounded-md pl-6 pr-2 py-1 text-right text-sm font-mono focus:ring-1 focus:ring-primary"})]}),e.jsx("button",{onClick:()=>ae(x),className:"w-6 h-6 flex items-center justify-center text-text-muted hover:text-red-500 hover:bg-red-500/10 rounded opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(de,{className:"w-4 h-4"})})]},x)),d.category_breakdown.length===0&&e.jsx("p",{className:"text-xs text-text-muted text-center py-4 border-2 border-dashed border-border/50 rounded-lg",children:"内訳を登録すると、統計比較がより詳細になります。"})]})]}),e.jsxs("div",{className:"bg-primary/5 rounded-xl p-5 border border-primary/20 mt-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-text-main flex items-center",children:[e.jsx(xe,{className:"w-4 h-4 text-primary mr-2"}),"資産・負債の状態（B/S）"]}),e.jsx("span",{className:"ml-2 text-[10px] text-primary bg-primary/10 px-1.5 py-0.5 rounded",children:"AI抽出"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"現預金"}),e.jsx("input",{type:"number",value:((B=d.balance_sheet)==null?void 0:B.assets_current_cash)||0,onChange:t=>v("assets_current_cash",parseInt(t.target.value)||0),className:"input-field h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"売掛金"}),e.jsx("input",{type:"number",value:((q=d.balance_sheet)==null?void 0:q.assets_current_receivable)||0,onChange:t=>v("assets_current_receivable",parseInt(t.target.value)||0),className:"input-field h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"棚卸資産"}),e.jsx("input",{type:"number",value:((Y=d.balance_sheet)==null?void 0:Y.assets_current_inventory)||0,onChange:t=>v("assets_current_inventory",parseInt(t.target.value)||0),className:"input-field h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"固定資産"}),e.jsx("input",{type:"number",value:((P=d.balance_sheet)==null?void 0:P.assets_fixed_total)||0,onChange:t=>v("assets_fixed_total",parseInt(t.target.value)||0),className:"input-field h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"買掛金"}),e.jsx("input",{type:"number",value:((L=d.balance_sheet)==null?void 0:L.liabilities_current_payable)||0,onChange:t=>v("liabilities_current_payable",parseInt(t.target.value)||0),className:"input-field h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"短期借入"}),e.jsx("input",{type:"number",value:(($=d.balance_sheet)==null?void 0:$.liabilities_short_term_loans)||0,onChange:t=>v("liabilities_short_term_loans",parseInt(t.target.value)||0),className:"input-field h-8 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-text-muted mb-1",children:"長期借入"}),e.jsx("input",{type:"number",value:((M=d.balance_sheet)==null?void 0:M.liabilities_long_term_loans)||0,onChange:t=>v("liabilities_long_term_loans",parseInt(t.target.value)||0),className:"input-field h-8 text-sm"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"資産合計"}),e.jsx("input",{type:"number",value:((U=d.balance_sheet)==null?void 0:U.assets_total)||0,onChange:t=>v("assets_total",parseInt(t.target.value)||0),className:"input-field",placeholder:"資産の部 合計"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"負債合計"}),e.jsx("input",{type:"number",value:((G=d.balance_sheet)==null?void 0:G.liabilities_total)||0,onChange:t=>v("liabilities_total",parseInt(t.target.value)||0),className:"input-field",placeholder:"負債の部 合計"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-primary mb-1",children:"純資産合計 (Net Assets)"}),e.jsx("input",{type:"number",value:((W=d.balance_sheet)==null?void 0:W.net_assets_total)||0,onChange:t=>v("net_assets_total",parseInt(t.target.value)||0),className:"input-field border-primary/50 bg-white font-bold",placeholder:"自己資本 / 元入金"})]})]}),e.jsx("p",{className:"text-[10px] text-text-muted mt-2",children:"※ 損益計算書のみの書類でも、下部に「純資産」等の記載があればAIが自動的に抽出します。"})]}),e.jsx("div",{className:"border-t border-border pt-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"特別利益"}),e.jsx("input",{type:"number",value:d.extraordinary_income,onChange:t=>j("extraordinary_income",parseInt(t.target.value)),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-muted mb-1",children:"特別損失"}),e.jsx("input",{type:"number",value:d.extraordinary_loss,onChange:t=>j("extraordinary_loss",parseInt(t.target.value)),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-primary mb-1",children:"当期純利益"}),e.jsx("input",{type:"number",value:d.net_income,onChange:t=>j("net_income",parseInt(t.target.value)),className:"input-field border-primary/50 bg-primary/5 font-bold"})]})]})})]}),p===3&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-green-500/10 rounded-full flex items-center justify-center mb-6",children:e.jsx(z,{className:"w-10 h-10 text-green-500"})}),e.jsx("h3",{className:"text-2xl font-bold text-text-main mb-2",children:"インポート完了"}),e.jsxs("p",{className:"text-text-muted mb-8 text-center max-w-md",children:["前年度",c==="corporation"?"決算データ":"申告データ","の保存が完了しました。",e.jsx("br",{}),"経営分析の比較データとして利用されます。"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:l,className:"btn-ghost",children:"閉じる"}),e.jsx("button",{onClick:te,className:"btn-primary",children:"続けてインポートする"})]})]})]}),p===2&&e.jsxs("div",{className:"px-6 py-4 border-t border-border flex items-center justify-between bg-surface-highlight/30",children:[e.jsxs("button",{onClick:()=>u(1),className:"flex items-center text-text-muted hover:text-text-main transition-colors",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"戻る"]}),e.jsx("button",{onClick:R,disabled:i,className:"btn-primary min-w-[140px]",children:i?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),"保存中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"保存して完了"]})})]})]})})};export{Se as P,we as a,he as s,T as y};
