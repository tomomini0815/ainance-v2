import{e as q,a as J,l as z,m as A,r as I,j as e,L as V,C as E,P as H,H as G,F as L,J as K}from"./index-C8W6MraP.js";import{T}from"./TransactionIcon-CSveWpu5.js";import{R as Q}from"./ReceiptResultModal-Bjz3FLHF.js";import{R as _}from"./repeat-CsGo_ued.js";import"./rotate-ccw-C1Uiy30L.js";const U=({transactions:C,onOpenCreateModal:M,showCreateButton:D=!0,disableEdit:y=!1})=>{const{currentBusinessType:r}=q(),{user:j}=J(),{transactions:S,loading:F,fetchTransactions:c}=z(j==null?void 0:j.id,r==null?void 0:r.business_type),[N,w]=A.useState(null);I.useEffect(()=>{r!=null&&r.id&&c()},[r,c]),I.useEffect(()=>{const t=()=>{r!=null&&r.id&&c()},s=()=>{r!=null&&r.id&&c()};return window.addEventListener("transactionRecorded",t),window.addEventListener("transactionApproved",s),()=>{window.removeEventListener("transactionRecorded",t),window.removeEventListener("transactionApproved",s)}},[r,c]);const P=[...Array.isArray(C)?C:S].filter(t=>t.approval_status!=="pending").sort((t,s)=>new Date(s.date).getTime()-new Date(t.date).getTime()),[i,$]=A.useState(1),v=8,o=Math.ceil(P.length/v),b=P.slice((i-1)*v,i*v),k=t=>{$(t)},R=t=>{let s=[];if(t.description&&t.description.includes("【内訳】")){const d=t.description.split("【内訳】")[1];d&&(s=d.trim().split(`
`).map(a=>{const n=a.match(/・(.+): ¥([\d,]+)/);return n?{name:n[1].trim(),price:parseInt(n[2].replace(/,/g,"")),line_total:parseInt(n[2].replace(/,/g,"")),qty:1}:null}).filter(a=>a!==null))}const l={merchant:t.item,date:t.date.split("T")[0],amount:Math.abs(t.amount),category:t.category,taxRate:10,confidence:100,items:s};w({id:t.id,data:l})};return F?e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-6 border border-border shadow-sm transition-all duration-200 hover:shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main",children:"最近の履歴"}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("div",{className:"h-4 w-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"})})]}),e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((t,s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-800 rounded-lg animate-pulse",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-3 w-16 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 dark:bg-gray-700 rounded"})]},s))})]}):e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-4 border border-border shadow-sm transition-all duration-200 hover:shadow-md h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-text-main",children:"取引履歴"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(V,{to:"/transaction-history",className:"flex items-center text-sm text-primary hover:text-primary/80 font-medium transition-colors",children:["詳細一覧",e.jsx(E,{className:"w-4 h-4 ml-1"})]}),D&&M&&e.jsxs("button",{onClick:M,className:"flex items-center px-3 py-1.5 bg-primary text-white text-sm rounded-lg hover:bg-primary/90 transition-colors shadow-lg shadow-primary/20",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"新規作成"]})]})]}),N&&e.jsx(Q,{mode:"edit",transactionId:N.id,receiptData:N.data,onClose:()=>w(null),onSave:()=>{c(),w(null)}}),e.jsx("div",{className:"block md:hidden flex-1 min-h-0 overflow-y-auto custom-scrollbar space-y-3",children:b.length>0?b.slice(0,5).map(t=>{var m,h,p,u;let s=0;if(typeof t.amount=="string"?s=parseFloat(t.amount):typeof t.amount=="number"&&(s=t.amount),(m=t.tags)!=null&&m.includes("depreciation_asset")){const g=(h=t.description)==null?void 0:h.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(g)s=parseInt(g[1].replace(/,/g,""),10);else{const f=(p=t.description)==null?void 0:p.match(/年間償却費: ¥([\d,]+)/);f&&(s=parseInt(f[1].replace(/,/g,""),10))}}const l=!isNaN(s)&&isFinite(s),x=t.type==="income",d=t.type==="expense",a=x?!0:d?!1:l&&s>0,n=(u=t.tags)==null?void 0:u.includes("depreciation_asset");return e.jsxs("div",{onClick:()=>!y&&R(t),className:`${y?"cursor-default":"cursor-pointer active:scale-[0.98]"} bg-surface-highlight rounded-xl p-2.5 border border-border hover:border-primary/50 transition-all relative group`,children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-400 mb-2 px-0.5 font-medium uppercase tracking-wider",children:[e.jsx(G,{className:"w-2.5 h-2.5 opacity-40"}),e.jsx("span",{children:new Date(t.date).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsx(T,{item:t.item,category:t.category,size:"xs"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 min-w-0",children:[e.jsx("div",{className:"font-medium text-text-main text-sm truncate",children:t.item}),t.recurring&&e.jsxs("div",{className:"flex items-center gap-1 px-1 py-0.5 rounded bg-primary/10 text-primary text-[8px] font-bold border border-primary/20 shrink-0",children:[e.jsx(_,{className:"w-2 h-2"}),e.jsx("span",{children:{daily:"毎日",weekly:"毎週",monthly:"毎月",yearly:"毎年"}[t.recurring_frequency||"monthly"]})]})]})]}),e.jsx("div",{className:"text-right ml-3 shrink-0",children:e.jsxs("div",{className:`font-bold text-base ${a?"text-green-500":n?"text-primary":"text-slate-900 dark:text-white"}`,children:[a?"+":"-"," ",l?Math.abs(s).toLocaleString():"N/A","円"]})})]}),e.jsx("div",{className:"flex items-center justify-between min-w-0",children:e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("span",{className:"inline-flex px-2.5 py-0.5 text-[10px] font-medium rounded-full bg-surface-highlight text-gray-400 border border-white/5 truncate max-w-[120px]",children:t.category})})})]},t.id)}):e.jsx("div",{className:"py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-surface-highlight flex items-center justify-center mb-3",children:e.jsx(L,{className:"w-6 h-6 text-slate-600"})}),e.jsx("p",{className:"text-text-muted text-sm",children:"取引がありません"})]})})}),e.jsx("div",{className:"hidden md:block flex-1 min-h-0 overflow-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-2 px-3 text-[10px] font-bold text-slate-500 dark:text-text-muted uppercase tracking-wider",children:"項目"}),e.jsx("th",{className:"text-right py-2 px-3 text-[10px] font-bold text-slate-500 dark:text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"text-left py-2 px-3 text-[10px] font-bold text-slate-500 dark:text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"text-center py-2 px-3 text-[10px] font-bold text-slate-500 dark:text-text-muted uppercase tracking-wider",children:"カテゴリ"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:b.length>0?b.map(t=>{var m,h,p,u;let s=0;if(typeof t.amount=="string"?s=parseFloat(t.amount):typeof t.amount=="number"&&(s=t.amount),(m=t.tags)!=null&&m.includes("depreciation_asset")){const g=(h=t.description)==null?void 0:h.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(g)s=parseInt(g[1].replace(/,/g,""),10);else{const f=(p=t.description)==null?void 0:p.match(/年間償却費: ¥([\d,]+)/);f&&(s=parseInt(f[1].replace(/,/g,""),10))}}const l=!isNaN(s)&&isFinite(s),x=t.type==="income",d=t.type==="expense",a=x?!0:d?!1:l&&s>0,n=(u=t.tags)==null?void 0:u.includes("depreciation_asset");return e.jsxs("tr",{className:`hover:bg-white/5 transition-colors group ${y?"cursor-default":"cursor-pointer"}`,onClick:()=>!y&&R(t),children:[e.jsx("td",{className:"py-2.5 px-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{item:t.item,category:t.category,size:"xs"}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-text-main text-xs group-hover:text-primary dark:group-hover:text-white transition-colors",children:t.item}),t.recurring&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded bg-primary/10 text-primary text-[10px] font-bold border border-primary/20",children:[e.jsx(_,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:{daily:"毎日",weekly:"毎週",monthly:"毎月",yearly:"毎年"}[t.recurring_frequency||"monthly"]})]})]})})]})}),e.jsx("td",{className:"py-2.5 px-3 text-right font-medium",children:e.jsxs("span",{className:`${a?"text-green-600 dark:text-green-500":n?"text-primary":"text-slate-900 dark:text-white"}`,children:[a?"+":"-",l?Math.abs(s).toLocaleString():"N/A","円"]})}),e.jsx("td",{className:"py-2.5 px-3 text-xs text-text-muted",children:new Date(t.date).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}),e.jsx("td",{className:"py-2.5 px-3 text-center",children:e.jsx("span",{className:"whitespace-nowrap inline-flex px-2 py-0.5 text-[10px] font-bold rounded-full bg-slate-100 dark:bg-surface-highlight text-slate-600 dark:text-gray-300 border border-slate-200 dark:border-white/5",children:t.category})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-surface-highlight flex items-center justify-center mb-3",children:e.jsx(L,{className:"w-6 h-6 text-slate-600"})}),e.jsx("p",{className:"text-text-muted text-sm",children:"取引がありません"})]})})})})]})}),o>1&&e.jsxs("div",{className:"flex items-center justify-center mt-6 space-x-2",children:[e.jsx("button",{onClick:()=>k(Math.max(1,i-1)),disabled:i===1,className:`p-2 rounded-lg transition-colors ${i===1?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-text-secondary hover:bg-surface-highlight"}`,children:e.jsx(K,{className:"w-4 h-4"})}),(()=>{let t=Math.max(1,i-2),s=Math.min(o,t+4);s-t<4&&(t=Math.max(1,s-4));const l=Array.from({length:s-t+1}).map((x,d)=>{const a=t+d;return e.jsx("button",{onClick:()=>k(a),className:`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-medium transition-all ${i===a?"bg-primary text-white shadow-lg shadow-primary/25 hover:bg-primary/90":"bg-surface text-text-muted hover:bg-surface-highlight hover:text-text-main border border-border"}`,children:a},a)});return s<o&&l.push(e.jsx("span",{className:"w-8 h-8 flex items-center justify-center text-text-muted",children:"..."},"ellipsis")),l})(),e.jsx("button",{onClick:()=>k(Math.min(o,i+1)),disabled:i===o,className:`p-2 rounded-lg transition-colors ${i===o?"text-gray-300 cursor-not-allowed":"text-text-muted hover:text-text-secondary hover:bg-surface-highlight"}`,children:e.jsx(E,{className:"w-4 h-4"})})]})]})};export{U as default};
