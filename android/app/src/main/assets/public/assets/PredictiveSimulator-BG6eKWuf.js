import{c as L,a as M,l as k,d as T,r as g,j as e,L as E,U as C,i as $,C as F,S as y}from"./index-ANsWalRW.js";import{G as _}from"./index-BpRkNtKl.js";import{A as P}from"./arrow-left-CzwRZ0lz.js";import{C as G}from"./calculator-CeXj6_6n.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]],S=L("building-2",Y),A=new _("AIzaSyCojD6WNfryAIw-hiGr-IH8jaPAlMzpQs0"),D=o=>{const s={};o.forEach(i=>{const l=i.date.substring(0,7);s[l]||(s[l]={income:0,expense:0,count:0}),i.type==="income"?s[l].income+=i.amount:s[l].expense+=Math.abs(i.amount),s[l].count++});const t=Object.keys(s);if(t.length===0)return{avgIncome:0,avgExpense:0};const r=t.reduce((i,l)=>i+s[l].income,0),n=t.reduce((i,l)=>i+s[l].expense,0);return{avgIncome:r/t.length,avgExpense:n/t.length}},O=(o,s=[])=>{const{avgIncome:t,avgExpense:r}=D(o),n=[],i=new Date;let l=0;for(let d=0;d<12;d++){const x=new Date(i.getFullYear(),i.getMonth()+d,1),m=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`,f=s.filter(a=>a.date.startsWith(m)),h=f.filter(a=>a.type==="income").reduce((a,c)=>a+c.amount,0),j=f.filter(a=>a.type==="expense").reduce((a,c)=>a+Math.abs(c.amount),0),N=h>0?h:t,b=j>0?j:r,v=N-b;l+=v,n.push({month:m,income:N,expense:b,balance:v,cumulativeBalance:l})}return n},B=(o,s)=>{const t=o.reduce((d,x)=>d+x.income,0),r=o.reduce((d,x)=>d+x.expense,0),n=t-r;let i=0,l=0;return s==="sole_proprietor"?n<=195e4?(i=n*.05,l=5):n<=33e5?(i=n*.1-97500,l=10):n<=695e4?(i=n*.2-427500,l=20):n<=9e6?(i=n*.23-636e3,l=23):n<=18e6?(i=n*.33-1536e3,l=33):(i=n*.4-2796e3,l=40):n<=8e6?(i=n*.15,l=15):(i=8e6*.15+(n-8e6)*.234,l=23.4),{estimatedIncome:t,estimatedExpense:r,estimatedProfit:n,estimatedTax:Math.max(0,i),effectiveTaxRate:l}},J=async(o,s,t)=>{try{const r=A.getGenerativeModel({model:"gemini-pro"}),n=`
あなたは日本の税務・会計の専門家です。以下の情報を基に、個人事業主が法人化すべきかどうかをアドバイスしてください。

【現在の状況】
- 現在の年間利益: ${o.toLocaleString()}円
- 予測される年間利益: ${s.toLocaleString()}円
- 現在の税額: ${t.toLocaleString()}円

【アドバイス内容】
1. 法人化すべきかどうか（true/false）
2. 最適なタイミング（具体的な月）
3. 推定節税額（年間）
4. 法人化を推奨する理由（3-5個）
5. 法人化の手順（5-7ステップ）

以下のJSON形式で回答してください：
{
  "shouldIncorporate": boolean,
  "optimalTiming": "YYYY年MM月",
  "estimatedSavings": number,
  "reasons": ["理由1", "理由2", ...],
  "steps": ["ステップ1", "ステップ2", ...]
}
`,x=(await(await r.generateContent(n)).response).text().match(/\{[\s\S]*\}/);return x?JSON.parse(x[0]):w(o,s)}catch(r){return console.error("AI法人化アドバイス生成エラー:",r),w(o,s)}},w=(o,s)=>{const t=s>=8e6,r=t?Math.max(0,o*.33-o*.234):0;return{shouldIncorporate:t,optimalTiming:t?"来年1月":"現時点では不要",estimatedSavings:r,reasons:t?["年間利益が800万円を超えており、法人税率の方が有利です","社会的信用が向上し、取引先の拡大が期待できます","経費の範囲が広がり、節税効果が高まります","事業承継や資金調達がしやすくなります"]:["現在の利益水準では個人事業主の方が税負担が少ないです","法人化には設立費用や維持コストがかかります","利益が800万円を超えたタイミングで再検討をお勧めします"],steps:t?["定款の作成と公証人の認証","資本金の払込","法務局での登記申請","税務署への届出（法人設立届出書など）","都道府県・市区町村への届出","社会保険の加入手続き","銀行口座の開設"]:[]}},z=async(o,s,t)=>{try{const r=A.getGenerativeModel({model:"gemini-pro"}),n=`
あなたは日本の税務・会計の専門家です。以下の情報を基に、法人が2社目を設立すべきかどうかをアドバイスしてください。

【現在の状況】
- 現在の年間売上: ${o.toLocaleString()}円
- 予測される年間売上: ${s.toLocaleString()}円
- 現在の税額: ${t.toLocaleString()}円

【アドバイス内容】
1. 2社目を設立すべきかどうか（true/false）
2. 最適な会社構造（持株会社、事業分割など）
3. 推定節税額（年間）
4. 2社目設立を推奨する理由（3-5個）
5. 2社目設立の手順（5-7ステップ）

以下のJSON形式で回答してください：
{
  "shouldEstablish": boolean,
  "optimalStructure": "推奨する会社構造",
  "estimatedSavings": number,
  "reasons": ["理由1", "理由2", ...],
  "steps": ["ステップ1", "ステップ2", ...]
}
`,x=(await(await r.generateContent(n)).response).text().match(/\{[\s\S]*\}/);return x?JSON.parse(x[0]):I(o,s)}catch(r){return console.error("AI 2社目設立アドバイス生成エラー:",r),I(o,s)}},I=(o,s)=>{const t=s>=5e7,r=t?s*.05:0;return{shouldEstablish:t,optimalStructure:t?"持株会社方式":"現時点では不要",estimatedSavings:r,reasons:t?["売上規模が大きく、事業分割による節税効果が期待できます","リスク分散により経営の安定性が向上します","事業ごとの損益管理が明確になります","複数の軽減税率枠を活用できます"]:["現在の売上規模では1社での運営が効率的です","2社目設立には初期費用と維持コストがかかります","売上が5,000万円を超えたタイミングで再検討をお勧めします"],steps:t?["事業分割計画の策定","新会社の定款作成","資本金の払込","法務局での登記申請","税務署への届出","既存事業の移管手続き","取引先への通知と契約変更"]:[]}},K=()=>{const{user:o}=M(),{currentBusinessType:s}=k(o==null?void 0:o.id),{transactions:t}=T(o==null?void 0:o.id,s==null?void 0:s.business_type),[r,n]=g.useState("sole_proprietor"),[i,l]=g.useState([]),[d,x]=g.useState(null),[m,f]=g.useState(null),[h,j]=g.useState(null),[N,b]=g.useState(!1);g.useEffect(()=>{t.length>0&&v()},[t,r]);const v=async()=>{b(!0);try{const a=t.map(p=>({id:p.id,date:p.date,description:p.description||p.item||"",amount:typeof p.amount=="number"?p.amount:0,category:p.category||"未分類",type:p.type})),c=O(a);l(c);const u=B(c,r);if(x(u),r==="sole_proprietor"){const p=await J(u.estimatedProfit,u.estimatedProfit,u.estimatedTax);f(p)}else{const p=await z(u.estimatedIncome,u.estimatedIncome,u.estimatedTax);j(p)}}catch(a){console.error("予測生成エラー:",a)}finally{b(!1)}};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(E,{to:"/dashboard",className:"mr-4",children:e.jsx(P,{className:"w-6 h-6 text-text-muted hover:text-text-main transition-colors"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-main",children:"予測シミュレーター"}),e.jsx("p",{className:"text-text-muted mt-1",children:"未来のキャッシュフローと最適な経営戦略を予測"})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-2 mb-6 inline-flex",children:[e.jsxs("button",{onClick:()=>n("sole_proprietor"),className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${r==="sole_proprietor"?"bg-primary text-white shadow-lg":"text-text-muted hover:text-text-main hover:bg-surface-highlight"}`,children:[e.jsx(C,{className:"w-5 h-5"}),"個人事業主"]}),e.jsxs("button",{onClick:()=>n("corporation"),className:`flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-all ${r==="corporation"?"bg-primary text-white shadow-lg":"text-text-muted hover:text-text-main hover:bg-surface-highlight"}`,children:[e.jsx(S,{className:"w-5 h-5"}),"法人"]})]}),N?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-text-muted",children:"AIが予測を生成中..."})]})}):e.jsxs(e.Fragment,{children:[d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 rounded-xl p-6 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-muted",children:"予測収入"}),e.jsx($,{className:"w-5 h-5 text-blue-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-text-main",children:["¥",d.estimatedIncome.toLocaleString()]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-500/10 to-red-600/10 rounded-xl p-6 border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-muted",children:"予測支出"}),e.jsx(F,{className:"w-5 h-5 text-red-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-text-main",children:["¥",d.estimatedExpense.toLocaleString()]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 rounded-xl p-6 border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-muted",children:"予測利益"}),e.jsx(G,{className:"w-5 h-5 text-green-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-text-main",children:["¥",d.estimatedProfit.toLocaleString()]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 rounded-xl p-6 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-muted",children:"予測税額"}),e.jsx(y,{className:"w-5 h-5 text-purple-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-text-main",children:["¥",d.estimatedTax.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-text-muted mt-1",children:["実効税率: ",d.effectiveTaxRate,"%"]})]})]}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-main mb-4",children:"12ヶ月キャッシュフロー予測"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-text-muted",children:"月"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-text-muted",children:"収入"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-text-muted",children:"支出"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-text-muted",children:"収支"}),e.jsx("th",{className:"text-right py-3 px-4 text-sm font-medium text-text-muted",children:"累計残高"})]})}),e.jsx("tbody",{children:i.map((a,c)=>e.jsxs("tr",{className:"border-b border-border hover:bg-surface-highlight transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-text-main",children:a.month}),e.jsxs("td",{className:"py-3 px-4 text-sm text-right text-green-500",children:["¥",a.income.toLocaleString()]}),e.jsxs("td",{className:"py-3 px-4 text-sm text-right text-red-500",children:["¥",a.expense.toLocaleString()]}),e.jsxs("td",{className:`py-3 px-4 text-sm text-right font-medium ${a.balance>=0?"text-green-500":"text-red-500"}`,children:["¥",a.balance.toLocaleString()]}),e.jsxs("td",{className:`py-3 px-4 text-sm text-right font-bold ${a.cumulativeBalance>=0?"text-green-500":"text-red-500"}`,children:["¥",a.cumulativeBalance.toLocaleString()]})]},c))})]})})]}),r==="sole_proprietor"&&m&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-blue-500/10 rounded-xl p-6 border border-purple-500/20 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(y,{className:"w-6 h-6 text-purple-500"}),e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"AI法人化アドバイス"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-muted",children:"法人化の推奨"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${m.shouldIncorporate?"bg-green-500/20 text-green-500":"bg-gray-500/20 text-gray-500"}`,children:m.shouldIncorporate?"推奨":"不要"})]}),m.shouldIncorporate&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-text-main mb-2",children:[e.jsx("span",{className:"font-semibold",children:"最適なタイミング:"})," ",m.optimalTiming]}),e.jsxs("p",{className:"text-text-main",children:[e.jsx("span",{className:"font-semibold",children:"推定節税額:"})," ",e.jsxs("span",{className:"text-green-500 font-bold text-lg",children:["¥",m.estimatedSavings.toLocaleString(),"/年"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main mb-2",children:"理由"}),e.jsx("ul",{className:"space-y-2",children:m.reasons.map((a,c)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-text-muted",children:[e.jsx("span",{className:"text-purple-500 mt-1",children:"•"}),e.jsx("span",{children:a})]},c))})]}),m.shouldIncorporate&&m.steps.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main mb-2",children:"法人化の手順"}),e.jsx("ol",{className:"space-y-2",children:m.steps.map((a,c)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm text-text-muted",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-purple-500/20 text-purple-500 flex items-center justify-center text-xs font-bold",children:c+1}),e.jsx("span",{children:a})]},c))})]})]})]}),r==="corporation"&&h&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-cyan-500/10 rounded-xl p-6 border border-blue-500/20 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(S,{className:"w-6 h-6 text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold text-text-main",children:"AI 2社目設立アドバイス"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-surface/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-text-muted",children:"2社目設立の推奨"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-bold ${h.shouldEstablish?"bg-green-500/20 text-green-500":"bg-gray-500/20 text-gray-500"}`,children:h.shouldEstablish?"推奨":"不要"})]}),h.shouldEstablish&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-text-main mb-2",children:[e.jsx("span",{className:"font-semibold",children:"最適な構造:"})," ",h.optimalStructure]}),e.jsxs("p",{className:"text-text-main",children:[e.jsx("span",{className:"font-semibold",children:"推定節税額:"})," ",e.jsxs("span",{className:"text-green-500 font-bold text-lg",children:["¥",h.estimatedSavings.toLocaleString(),"/年"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main mb-2",children:"理由"}),e.jsx("ul",{className:"space-y-2",children:h.reasons.map((a,c)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-text-muted",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"•"}),e.jsx("span",{children:a})]},c))})]}),h.shouldEstablish&&h.steps.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-text-main mb-2",children:"2社目設立の手順"}),e.jsx("ol",{className:"space-y-2",children:h.steps.map((a,c)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm text-text-muted",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-blue-500/20 text-blue-500 flex items-center justify-center text-xs font-bold",children:c+1}),e.jsx("span",{children:a})]},c))})]})]})]})]})]})})};export{K as default};
