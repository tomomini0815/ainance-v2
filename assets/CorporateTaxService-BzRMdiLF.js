const x={2:{straightLine:.5,decliningBalance:1},3:{straightLine:.334,decliningBalance:.667},4:{straightLine:.25,decliningBalance:.5},5:{straightLine:.2,decliningBalance:.4},6:{straightLine:.167,decliningBalance:.333},8:{straightLine:.125,decliningBalance:.25},10:{straightLine:.1,decliningBalance:.2},12:{straightLine:.084,decliningBalance:.167},15:{straightLine:.067,decliningBalance:.133},20:{straightLine:.05,decliningBalance:.1},22:{straightLine:.046,decliningBalance:.091}},M={smallBusiness:{lowerRate:.15,upperRate:.232,threshold:8e6},largeBusiness:{rate:.232}},A=.103,T={prefectural:.01,municipal:.06,perCapitaLevy:7e4},p={income400:.035,income800:.052,incomeOver:.07};function L(a,n){if(n<=1e8){const{lowerRate:t,upperRate:c,threshold:i}=M.smallBusiness;if(a<=i)return{tax:Math.floor(a*t),breakdown:{lowerBracket:Math.floor(a*t),upperBracket:0}};{const o=Math.floor(i*t),r=Math.floor((a-i)*c);return{tax:o+r,breakdown:{lowerBracket:o,upperBracket:r}}}}else{const t=Math.floor(a*M.largeBusiness.rate);return{tax:t,breakdown:{lowerBracket:0,upperBracket:t}}}}function R(a){return Math.floor(a*A)}function E(a){const n=Math.floor(a*T.prefectural),e=Math.floor(a*T.municipal),t=T.perCapitaLevy;return{prefecturalTax:n,municipalTax:e,perCapitaLevy:t,total:n+e+t}}function C(a){if(a<=0)return 0;let n=0;return a<=4e6?n=Math.floor(a*p.income400):a<=8e6?(n=Math.floor(4e6*p.income400),n+=Math.floor((a-4e6)*p.income800)):(n=Math.floor(4e6*p.income400),n+=Math.floor(4e6*p.income800),n+=Math.floor((a-8e6)*p.incomeOver)),n}function y(a,n){const e=Math.max(0,a.incomeBeforeTax),t=L(e,n.capital),c=R(t.tax),i=E(t.tax),o=C(e),r=t.tax+c+i.total+o,l=a.incomeBeforeTax-r,m=e>0?r/e:0;return{taxableIncome:e,corporateTax:t.tax,corporateTaxBreakdown:t.breakdown,localCorporateTax:c,corporateInhabitantTax:i.total,prefecturalTax:i.prefecturalTax,municipalTax:i.municipalTax,perCapitaLevy:i.perCapitaLevy,businessTax:o,totalTax:r,netIncome:l,effectiveTaxRate:m}}function S(a,n){const t=.28205128205128205,c=Math.floor(a*.1/(1+.1)),i=Math.floor(n*.1/(1+.1)),o=Math.max(0,c-i),r=Math.floor(o*t);return{taxableRevenue:a,taxExemptRevenue:0,taxablePurchases:n,outputTax:c,inputTax:i,netConsumptionTax:o,localConsumptionTax:r,totalConsumptionTax:o+r}}function D(a){const{acquisitionCost:n,depreciationMethod:e,usefulLife:t,businessRatio:c,currentYearMonths:i}=a;let o=0;if(e==="lumpSum")o=1/3;else if(e==="immediateSME")o=1;else if(e==="leasePeriod")o=1/t;else if(e==="unitsOfProduction")a.totalEstimatedUnits&&a.totalEstimatedUnits>0&&(o=(a.currentYearUnits||0)/a.totalEstimatedUnits);else if(x[t]){const m=x[t];e==="straightLine"||e==="decliningBalance"?o=m[e]:o=1/t}else o=1/t;let r=0;e==="lumpSum"?r=Math.floor(n*o):e==="immediateSME"?r=n:e==="unitsOfProduction"?r=Math.floor(n*o):r=Math.floor(n*o*(i/12)),r=Math.floor(r*(c/100));let l=n-r;return e!=="immediateSME"&&e!=="lumpSum"&&(l=Math.max(1,l)),l=Math.max(0,l),{assetId:a.id,depreciationRate:o,currentDepreciation:r,accumulatedDepreciation:r,bookValue:l,allowableLimit:r}}function _(a,n){const e=a.filter(s=>{var g;const h=new Date(s.date).getFullYear()===n,B=(g=s.tags)==null?void 0:g.includes("depreciation_asset");return h&&!B}),t=e.filter(s=>s.type==="income"),c=e.filter(s=>s.type==="expense"),i=t.reduce((s,u)=>s+Math.abs(Number(u.amount)||0),0),o=c.reduce((s,u)=>s+Math.abs(Number(u.amount)||0),0),r=Object.entries(c.reduce((s,u)=>{const h=u.category||"未分類";return s[h]=(s[h]||0)+Math.abs(Number(u.amount)||0),s},{})).map(([s,u])=>({category:s,amount:u})).sort((s,u)=>u.amount-s.amount),l=i,m=l-o,f=m;return{revenue:i,costOfSales:0,grossProfit:l,operatingExpenses:o,operatingIncome:m,nonOperatingIncome:0,nonOperatingExpenses:0,ordinaryIncome:f,extraordinaryIncome:0,extraordinaryLoss:0,incomeBeforeTax:f,totalAssets:i,totalLiabilities:0,netAssets:i,cash:i,accountsReceivable:0,inventory:0,fixedAssets:0,accountsPayable:0,shortTermLoans:0,longTermLoans:0,expensesByCategory:r}}function O(a){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",maximumFractionDigits:0}).format(a)}function b(a){return`${(a*100).toFixed(1)}%`}function w(a,n){return a.filter(e=>{var t;return(t=e.tags)==null?void 0:t.includes("depreciation_asset")}).map(e=>{const t=e.description||"",c=t.match(/取得日:(\d{4}-\d{2}-\d{2})/),i=t.match(/取得価額:¥([\d,]+)/),o=t.match(/償却方法:(定額法|定率法|一括償却 \(3年\)|少額減価償却資産 \(特例\))/),r=t.match(/耐用年数:(\d+)年/),l=t.match(/事業割合:(\d+)%/),m={定額法:"straightLine",定率法:"decliningBalance","一括償却 (3年)":"lumpSum","少額減価償却資産 (特例)":"immediateSME"},f=c?c[1]:e.date,d=new Date(f),u=d.getFullYear()===n?12-d.getMonth():12;return{id:e.id||Math.random().toString(36).substr(2,9),name:e.item,quantity:1,unit:"台",acquisitionDate:f,acquisitionCost:i?parseInt(i[1].replace(/,/g,""),10):Math.abs(e.amount),depreciationMethod:m[o?o[1]:"定額法"]||"straightLine",usefulLife:r?parseInt(r[1],10):5,businessRatio:l?parseInt(l[1],10):100,currentYearMonths:u}}).filter(e=>new Date(e.acquisitionDate).getFullYear()<=n).reduce((e,t)=>(e.some(i=>i.name===t.name&&i.acquisitionDate===t.acquisitionDate)||e.push(t),e),[])}export{S as a,b,y as c,D as d,w as e,O as f,_ as g};
