const S={2:{straightLine:.5,decliningBalance:1},3:{straightLine:.334,decliningBalance:.667},4:{straightLine:.25,decliningBalance:.5},5:{straightLine:.2,decliningBalance:.4},6:{straightLine:.167,decliningBalance:.333},8:{straightLine:.125,decliningBalance:.25},10:{straightLine:.1,decliningBalance:.2},12:{straightLine:.084,decliningBalance:.167},15:{straightLine:.067,decliningBalance:.133},20:{straightLine:.05,decliningBalance:.1},22:{straightLine:.046,decliningBalance:.091}},O={smallBusiness:{lowerRate:.15,upperRate:.232,threshold:8e6},largeBusiness:{rate:.232}},I=.103,g={prefectural:.01,municipal:.06,perCapitaLevy:7e4},f={income400:.035,income800:.052,incomeOver:.07};function k(o,r){if(r<=1e8){const{lowerRate:a,upperRate:l,threshold:n}=O.smallBusiness;if(o<=n)return{tax:Math.floor(o*a),breakdown:{lowerBracket:Math.floor(o*a),upperBracket:0}};{const s=Math.floor(n*a),i=Math.floor((o-n)*l);return{tax:s+i,breakdown:{lowerBracket:s,upperBracket:i}}}}else{const a=Math.floor(o*O.largeBusiness.rate);return{tax:a,breakdown:{lowerBracket:0,upperBracket:a}}}}function q(o){return Math.floor(o*I)}function Y(o){const r=Math.floor(o*g.prefectural),t=Math.floor(o*g.municipal),a=g.perCapitaLevy;return{prefecturalTax:r,municipalTax:t,perCapitaLevy:a,total:r+t+a}}function F(o){if(o<=0)return 0;let r=0;return o<=4e6?r=Math.floor(o*f.income400):o<=8e6?(r=Math.floor(4e6*f.income400),r+=Math.floor((o-4e6)*f.income800)):(r=Math.floor(4e6*f.income400),r+=Math.floor(4e6*f.income800),r+=Math.floor((o-8e6)*f.incomeOver)),r}function X(o,r){const t=Math.max(0,o.incomeBeforeTax),a=k(t,r.capital),l=q(a.tax),n=Y(a.tax),s=F(t),i=a.tax+l+n.total+s,u=o.incomeBeforeTax-i,m=t>0?i/t:0;return{taxableIncome:t,corporateTax:a.tax,corporateTaxBreakdown:a.breakdown,localCorporateTax:l,corporateInhabitantTax:n.total,prefecturalTax:n.prefecturalTax,municipalTax:n.municipalTax,perCapitaLevy:n.perCapitaLevy,businessTax:s,totalTax:i,netIncome:u,effectiveTaxRate:m}}function B(o,r){const a=.28205128205128205,l=Math.floor(o*.1/(1+.1)),n=Math.floor(r*.1/(1+.1)),s=Math.max(0,l-n),i=Math.floor(s*a);return{taxableRevenue:o,taxExemptRevenue:0,taxablePurchases:r,outputTax:l,inputTax:n,netConsumptionTax:s,localConsumptionTax:i,totalConsumptionTax:s+i}}function U(o){const{acquisitionCost:r,depreciationMethod:t,usefulLife:a,businessRatio:l,currentYearMonths:n}=o;let s=0;if(t==="lumpSum")s=1/3;else if(t==="immediateSME")s=1;else if(t==="leasePeriod")s=1/a;else if(t==="unitsOfProduction")o.totalEstimatedUnits&&o.totalEstimatedUnits>0&&(s=(o.currentYearUnits||0)/o.totalEstimatedUnits);else if(S[a]){const m=S[a];t==="straightLine"||t==="decliningBalance"?s=m[t]:s=1/a}else s=1/a;let i=0;t==="lumpSum"?i=Math.floor(r*s):t==="immediateSME"?i=r:t==="unitsOfProduction"?i=Math.floor(r*s):i=Math.floor(r*s*(n/12)),i=Math.floor(i*(l/100));let u=r-i;return t!=="immediateSME"&&t!=="lumpSum"&&(u=Math.max(1,u)),u=Math.max(0,u),{assetId:o.id,depreciationRate:s,currentDepreciation:i,accumulatedDepreciation:i,bookValue:u,allowableLimit:i}}function j(o,r,t={}){const a=o.filter(e=>{var b;const p=new Date(e.date).getFullYear()===r,N=(b=e.tags)==null?void 0:b.includes("depreciation_asset");return p&&!N}),l=a.filter(e=>e.type==="income"),n=a.filter(e=>e.type==="expense"),s=l.filter(e=>e.category==="売上"||e.category==="業務委託収入"),i=l.filter(e=>e.category!=="売上"&&e.category!=="業務委託収入"),u=s.reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),m=i.reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),h=n.filter(e=>e.category==="仕入"||e.category==="外注費"||e.category==="外注工賃").reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),d=n.filter(e=>e.category!=="仕入"&&e.category!=="外注費"&&e.category!=="外注工賃").reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),x=n.filter(e=>e.category==="借入金"||e.category==="短期借入金").reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),y=n.filter(e=>e.category==="買掛金"||e.category==="未払金").reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),L=l.filter(e=>e.category==="売掛金"||e.category==="未収金").reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),D=Object.entries(n.reduce((e,c)=>{let p=c.category||"未分類";return(p==="交際費"||p==="食費")&&(p="接待交際費"),e[p]=(e[p]||0)+Math.abs(Number(c.amount)||0),e},{})).map(([e,c])=>({category:e,amount:c})).sort((e,c)=>c.amount-e.amount),A=u-h,E=A-d,R=E+m,M=R,_=l.reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),w=n.reduce((e,c)=>e+Math.abs(Number(c.amount)||0),0),P=_-w,C=Math.max(0,(t.cash||0)+P);return{revenue:u,costOfSales:h,grossProfit:A,operatingExpenses:d,operatingIncome:E,nonOperatingIncome:m,nonOperatingExpenses:0,ordinaryIncome:R,extraordinaryIncome:0,extraordinaryLoss:0,incomeBeforeTax:M,totalAssets:C+(L+(t.receivable||0))+(t.inventory||0)+(t.fixedAssets||0),totalLiabilities:y+(t.payable||0)+(x+(t.shortTermLoans||0))+(t.longTermLoans||0),netAssets:(t.capital||0)+(t.retainedEarnings||0)+M,cash:C,accountsReceivable:L+(t.receivable||0),inventory:t.inventory||0,fixedAssets:t.fixedAssets||0,accountsPayable:y+(t.payable||0),shortTermLoans:x+(t.shortTermLoans||0),longTermLoans:t.longTermLoans||0,beginningRetainedEarnings:t.retainedEarnings||0,retainedEarnings:(t.retainedEarnings||0)+M,beginningCapital:t.capital||0,beginningCash:t.cash||0,beginningReceivable:t.receivable||0,beginningInventory:t.inventory||0,beginningFixedAssets:t.fixedAssets||0,beginningPayable:t.payable||0,beginningShortTermLoans:t.shortTermLoans||0,beginningLongTermLoans:t.longTermLoans||0,expensesByCategory:D}}function J(o){return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",maximumFractionDigits:0}).format(o)}function H(o){return`${(o*100).toFixed(1)}%`}function V(o,r){return o.filter(t=>{var a;return(a=t.tags)==null?void 0:a.includes("depreciation_asset")}).map(t=>{const a=t.description||"",l=a.match(/取得日:(\d{4}-\d{2}-\d{2})/),n=a.match(/取得価額:¥([\d,]+)/),s=a.match(/償却方法:(定額法|定率法|一括償却 \(3年\)|少額減価償却資産 \(特例\))/),i=a.match(/耐用年数:(\d+)年/),u=a.match(/事業割合:(\d+)%/),m={定額法:"straightLine",定率法:"decliningBalance","一括償却 (3年)":"lumpSum","少額減価償却資産 (特例)":"immediateSME"},T=l?l[1]:t.date,h=new Date(T),d=h.getFullYear()===r?12-h.getMonth():12;return{id:t.id||Math.random().toString(36).substr(2,9),name:t.item,quantity:1,unit:"台",acquisitionDate:T,acquisitionCost:n?parseInt(n[1].replace(/,/g,""),10):Math.abs(t.amount),depreciationMethod:m[s?s[1]:"定額法"]||"straightLine",usefulLife:i?parseInt(i[1],10):5,businessRatio:u?parseInt(u[1],10):100,currentYearMonths:d}}).filter(t=>new Date(t.acquisitionDate).getFullYear()<=r).reduce((t,a)=>(t.some(n=>n.name===a.name&&n.acquisitionDate===a.acquisitionDate)||t.push(a),t),[])}export{B as a,H as b,X as c,U as d,V as e,J as f,j as g};
