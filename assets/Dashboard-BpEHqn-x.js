const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RevenueChart-D8plcGPG.js","assets/index-CIKZNbWN.js","assets/index-BCk3r-Sa.css","assets/index-D8d3j8Vd.js","assets/chart-pie-DWdfQmrc.js","assets/activity-Dy7CuXNv.js","assets/motion-D5T1KndV.js","assets/ExpenseChart-Dyqa9slN.js","assets/index-BZCcOwBc.js","assets/TransactionTable-BjDFzkfu.js","assets/TransactionIcon-zfyOrqfX.js","assets/ReceiptResultModal-ZZDUdsmd.js","assets/rotate-ccw-BGQwpsII.js","assets/repeat-YWUjIzxS.js","assets/OmniEntryPortal-CE0032n-.js","assets/TransactionForm-BEW-uYEg.js","assets/keywordCategoryService-CeSB7JfV.js","assets/wallet-BjX_l8l8.js","assets/clock-C2CH3pQr.js","assets/star-CYPK5dmo.js","assets/zap-B2n-sPNh.js","assets/DashboardChatbot-DM9pKeau.js","assets/geminiAIService-DZAAZO20.js","assets/send-CUZX1iF4.js"])))=>i.map(i=>d[i]);
import{c as te,e as se,j as e,F as ae,S as G,L as H,r as c,f as X,g as re,T as ne,h as Z,i as le,k as oe,a as ie,l as ce,P as de,m as z,n as xe,_ as Y}from"./index-CIKZNbWN.js";import{M as me}from"./mic-DYRohcGx.js";import{C as ue}from"./camera-DXR6qhrV.js";import{F as he}from"./file-spreadsheet-BSKl9vQc.js";import{C as ge}from"./chart-pie-DWdfQmrc.js";import{u as pe,a as be}from"./useCorporateTaxCalculation-DtHVCfLh.js";import{B as U,C as fe,a as je,L as ye,b as Ne,A as ve,p as we,c as ke,d as Ce}from"./index-D8d3j8Vd.js";import{C as ee}from"./circle-check-RKPDMRae.js";import{I as Me}from"./info-CYssVvqX.js";import{A as _e}from"./arrow-right-FWvQseBp.js";import{I as Te}from"./inbox-DwFpPTMu.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],Se=te("chart-no-axes-column",Ee);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Ae=te("link",$e),De=()=>{const{currentBusinessType:n}=se(),g=(n==null?void 0:n.business_type)==="corporation",S=[{title:"音声で記録",description:"音声で取引を記録",icon:me,link:"/chat-to-book",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:"レシート処理",description:"レシートをスキャン",icon:ue,link:"/receipt-processing",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:"取引履歴",description:"すべての取引を確認",icon:Se,link:"/transaction-history",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:"請求書作成",description:"新しい請求書を作成",icon:ae,link:"/invoice-creation",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:"CSV入出力管理",description:"データの一括取込・出力",icon:he,link:"/csv-import",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:"経営分析",description:"事業の状況を分析",icon:ge,link:"/business-analysis",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:"補助金マッチング",description:"AI補助金提案",icon:Ae,link:"/subsidy-matching",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:g?"即日法人税申告":"即日確定申告",description:"ご自身で既にデータがある方向け",icon:G,link:"/quick-tax-filing",color:"bg-blue-500/20",iconColor:"text-blue-500"},{title:g?"法人税申告サポート":"確定申告サポート",description:"Ainanceのデータで書類作成",icon:G,link:g?"/corporate-tax":"/tax-filing-wizard",color:"bg-blue-500/20",iconColor:"text-blue-500"}];return e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-3 lg:grid-cols-5 xl:grid-cols-9 gap-4 mb-8",children:S.map((l,i)=>e.jsx(H,{to:l.link,className:"bg-white dark:bg-surface rounded-xl p-2.5 hover:bg-surface-highlight transition-all duration-300 group border border-border hover:border-border-strong hover:-translate-y-1 shadow-sm hover:shadow-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`w-10 h-10 ${l.color} rounded-full flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-300`,children:e.jsx(l.icon,{className:`w-5 h-5 ${l.iconColor}`})}),e.jsx("h3",{className:"font-medium text-text-main mb-1 text-xs",children:l.title}),e.jsx("p",{className:"text-[10px] text-text-muted leading-tight",children:l.description})]})},i))})};fe.register(je,ye,Ne,ve,we,ke,Ce);const Le=({transactions:n,receipts:g=[],businessType:S="individual",selectedYear:l})=>{const[i,L]=c.useState("total"),[j,E]=c.useState(()=>{const s=localStorage.getItem("monthly_budget");return s?parseInt(s):5e5}),[F,R]=c.useState(!1),[P,A]=c.useState(j.toString()),p=()=>{const s=parseInt(P);isNaN(s)||(E(s),localStorage.setItem("monthly_budget",s.toString())),R(!1)},I=s=>{if(typeof s=="number")return s;if(typeof s=="string"){const u=parseFloat(s.replace(/,/g,""));return isNaN(u)?0:u}if(typeof s=="object"&&s!==null){const u=s.value??s.amount??s.number??0;return I(u)}return 0},$=s=>Math.abs(I(s)),b=c.useMemo(()=>{const s=new Date,u=s.getMonth(),t=l||s.getFullYear(),a=new Date(t,u+1,0).getDate(),d=s.getDate(),M=n.filter(r=>{const y=new Date(r.date),D=y.getMonth()===u&&y.getFullYear()===t,J=I(r.amount),Q=r.type==="expense"||r.type!=="income"&&J<0;return D&&Q&&r.approval_status==="approved"}).map(r=>{var D,J,Q;let y=$(r.amount);if((D=r.tags)!=null&&D.includes("depreciation_asset")){const K=(J=r.description)==null?void 0:J.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(K)y=parseInt(K[1].replace(/,/g,""),10);else{const W=(Q=r.description)==null?void 0:Q.match(/年間償却費: ¥([\d,]+)/);W&&(y=parseInt(W[1].replace(/,/g,""),10))}}return{...r,amount:y}}),_=[],T=[...M,..._],N=T.reduce((r,y)=>r+$(y.amount),0),k=N/(d||1)*a,o=Math.min(N/j*100,100),h={};T.forEach(r=>{const y=$(r.amount),D=r.category||"未分類";h[D]=(h[D]||0)+y});const v=Object.entries(h).sort(([,r],[,y])=>y-r).slice(0,7),V=Object.values(h).reduce((r,y)=>r+y,0),B=v.map(([,r])=>Math.round(V===0?j/Math.max(v.length,1):j*(r/V))),q={labels:v.map(([r])=>r),datasets:[{label:"実績",data:v.map(([,r])=>r),backgroundColor:"#3b82f6",borderRadius:4,barThickness:12,maxBarThickness:12,barPercentage:.8,categoryPercentage:.9},{label:"目安",data:B,backgroundColor:"rgba(156, 163, 175, 0.3)",borderRadius:4,barThickness:12,maxBarThickness:12,barPercentage:.8,categoryPercentage:.9}]};return{total:N,projected:k,progress:o,topCategory:v[0]?{name:v[0][0]}:null,chartData:q}},[n,g,j]),f=c.useMemo(()=>{const s=n.filter(o=>{const h=I(o.amount);return(o.type==="expense"||o.type!=="income"&&h<0)&&o.approval_status!=="rejected"}).map(o=>{var v,V,B;let h=$(o.amount);if((v=o.tags)!=null&&v.includes("depreciation_asset")){const q=(V=o.description)==null?void 0:V.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(q)h=parseInt(q[1].replace(/,/g,""),10);else{const r=(B=o.description)==null?void 0:B.match(/年間償却費: ¥([\d,]+)/);r&&(h=parseInt(r[1].replace(/,/g,""),10))}}return{...o,amount:h}}),u=[],t=[...s,...u],a=t.reduce((o,h)=>o+$(h.amount),0),d=new Set(t.map(o=>{const h=new Date(o.date);return`${h.getFullYear()}-${h.getUTCMonth()}`})),M=Math.max(1,d.size),_=j*M,T=Math.min(a/_*100,100),N={};t.forEach(o=>{const h=$(o.amount),v=o.category||"未分類";N[v]=(N[v]||0)+h});const C=Object.entries(N).sort(([,o],[,h])=>h-o).slice(0,7),k={labels:C.map(([o])=>o),datasets:[{label:"実績",data:C.map(([,o])=>o),backgroundColor:"#10b981",borderRadius:4,barThickness:12,maxBarThickness:12,barPercentage:.8,categoryPercentage:.9}]};return{total:a,cumulativeBudget:_,progress:T,topCategory:C[0]?{name:C[0][0]}:null,chartData:k,monthCount:M}},[n,g,j]),x=pe(n,g,{year:l}),w=be(n,g,{year:l}),m=S==="corporation"?w:x,O={indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{display:!1,grid:{display:!1},border:{display:!1}},y:{grid:{display:!1},border:{display:!1},ticks:{font:{size:9},color:"#9ca3af"}}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0,0,0,0.8)",padding:8,cornerRadius:4,titleFont:{size:10},bodyFont:{size:10}}}};return e.jsxs("div",{className:"bg-white dark:bg-surface rounded-2xl p-4 border border-border shadow-sm h-full flex flex-col relative overflow-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-text-muted uppercase tracking-wider mb-1",children:[l||new Date().getFullYear(),"年度累計実績"]}),e.jsx("h3",{className:"text-base font-bold text-text-main leading-tight",children:"経営管理コックピット"}),e.jsx("p",{className:"text-[10px] text-text-muted",children:"財務状況をリアルタイムに把握"})]})}),e.jsxs("div",{className:"flex p-1 bg-surface-highlight rounded-xl w-fit",children:[e.jsxs("button",{onClick:()=>L("total"),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 ${i==="total"?"bg-white dark:bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[e.jsx(X,{className:"w-3.5 h-3.5"}),"累計予実"]}),e.jsxs("button",{onClick:()=>L("month"),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 ${i==="month"?"bg-white dark:bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[e.jsx(re,{className:"w-3.5 h-3.5"}),"今月"]}),e.jsxs("button",{onClick:()=>L("tax"),className:`px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1.5 ${i==="tax"?"bg-white dark:bg-surface text-primary shadow-sm":"text-text-muted hover:text-text-main"}`,children:[e.jsx(ne,{className:"w-3.5 h-3.5"}),"納税予測"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-3",children:[i==="month"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-text-muted",children:"今月の予算進捗"}),e.jsx("div",{className:"text-right",children:F?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",className:"w-20 px-1 py-0.5 text-right border rounded text-xs bg-background",value:P,onChange:s=>A(s.target.value)}),e.jsx("button",{onClick:p,className:"text-xs bg-primary text-white border border-primary px-2 py-0.5 rounded",children:"保存"})]}):e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("div",{className:"text-xl font-bold text-text-main",children:[j.toLocaleString(),"円"]}),e.jsx("button",{onClick:()=>R(!0),className:"p-1 text-text-muted hover:text-primary transition-colors hover:bg-surface-highlight rounded-lg",children:e.jsx(Z,{className:"w-3.5 h-3.5"})})]})})]}),e.jsxs("div",{className:"relative h-2.5 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 h-full rounded-full transition-all duration-1000 ${b.projected>j?"bg-red-500":"bg-primary"}`,style:{width:`${b.progress}%`}}),e.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-black/20 dark:bg-white/50 z-10",style:{left:`${Math.min(b.projected/j*100,100)}%`}})]}),e.jsxs("div",{className:"flex justify-between mt-1 text-[10px]",children:[e.jsxs("span",{className:"font-bold text-primary",children:["支払済: ",b.total.toLocaleString(),"円"]}),e.jsxs("span",{className:`font-bold ${b.projected>j?"text-red-500":"text-text-muted"}`,children:["着地: ",Math.round(b.projected).toLocaleString(),"円"]})]})]}),e.jsxs("div",{className:"bg-surface-highlight/30 rounded-xl p-3 border border-border/50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-[10px] font-bold text-text-main",children:"支出TOPカテゴリ 予実"}),e.jsxs("div",{className:"flex gap-2 text-[8px]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded bg-blue-500"}),"実績"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded bg-gray-300"}),"目安"]})]})]}),e.jsx("div",{className:"relative",style:{height:`${Math.max(150,b.chartData.labels.length*50)}px`},children:e.jsx(U,{data:b.chartData,options:O})})]})]}):i==="total"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsxs("span",{className:"text-xs font-medium text-text-muted",children:["全期間の累計予実 (",f.monthCount,"ヶ月分)"]}),e.jsx("div",{className:"text-right",children:F?e.jsxs("div",{className:"flex items-center gap-2 justify-end flex-nowrap whitespace-nowrap",children:[e.jsx("span",{className:"text-[10px] text-text-muted",children:"月次予算設定:"}),e.jsx("input",{type:"number",className:"w-20 px-1 py-0.5 text-right border rounded text-xs bg-background",value:P,onChange:s=>A(s.target.value)}),e.jsx("button",{onClick:p,className:"text-xs bg-primary text-white border border-primary px-2 py-0.5 rounded flex-shrink-0",children:"保存"})]}):e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs("span",{className:"text-base font-bold text-text-main",children:["￥",f.total.toLocaleString(),e.jsxs("span",{className:"text-[10px] text-text-muted font-normal ml-1",children:["/ ￥",f.cumulativeBudget.toLocaleString()]})]}),e.jsx("button",{onClick:()=>R(!0),className:"p-1 text-text-muted hover:text-primary transition-colors hover:bg-surface-highlight rounded-lg",children:e.jsx(Z,{className:"w-3.5 h-3.5"})})]})})]}),e.jsx("div",{className:"h-1.5 bg-surface-highlight rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${f.progress>90?"bg-red-500":f.progress>70?"bg-orange-400":"bg-emerald-500"}`,style:{width:`${f.progress}%`}})}),e.jsxs("div",{className:"flex justify-between mt-1 text-[10px]",children:[e.jsxs("span",{className:"font-bold text-emerald-500",children:["合計支出: ",f.total.toLocaleString(),"円"]}),e.jsxs("span",{className:"font-bold text-text-muted",children:["対象月数: ",f.monthCount,"ヶ月"]})]})]}),e.jsxs("div",{className:"bg-surface-highlight/30 rounded-xl p-3 border border-border/50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-[10px] font-bold text-text-main",children:"累計支出内訳"}),e.jsx("div",{className:"flex gap-2 text-[8px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded bg-emerald-500"}),"累計実績"]})})]}),e.jsx("div",{className:"relative",style:{height:`${Math.max(150,f.chartData.labels.length*50)}px`},children:e.jsx(U,{data:f.chartData,options:O})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsxs("span",{className:"text-xs font-medium text-text-muted",children:["年間納税予測額 (",m.calculationYear,"年)"]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-xl font-bold text-text-main",children:[e.jsx("span",{className:"text-xs mr-1",children:"約"}),Math.round(m.totalTax).toLocaleString(),"円"]})})]}),e.jsx("div",{className:"relative h-2.5 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden flex",children:m.chartData.datasets[0].data.map((s,u)=>e.jsx("div",{style:{width:`${s/m.totalTax*100}%`,backgroundColor:m.chartData.datasets[0].backgroundColor[u]},className:"h-full"},u))}),e.jsxs("div",{className:"flex justify-between mt-1 text-[10px]",children:[e.jsxs("span",{className:"font-bold text-blue-500",children:[S==="corporation"?"法人税":"所得税",": ",Math.round(S==="corporation"?m.breakdown.corporateTax||0:m.breakdown.incomeTax||0).toLocaleString(),"円"]}),e.jsxs("span",{className:"font-bold text-text-muted",children:["月平均: ",Math.round(m.monthlyTaxAru).toLocaleString(),"円"]})]})]}),e.jsxs("div",{className:"bg-surface-highlight/30 rounded-xl p-3 border border-border/50 flex flex-col",children:[e.jsx("h4",{className:"text-[10px] font-bold text-text-main mb-2",children:"税目別内訳（着地予想）"}),e.jsx("div",{className:"space-y-2.5",children:S==="corporation"?[{label:"法人税",value:m.breakdown.corporateTax||0,color:"bg-blue-500"},{label:"法人住民税",value:m.breakdown.residentTax,color:"bg-emerald-500"},{label:"法人事業税",value:m.breakdown.businessTax,color:"bg-amber-500"}].map((s,u)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${s.color}`}),e.jsx("span",{className:"text-xs text-text-main",children:s.label})]}),e.jsxs("span",{className:"text-xs font-bold text-text-main",children:[Math.round(s.value).toLocaleString(),"円"]})]},u)):[{label:"所得税",value:m.breakdown.incomeTax,color:"bg-blue-500"},{label:"住民税",value:m.breakdown.residentTax,color:"bg-emerald-500"},{label:"個人事業税",value:m.breakdown.businessTax,color:"bg-amber-500"},{label:"国民健康保険",value:m.breakdown.healthInsurance,color:"bg-purple-500"}].map((s,u)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${s.color}`}),e.jsx("span",{className:"text-xs text-text-main",children:s.label})]}),e.jsxs("span",{className:"text-xs font-bold text-text-main",children:[Math.round(s.value).toLocaleString(),"円"]})]},u))})]})]}),e.jsxs("div",{className:"bg-surface-highlight/50 rounded-lg p-2.5 flex items-center justify-between gap-3 border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[i==="month"?b.projected>j?e.jsx(le,{className:"w-4 h-4 text-red-500 shrink-0"}):e.jsx(ee,{className:"w-4 h-4 text-green-500 shrink-0"}):i==="total"?f.progress>90?e.jsx(X,{className:"w-4 h-4 text-red-500 shrink-0"}):e.jsx(ee,{className:"w-4 h-4 text-emerald-500 shrink-0"}):e.jsx(Me,{className:"w-4 h-4 text-primary shrink-0"}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("p",{className:"text-[10px] text-text-main truncate font-bold",children:i==="month"?b.projected>j?"予算超過に注意が必要です":"予算内で推移しています":i==="total"?f.progress>100?"累計予算を超過しています":`${f.monthCount}ヶ月間の累計予算内です`:`利益: ${Math.round(m.ytdProfit).toLocaleString()}円から算出`}),e.jsx("p",{className:"text-[9px] text-text-muted truncate",children:i==="month"?b.topCategory&&`最大支出: ${b.topCategory.name}`:i==="total"?f.topCategory&&`累計最大支出: ${f.topCategory.name}`:`${m.calculationYear}年 納税予測: 約${Math.round(m.totalTax).toLocaleString()}円`})]})]}),e.jsxs(H,{to:i==="month"?"/budget-analysis":i==="total"?"/cumulative-analysis":"/tax-report",className:"flex items-center gap-1 text-[10px] text-primary font-bold hover:underline whitespace-nowrap",children:["詳細 ",e.jsx(_e,{className:"w-3 h-3"})]})]})]}),g.length>0&&e.jsxs("div",{className:"absolute top-0 right-10 flex items-center gap-1 text-[8px] text-text-muted mt-5 animate-pulse",children:[e.jsx(G,{className:"w-2.5 h-2.5 text-primary"}),e.jsx("span",{children:"リアルタイム同期中"})]})]})},Ie=z.lazy(()=>Y(()=>import("./RevenueChart-D8plcGPG.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Fe=z.lazy(()=>Y(()=>import("./ExpenseChart-Dyqa9slN.js"),__vite__mapDeps([7,1,2,3,8,6]))),Re=z.lazy(()=>Y(()=>import("./TransactionTable-BjDFzkfu.js"),__vite__mapDeps([9,1,2,10,11,12,13]))),Pe=z.lazy(()=>Y(()=>import("./OmniEntryPortal-CE0032n-.js"),__vite__mapDeps([14,1,2,15,16,17,18,19,20]))),Oe=z.lazy(()=>Y(()=>import("./DashboardChatbot-DM9pKeau.js"),__vite__mapDeps([21,1,2,22,16,23]))),Xe=()=>{const{currentBusinessType:n}=se(),{selectedYear:g}=oe(),{isAuthenticated:S,user:l,loading:i}=ie(),{transactions:L,loading:j,fetchTransactions:E}=ce(l==null?void 0:l.id,n==null?void 0:n.business_type),[F,R]=c.useState([]),[P,A]=c.useState(!1),p=c.useMemo(()=>L.filter(x=>new Date(x.date).getFullYear()===g),[L,g]),I=c.useMemo(()=>F.filter(x=>new Date(x.date).getFullYear()===g),[F,g]);console.log("ダッシュボード - currentBusinessType:",n),console.log("ダッシュボード - transactions:",p),console.log("ダッシュボード - loading:",j),console.log("ダッシュボード - authUser:",l),c.useEffect(()=>{const x=()=>A(!0);return window.addEventListener("openCreateTransactionModal",x),()=>{window.removeEventListener("openCreateTransactionModal",x)}},[]),c.useEffect(()=>{i||(console.log("ダッシュボード - 取引データの読み込みを開始"),E())},[i,E]),c.useEffect(()=>{console.log("ダッシュボード - transactions状態が更新されました:",p)},[p]);const $=async()=>{if(l!=null&&l.id){const x=await xe(l.id);R(x.filter(w=>w.status==="pending"))}};c.useEffect(()=>{!i&&(l!=null&&l.id)&&$()},[i,l==null?void 0:l.id]),c.useEffect(()=>{const x=async()=>{console.log("ダッシュボード - transactionRecordedイベントを受信"),n!=null&&n.id&&(await new Promise(w=>setTimeout(w,100)),E())};return window.addEventListener("transactionRecorded",x),()=>{window.removeEventListener("transactionRecorded",x)}},[n,E]),c.useEffect(()=>{const x=async()=>{console.log("ダッシュボード - transactionApprovedイベントを受信"),n!=null&&n.id&&(await new Promise(w=>setTimeout(w,100)),E())};window.addEventListener("transactionApproved",x)},[n,E]);const b=c.useMemo(()=>{console.log("ダッシュボード - 取引データ:",p),p.forEach((t,a)=>{console.log(`ダッシュボード - 取引 ${a+1}:`,{id:t.id,item:t.item,amount:t.amount,amountType:typeof t.amount,amountStructure:typeof t.amount=="object"?Object.keys(t.amount):"N/A",date:t.date,category:t.category,type:t.type})});const x=t=>{if(typeof t=="number")return t;if(typeof t=="string"){const a=parseFloat(t.replace(/,/g,""));return isNaN(a)?0:a}if(typeof t=="object"&&t!==null){const a=t.value||t.amount||t.number||0;return x(a)}return 0},w=p.filter(t=>{if(t.type==="income")return!0;if(t.type==="expense")return!1;const a=x(t.amount),d=!isNaN(a)&&isFinite(a)&&a>0;return console.log(`ダッシュボード - 取引ID ${t.id}: type=${t.type}, 元のamount=${JSON.stringify(t.amount)}, 数値化後=${a}, 収入判定=${d}`),d}),m=p.filter(t=>{if(t.type==="expense")return!0;if(t.type==="income")return!1;const a=x(t.amount),d=!isNaN(a)&&isFinite(a)&&a<0;return console.log(`ダッシュボード - 取引ID ${t.id}: type=${t.type}, 元のamount=${JSON.stringify(t.amount)}, 数値化後=${a}, 支出判定=${d}`),d}),O=w.reduce((t,a)=>{var _,T,N;let d=x(a.amount);if((_=a.tags)!=null&&_.includes("depreciation_asset")){const C=(T=a.description)==null?void 0:T.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(C)d=parseInt(C[1].replace(/,/g,""),10);else{const k=(N=a.description)==null?void 0:N.match(/年間償却費: ¥([\d,]+)/);k&&(d=parseInt(k[1].replace(/,/g,""),10))}}const M=!isNaN(d)&&isFinite(d)?Math.abs(d):0;return t+M},0),s=m.reduce((t,a)=>{var _,T,N;let d=x(a.amount);if((_=a.tags)!=null&&_.includes("depreciation_asset")){const C=(T=a.description)==null?void 0:T.match(/今期\(\d+年\)償却額:¥([\d,]+)/);if(C){const k=parseInt(C[1].replace(/,/g,""),10);console.log(`ダッシュボード - 減価償却資産を検知 (ID: ${a.id}): 全額 ${d} -> 今期償却額 ${k} を適用`),d=k}else{const k=(N=a.description)==null?void 0:N.match(/年間償却費: ¥([\d,]+)/);k&&(d=parseInt(k[1].replace(/,/g,""),10))}}const M=!isNaN(d)&&isFinite(d)?Math.abs(d):0;return console.log(`ダッシュボード - 支出計算: ${t} + ${M} = ${t+M}`),t+M},0),u={total:p.length,income:O,expense:s,balance:O-s,pendingCount:p.filter(t=>t.approval_status==="pending").length};return console.log("ダッシュボード - 統計情報計算結果:",u),console.log("ダッシュボード - 収入取引:",w),console.log("ダッシュボード - 支出取引:",m),u},[p]),f=()=>e.jsxs("div",{className:"min-h-screen p-4 sm:p-0",children:[e.jsxs("div",{className:"p-4 bg-red-500 text-white text-center mb-4",children:[e.jsx("p",{children:"ダッシュボードのローディング中..."}),e.jsxs("p",{children:["authLoading: ",i?"true":"false"]}),e.jsxs("p",{children:["isAuthenticated: ",S?"true":"false"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-24 w-full bg-gray-200 dark:bg-gray-700 rounded-xl mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"})]})]});return i?(console.log("ダッシュボードをスケルトンローディングで表示中 - authLoading:",i),e.jsx(f,{})):e.jsxs("div",{className:"min-h-screen p-4 sm:p-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-text-main tracking-tight",children:"ダッシュボード"}),e.jsx("p",{className:"text-xs text-text-muted mt-0.5",children:"財務状況の概要と最近の活動"})]})})}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto h-10",children:[e.jsxs(H,{to:"/transaction-inbox",className:`group flex-1 sm:flex-none relative inline-flex items-center justify-center gap-2 px-4 py-1.5 rounded-full transition-all duration-200 border whitespace-nowrap ${b.pendingCount>0?"border-red-500/50 hover:border-red-500 text-red-500 hover:bg-red-500/10":"border-border hover:border-border-strong text-text-muted hover:bg-surface-highlight"} bg-surface`,children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-bold text-sm",children:["確認待ち",b.pendingCount===0?"(0)":""]}),b.pendingCount>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex items-center justify-center min-w-[20px] h-5 px-1.5 ml-1 rounded-full text-[10px] font-bold bg-white/10 text-red-500",children:b.pendingCount}),e.jsx("span",{className:"absolute top-0 right-1 w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse border-2 border-surface shadow-[0_0_10px_rgba(239,68,68,0.5)]"})]})]}),e.jsxs("button",{onClick:()=>A(!0),className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 px-6 py-1.5 rounded-full bg-primary hover:bg-primary/90 text-white text-sm font-bold transition-all shadow-lg shadow-primary/25 active:scale-95",children:[e.jsx(de,{className:"w-4 h-4"}),"新規取引"]})]})]}),e.jsx(De,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-[620px] bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx("div",{className:"h-[620px]",children:e.jsx(Ie,{transactions:p,selectedYear:g})})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-[620px] bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx("div",{className:"h-[620px]",children:e.jsx(Fe,{transactions:p,selectedYear:g})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-[650px] bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx("div",{className:"h-[650px]",children:e.jsx(Re,{transactions:p,onOpenCreateModal:()=>A(!0),showCreateButton:!1,disableEdit:!0})})}),e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-[650px] bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx("div",{className:"h-[650px]",children:e.jsx(Le,{transactions:p,receipts:I,businessType:n==null?void 0:n.business_type,selectedYear:g})})})]}),P&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(Pe,{onClose:()=>A(!1),onSuccess:()=>E()})}),e.jsx(c.Suspense,{fallback:null,children:e.jsx(Oe,{})})]})};export{Xe as default};
