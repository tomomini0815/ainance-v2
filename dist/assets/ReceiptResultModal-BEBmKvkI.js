import{c as N,r as c,j as e,X as K,h as me,g as F,s as _,e as he,b as be,u as pe,F as fe}from"./index-DiEsiMSQ.js";import{Z as J}from"./zap-DAggFJmq.js";import{L as ye}from"./loader-circle-DL7ki-8N.js";import{C as we}from"./camera-BrCpaH3Y.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],je=N("circle-check",ve);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 18a6 6 0 0 0 0-12v12z",key:"j4l70d"}]],ke=N("contrast",Ne);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Re=N("pen",Ce);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],O=N("rotate-ccw",Se);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],_e=N("rotate-cw",Me);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],q=N("triangle-alert",Ee);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M10.513 4.856 13.12 2.17a.5.5 0 0 1 .86.46l-1.377 4.317",key:"193nxd"}],["path",{d:"M15.656 10H20a1 1 0 0 1 .78 1.63l-1.72 1.773",key:"27a7lr"}],["path",{d:"M16.273 16.273 10.88 21.83a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14H4a1 1 0 0 1-.78-1.63l4.507-4.643",key:"1e0qe9"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],$e=N("zap-off",Ie),De=({onCapture:i,onClose:r})=>{const n=c.useRef(null),d=c.useRef(null),h=c.useRef(null),[b,x]=c.useState(null),[g,l]=c.useState(null),[y,p]=c.useState(!1),[k,w]=c.useState(null),[j,T]=c.useState("auto"),[E,B]=c.useState(1),[a,R]=c.useState(!0),[v,I]=c.useState(!1),[Oe,Y]=c.useState([]),[S,ee]=c.useState(null),[te,P]=c.useState(!1),[$,Q]=c.useState(100),[z,Z]=c.useState(100),[C,A]=c.useState(0),D=async()=>{try{const s={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080},focusMode:"continuous",exposureMode:"continuous"}},t=await navigator.mediaDevices.getUserMedia(s);x(t),n.current&&(n.current.srcObject=t);const o=t.getVideoTracks()[0];o.getCapabilities().torch&&H(o,j)}catch(s){console.error("Camera error:",s),w("„Ç´„É°„É©„ÇíËµ∑Âãï„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÊ®©Èôê„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")}};c.useEffect(()=>(D(),()=>{b&&b.getTracks().forEach(s=>{s.stop()})}),[]);const H=async(s,t)=>{try{s.getCapabilities().torch&&await s.applyConstraints({advanced:[{torch:t==="on"}]})}catch(o){console.warn("Flash mode not supported:",o)}},se=()=>{const s=["off","on","auto"],t=s.indexOf(j),o=s[(t+1)%s.length];if(T(o),b){const u=b.getVideoTracks()[0];H(u,o)}};c.useEffect(()=>{if(!n.current||g||!a)return;const s=setInterval(()=>{re()},500);return()=>clearInterval(s)},[n.current,g,a]);const re=c.useCallback(()=>{if(!n.current||!h.current)return;const s=n.current,t=h.current;t.width=320,t.height=240;const o=t.getContext("2d");if(!o)return;o.drawImage(s,0,0,t.width,t.height);const u=o.getImageData(0,0,t.width,t.height),f=ae(u);ee(f),a&&f.brightness>60&&f.brightness<200&&f.contrast>40&&f.sharpness>30&&f.hasReceipt&&setTimeout(()=>U(),300)},[a]),ae=s=>{const t=s.data;let o=0,u=0;for(let m=0;m<t.length;m+=4){const L=t[m],ue=t[m+1],xe=t[m+2],X=(L+ue+xe)/3;if(o+=X,m>s.width*4*4){const ge=(t[m-s.width*4]+t[m-s.width*4+1]+t[m-s.width*4+2])/3;u+=Math.abs(X-ge)}}const f=o/(t.length/4),ie=u/(t.length/4);let G=0;for(let m=0;m<t.length;m+=4){const L=(t[m]+t[m+1]+t[m+2])/3;G+=Math.pow(L-f,2)}const W=Math.sqrt(G/(t.length/4)),de=f>100&&W>40;return{brightness:f,contrast:W,sharpness:ie,hasReceipt:de}},U=c.useCallback(()=>{if(n.current&&d.current&&!y){p(!0),P(!0);const s=n.current,t=d.current;t.width=s.videoWidth,t.height=s.videoHeight,console.log(`üì∏ ÊíÆÂΩ±Ëß£ÂÉèÂ∫¶: ${t.width}x${t.height}`);const o=t.getContext("2d");if(o){o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(s,0,0);const u=t.toDataURL("image/jpeg",.98);console.log(`üíæ ÁîªÂÉè„Çµ„Ç§„Ç∫: ${(u.length/1024/1024).toFixed(2)}MB`),"vibrate"in navigator&&navigator.vibrate(50),setTimeout(()=>{l(u),v&&Y(f=>[...f,u]),P(!1)},300)}p(!1)}},[v,y]),oe=()=>{l(null),Q(100),Z(100),A(0),b&&b.getTracks().forEach(s=>s.stop()),x(null),setTimeout(()=>{D()},100)},ne=s=>{const t=document.createElement("canvas"),o=new Image;o.src=s,t.width=o.width,t.height=o.height;const u=t.getContext("2d");return u?(C!==0&&(u.translate(t.width/2,t.height/2),u.rotate(C*Math.PI/180),u.translate(-t.width/2,-t.height/2)),u.filter=`brightness(${$}%) contrast(${z}%)`,u.drawImage(o,0,0),t.toDataURL("image/jpeg",.95)):s},le=()=>{if(g){const s=ne(g);fetch(s).then(t=>t.blob()).then(t=>i(t))}},V=async s=>{if(!b||g)return;const t=b.getVideoTracks()[0],o=t.getCapabilities();if(o.focusMode&&o.focusMode.includes("manual"))try{await t.applyConstraints({advanced:[{focusMode:"manual"}]})}catch(u){console.warn("Manual focus not supported:",u)}},ce=()=>{if(!S)return null;const{brightness:s,contrast:t,hasReceipt:o}=S;return s<40||s>220?{icon:q,text:"Êòé„Çã„Åï„Åå‰∏çÈÅ©Âàá„Åß„Åô",color:"text-yellow-400"}:t<30?{icon:q,text:"„Ç≥„É≥„Éà„É©„Çπ„Éà„Åå‰Ωé„ÅÑ„Åß„Åô",color:"text-yellow-400"}:o?{icon:je,text:"ÊíÆÂΩ±Ê∫ñÂÇôÂÆå‰∫ÜÔºÅ",color:"text-green-400"}:{icon:we,text:"„É¨„Ç∑„Éº„Éà„ÇíÊ§úÂá∫‰∏≠...",color:"text-blue-400"}};if(k)return e.jsx("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center text-white p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("p",{className:"mb-4 text-lg",children:k}),e.jsx("button",{onClick:r,className:"px-6 py-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:"Èñâ„Åò„Çã"})]})});const M=ce();return e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-20 bg-gradient-to-b from-black/70 to-transparent",children:[e.jsx("button",{onClick:r,className:"p-3 text-white/90 hover:text-white rounded-full bg-black/30 backdrop-blur-md transition-all hover:bg-black/50",children:e.jsx(K,{size:24})}),!g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>R(!a),className:`px-4 py-2 rounded-full text-xs font-medium transition-all backdrop-blur-md ${a?"bg-primary/80 text-white":"bg-black/30 text-white/70"}`,children:["Ëá™ÂãïÊíÆÂΩ±: ",a?"ON":"OFF"]}),e.jsx("button",{onClick:se,className:"p-3 text-white/90 hover:text-white rounded-full bg-black/30 backdrop-blur-md transition-all hover:bg-black/50",children:j==="on"?e.jsx(J,{size:20,className:"text-yellow-400"}):j==="off"?e.jsx($e,{size:20}):e.jsx(J,{size:20,className:"text-blue-400"})})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden bg-black",children:[g?e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx("img",{src:g,alt:"Captured",className:"max-w-full max-h-full object-contain",style:{filter:`brightness(${$}%) contrast(${z}%)`,transform:`rotate(${C}deg)`}}),e.jsx("div",{className:"absolute bottom-24 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{size:20,className:"text-white"}),e.jsx("input",{type:"range",min:"50",max:"150",value:$,onChange:s=>Q(Number(s.target.value)),className:"flex-1 h-2 bg-white/20 rounded-lg appearance-none cursor-pointer"}),e.jsxs("span",{className:"text-white text-sm w-12",children:[$,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{size:20,className:"text-white"}),e.jsx("input",{type:"range",min:"50",max:"150",value:z,onChange:s=>Z(Number(s.target.value)),className:"flex-1 h-2 bg-white/20 rounded-lg appearance-none cursor-pointer"}),e.jsxs("span",{className:"text-white text-sm w-12",children:[z,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[e.jsx("button",{onClick:()=>A((C-90)%360),className:"p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:e.jsx(O,{size:20,className:"text-white"})}),e.jsxs("span",{className:"text-white text-sm",children:[C,"¬∞"]}),e.jsx("button",{onClick:()=>A((C+90)%360),className:"p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:e.jsx(_e,{size:20,className:"text-white"})})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover",onClick:V,onTouchStart:V}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"relative",style:{width:"85%",paddingBottom:"113.33%"},children:e.jsxs("div",{className:"absolute inset-0 border-4 border-primary/60 rounded-lg shadow-2xl",style:{boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.6)"},children:[e.jsx("div",{className:"absolute -top-1 -left-1 w-16 h-16 border-t-[6px] border-l-[6px] border-primary rounded-tl-xl shadow-lg shadow-primary/50"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-16 h-16 border-t-[6px] border-r-[6px] border-primary rounded-tr-xl shadow-lg shadow-primary/50"}),e.jsx("div",{className:"absolute -bottom-1 -left-1 w-16 h-16 border-b-[6px] border-l-[6px] border-primary rounded-bl-xl shadow-lg shadow-primary/50"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-16 h-16 border-b-[6px] border-r-[6px] border-primary rounded-br-xl shadow-lg shadow-primary/50"}),e.jsx("div",{className:"absolute top-1/2 left-4 right-4 h-px bg-primary/40"}),e.jsx("div",{className:"absolute left-1/2 top-4 bottom-4 w-px bg-primary/40"}),M&&e.jsx("div",{className:"absolute top-4 left-0 right-0 flex justify-center",children:e.jsxs("div",{className:"px-4 py-2 bg-black/70 backdrop-blur-md rounded-full flex items-center gap-2",children:[e.jsx(M.icon,{size:16,className:M.color}),e.jsx("span",{className:`text-xs font-medium ${M.color}`,children:M.text})]})}),te&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"bg-black/70 backdrop-blur-md rounded-2xl p-6 flex flex-col items-center gap-3",children:[e.jsx(ye,{size:32,className:"text-primary animate-spin"}),e.jsx("span",{className:"text-white text-sm",children:"ÁîªÂÉè„ÇíËß£Êûê‰∏≠..."})]})}),e.jsxs("div",{className:"absolute -bottom-16 left-0 right-0 text-center",children:[e.jsx("p",{className:"text-white/90 text-sm font-medium drop-shadow-lg mb-2",children:"„É¨„Ç∑„Éº„Éà„ÇíÊû†ÂÜÖ„Å´Âêà„Çè„Åõ„Å¶„Åè„Å†„Åï„ÅÑ"}),e.jsx("p",{className:"text-white/70 text-xs drop-shadow-lg",children:"„Çø„ÉÉ„Éó„Åó„Å¶„Éï„Ç©„Éº„Ç´„ÇπË™øÊï¥"})]})]})})})]}),e.jsx("canvas",{ref:d,className:"hidden"}),e.jsx("canvas",{ref:h,className:"hidden"})]}),e.jsx("div",{className:"p-6 bg-black flex justify-center items-center gap-8 pb-safe",children:g?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:oe,className:"flex flex-col items-center gap-2 text-white/80 hover:text-white transition-colors active:scale-95",children:[e.jsx("div",{className:"p-4 rounded-full bg-white/10 hover:bg-white/20 transition-colors",children:e.jsx(O,{size:24})}),e.jsx("span",{className:"text-xs font-medium",children:"ÊíÆ„ÇäÁõ¥„Åô"})]}),e.jsxs("button",{onClick:le,className:"flex flex-col items-center gap-2 text-primary hover:text-primary/80 transition-all active:scale-95",children:[e.jsx("div",{className:"p-5 rounded-full bg-primary/20 border-4 border-primary shadow-lg shadow-primary/30 hover:shadow-primary/50",children:e.jsx(F,{size:36})}),e.jsx("span",{className:"text-xs font-bold",children:"„Åì„ÅÆÁîªÂÉè„Çí‰ΩøÁî®"})]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("button",{onClick:U,disabled:y,className:"relative w-20 h-20 rounded-full border-4 border-white flex items-center justify-center group active:scale-95 transition-all disabled:opacity-50 shadow-2xl",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white group-hover:bg-gray-200 transition-colors"}),y&&e.jsx("div",{className:"absolute inset-0 rounded-full bg-white/30 animate-ping"})]}),a&&(S==null?void 0:S.hasReceipt)&&e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-green-400 text-xs font-medium animate-pulse",children:"Ëá™ÂãïÊíÆÂΩ±ÂæÖÊ©ü‰∏≠..."})})]})})]})},ze=async i=>{try{console.log("„É¨„Ç∑„Éº„Éà„Çí‰øùÂ≠ò‰∏≠:",i);const{data:r,error:n}=await _.from("receipts").insert([i]).select().single();if(n)throw console.error("„É¨„Ç∑„Éº„Éà‰øùÂ≠ò„Ç®„É©„Éº:",n),n;return console.log("„É¨„Ç∑„Éº„Éà‰øùÂ≠òÊàêÂäü:",r),r}catch(r){return console.error("saveReceipt „Ç®„É©„Éº:",r),null}},He=async i=>{try{console.log("„É¨„Ç∑„Éº„Éà„ÇíÂèñÂæó‰∏≠:",{userId:i});const{data:r,error:n}=await _.from("receipts").select("*").eq("user_id",i).order("created_at",{ascending:!1});if(n)throw console.error("„É¨„Ç∑„Éº„ÉàÂèñÂæó„Ç®„É©„Éº:",n),n;return console.log("„É¨„Ç∑„Éº„ÉàÂèñÂæóÊàêÂäü:",{count:r==null?void 0:r.length,data:r}),r||[]}catch(r){return console.error("getReceipts „Ç®„É©„Éº:",r),[]}},Fe=async(i,r)=>{try{console.log("„É¨„Ç∑„Éº„Éà„ÇíÊõ¥Êñ∞‰∏≠:",{id:i,updates:r});const{data:n,error:d}=await _.from("receipts").update({...r,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(d)throw console.error("„É¨„Ç∑„Éº„ÉàÊõ¥Êñ∞„Ç®„É©„Éº:",d),d;return console.log("„É¨„Ç∑„Éº„ÉàÊõ¥Êñ∞ÊàêÂäü:",n),n}catch(n){return console.error("updateReceipt „Ç®„É©„Éº:",n),null}},Te=async(i,r)=>(console.log("„É¨„Ç∑„Éº„Éà„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞‰∏≠:",{id:i,status:r}),Fe(i,{status:r})),Ae=async(i,r,n,d)=>{try{if(console.log("„É¨„Ç∑„Éº„ÉàÊâøË™ç„Å®ÂèñÂºï‰ΩúÊàê„ÇíÈñãÂßã:",{receiptId:i,receipt:r,businessType:n,userId:d}),!d)throw new Error("„É¶„Éº„Ç∂„ÉºID„ÅåÁÑ°Âäπ„Åß„Åô");if(!n)throw new Error("Ê•≠ÊÖãÊÉÖÂ†±„ÅåÁÑ°Âäπ„Åß„Åô");if(!await Te(i,"approved"))throw new Error("„É¨„Ç∑„Éº„Éà„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");const b={item:r.merchant,amount:r.amount,date:r.date,category:r.category,type:"expense",description:r.description||`${r.merchant}„Åß„ÅÆ„É¨„Ç∑„Éº„Éà`,receipt_url:null,creator:d,tags:[],location:null,recurring:!1,recurring_frequency:null},x=n==="individual"?"individual_transactions":"corporation_transactions",g=n==="corporation"?{...b,department:null,project_code:null,approval_status:"approved"}:b;console.log("„Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥„Çí‰øùÂ≠ò‰∏≠:",{tableName:x,transactionPayload:g});const{data:l,error:y}=await _.from(x).insert([g]).select().single();if(y)throw console.error("„Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥‰øùÂ≠ò„Ç®„É©„Éº:",y),console.error("„ÉÜ„Éº„Éñ„É´Âêç:",x),console.error("„Éö„Ç§„É≠„Éº„Éâ:",g),new Error(`${x}„Å∏„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${y.message}`);console.log(`${x}„Å´‰øùÂ≠òÊàêÂäü:`,l);const p={item:r.merchant,amount:r.amount,category:r.category,confidence:r.confidence,ai_category:Le(r.category),manual_verified:!0,original_text:r.description||"",receipt_url:null,location:null,creator:d,ai_suggestions:[],learning_feedback:`ÊâøË™çÊ∏à„Åø: ‰ø°È†ºÂ∫¶${r.confidence}%`,processing_time:null};console.log("AI„Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥„Çí‰øùÂ≠ò‰∏≠:",{aiTransactionData:p});const{data:k,error:w}=await _.from("ai_transactions").insert([p]).select().single();return w?console.warn("AI „Éà„É©„É≥„Ç∂„ÇØ„Ç∑„Éß„É≥‰øùÂ≠ò„Ç®„É©„ÉºÔºàË≠¶Âëä„ÅÆ„ÅøÔºâ:",w):console.log("ai_transactions„Å´‰øùÂ≠òÊàêÂäü:",k),{success:!0}}catch(h){return console.error("approveReceiptAndCreateTransaction „Ç®„É©„Éº:",h),{success:!1,error:h instanceof Error?h.message:"‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü"}}},Le=i=>({ÊóÖË≤ª‰∫§ÈÄöË≤ª:"‰∫§ÈÄöË≤ª",‰∫§ÈÄöË≤ª:"‰∫§ÈÄöË≤ª",Êé•ÂæÖ‰∫§ÈöõË≤ª:"È£üË≤ª",È£üË≤ª:"È£üË≤ª",Ê∂àËÄóÂìÅË≤ª:"Ê∂àËÄóÂìÅË≤ª",ÈÄö‰ø°Ë≤ª:"ÈÄö‰ø°Ë≤ª",Ê∞¥ÈÅìÂÖâÁÜ±Ë≤ª:"ÂÖâÁÜ±Ë≤ª",ÂÖâÁÜ±Ë≤ª:"ÂÖâÁÜ±Ë≤ª"})[i]||"„Åù„ÅÆ‰ªñ",qe=[{value:"È£üË≤ª",label:"üçΩÔ∏è È£üË≤ª",description:"È£üÊñôÂìÅ„ÄÅÈ£≤Êñô„ÄÅÂ§ñÈ£ü„Å™„Å©"},{value:"‰∫§ÈÄöË≤ª",label:"üöÉ ‰∫§ÈÄöË≤ª",description:"ÈõªËªä„ÄÅ„Éê„Çπ„ÄÅ„Çø„ÇØ„Ç∑„Éº„ÄÅ„Ç¨„ÇΩ„É™„É≥„Å™„Å©"},{value:"Ê∂àËÄóÂìÅË≤ª",label:"üì¶ Ê∂àËÄóÂìÅË≤ª",description:"‰∫ãÂãôÁî®ÂìÅ„ÄÅÊó•Áî®ÂìÅ„Å™„Å©"},{value:"Êé•ÂæÖ‰∫§ÈöõË≤ª",label:"üçª Êé•ÂæÖ‰∫§ÈöõË≤ª",description:"ÂèñÂºïÂÖà„Å®„ÅÆÈ£≤È£ü„ÄÅË¥àÁ≠îÂìÅ„Å™„Å©"},{value:"ÈÄö‰ø°Ë≤ª",label:"üì± ÈÄö‰ø°Ë≤ª",description:"Êê∫Â∏ØÈõªË©±„ÄÅ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„Éà„Å™„Å©"},{value:"Ê∞¥ÈÅìÂÖâÁÜ±Ë≤ª",label:"üí° Ê∞¥ÈÅìÂÖâÁÜ±Ë≤ª",description:"ÈõªÊ∞ó„ÄÅ„Ç¨„Çπ„ÄÅÊ∞¥ÈÅì„Å™„Å©"},{value:"ÂÆ∂Ë≥É",label:"üè† ÂÆ∂Ë≥É",description:"‰∫ãÂãôÊâÄÂÆ∂Ë≥É„ÄÅÈßêËªäÂ†¥‰ª£„Å™„Å©"},{value:"ÈõëË≤ª",label:"üìù ÈõëË≤ª",description:"„Åù„ÅÆ‰ªñ„ÅÆÁµåË≤ª"}],Ue=({receiptData:i,onClose:r,onRetake:n})=>{console.log("üéØ ReceiptResultModal„ÅåÂëº„Å≥Âá∫„Åï„Çå„Åæ„Åó„Åü",{receiptData:i});const{user:d}=he(),{currentBusinessType:h}=be(),b=pe(),[x,g]=c.useState(!1),[l,y]=c.useState(i||{merchant:"",date:new Date().toISOString().split("T")[0],amount:0,category:"ÈõëË≤ª",taxRate:10,confidence:0}),[p,k]=c.useState((i==null?void 0:i.category)||"ÈõëË≤ª"),[w,j]=c.useState(!1),T=a=>{k(a),y({...l,category:a})},E=(a,R)=>{y({...l,[a]:R})},B=async()=>{if(!(d!=null&&d.id)){alert("„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô");return}j(!0);try{const a=(h==null?void 0:h.business_type)||"individual";if(console.log("„É¨„Ç∑„Éº„Éà‰øùÂ≠ò„ÇíÈñãÂßã:",{user:d,businessType:a,editedData:l,selectedCategory:p}),!d.id)throw new Error("„É¶„Éº„Ç∂„ÉºID„ÅåÁÑ°Âäπ„Åß„Åô");console.log("„É¶„Éº„Ç∂„ÉºË™çË®ºÊÉÖÂ†±:",d),console.log("ÁèæÂú®„ÅÆÊ•≠ÊÖã:",h);const R={user_id:d.id,date:l.date,merchant:l.merchant,amount:l.amount,category:p,description:`${l.merchant}„Åß„ÅÆË≥ºÂÖ•`,confidence:l.confidence,status:"approved",tax_rate:l.taxRate,confidence_scores:{merchant:l.confidence,date:l.confidence,amount:l.confidence}},v=await ze(R);if(console.log("„É¨„Ç∑„Éº„Éà‰øùÂ≠òÁµêÊûú:",{savedReceipt:v}),!v||!v.id)throw new Error("„É¨„Ç∑„Éº„Éà„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");const I=await Ae(v.id,v,a,d.id);if(console.log("ÂèñÂºï‰ΩúÊàêÁµêÊûú:",{result:I}),I.success)window.dispatchEvent(new CustomEvent("transactionRecorded")),alert("‚úÖ „É¨„Ç∑„Éº„Éà„ÅåË®òÈå≤„Åï„Çå„Åæ„Åó„ÅüÔºÅ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´ÂèçÊò†„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ"),b("/dashboard"),r();else throw new Error(I.error||"‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}catch(a){console.error("‰øùÂ≠ò„Ç®„É©„Éº:",a),alert(`‚ùå „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${a.message}`)}finally{j(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 text-gray-900 dark:text-white p-4 border-b border-gray-200 dark:border-gray-700 rounded-t-2xl z-10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mr-2"}),e.jsx("h2",{className:"text-lg font-bold",children:"„É¨„Ç∑„Éº„ÉàË™≠„ÅøÂèñ„ÇäÁµêÊûú"})]}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(K,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"ÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„Å¶„ÄÅ„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 border-b border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"AIË™çË≠òÁ≤æÂ∫¶"})]}),e.jsxs("span",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:[Math.round(l.confidence),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-1.5 rounded-full transition-all duration-500",style:{width:`${l.confidence}%`}})})]}),e.jsxs("div",{className:"p-5 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx("div",{className:"w-1 h-4 bg-blue-600 rounded-full mr-2"}),"ÊäΩÂá∫„Éá„Éº„Çø"]}),e.jsx("button",{onClick:()=>g(!x),className:`flex items-center px-2.5 py-1.5 text-xs rounded-lg font-medium transition-all ${x?"bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-800":"bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-800"}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"ÂÆå‰∫Ü"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),"Á∑®ÈõÜ"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:[e.jsx("span",{className:"w-4 h-4 bg-blue-100 dark:bg-blue-900 rounded mr-1 flex items-center justify-center text-[8px]",children:"üè™"}),"Â∫óËàóÂêç"]}),x?e.jsx("input",{type:"text",value:l.merchant,onChange:a=>E("merchant",a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm",placeholder:"Â∫óËàóÂêç„ÇíÂÖ•Âäõ"}):e.jsx("div",{className:"px-3 py-2 bg-blue-50 dark:bg-blue-900/50 rounded-lg text-sm font-medium text-gray-900 dark:text-white border border-blue-100 dark:border-blue-800/50",children:l.merchant})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:[e.jsx("span",{className:"w-4 h-4 bg-green-100 dark:bg-green-900 rounded mr-1 flex items-center justify-center text-[8px]",children:"üìÖ"}),"Êó•‰ªò"]}),x?e.jsx("input",{type:"date",value:l.date,onChange:a=>E("date",a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm"}):e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700 rounded-lg text-sm font-medium text-gray-900 dark:text-white border border-gray-200 dark:border-gray-600",children:l.date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:[e.jsx("span",{className:"w-4 h-4 bg-yellow-100 dark:bg-yellow-900 rounded mr-1 flex items-center justify-center text-[8px]",children:"üí∞"}),"ÈáëÈ°ç"]}),x?e.jsx("input",{type:"number",value:l.amount,onChange:a=>E("amount",parseInt(a.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm",placeholder:"ÈáëÈ°ç„ÇíÂÖ•Âäõ"}):e.jsxs("div",{className:"px-3 py-2 bg-yellow-50 dark:bg-yellow-900/50 rounded-lg text-sm font-bold text-yellow-700 dark:text-yellow-300 border border-yellow-200 dark:border-yellow-800/50",children:["¬•",l.amount.toLocaleString()]})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-white flex items-center mb-3",children:[e.jsx("div",{className:"w-1 h-4 bg-purple-600 rounded-full mr-2"}),"„Ç´„ÉÜ„Ç¥„É™„ÇíÈÅ∏Êäû",e.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 text-[10px] font-bold rounded-full",children:"ÂøÖÈ†à"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:qe.map(a=>e.jsxs("button",{onClick:()=>T(a.value),className:`p-3 rounded-lg border text-left transition-all text-sm ${p===a.value?"border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/50 shadow-sm":"border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-base mr-2",children:a.label.split(" ")[0]}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:a.label.split(" ")[1]}),p===a.value&&e.jsx(F,{className:"w-4 h-4 ml-auto text-blue-600 dark:text-blue-400"})]}),e.jsx("div",{className:"text-[10px] text-gray-600 dark:text-gray-400 mt-1",children:a.description})]},a.value))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 dark:bg-gray-700 p-6 rounded-b-2xl border-t border-gray-200 dark:border-gray-600 flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("button",{onClick:n,className:"w-full sm:w-auto px-4 py-2.5 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 text-gray-700 dark:text-white rounded-lg hover:bg-gray-50 dark:hover:bg-gray-500 transition-all text-sm font-medium flex items-center justify-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"ÊíÆ„ÇäÁõ¥„Åô"]}),e.jsx("button",{onClick:B,disabled:w||!p,className:`w-full sm:w-auto px-4 py-2.5 rounded-lg font-medium text-sm flex items-center justify-center transition-all ${w||!p?"bg-gray-300 dark:bg-gray-500 text-gray-500 dark:text-gray-300 cursor-not-allowed":"bg-blue-600 dark:bg-blue-500 text-white hover:bg-blue-700 dark:hover:bg-blue-400 shadow-sm"}`,children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"‰øùÂ≠ò‰∏≠..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"„Éá„Éº„Çø„ÇíË®òÈå≤„Åô„Çã"]})})]})]})})};export{De as R,q as T,O as a,Ue as b,Ae as c,He as g,Te as u};
