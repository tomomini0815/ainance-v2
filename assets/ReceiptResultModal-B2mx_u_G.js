import{o as T,e as $,l as A,r as f,n as F,j as e,F as k,X as z,d as N,a0 as M}from"./index-Ca_aGh3E.js";import{R as O}from"./rotate-ccw-RYn08srC.js";const q=[{value:"é£Ÿè²»",label:"ğŸ½ï¸ é£Ÿè²»",description:"é£Ÿæ–™å“ã€é£²æ–™ã€å¤–é£Ÿãªã©"},{value:"äº¤é€šè²»",label:"ğŸšƒ äº¤é€šè²»",description:"é›»è»Šã€ãƒã‚¹ã€ã‚¿ã‚¯ã‚·ãƒ¼ã€ã‚¬ã‚½ãƒªãƒ³ãªã©"},{value:"æ¶ˆè€—å“è²»",label:"ğŸ“¦ æ¶ˆè€—å“è²»",description:"äº‹å‹™ç”¨å“ã€æ—¥ç”¨å“ãªã©"},{value:"æ¥å¾…äº¤éš›è²»",label:"ğŸ» æ¥å¾…äº¤éš›è²»",description:"å–å¼•å…ˆã¨ã®é£²é£Ÿã€è´ˆç­”å“ãªã©"},{value:"é€šä¿¡è²»",label:"ğŸ“± é€šä¿¡è²»",description:"æºå¸¯é›»è©±ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãªã©"},{value:"æ°´é“å…‰ç†±è²»",label:"ğŸ’¡ æ°´é“å…‰ç†±è²»",description:"é›»æ°—ã€ã‚¬ã‚¹ã€æ°´é“ãªã©"},{value:"å½¹å“¡å ±é…¬",label:"ğŸ‘” å½¹å“¡å ±é…¬",description:"ä»£è¡¨è€…ã¸ã®çµ¦ä¸ãƒ»å ±é…¬æ”¯æ‰•ã„"},{value:"å®¶è³ƒ",label:"ğŸ  å®¶è³ƒ",description:"äº‹å‹™æ‰€å®¶è³ƒã€é§è»Šå ´ä»£ãªã©"},{value:"é›‘è²»",label:"ğŸ“ é›‘è²»",description:"ãã®ä»–ã®çµŒè²»"}],H=({receiptData:d,onClose:b,onRetake:C,onSave:x,mode:h="create",transactionId:j})=>{console.log("ğŸ¯ ReceiptResultModalãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ",{receiptData:d,mode:h});const{user:s}=T(),{currentBusinessType:i}=$(),{createTransaction:E,updateTransaction:R}=A(s==null?void 0:s.id,i==null?void 0:i.business_type),[r,m]=f.useState(d||{merchant:"",date:new Date().toISOString().split("T")[0],amount:0,category:"é›‘è²»",taxRate:10,confidence:0}),[n,S]=f.useState((d==null?void 0:d.category)||"é›‘è²»"),[y,v]=f.useState(!1);F.useEffect(()=>()=>{const t=document.querySelector('meta[name="viewport"]');t&&(t.getAttribute("content"),t.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"),setTimeout(()=>{t.setAttribute("content","width=device-width, initial-scale=1.0")},100))},[]);const _=t=>{S(t),m({...r,category:t})},p=(t,a)=>{m({...r,[t]:a})},I=async()=>{if(!(s!=null&&s.id)){alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™");return}v(!0);try{const t=(i==null?void 0:i.business_type)||"individual";if(console.log("ãƒ¬ã‚·ãƒ¼ãƒˆä¿å­˜ã‚’é–‹å§‹:",{user:s,businessType:t,editedData:r,selectedCategory:n}),!s.id)throw new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒç„¡åŠ¹ã§ã™");console.log("ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±:",s),console.log("ç¾åœ¨ã®æ¥­æ…‹:",i);let a=r.merchant;if(r.items&&r.items.length>0?a+=`
ã€å†…è¨³ã€‘
`+r.items.map(c=>`ãƒ»${c.name}: Â¥${c.line_total||c.price}`).join(`
`):h==="edit"&&d.items&&d.items.length>0,h==="edit"){if(!j)throw new Error("æ›´æ–°å¯¾è±¡ã®IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");const c={item:r.merchant,amount:r.amount,date:r.date,category:n,description:a},w=await R(String(j),c);if(w.error)throw w.error;alert("âœ… å–å¼•å†…å®¹ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),x&&x(),window.dispatchEvent(new CustomEvent("transactionRecorded")),b();return}const o={user_id:s.id,date:r.date,merchant:r.merchant,amount:r.amount,category:n,description:a,confidence:r.confidence,status:"pending",tax_rate:r.taxRate,confidence_scores:{merchant:r.confidence,date:r.confidence,amount:r.confidence}},l=await M(o);if(console.log("ãƒ¬ã‚·ãƒ¼ãƒˆä¿å­˜çµæœ:",{savedReceipt:l}),!l||!l.id)throw new Error("ãƒ¬ã‚·ãƒ¼ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");const g={item:r.merchant,amount:r.amount,date:r.date,category:n,type:"expense",description:a,approval_status:"pending",tags:["receipt_created",`receipt_id:${l.id}`],creator:s.id},u=await E(g);if(console.log("ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¿å­˜çµæœ:",u),u.error)throw console.error("ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¿å­˜å¤±æ•—:",u.error),u.error;alert("âœ… ãƒ¬ã‚·ãƒ¼ãƒˆãŒã‚¤ãƒ³ãƒœãƒƒã‚¯ã‚¹ã¨ãƒ¬ã‚·ãƒ¼ãƒˆä¸€è¦§ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚å†…å®¹ã‚’ç¢ºèªã—ã¦æ‰¿èªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚"),x&&x(),window.dispatchEvent(new CustomEvent("transactionRecorded")),b()}catch(t){console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:",t),alert(`âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${t.message}`)}finally{v(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-hidden touch-none animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto touch-auto animate-in zoom-in-95 duration-300",children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 text-gray-900 dark:text-white p-4 border-b border-gray-200 dark:border-gray-700 rounded-t-2xl z-10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 mr-2"}),e.jsx("h2",{className:"text-lg font-bold",children:"ãƒ¬ã‚·ãƒ¼ãƒˆèª­ã¿å–ã‚Šçµæœ"})]}),e.jsx("button",{onClick:b,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(z,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"å†…å®¹ã‚’ç¢ºèªã—ã¦ã€ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 border-b border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"AIèªè­˜ç²¾åº¦"})]}),e.jsxs("span",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:[Math.round(r.confidence),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-1.5 rounded-full transition-all duration-500",style:{width:`${r.confidence}%`}})})]}),d.validationErrors&&d.validationErrors.length>0&&e.jsx("div",{className:"mx-5 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-red-500 dark:text-red-400",children:"âš ï¸"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆ"}),e.jsx("div",{className:"mt-1 text-xs text-red-700 dark:text-red-400",children:e.jsx("ul",{className:"list-disc pl-4 space-y-1",children:d.validationErrors.map((t,a)=>e.jsx("li",{children:t},a))})})]})]})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx("div",{className:"w-1 h-4 bg-blue-600 rounded-full mr-2"}),"æŠ½å‡ºãƒ‡ãƒ¼ã‚¿"]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:[e.jsx("span",{className:"w-4 h-4 bg-blue-100 dark:bg-blue-900 rounded mr-1 flex items-center justify-center text-[8px]",children:"ğŸª"}),"åº—èˆ—å"]}),e.jsx("input",{type:"text",value:r.merchant,onChange:t=>p("merchant",t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-base sm:text-sm",placeholder:"åº—èˆ—åã‚’å…¥åŠ›"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:[e.jsx("span",{className:"w-4 h-4 bg-green-100 dark:bg-green-900 rounded mr-1 flex items-center justify-center text-[8px]",children:"ğŸ“…"}),"æ—¥ä»˜"]}),e.jsx("input",{type:"date",value:r.date,onChange:t=>p("date",t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-base sm:text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center",children:[e.jsx("span",{className:"w-4 h-4 bg-yellow-100 dark:bg-yellow-900 rounded mr-1 flex items-center justify-center text-[8px]",children:"ğŸ’°"}),"é‡‘é¡"]}),e.jsx("input",{type:"number",value:r.amount,onChange:t=>p("amount",parseInt(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-base sm:text-sm",placeholder:"é‡‘é¡ã‚’å…¥åŠ›"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-bold text-gray-900 dark:text-white flex items-center mb-3",children:[e.jsx("div",{className:"w-1 h-4 bg-purple-600 rounded-full mr-2"}),"ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ",e.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 text-[10px] font-bold rounded-full",children:"å¿…é ˆ"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:q.map(t=>e.jsxs("button",{onClick:()=>_(t.value),className:`p-3 rounded-lg border text-left transition-all text-sm ${n===t.value?"border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/50 shadow-sm":"border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-400 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-base mr-2",children:t.label.split(" ")[0]}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.label.split(" ")[1]}),n===t.value&&e.jsx(N,{className:"w-4 h-4 ml-auto text-blue-600 dark:text-blue-400"})]}),e.jsx("div",{className:"text-[10px] text-gray-600 dark:text-gray-400 mt-1",children:t.description})]},t.value))})]}),r.items&&r.items.length>0&&e.jsxs("div",{className:"mt-4 border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-2 flex items-center justify-between",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(k,{className:"w-4 h-4 mr-1 text-gray-500"}),"èª­ã¿å–ã£ãŸæ˜ç´° (ç·¨é›†å¯)",e.jsxs("span",{className:"ml-2 px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs rounded-full",children:[r.items.length,"ä»¶"]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 max-h-40 overflow-y-auto shadow-inner",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-900 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-2/3",children:"å“å"}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-1/3",children:"é‡‘é¡"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:r.items.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-1 py-1 text-xs text-gray-900 dark:text-gray-300",children:e.jsx("input",{type:"text",value:t.name,onChange:o=>{const l=[...r.items||[]];l[a]={...t,name:o.target.value},m({...r,items:l})},className:"w-full px-2 py-1 bg-transparent border-0 focus:ring-1 focus:ring-blue-500 rounded text-base sm:text-xs"})}),e.jsx("td",{className:"px-1 py-1 text-xs text-right text-gray-900 dark:text-gray-300",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx("span",{className:"text-gray-400 mr-1",children:"Â¥"}),e.jsx("input",{type:"number",value:t.line_total||t.price||0,onChange:o=>{const l=parseInt(o.target.value)||0,g=[...r.items||[]];g[a]={...t,line_total:l,price:l},m({...r,items:g})},className:"w-20 px-1 py-1 bg-transparent border-0 focus:ring-1 focus:ring-blue-500 rounded text-right text-base sm:text-xs font-mono"})]})})]},a))})]})}),e.jsx("p",{className:"mt-1 text-[10px] text-gray-500 text-right",children:"â€»æ˜ç´°ã‚’ä¿®æ­£ã—ã¦ã‚‚åˆè¨ˆé‡‘é¡ã¯è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã›ã‚“ï¼ˆå¿…è¦ãªã‚‰ä¸Šéƒ¨ã§ä¿®æ­£ã—ã¦ãã ã•ã„ï¼‰"})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 dark:bg-gray-700 p-4 rounded-b-2xl border-t border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("button",{onClick:C,className:"w-full sm:w-auto px-4 py-2.5 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 text-gray-700 dark:text-white rounded-lg hover:bg-gray-50 dark:hover:bg-gray-500 transition-all text-sm font-medium flex items-center justify-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"æ’®ã‚Šç›´ã™"]}),e.jsx("button",{onClick:I,disabled:y||!n,className:`w-full sm:w-auto px-4 py-2.5 rounded-lg font-medium text-sm flex items-center justify-center transition-all ${y||!n?"bg-gray-300 dark:bg-gray-500 text-gray-500 dark:text-gray-300 cursor-not-allowed":"bg-primary text-white hover:bg-primary/90 shadow-sm"}`,children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"ä¿å­˜ä¸­..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã™ã‚‹"]})})]})]})})};export{H as R};
