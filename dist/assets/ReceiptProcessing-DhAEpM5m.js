const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-2uPoJ3v2.js","assets/index-DbpAXpfG.js","assets/index-BE0n4d-m.css"])))=>i.map(i=>d[i]);
import{c as B,j as e,r as o,X as P,C as U,s as G,f as fe,F as re,S as ge,_ as je}from"./index-DbpAXpfG.js";import{U as z}from"./upload-D5UFsZaS.js";import{A as Ne}from"./arrow-right-CT3qbKYu.js";import{C as ve}from"./circle-check-big-C3mejhXj.js";import{C as ne}from"./camera-jajAmbNx.js";import{R as ye}from"./refresh-cw-C34BTyf2.js";import{E as le}from"./eye-CI7efab4.js";import{S as we}from"./save-3EDGNv8l.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Se=B("file-image",Ce);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],q=B("rotate-ccw",Re);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],de=B("triangle-alert",ke),Ae=({onUpload:i})=>e.jsxs("label",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-primary hover:bg-surface-highlight transition-colors block",children:[e.jsx("input",{type:"file",accept:"image/*,application/pdf",multiple:!0,onChange:i,className:"hidden"}),e.jsx(z,{className:"w-8 h-8 text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-main",children:"ファイルを選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"PNG, JPG, PDF対応"})]}),Me=({onCapture:i,onClose:m})=>{const n=o.useRef(null),x=o.useRef(null),[h,v]=o.useState(null),[S,y]=o.useState(null),[C,O]=o.useState(!1),[R,k]=o.useState(null);o.useEffect(()=>((async()=>{try{const j={video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}},r=await navigator.mediaDevices.getUserMedia(j);v(r),n.current&&(n.current.srcObject=r)}catch(j){console.error("Camera error:",j),k("カメラを起動できませんでした。権限を確認してください。")}})(),()=>{h&&h.getTracks().forEach(j=>j.stop())}),[]),o.useEffect(()=>()=>{h&&h.getTracks().forEach(u=>u.stop())},[h]);const D=o.useCallback(()=>{if(n.current&&x.current){O(!0);const u=n.current,j=x.current;j.width=u.videoWidth,j.height=u.videoHeight;const r=j.getContext("2d");if(r){r.drawImage(u,0,0);const T=j.toDataURL("image/jpeg",.9);y(T)}O(!1)}},[]),A=()=>{y(null)},_=()=>{S&&fetch(S).then(u=>u.blob()).then(u=>i(u))};return R?e.jsx("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center text-white p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-4",children:R}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-white/20 rounded-full",children:"閉じる"})]})}):e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-20 bg-gradient-to-b from-black/50 to-transparent",children:e.jsx("button",{onClick:m,className:"p-2 text-white/80 hover:text-white rounded-full bg-black/20 backdrop-blur-md",children:e.jsx(P,{size:24})})}),e.jsxs("div",{className:"flex-1 relative overflow-hidden bg-black",children:[S?e.jsx("img",{src:S,alt:"Captured",className:"w-full h-full object-contain"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:e.jsx("div",{className:"absolute inset-0 border-[40px] border-black/50",children:e.jsxs("div",{className:"w-full h-full border-2 border-white/30 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-primary rounded-tl-lg"}),e.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-primary rounded-tr-lg"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-primary rounded-bl-lg"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-primary rounded-br-lg"}),e.jsx("div",{className:"absolute top-1/2 left-4 right-4 h-px bg-white/20"}),e.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center text-white/80 text-sm font-medium drop-shadow-md",children:"レシートを枠内に合わせてください"})]})})})]}),e.jsx("canvas",{ref:x,className:"hidden"})]}),e.jsx("div",{className:"p-8 bg-black flex justify-center items-center gap-12 pb-12",children:S?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:A,className:"flex flex-col items-center gap-2 text-white/80 hover:text-white transition-colors",children:[e.jsx("div",{className:"p-4 rounded-full bg-white/10",children:e.jsx(q,{size:24})}),e.jsx("span",{className:"text-xs",children:"撮り直す"})]}),e.jsxs("button",{onClick:_,className:"flex flex-col items-center gap-2 text-primary hover:text-primary/80 transition-colors",children:[e.jsx("div",{className:"p-4 rounded-full bg-primary/20 border-2 border-primary",children:e.jsx(U,{size:32})}),e.jsx("span",{className:"text-xs font-bold",children:"これを使う"})]})]}):e.jsx("button",{onClick:D,disabled:C,className:"relative w-20 h-20 rounded-full border-4 border-white flex items-center justify-center group active:scale-95 transition-transform",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-white group-hover:bg-gray-200 transition-colors"})})})]})},Oe=async i=>{try{const{data:m,error:n}=await G.from("receipts").insert([i]).select().single();if(n)throw console.error("レシート保存エラー:",n),n;return console.log("レシート保存成功:",m),m}catch(m){return console.error("saveReceipt エラー:",m),null}},Ie=async i=>{try{const{data:m,error:n}=await G.from("receipts").select("*").eq("user_id",i).order("created_at",{ascending:!1});if(n)throw console.error("レシート取得エラー:",n),n;return m||[]}catch(m){return console.error("getReceipts エラー:",m),[]}},Pe=async(i,m)=>{try{const{data:n,error:x}=await G.from("receipts").update({...m,updated_at:new Date().toISOString()}).eq("id",i).select().single();if(x)throw console.error("レシート更新エラー:",x),x;return console.log("レシート更新成功:",n),n}catch(n){return console.error("updateReceipt エラー:",n),null}},ce=async(i,m)=>Pe(i,{status:m}),ze=()=>{const{user:i}=fe(),[m,n]=o.useState([]),[x,h]=o.useState({isProcessing:!1,retryCount:0}),[v,S]=o.useState(null),[y,C]=o.useState({}),[O,R]=o.useState(!1),[k,D]=o.useState(""),[A,_]=o.useState("all"),[u,j]=o.useState("all"),[r,T]=o.useState(null),[ie,$]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!(i!=null&&i.uid))return;const s=(await Ie(i.uid)).map(l=>({id:l.id,date:l.date,merchant:l.merchant,amount:l.amount,category:l.category,description:l.description,confidence:l.confidence,status:l.status,taxRate:l.tax_rate,confidenceScores:l.confidence_scores}));n(s)})()},[i]);const H=()=>{R(!0)},oe=()=>{R(!1)},L=async t=>{R(!1),await xe(t)},xe=async t=>{h({isProcessing:!0,retryCount:0,progress:0,currentStep:"OCR処理を開始しています..."});const a={id:Date.now().toString(),date:new Date().toISOString().split("T")[0],merchant:"処理中...",amount:0,category:"未分類",description:"解析中...",confidence:0,status:"pending"};n(s=>[a,...s]);try{const s=await je(()=>import("./index-2uPoJ3v2.js").then(d=>d.i),__vite__mapDeps([0,1,2])),l=URL.createObjectURL(t);h(d=>({...d,progress:10,currentStep:"OCRエンジンを初期化中..."}));const p=await s.recognize(l,"jpn+eng",{logger:d=>{if(d.status==="recognizing text"){const b=Math.round(d.progress*80)+10;h(N=>({...N,progress:b,currentStep:`テキストを認識中... ${Math.round(d.progress*100)}%`}))}}});URL.revokeObjectURL(l),console.log("OCR結果:",p.data.text),h(d=>({...d,progress:90,currentStep:"データを抽出中..."}));const c=W(p.data.text);if(n(d=>d.map(b=>b.id===a.id?{...b,merchant:c.merchant||"不明",date:c.date||b.date,amount:c.amount||0,taxRate:c.taxRate||0,description:c.description||"OCR処理完了",confidence:c.confidence||70,confidenceScores:c.confidenceScores}:b)),h(d=>({...d,progress:95,currentStep:"データベースに保存中..."})),i!=null&&i.uid){const d=await Oe({user_id:i.uid,date:c.date||a.date,merchant:c.merchant||"不明",amount:c.amount||0,category:c.category||"未分類",description:c.description||"OCR処理完了",confidence:c.confidence||70,status:"pending",tax_rate:c.taxRate||0,confidence_scores:c.confidenceScores});d&&d.id&&n(b=>b.map(N=>N.id===a.id?{...N,id:d.id}:N))}h(d=>({...d,progress:100,currentStep:"完了"})),setTimeout(()=>{h({isProcessing:!1,retryCount:0})},500)}catch(s){console.error("OCR処理エラー:",s),n(l=>l.map(p=>p.id===a.id?{...p,merchant:"解析エラー",description:`OCR処理に失敗しました: ${s.message}`,confidence:0}:p)),h({isProcessing:!1,retryCount:0,errorMessage:`OCR処理に失敗しました: ${s.message}`})}},W=t=>{var te,se,ae;console.log("抽出対象テキスト:",t);const a={totalAmount:[/合計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/総計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/小計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/計[\s:：]*[¥￥]*\s*([0-9,]+)/i,/total[\s:：]*[¥￥]*\s*([0-9,]+)/i,/[¥￥]\s*([0-9,]+)/],date:[/(\d{4})[年\/\-](\d{1,2})[月\/\-](\d{1,2})[日]?/,/(\d{2,4})[\/\-](\d{1,2})[\/\-](\d{1,2})/,/(\d{4})\.(\d{2})\.(\d{2})/],taxRate:/[税消費]*税?\s*([0-9]+)\s*%/i};let s="不明",l=0;const p=["セブンイレブン","セブン-イレブン","セブン","ローソン","LAWSON","ファミリーマート","ファミマ","FamilyMart","スターバックス","スタバ","Starbucks","マクドナルド","McDonald's","すき家","吉野家","松屋","イオン","AEON"],c=t.split(`
`).slice(0,5);for(const g of p){for(const f of c)if(f.includes(g)){s=g,l=90;break}if(l>0)break}if(l===0&&c.length>0){const g=c[0].trim();g.length>0&&g.length<30&&(s=g,l=60)}let d="",b=0;for(const g of a.date){const f=t.match(g);if(f){const w=((te=f[1])==null?void 0:te.length)===2?"20"+f[1]:f[1],M=(se=f[2])==null?void 0:se.padStart(2,"0"),be=(ae=f[3])==null?void 0:ae.padStart(2,"0");d=`${w}-${M}-${be}`,b=85;break}}let N=0,I=0;for(const g of a.totalAmount){const f=t.match(g);if(f){const w=f[1].replace(/,/g,""),M=parseInt(w);if(!isNaN(M)&&M>0){N=M,I=85;break}}}if(N===0){const g=t.match(/[0-9,]+/g);if(g){const f=g.map(w=>parseInt(w.replace(/,/g,""))).filter(w=>!isNaN(w)&&w>0&&w<1e6);f.length>0&&(N=Math.max(...f),I=60)}}let F=10,E=50;const Y=t.match(a.taxRate);Y&&(F=parseInt(Y[1]),E=85);const ee=Math.round((l+b+I+E)/4);return console.log("抽出結果:",{merchant:s,date:d,amount:N,taxRate:F,confidence:ee}),{merchant:s,date:d,amount:N,taxRate:F,category:"未分類",description:"OCRで抽出",confidence:ee,confidenceScores:{merchant:l,date:b,amount:I,taxRate:E}}},J=async t=>{const a=t.target.files;if(a&&a.length>0){const s=a[0],l=new FileReader;l.onload=async p=>{var d;const c=(d=p.target)==null?void 0:d.result;if(c){const b=new Blob([c],{type:s.type});await L(b)}},l.readAsArrayBuffer(s)}},me=()=>{v&&y&&(n(t=>t.map(a=>a.id===v?{...a,...y}:a)),S(null),C({}))},V=async t=>{n(a=>a.map(s=>s.id===t?{...s,status:"approved"}:s)),await ce(t,"approved")},K=async t=>{n(a=>a.map(s=>s.id===t?{...s,status:"rejected"}:s)),await ce(t,"rejected")},he=async()=>{try{const t={id:Date.now().toString(),date:new Date().toISOString().split("T")[0],merchant:"処理中...",amount:0,category:"未分類",description:"解析中...",confidence:0,status:"pending"};n(l=>[t,...l]);const s=W(`セブンイレブン
2024/01/15
レシート番号: 12345
商品名: コピー用紙 ￥1,200
消費税: ￥120
合計: ￥1,320
      
マクドナルド
2024/01/14
商品名: ビッグマックセット ￥680
消費税: ￥68
合計: ￥748`);n(l=>l.map(p=>p.id===t.id?{...p,merchant:s.merchant||"不明",amount:s.amount||0,description:s.description||"OCR処理完了",confidence:s.confidence||80}:p))}catch(t){console.error("OCRテストエラー:",t)}},X=async t=>{n(a=>a.map(s=>s.id===t?{...s,merchant:"処理中...",amount:0,description:"再解析中...",confidence:0}:s)),setTimeout(()=>{n(a=>a.map(s=>s.id===t?{...s,merchant:"ファミリーマート",amount:950,description:"再解析完了",confidence:88}:s))},3e3)},ue=async()=>{if(x.imageData&&x.retryCount<3){h(t=>({...t,retryCount:t.retryCount+1,errorMessage:void 0}));try{const a=await(await fetch(x.imageData)).blob();await L(a)}catch(t){console.error("再試行エラー:",t),h(a=>({...a,errorMessage:"再試行に失敗しました"}))}}},Z=t=>{T(t),$(!0)},Q=m.filter(t=>{const a=t.merchant.toLowerCase().includes(k.toLowerCase())||t.description.toLowerCase().includes(k.toLowerCase()),s=A==="all"||t.status===A,l=u==="all"||t.category===u;return a&&s&&l}),pe=Array.from(new Set(m.map(t=>t.category)));return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&location.protocol!=="https:"&&e.jsx("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(de,{className:"w-5 h-5 text-yellow-500 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"モバイル端末からのアクセスについて"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"現在HTTP環境でアクセスしています。カメラ機能を使用するにはHTTPS環境が必要です。 テスト目的であれば、PCのlocalhost環境（http://localhost:5173）でアクセスしてください。"})]})]})}),e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"レシート処理"}),e.jsx("p",{className:"text-text-muted mt-2",children:"アップロードされたレシートをAIが解析し、自動で仕訳データを作成します"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-xl font-semibold text-text-main mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-primary"}),"レシートアップロード"]}),e.jsx(Ae,{onUpload:J})]}),e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6 shadow-sm",children:[e.jsxs("h2",{className:"text-xl font-semibold text-text-main mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),"最近のアップロード"]}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-background rounded-xl border border-border hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-main",children:"セブンイレブン ジャパン"}),e.jsxs("p",{className:"text-sm text-text-muted",children:["2024年3月",15-t,"日 12:30"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-green-500/10 text-green-500 border border-green-500/20",children:"処理完了"}),e.jsx("button",{className:"p-2 text-text-muted hover:text-primary transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]},t))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-surface border border-border rounded-2xl p-6 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-text-main mb-4",children:"処理ステータス"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-background rounded-xl border border-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-text-muted",children:"今月の処理枚数"}),e.jsx("span",{className:"text-2xl font-bold text-text-main",children:"45枚"})]}),e.jsx("div",{className:"w-full bg-surface-highlight rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:"75%"}})})]}),e.jsxs("div",{className:"p-4 bg-background rounded-xl border border-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-text-muted",children:"AI認識精度"}),e.jsx("span",{className:"text-2xl font-bold text-text-main",children:"98.5%"})]}),e.jsx("div",{className:"w-full bg-surface-highlight rounded-full h-2",children:e.jsx("div",{className:"bg-secondary h-2 rounded-full",style:{width:"98.5%"}})})]}),e.jsxs("div",{className:"p-4 bg-background rounded-xl border border-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-text-muted",children:"削減時間"}),e.jsx("span",{className:"text-2xl font-bold text-text-main",children:"12.5時間"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-500",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"先月比 +2.5時間"})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-secondary/10 border border-primary/20 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-main mb-2",children:"Proプランでさらに便利に"}),e.jsx("p",{className:"text-sm text-text-muted mb-4",children:"月間処理枚数無制限、優先処理、専任サポートなど、ビジネスを加速させる機能をご利用いただけます。"}),e.jsx("button",{className:"w-full py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors shadow-lg shadow-primary/25",children:"プランを確認する"})]})]})]})]}),O&&e.jsx(Me,{onCapture:L,onClose:oe}),ie&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-surface rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"レシート詳細"}),e.jsx("button",{onClick:()=>$(!1),className:"text-text-muted hover:text-text-muted",children:e.jsx(P,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"日付"}),e.jsx("p",{className:"text-text-main",children:r.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"店舗名"}),e.jsx("p",{className:"text-text-main",children:r.merchant})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"金額"}),e.jsxs("p",{className:"text-text-main",children:["¥",r.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"カテゴリ"}),e.jsx("p",{className:"text-text-main",children:r.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"説明"}),e.jsx("p",{className:"text-text-main",children:r.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${r.confidence>=90?"bg-green-500":r.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[r.confidence,"%"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"ステータス"}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${r.status==="approved"?"bg-green-100 text-green-800":r.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:r.status==="approved"?"承認済み":r.status==="rejected"?"却下":"保留中"})]}),r.taxRate!==void 0&&r.taxRate>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"税率"}),e.jsxs("p",{className:"text-text-main",children:[r.taxRate,"%"]})]}),r.confidenceScores&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"信頼度詳細"}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",r.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",r.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",r.confidenceScores.amount||0,"%"]})]})]}),r.aiAnalysis&&e.jsxs("div",{className:"border-t border-border pt-3",children:[e.jsx("h4",{className:"text-sm font-medium text-text-muted mb-2",children:"AI分析結果"}),r.aiAnalysis.category&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"推定カテゴリ"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.category})]}),r.aiAnalysis.expenseType&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"支出種別"}),e.jsx("p",{className:"text-sm text-text-main",children:r.aiAnalysis.expenseType})]}),r.aiAnalysis.confidence!==void 0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"AI信頼度"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${r.aiAnalysis.confidence>=.9?"bg-green-500":r.aiAnalysis.confidence>=.7?"bg-yellow-500":"bg-red-500"}`,style:{width:`${r.aiAnalysis.confidence*100}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[Math.round(r.aiAnalysis.confidence*100),"%"]})]})]}),r.aiAnalysis.insights&&r.aiAnalysis.insights.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"分析インサイト"}),e.jsx("ul",{className:"list-disc pl-4 space-y-1 mt-1",children:r.aiAnalysis.insights.map((t,a)=>e.jsx("li",{className:"text-xs text-text-muted",children:t},a))})]}),r.aiAnalysis.items&&r.aiAnalysis.items.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-text-muted",children:"商品アイテム"}),e.jsx("div",{className:"mt-1 space-y-1",children:r.aiAnalysis.items.map((t,a)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-text-muted",children:t.name}),e.jsxs("span",{className:"text-text-main",children:["¥",t.price.toLocaleString()]})]},a))})]})]})]})}),e.jsx("div",{className:"p-4 border-t border-border flex justify-end space-x-2",children:e.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 bg-border text-text-main rounded-md hover:bg-gray-300 transition-colors",children:"閉じる"})})]})}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"レシートをアップロード"}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:H,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors",children:[e.jsx(ne,{className:"w-5 h-5"}),"カメラでレシートを撮影"]})}),x.isProcessing&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-500 animate-spin mr-2"}),e.jsx("span",{className:"text-blue-700 font-medium",children:"レシートを処理中です..."})]}),x.currentStep&&e.jsxs("div",{className:"text-sm text-primary mb-2",children:["処理ステップ: ",x.currentStep]}),x.progress!==void 0&&e.jsx("div",{className:"w-full bg-border rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${x.progress}%`}})})]}),x.errorMessage&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md flex items-center",children:[e.jsx(de,{className:"w-5 h-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700",children:x.errorMessage}),x.retryCount<3&&e.jsx("button",{onClick:ue,className:"ml-4 px-3 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors text-sm",children:"再試行"})]}),e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[e.jsx("button",{onClick:addSampleReceipts,className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors text-sm w-full sm:w-auto",children:"サンプルレシートを追加（テスト用）"}),e.jsx("button",{onClick:he,className:"px-4 py-2 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors text-sm w-full sm:w-auto",children:"OCRテストを実行（サンプル画像）"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-purple-400 hover:bg-purple-50 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:J,className:"hidden"}),e.jsx(z,{className:"w-8 h-8 text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-muted",children:"ファイルを選択"}),e.jsx("p",{className:"text-xs text-text-muted",children:"PNG, JPG, PDF対応"})]}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-purple-400 hover:bg-purple-50 transition-colors",onClick:H,children:[e.jsx(ne,{className:"w-8 h-8 text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-muted",children:"カメラで撮影"}),e.jsx("p",{className:"text-xs text-text-muted",children:"その場で撮影"})]}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[e.jsx(Se,{className:"w-8 h-8 text-text-muted mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-text-muted",children:"ドラッグ&ドロップ"}),e.jsx("p",{className:"text-xs text-text-muted",children:"ここに画像をドロップ"})]})]})]}),e.jsx("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-text-muted w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"店舗名や説明で検索...",className:"w-full pl-10 pr-4 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary",value:k,onChange:t=>D(t.target.value)})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("select",{className:"px-3 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary w-full sm:w-auto",value:A,onChange:t=>_(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのステータス"}),e.jsx("option",{value:"pending",children:"保留中"}),e.jsx("option",{value:"approved",children:"承認済み"}),e.jsx("option",{value:"rejected",children:"却下"})]}),e.jsxs("select",{className:"px-3 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary w-full sm:w-auto",value:u,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"all",children:"すべてのカテゴリ"}),pe.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})}),e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsx("h2",{className:"text-lg font-semibold",children:"処理済みレシート"})}),e.jsx("div",{className:"md:hidden p-4 space-y-4",children:Q.map(t=>e.jsxs("div",{className:"border border-border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-main",children:t.merchant}),e.jsx("p",{className:"text-sm text-text-muted",children:t.date})]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認":t.status==="rejected"?"却下":"保留"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-lg font-semibold text-text-main",children:["¥",t.amount.toLocaleString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-1.5 mr-2",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-text-muted",children:t.category}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>Z(t),className:"text-primary hover:text-blue-900",children:e.jsx(le,{className:"w-4 h-4"})}),t.merchant==="解析エラー"&&e.jsx("button",{onClick:()=>X(t.id),className:"text-orange-600 hover:text-orange-900",title:"再試行",children:e.jsx(q,{className:"w-4 h-4"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t.id),className:"text-green-600 hover:text-green-900",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>K(t.id),className:"text-red-600 hover:text-red-900",children:e.jsx(P,{className:"w-4 h-4"})})]})]})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-background",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"日付"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"店舗名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"金額"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"カテゴリ"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"説明"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"信頼度"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"ステータス"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-muted uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-surface divide-y divide-gray-200",children:Q.map(t=>e.jsxs("tr",{className:"hover:bg-background",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:v===t.id?e.jsx("input",{type:"date",value:y.date||t.date,onChange:a=>C(s=>({...s,date:a.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:v===t.id?e.jsx("input",{type:"text",value:y.merchant||t.merchant,onChange:a=>C(s=>({...s,merchant:a.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):t.merchant}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:v===t.id?e.jsx("input",{type:"number",value:y.amount||t.amount,onChange:a=>C(s=>({...s,amount:Number(a.target.value)})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):`¥${t.amount.toLocaleString()}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-main",children:v===t.id?e.jsxs("select",{value:y.category||t.category,onChange:a=>C(s=>({...s,category:a.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm",children:[e.jsx("option",{value:"消耗品費",children:"消耗品費"}),e.jsx("option",{value:"接待交際費",children:"接待交際費"}),e.jsx("option",{value:"旅費交通費",children:"旅費交通費"}),e.jsx("option",{value:"通信費",children:"通信費"}),e.jsx("option",{value:"水道光熱費",children:"水道光熱費"})]}):t.category}),e.jsx("td",{className:"px-6 py-4 text-sm text-text-main max-w-xs truncate",children:v===t.id?e.jsx("input",{type:"text",value:y.description||t.description,onChange:a=>C(s=>({...s,description:a.target.value})),className:"w-full px-2 py-1 border border-border rounded text-sm"}):e.jsxs("div",{children:[e.jsx("div",{children:t.description}),t.taxRate!==void 0&&t.taxRate>0&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:["税率: ",t.taxRate,"%"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 bg-border rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.confidence>=90?"bg-green-500":t.confidence>=70?"bg-yellow-500":"bg-red-500"}`,style:{width:`${t.confidence}%`}})}),e.jsxs("span",{className:"text-xs text-text-muted",children:[t.confidence,"%"]})]}),t.confidenceScores&&e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[e.jsxs("div",{children:["店舗: ",t.confidenceScores.merchant||0,"%"]}),e.jsxs("div",{children:["日付: ",t.confidenceScores.date||0,"%"]}),e.jsxs("div",{children:["金額: ",t.confidenceScores.amount||0,"%"]})]}),t.aiAnalysis&&t.aiAnalysis.confidence!==void 0&&e.jsx("div",{className:"text-xs text-text-muted mt-1",children:e.jsxs("div",{children:["AI信頼度: ",Math.round(t.aiAnalysis.confidence*100),"%"]})})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.status==="approved"?"承認済み":t.status==="rejected"?"却下":"保留中"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("div",{className:"flex space-x-2",children:v===t.id?e.jsx("button",{onClick:me,className:"text-green-600 hover:text-green-900",children:e.jsx(we,{className:"w-4 h-4"})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Z(t),className:"text-primary hover:text-blue-900",children:e.jsx(le,{className:"w-4 h-4"})}),t.merchant==="解析エラー"&&e.jsx("button",{onClick:()=>X(t.id),className:"text-orange-600 hover:text-orange-900",title:"再試行",children:e.jsx(q,{className:"w-4 h-4"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(t.id),className:"text-green-600 hover:text-green-900",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>K(t.id),className:"text-red-600 hover:text-red-900",children:e.jsx(P,{className:"w-4 h-4"})})]})]})})})]},t.id))})]})})]})]})})};export{ze as default};
