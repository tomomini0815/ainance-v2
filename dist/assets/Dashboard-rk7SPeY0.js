const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RevenueChart-DGLQcWHb.js","assets/index-B-if9VQJ.js","assets/index-B5Dz48T1.css","assets/index-Dzq28UKu.js","assets/ExpenseChart-COO2nVY6.js","assets/TransactionTable-BMB8jdh2.js","assets/trending-up-ImEnoBKX.js","assets/trending-down-vR-EKlYd.js","assets/AITransactionTable-D5QCurrs.js","assets/brain-DpYqCMWW.js","assets/circle-check-big-Bu7tQ_Co.js","assets/circle-alert-BJ_sZxfB.js","assets/TransactionForm-DFgKG8ln.js","assets/star-CrMDy7ES.js","assets/calendar-BjnVQe_3.js","assets/zap-CUJ10RwA.js"])))=>i.map(i=>d[i]);
import{c as k,j as e,F as w,L as _,r as t,s as N,a as T,b as A,P as S,R as h,_ as b}from"./index-B-if9VQJ.js";import{C as L,B as E}from"./calculator-CZggMjT1.js";import{C as I}from"./camera-BgrSI000.js";import{u as O}from"./useMySQLTransactions-CvUW-1qb.js";import{D as R}from"./download-2FUm49l-.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],F=k("chart-no-axes-column",$);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],P=k("link",M),V=()=>{const i=[{title:"CHAT-TO-BOOK",description:"音声で取引を記録",icon:L,link:"/chat-to-book",color:"bg-purple-500/20",iconColor:"text-purple-400",borderColor:"border-purple-500/30"},{title:"レシート処理",description:"レシートをスキャン",icon:I,link:"/receipt-processing",color:"bg-emerald-500/20",iconColor:"text-emerald-400",borderColor:"border-emerald-500/30"},{title:"請求書作成",description:"新しい請求書を作成",icon:w,link:"/invoice-creation",color:"bg-blue-500/20",iconColor:"text-blue-400",borderColor:"border-blue-500/30"},{title:"取引履歴",description:"すべての取引を確認",icon:F,link:"/transaction-history",color:"bg-amber-500/20",iconColor:"text-amber-400",borderColor:"border-amber-500/30"},{title:"申告サポート",description:"税務申告の準備",icon:E,link:"/tax-filing-support",color:"bg-rose-500/20",iconColor:"text-rose-400",borderColor:"border-rose-500/30"},{title:"連携設定",description:"外部サービス連携",icon:P,link:"/integration-settings",color:"bg-indigo-500/20",iconColor:"text-indigo-400",borderColor:"border-indigo-500/30"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:i.map((s,g)=>e.jsx(_,{to:s.link,className:"glass-card rounded-xl p-4 hover:bg-surface-highlight transition-all duration-300 group border border-white/5 hover:border-white/10 hover:-translate-y-1",children:e.jsxs("div",{className:"flex flex-col items-center text-center h-full",children:[e.jsx("div",{className:`w-12 h-12 ${s.color} rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300 border ${s.borderColor}`,children:e.jsx(s.icon,{className:`w-6 h-6 ${s.iconColor}`})}),e.jsx("h3",{className:"font-medium text-text-main mb-1 text-sm",children:s.title}),e.jsx("p",{className:"text-xs text-text-muted leading-relaxed",children:s.description})]})},g))})},D=()=>{const[i,s]=t.useState([]),[g,f]=t.useState(!1),m=t.useCallback(()=>(f(!0),N.from("ai_transactions").select("*").order("created_at",{ascending:!1}).then(({data:r,error:o})=>{o?(console.error(`AI取引データの取得に失敗しました: ${o.message}`),s([])):s(r||[]),f(!1)}),()=>{}),[]),y=async(r,o,x)=>{try{const{data:c,error:j}=await N.from("ai_transactions").update({manual_verified:o,learning_feedback:x,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(j)throw j;console.log(o?"AI分類を承認しました":"AI分類を却下しました"),s(v=>v.map(u=>u.id===r?{...u,manual_verified:o}:u))}catch(c){throw console.error("AI取引の確認に失敗しました:",c),c}};return t.useEffect(()=>{const r=m();return()=>{r&&r()}},[m]),{aiTransactions:i,loading:g,fetchAITransactions:m,verifyAITransaction:y}},z=h.lazy(()=>b(()=>import("./RevenueChart-DGLQcWHb.js"),__vite__mapDeps([0,1,2,3]))),B=h.lazy(()=>b(()=>import("./ExpenseChart-COO2nVY6.js"),__vite__mapDeps([4,1,2,3]))),q=h.lazy(()=>b(()=>import("./TransactionTable-BMB8jdh2.js"),__vite__mapDeps([5,1,2,6,7]))),Q=h.lazy(()=>b(()=>import("./AITransactionTable-D5QCurrs.js"),__vite__mapDeps([8,1,2,9,10,11]))),U=h.lazy(()=>b(()=>import("./TransactionForm-DFgKG8ln.js"),__vite__mapDeps([12,1,2,13,14,15,7,6]))),X=()=>{const{currentBusinessType:i}=T(),{transactions:s,createTransaction:g}=O(i==null?void 0:i.id),{aiTransactions:f,loading:m}=D(),[y,r]=t.useState(!1),{isAuthenticated:o,user:x,loading:c}=A();t.useEffect(()=>{const a=()=>r(!0);return window.addEventListener("openCreateTransactionModal",a),()=>{window.removeEventListener("openCreateTransactionModal",a)}},[]);const j=()=>e.jsxs("div",{className:"min-h-screen animate-pulse",children:[e.jsxs("div",{className:"p-4 bg-red-500 text-white text-center mb-4",children:[e.jsx("p",{children:"ダッシュボードのローディング中..."}),e.jsxs("p",{children:["authLoading: ",c?"true":"false"]}),e.jsxs("p",{children:["isAuthenticated: ",o?"true":"false"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),e.jsx("div",{className:"h-4 w-64 bg-gray-200 dark:bg-gray-700 rounded"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 dark:bg-gray-700 rounded"})]})]}),e.jsx("div",{className:"h-24 w-full bg-gray-200 dark:bg-gray-700 rounded-xl mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-80 bg-gray-200 dark:bg-gray-700 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"}),e.jsx("div",{className:"h-96 bg-gray-200 dark:bg-gray-700 rounded-xl"})]})]});if(c)return console.log("ダッシュボードをスケルトンローディングで表示中 - authLoading:",c),e.jsx(j,{});const v=a=>{const n=["日付","説明","金額","カテゴリ","タイプ","ステータス"],p=a.map(l=>[l.date,`"${l.description}"`,l.amount.toString(),`"${l.category}"`,l.type,l.status]);return[n.join(","),...p.map(l=>l.join(","))].join(`
`)},u=()=>{const a=v(s),n=new Blob(["\uFEFF",a],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(n),d=document.createElement("a");d.setAttribute("href",p),d.setAttribute("download",`取引データ_${new Date().toISOString().split("T")[0]}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},C=async a=>{try{console.log("取引作成を開始:",a),x&&x.id&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(x.id)?a.creator=x.id:a.creator="00000000-0000-0000-0000-000000000000",console.log("creator IDを設定:",a.creator);const n=await g(a);console.log("取引作成成功:",n),r(!1)}catch(n){console.error("取引の作成に失敗:",n),alert(`取引の作成に失敗しました: ${n.message||"もう一度お試しください。"}`)}};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-text-main tracking-tight",children:"ダッシュボード"}),e.jsx("p",{className:"text-text-muted mt-1",children:"財務状況の概要と最近の活動"})]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:u,disabled:s.length===0,className:`btn-secondary flex-1 sm:flex-none flex items-center justify-center ${s.length===0?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"CSV出力"]}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex-1 sm:flex-none flex items-center justify-center",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"新規取引"]})]})]}),e.jsx(V,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(z,{transactions:s})}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-80 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(B,{transactions:s})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(q,{transactions:s,onOpenCreateModal:()=>r(!0),showCreateButton:!1})}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(Q,{aiTransactions:f,loading:m})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-surface border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:e.jsx("div",{className:"p-6",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"h-96 bg-gray-100 dark:bg-gray-800 rounded-xl flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"読み込み中..."})}),children:e.jsx(U,{onSubmit:C,onCancel:()=>r(!1)})})})})})]})};export{X as default};
