import{K as c}from"./index-Dp8kLXFF.js";const p={async getByYear(e,a,t){const{data:i,error:s}=await c.from("yearly_balance_sheets").select("*").eq("user_id",e).eq("business_type",a).eq("year",t).single();if(s){if(s.code==="PGRST116")return null;throw console.error("getYearlyBalanceSheet Error:",s),s}return i},async getAllByBusinessType(e,a){const{data:t,error:i}=await c.from("yearly_balance_sheets").select("*").eq("user_id",e).eq("business_type",a).order("year",{ascending:!1});if(i)throw console.error("getAllYearlyBalanceSheets Error:",i),i;return t||[]},async save(e){console.log("--- yearlyBalanceSheetService.save Start ---",e);const{data:a,error:t}=await c.from("yearly_balance_sheets").upsert({...e,updated_at:new Date().toISOString()},{onConflict:"user_id,business_type,year"}).select().single();if(t)throw console.error("saveYearlyBalanceSheet Error Full:",t),console.error("Error Details:",t.details),console.error("Error Hint:",t.hint),console.error("Error Code:",t.code),t;return console.log("saveYearlyBalanceSheet Success:",a),a},mapAiResultToBS(e,a,t,i={}){console.log("--- BS Result Mapping Start ---");const s=o=>{if(o==null||o==="")return 0;if(typeof o=="number")return o;let r=String(o).replace(/[$,¥円\s,()]/g,""),_=!1;(r.startsWith("△")||r.startsWith("▲")||r.startsWith("-"))&&(_=!0,r=r.substring(1));let l=1;r.includes("千万")?l=1e7:r.includes("百万")?l=1e6:r.includes("千")?l=1e3:r.includes("万")&&(l=1e4);const u=parseFloat(r.replace(/[千万万円]/g,"")),y=isNaN(u)?0:u*l;return Math.floor(_?-y:y)},n=o=>{if(!(!e||typeof e!="object"))for(const r of o){if(e[r]!==void 0&&e[r]!==null)return e[r];const _=r.toLowerCase(),l=Object.keys(e).find(u=>u.toLowerCase()===_);if(l)return e[l]}},d={user_id:a,business_type:t,year:s(n(["year","年度","決算年度"]))||new Date().getFullYear()-1,assets_current_cash:s(n(["assets_current_cash","現金及び預金","現金預金"])),assets_current_total:s(n(["assets_current_total","流動資産合計"])),assets_total:s(n(["assets_total","資産の部合計","資産合計"])),liabilities_total:s(n(["liabilities_total","負債の部合計","負債合計"])),net_assets_capital:s(n(["net_assets_capital","資本金"])),net_assets_retained_earnings:s(n(["net_assets_retained_earnings","繰越利益剰余金"])),net_assets_retained_earnings_total:s(n(["net_assets_retained_earnings_total","利益剰余金合計","その他利益剰余金合計"])),net_assets_shareholders_equity:s(n(["net_assets_shareholders_equity","株主資本合計"])),net_assets_total:s(n(["net_assets_total","純資産の部合計","純資産合計"])),liabilities_and_net_assets_total:s(n(["liabilities_and_net_assets_total","負債及び純資産の部合計","負債純資産合計"])),status:"draft",metadata:{...i,confidence:e.confidence}};return console.log("Mapped BS Data:",d),d},async updateStatus(e,a){const{error:t}=await c.from("yearly_balance_sheets").update({status:a,updated_at:new Date().toISOString()}).eq("id",e);if(t)throw console.error("updateStatus BS Error:",t),t},async delete(e){const{error:a}=await c.from("yearly_balance_sheets").delete().eq("id",e);if(a)throw console.error("deleteYearlyBS Error:",a),a}};export{p as y};
